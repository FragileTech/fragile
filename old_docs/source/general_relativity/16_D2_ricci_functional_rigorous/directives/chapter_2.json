{
  "chapter_index": 2,
  "section_id": "## 2. Emergent Metric from Density",
  "directive_count": 3,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-ot-metric",
      "title": "Optimal Transport Induced Metric",
      "start_line": 136,
      "end_line": 151,
      "header_lines": [
        137
      ],
      "content_start": 139,
      "content_end": 150,
      "content": "139: :label: def-ot-metric\n140: \n141: Given a density $\\rho(x)$ on $\\Omega$ and a reference density $\\rho_0$ (e.g., uniform), the optimal transport map $T = \\nabla \\phi$ from $\\rho_0$ to $\\rho$ induces a metric:\n142: \n143: $$\n144: g_{ij}^{\\text{OT}}(x) := \\nabla^2_{ij} \\phi(x)\n145: $$\n146: \n147: where $\\phi$ satisfies the Monge-Amp\u00e8re equation:\n148: \n149: $$\n150: \\det(\\nabla^2 \\phi) = \\frac{\\rho_0}{\\rho \\circ \\nabla \\phi}",
      "metadata": {
        "label": "def-ot-metric"
      },
      "section": "## 2. Emergent Metric from Density",
      "references": [],
      "raw_directive": "136: ### 2.1 Optimal Transport Metric\n137: \n138: :::{prf:definition} Optimal Transport Induced Metric\n139: :label: def-ot-metric\n140: \n141: Given a density $\\rho(x)$ on $\\Omega$ and a reference density $\\rho_0$ (e.g., uniform), the optimal transport map $T = \\nabla \\phi$ from $\\rho_0$ to $\\rho$ induces a metric:\n142: \n143: $$\n144: g_{ij}^{\\text{OT}}(x) := \\nabla^2_{ij} \\phi(x)\n145: $$\n146: \n147: where $\\phi$ satisfies the Monge-Amp\u00e8re equation:\n148: \n149: $$\n150: \\det(\\nabla^2 \\phi) = \\frac{\\rho_0}{\\rho \\circ \\nabla \\phi}\n151: $$"
    },
    {
      "directive_type": "proposition",
      "label": "prop-cvt-encodes-metric",
      "title": "CVT Encodes Optimal Transport Metric",
      "start_line": 159,
      "end_line": 194,
      "header_lines": [
        160
      ],
      "content_start": 162,
      "content_end": 193,
      "content": "162: :label: prop-cvt-encodes-metric\n163: \n164: Let $\\{x_i\\}_{i=1}^N$ be a CVT for density $\\rho$ with $N$ generators. Define the **discrete second fundamental form**:\n165: \n166: $$\n167: H_{ij}^{\\text{CVT}}(x_i) := \\frac{1}{|\\mathcal{V}_i|} \\int_{\\mathcal{V}_i} (x - x_i)_i (x - x_i)_j \\rho(x) \\, dx\n168: $$\n169: \n170: This is the covariance matrix of points in cell $\\mathcal{V}_i$ weighted by $\\rho$.\n171: \n172: Then as $N \\to \\infty$:\n173: \n174: $$\n175: H_{ij}^{\\text{CVT}}(x) \\to c \\cdot g_{ij}^{\\text{OT}}(x) + O(N^{-1/d})\n176: $$\n177: \n178: for a constant $c > 0$ depending on dimension $d$.\n179: \n180: **Proof Sketch**:\n181: \n182: The CVT generators $\\{x_i\\}$ approximate the optimal transport map via the discrete measure:\n183: \n184: $$\n185: \\rho_{\\text{empirical}} = \\frac{1}{N}\\sum_{i=1}^N \\delta_{x_i}\n186: $$\n187: \n188: The second moment matrix $H^{\\text{CVT}}$ measures the local distortion of the Voronoi cells, which in the continuum limit equals the Hessian of the transport potential:\n189: \n190: $$\n191: H^{\\text{CVT}} \\approx \\nabla^2 \\phi = g^{\\text{OT}}\n192: $$\n193: ",
      "metadata": {
        "label": "prop-cvt-encodes-metric"
      },
      "section": "## 2. Emergent Metric from Density",
      "references": [],
      "raw_directive": "159: The CVT tessellation encodes a **discrete approximation** to this optimal transport metric.\n160: \n161: :::{prf:proposition} CVT Encodes Optimal Transport Metric\n162: :label: prop-cvt-encodes-metric\n163: \n164: Let $\\{x_i\\}_{i=1}^N$ be a CVT for density $\\rho$ with $N$ generators. Define the **discrete second fundamental form**:\n165: \n166: $$\n167: H_{ij}^{\\text{CVT}}(x_i) := \\frac{1}{|\\mathcal{V}_i|} \\int_{\\mathcal{V}_i} (x - x_i)_i (x - x_i)_j \\rho(x) \\, dx\n168: $$\n169: \n170: This is the covariance matrix of points in cell $\\mathcal{V}_i$ weighted by $\\rho$.\n171: \n172: Then as $N \\to \\infty$:\n173: \n174: $$\n175: H_{ij}^{\\text{CVT}}(x) \\to c \\cdot g_{ij}^{\\text{OT}}(x) + O(N^{-1/d})\n176: $$\n177: \n178: for a constant $c > 0$ depending on dimension $d$.\n179: \n180: **Proof Sketch**:\n181: \n182: The CVT generators $\\{x_i\\}$ approximate the optimal transport map via the discrete measure:\n183: \n184: $$\n185: \\rho_{\\text{empirical}} = \\frac{1}{N}\\sum_{i=1}^N \\delta_{x_i}\n186: $$\n187: \n188: The second moment matrix $H^{\\text{CVT}}$ measures the local distortion of the Voronoi cells, which in the continuum limit equals the Hessian of the transport potential:\n189: \n190: $$\n191: H^{\\text{CVT}} \\approx \\nabla^2 \\phi = g^{\\text{OT}}\n192: $$\n193: \n194: The connection to Wasserstein geometry arises because CVT minimizes the same quantization functional (sum of squared distances weighted by $\\rho$) that defines the discrete Wasserstein distance. Rigorous bounds follow from CVT convergence theory (Du et al., 1999) and optimal transport regularity (Caffarelli, 1990)."
    },
    {
      "directive_type": "lemma",
      "label": "lem-emergent-equals-ot",
      "title": "Emergent Metric = Optimal Transport Metric (Rigorous)",
      "start_line": 222,
      "end_line": 345,
      "header_lines": [
        223
      ],
      "content_start": 225,
      "content_end": 344,
      "content": "225: :label: lem-emergent-equals-ot\n226: \n227: At the quasi-stationary distribution, the emergent metric from expected Hessian equals the optimal transport metric from CVT geometry:\n228: \n229: $$\n230: g_{ij}^{\\text{emergent}}[\\rho_t](x) = c_T \\cdot g_{ij}^{\\text{OT}}[\\rho_t](x) + \\varepsilon \\delta_{ij} + O(N^{-1/d})\n231: $$\n232: \n233: where $c_T = k_B T$ is a constant proportionality factor.\n234: \n235: **Rigorous Proof**:\n236: \n237: We establish this through a **variational characterization** showing both metrics arise from the same energy functional.\n238: \n239: **Step 1: QSD as Free Energy Minimizer**\n240: \n241: From Chapter 4 (QSD convergence theory), the quasi-stationary distribution $\\mu_{\\text{QSD}}$ minimizes the **free energy functional**:\n242: \n243: $$\n244: \\mathcal{F}[\\mu] = \\int_{\\mathcal{X} \\times \\mathcal{V}} \\left[U(x) + \\frac{1}{2}m\\|v\\|^2 + k_B T \\log \\mu(x,v)\\right] \\mu(x,v) \\, dx dv\n245: $$\n246: \n247: subject to normalization $\\int \\mu = 1$ and boundary conditions.\n248: \n249: At equilibrium, integrating over velocity yields the spatial free energy:\n250: \n251: $$\n252: \\mathcal{F}_{\\text{spatial}}[\\rho] = \\int_{\\mathcal{X}} \\left[U(x) + k_B T \\rho(x) \\log \\rho(x)\\right] \\rho(x) \\, dx\n253: $$\n254: \n255: where $\\rho(x) = \\int \\mu(x,v) dv$ is the spatial density.\n256: \n257: **Step 2: Fitness Potential from Free Energy**\n258: \n259: The fitness potential $\\Psi(x)$ is defined as the effective potential at QSD. From the free energy:\n260: \n261: $$\n262: \\frac{\\delta \\mathcal{F}_{\\text{spatial}}}{\\delta \\rho(x)} = U(x) + k_B T(\\log \\rho(x) + 1) = \\text{const}\n263: $$\n264: \n265: at equilibrium. This gives:\n266: \n267: $$\n268: \\rho_{\\text{QSD}}(x) \\propto \\exp\\left(-\\frac{U(x)}{k_B T}\\right)\n269: $$\n270: \n271: Define the **effective potential**:\n272: \n273: $$\n274: \\Psi_{\\text{eff}}(x) := U(x) = -k_B T \\log \\rho_{\\text{QSD}}(x) + \\text{const}\n275: $$\n276: \n277: **Step 3: Expected Hessian from Effective Potential**\n278: \n279: The emergent metric Hessian is (Chapter 8):\n280: \n281: $$\n282: H_{ij}[\\mu_t](x) = \\mathbb{E}_{x' \\sim \\rho_t, \\,\\|x'-x\\| < \\delta}\\left[\\frac{\\partial^2 \\Psi_{\\text{eff}}}{\\partial x^i \\partial x^j}\\bigg|_{x'}\\right]\n283: $$\n284: \n285: For smooth $\\rho_t$ and small $\\delta$, this becomes:\n286: \n287: $$\n288: H_{ij}(x) \\approx \\frac{\\partial^2 \\Psi_{\\text{eff}}}{\\partial x^i \\partial x^j}(x) = -k_B T \\frac{\\partial^2}{\\partial x^i \\partial x^j} \\log \\rho_t(x)\n289: $$\n290: \n291: **Step 4: Optimal Transport Metric from Wasserstein Geometry**\n292: \n293: Consider the optimal transport from a reference measure $\\rho_0 = \\text{const}$ to $\\rho_t$. The transport potential $\\phi$ satisfies the **Monge-Amp\u00e8re equation**:\n294: \n295: $$\n296: \\det(\\nabla^2 \\phi) = \\frac{\\rho_0}{\\rho_t \\circ \\nabla \\phi}\n297: $$\n298: \n299: with transport map $T = \\nabla \\phi$.\n300: \n301: **Key identity** (from optimal transport theory, Villani 2009, Theorem 12.49): The optimal transport potential $\\phi$ and the density $\\rho_t$ satisfy:\n302: \n303: $$\n304: \\phi(x) = -\\int_{x_0}^x \\nabla V_{\\text{KL}}(x') \\cdot dx'\n305: $$\n306: \n307: where $V_{\\text{KL}}(x)$ is the **Kullback-Leibler potential**:\n308: \n309: $$\n310: V_{\\text{KL}}(x) = k_B T \\log \\rho_t(x) + \\text{const}\n311: $$\n312: \n313: Therefore:\n314: \n315: $$\n316: \\nabla^2 \\phi(x) = -\\nabla^2 V_{\\text{KL}}(x) = -k_B T \\nabla^2 \\log \\rho_t(x)\n317: $$\n318: \n319: The optimal transport metric is:\n320: \n321: $$\n322: g_{ij}^{\\text{OT}} := \\nabla^2_{ij} \\phi = -k_B T \\frac{\\partial^2}{\\partial x^i \\partial x^j} \\log \\rho_t\n323: $$\n324: \n325: **Step 5: Comparison**\n326: \n327: From Steps 3 and 4:\n328: \n329: $$\n330: H_{ij}[\\mu_t](x) = -k_B T \\frac{\\partial^2 \\log \\rho_t}{\\partial x^i \\partial x^j} = g_{ij}^{\\text{OT}}(x)\n331: $$\n332: \n333: Therefore:\n334: \n335: $$\n336: g_{ij}^{\\text{emergent}} = H_{ij} + \\varepsilon \\delta_{ij} = g_{ij}^{\\text{OT}} + \\varepsilon \\delta_{ij}\n337: $$\n338: \n339: Combined with CVT convergence ({prf:ref}`prop-cvt-encodes-metric`), which gives $g^{\\text{CVT}} = g^{\\text{OT}} + O(N^{-1/d})$:\n340: \n341: $$\n342: \\boxed{g_{ij}^{\\text{emergent}}[\\rho_t] = g_{ij}^{\\text{OT}}[\\rho_t] + \\varepsilon \\delta_{ij} + O(N^{-1/d})}\n343: $$\n344: ",
      "metadata": {
        "label": "lem-emergent-equals-ot"
      },
      "section": "## 2. Emergent Metric from Density",
      "references": [
        "prop-cvt-encodes-metric"
      ],
      "raw_directive": "222: $$\n223: \n224: :::{prf:lemma} Emergent Metric = Optimal Transport Metric (Rigorous)\n225: :label: lem-emergent-equals-ot\n226: \n227: At the quasi-stationary distribution, the emergent metric from expected Hessian equals the optimal transport metric from CVT geometry:\n228: \n229: $$\n230: g_{ij}^{\\text{emergent}}[\\rho_t](x) = c_T \\cdot g_{ij}^{\\text{OT}}[\\rho_t](x) + \\varepsilon \\delta_{ij} + O(N^{-1/d})\n231: $$\n232: \n233: where $c_T = k_B T$ is a constant proportionality factor.\n234: \n235: **Rigorous Proof**:\n236: \n237: We establish this through a **variational characterization** showing both metrics arise from the same energy functional.\n238: \n239: **Step 1: QSD as Free Energy Minimizer**\n240: \n241: From Chapter 4 (QSD convergence theory), the quasi-stationary distribution $\\mu_{\\text{QSD}}$ minimizes the **free energy functional**:\n242: \n243: $$\n244: \\mathcal{F}[\\mu] = \\int_{\\mathcal{X} \\times \\mathcal{V}} \\left[U(x) + \\frac{1}{2}m\\|v\\|^2 + k_B T \\log \\mu(x,v)\\right] \\mu(x,v) \\, dx dv\n245: $$\n246: \n247: subject to normalization $\\int \\mu = 1$ and boundary conditions.\n248: \n249: At equilibrium, integrating over velocity yields the spatial free energy:\n250: \n251: $$\n252: \\mathcal{F}_{\\text{spatial}}[\\rho] = \\int_{\\mathcal{X}} \\left[U(x) + k_B T \\rho(x) \\log \\rho(x)\\right] \\rho(x) \\, dx\n253: $$\n254: \n255: where $\\rho(x) = \\int \\mu(x,v) dv$ is the spatial density.\n256: \n257: **Step 2: Fitness Potential from Free Energy**\n258: \n259: The fitness potential $\\Psi(x)$ is defined as the effective potential at QSD. From the free energy:\n260: \n261: $$\n262: \\frac{\\delta \\mathcal{F}_{\\text{spatial}}}{\\delta \\rho(x)} = U(x) + k_B T(\\log \\rho(x) + 1) = \\text{const}\n263: $$\n264: \n265: at equilibrium. This gives:\n266: \n267: $$\n268: \\rho_{\\text{QSD}}(x) \\propto \\exp\\left(-\\frac{U(x)}{k_B T}\\right)\n269: $$\n270: \n271: Define the **effective potential**:\n272: \n273: $$\n274: \\Psi_{\\text{eff}}(x) := U(x) = -k_B T \\log \\rho_{\\text{QSD}}(x) + \\text{const}\n275: $$\n276: \n277: **Step 3: Expected Hessian from Effective Potential**\n278: \n279: The emergent metric Hessian is (Chapter 8):\n280: \n281: $$\n282: H_{ij}[\\mu_t](x) = \\mathbb{E}_{x' \\sim \\rho_t, \\,\\|x'-x\\| < \\delta}\\left[\\frac{\\partial^2 \\Psi_{\\text{eff}}}{\\partial x^i \\partial x^j}\\bigg|_{x'}\\right]\n283: $$\n284: \n285: For smooth $\\rho_t$ and small $\\delta$, this becomes:\n286: \n287: $$\n288: H_{ij}(x) \\approx \\frac{\\partial^2 \\Psi_{\\text{eff}}}{\\partial x^i \\partial x^j}(x) = -k_B T \\frac{\\partial^2}{\\partial x^i \\partial x^j} \\log \\rho_t(x)\n289: $$\n290: \n291: **Step 4: Optimal Transport Metric from Wasserstein Geometry**\n292: \n293: Consider the optimal transport from a reference measure $\\rho_0 = \\text{const}$ to $\\rho_t$. The transport potential $\\phi$ satisfies the **Monge-Amp\u00e8re equation**:\n294: \n295: $$\n296: \\det(\\nabla^2 \\phi) = \\frac{\\rho_0}{\\rho_t \\circ \\nabla \\phi}\n297: $$\n298: \n299: with transport map $T = \\nabla \\phi$.\n300: \n301: **Key identity** (from optimal transport theory, Villani 2009, Theorem 12.49): The optimal transport potential $\\phi$ and the density $\\rho_t$ satisfy:\n302: \n303: $$\n304: \\phi(x) = -\\int_{x_0}^x \\nabla V_{\\text{KL}}(x') \\cdot dx'\n305: $$\n306: \n307: where $V_{\\text{KL}}(x)$ is the **Kullback-Leibler potential**:\n308: \n309: $$\n310: V_{\\text{KL}}(x) = k_B T \\log \\rho_t(x) + \\text{const}\n311: $$\n312: \n313: Therefore:\n314: \n315: $$\n316: \\nabla^2 \\phi(x) = -\\nabla^2 V_{\\text{KL}}(x) = -k_B T \\nabla^2 \\log \\rho_t(x)\n317: $$\n318: \n319: The optimal transport metric is:\n320: \n321: $$\n322: g_{ij}^{\\text{OT}} := \\nabla^2_{ij} \\phi = -k_B T \\frac{\\partial^2}{\\partial x^i \\partial x^j} \\log \\rho_t\n323: $$\n324: \n325: **Step 5: Comparison**\n326: \n327: From Steps 3 and 4:\n328: \n329: $$\n330: H_{ij}[\\mu_t](x) = -k_B T \\frac{\\partial^2 \\log \\rho_t}{\\partial x^i \\partial x^j} = g_{ij}^{\\text{OT}}(x)\n331: $$\n332: \n333: Therefore:\n334: \n335: $$\n336: g_{ij}^{\\text{emergent}} = H_{ij} + \\varepsilon \\delta_{ij} = g_{ij}^{\\text{OT}} + \\varepsilon \\delta_{ij}\n337: $$\n338: \n339: Combined with CVT convergence ({prf:ref}`prop-cvt-encodes-metric`), which gives $g^{\\text{CVT}} = g^{\\text{OT}} + O(N^{-1/d})$:\n340: \n341: $$\n342: \\boxed{g_{ij}^{\\text{emergent}}[\\rho_t] = g_{ij}^{\\text{OT}}[\\rho_t] + \\varepsilon \\delta_{ij} + O(N^{-1/d})}\n343: $$\n344: \n345: \u220e"
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}