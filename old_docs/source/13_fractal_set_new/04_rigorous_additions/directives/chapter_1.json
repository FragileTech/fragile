{
  "chapter_index": 1,
  "section_id": "## 2. Algorithmic Determination of Graph Structure",
  "directive_count": 4,
  "hints": [
    {
      "directive_type": "theorem",
      "label": "thm-ig-edge-weights-algorithmic",
      "title": "IG Edge Weights from Temporal Overlap",
      "start_line": 458,
      "end_line": 484,
      "header_lines": [
        459
      ],
      "content_start": 461,
      "content_end": 483,
      "content": "461: :label: thm-ig-edge-weights-algorithmic\n462: \n463: Let $e_i$ and $e_j$ be two episodes with temporal overlap interval:\n464: \n465: $$\n466: T_{\\text{overlap}}(i, j) = [t^b_{\\max}, t^d_{\\min}]\n467: $$\n468: \n469: where:\n470: - $t^b_{\\max} = \\max(t^b_i, t^b_j)$: Later birth time\n471: - $t^d_{\\min} = \\min(t^d_i, t^d_j)$: Earlier death time\n472: \n473: Let $P(c_i(t) = j \\mid i)$ be the probability that episode $i$ selects episode $j$ as its companion (diversity or cloning) at time $t \\in T_{\\text{overlap}}(i, j)$.\n474: \n475: Then the **IG edge weight** between episodes $i$ and $j$ is:\n476: \n477: $$\n478: w_{ij} = \\int_{T_{\\text{overlap}}(i, j)} P(c_i(t) = j \\mid i) \\, dt\n479: $$\n480: \n481: **Interpretation:** The edge weight is the **expected number of selection events** between episodes $i$ and $j$ during their temporal overlap.\n482: \n483: **Consequence:** This removes all arbitrariness from IG edge construction. The weights are **computed** from the algorithm, not **imposed** as hyperparameters.",
      "metadata": {
        "label": "thm-ig-edge-weights-algorithmic"
      },
      "section": "## 2. Algorithmic Determination of Graph Structure",
      "raw_directive": "458: One of the most important insights from the old documentation is that **IG edge weights are not free parameters** but are **algorithmically determined** by the companion selection mechanism.\n459: \n460: :::{prf:theorem} IG Edge Weights from Temporal Overlap\n461: :label: thm-ig-edge-weights-algorithmic\n462: \n463: Let $e_i$ and $e_j$ be two episodes with temporal overlap interval:\n464: \n465: $$\n466: T_{\\text{overlap}}(i, j) = [t^b_{\\max}, t^d_{\\min}]\n467: $$\n468: \n469: where:\n470: - $t^b_{\\max} = \\max(t^b_i, t^b_j)$: Later birth time\n471: - $t^d_{\\min} = \\min(t^d_i, t^d_j)$: Earlier death time\n472: \n473: Let $P(c_i(t) = j \\mid i)$ be the probability that episode $i$ selects episode $j$ as its companion (diversity or cloning) at time $t \\in T_{\\text{overlap}}(i, j)$.\n474: \n475: Then the **IG edge weight** between episodes $i$ and $j$ is:\n476: \n477: $$\n478: w_{ij} = \\int_{T_{\\text{overlap}}(i, j)} P(c_i(t) = j \\mid i) \\, dt\n479: $$\n480: \n481: **Interpretation:** The edge weight is the **expected number of selection events** between episodes $i$ and $j$ during their temporal overlap.\n482: \n483: **Consequence:** This removes all arbitrariness from IG edge construction. The weights are **computed** from the algorithm, not **imposed** as hyperparameters.\n484: "
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-33",
      "title": null,
      "start_line": 486,
      "end_line": 530,
      "header_lines": [],
      "content_start": 487,
      "content_end": 529,
      "content": "487: \n488: :::{prf:proof}\n489: **Step 1: Companion Selection Probability**\n490: \n491: From the diversity companion selection mechanism (Chapter 03), at each timestep $t$:\n492: \n493: $$\n494: P(c_i(t) = j \\mid i) = \\frac{\\exp\\left( -\\frac{d_{\\text{alg}}^2(i(t), j(t))}{2\\epsilon_d^2} \\right)}{\\sum_{k \\in A_t \\setminus \\{i\\}} \\exp\\left( -\\frac{d_{\\text{alg}}^2(i(t), k(t))}{2\\epsilon_d^2} \\right)}\n495: $$\n496: \n497: where $d_{\\text{alg}}^2(i, j) = \\|x_i - x_j\\|^2 + \\lambda_v \\|v_i - v_j\\|^2$ is the algorithmic distance.\n498: \n499: **Step 2: Temporal Integration**\n500: \n501: Over the lifetime of episode $i$, the total \"interaction strength\" with episode $j$ is:\n502: \n503: $$\n504: w_{ij} = \\int_{t^b_i}^{t^d_i} \\mathbb{1}_{j \\text{ alive}}(t) \\cdot P(c_i(t) = j \\mid i) \\, dt\n505: $$\n506: \n507: Restricting to the overlap interval where both are alive:\n508: \n509: $$\n510: w_{ij} = \\int_{T_{\\text{overlap}}(i,j)} P(c_i(t) = j \\mid i) \\, dt\n511: $$\n512: \n513: **Step 3: Physical Interpretation**\n514: \n515: If selections occur at discrete timesteps $t_k$ with rate $\\Delta t^{-1}$:\n516: \n517: $$\n518: w_{ij} \\approx \\sum_{k: t_k \\in T_{\\text{overlap}}} P(c_i(t_k) = j \\mid i) \\cdot \\Delta t\n519: $$\n520: \n521: This is the **expected number of times** episode $i$ selected episode $j$ as companion.\n522: \n523: **Step 4: Symmetrization**\n524: \n525: For undirected graph, symmetrize:\n526: \n527: $$\n528: w_{ij}^{\\text{sym}} = \\frac{w_{ij} + w_{ji}}{2}\n529: $$",
      "metadata": {},
      "section": "## 2. Algorithmic Determination of Graph Structure",
      "raw_directive": "486: :::\n487: \n488: :::{prf:proof}\n489: **Step 1: Companion Selection Probability**\n490: \n491: From the diversity companion selection mechanism (Chapter 03), at each timestep $t$:\n492: \n493: $$\n494: P(c_i(t) = j \\mid i) = \\frac{\\exp\\left( -\\frac{d_{\\text{alg}}^2(i(t), j(t))}{2\\epsilon_d^2} \\right)}{\\sum_{k \\in A_t \\setminus \\{i\\}} \\exp\\left( -\\frac{d_{\\text{alg}}^2(i(t), k(t))}{2\\epsilon_d^2} \\right)}\n495: $$\n496: \n497: where $d_{\\text{alg}}^2(i, j) = \\|x_i - x_j\\|^2 + \\lambda_v \\|v_i - v_j\\|^2$ is the algorithmic distance.\n498: \n499: **Step 2: Temporal Integration**\n500: \n501: Over the lifetime of episode $i$, the total \"interaction strength\" with episode $j$ is:\n502: \n503: $$\n504: w_{ij} = \\int_{t^b_i}^{t^d_i} \\mathbb{1}_{j \\text{ alive}}(t) \\cdot P(c_i(t) = j \\mid i) \\, dt\n505: $$\n506: \n507: Restricting to the overlap interval where both are alive:\n508: \n509: $$\n510: w_{ij} = \\int_{T_{\\text{overlap}}(i,j)} P(c_i(t) = j \\mid i) \\, dt\n511: $$\n512: \n513: **Step 3: Physical Interpretation**\n514: \n515: If selections occur at discrete timesteps $t_k$ with rate $\\Delta t^{-1}$:\n516: \n517: $$\n518: w_{ij} \\approx \\sum_{k: t_k \\in T_{\\text{overlap}}} P(c_i(t_k) = j \\mid i) \\cdot \\Delta t\n519: $$\n520: \n521: This is the **expected number of times** episode $i$ selected episode $j$ as companion.\n522: \n523: **Step 4: Symmetrization**\n524: \n525: For undirected graph, symmetrize:\n526: \n527: $$\n528: w_{ij}^{\\text{sym}} = \\frac{w_{ij} + w_{ji}}{2}\n529: $$\n530: "
    },
    {
      "directive_type": "theorem",
      "label": "thm-weighted-first-moment-connection",
      "title": "Weighted First Moment Encodes Christoffel Symbols",
      "start_line": 547,
      "end_line": 577,
      "header_lines": [
        548
      ],
      "content_start": 550,
      "content_end": 576,
      "content": "550: :label: thm-weighted-first-moment-connection\n551: \n552: Let $e_i$ be an episode at position $x_i$. Define the **weighted first moment** of IG edge displacements:\n553: \n554: $$\n555: M_i := \\sum_{e_j \\in \\text{IG}(e_i)} w_{ij} \\Delta x_{ij}\n556: $$\n557: \n558: where $\\text{IG}(e_i)$ are IG neighbors of episode $i$ and $\\Delta x_{ij} = x_j - x_i$.\n559: \n560: Let $\\varepsilon_c = \\sqrt{T/\\gamma}$ be the thermal coherence length (typical IG edge length). Then:\n561: \n562: $$\n563: M_i = \\varepsilon_c^2 \\cdot D_{\\text{reg}}(x_i) \\cdot \\nabla \\log \\sqrt{\\det g(x_i)} + O(\\varepsilon_c^3)\n564: $$\n565: \n566: where:\n567: - $D_{\\text{reg}}(x_i) = g(x_i)^{-1}$ is the regularized diffusion tensor\n568: - $\\nabla \\log \\sqrt{\\det g} = \\frac{1}{2\\sqrt{\\det g}} \\nabla(\\det g) = \\frac{1}{2} g^{ij} \\partial_k g_{ij}$ is the **divergence of the metric connection**\n569: \n570: **Physical interpretation:** The first moment encodes the **drift term** from the volume factor in the stationary distribution, which is precisely the Christoffel symbol of the second kind:\n571: \n572: $$\n573: \\Gamma^i_{jj} = \\frac{1}{2} g^{ik} \\partial_j g_{kj}\n574: $$\n575: \n576: **Consequence:** Connection coefficients are **not put in by hand** but **emerge from the algorithm**.",
      "metadata": {
        "label": "thm-weighted-first-moment-connection"
      },
      "section": "## 2. Algorithmic Determination of Graph Structure",
      "raw_directive": "547: An even more striking result: the **connection coefficients** (Christoffel symbols) of the emergent Riemannian geometry are **algorithmically computable** from weighted moments of IG edge displacements.\n548: \n549: :::{prf:theorem} Weighted First Moment Encodes Christoffel Symbols\n550: :label: thm-weighted-first-moment-connection\n551: \n552: Let $e_i$ be an episode at position $x_i$. Define the **weighted first moment** of IG edge displacements:\n553: \n554: $$\n555: M_i := \\sum_{e_j \\in \\text{IG}(e_i)} w_{ij} \\Delta x_{ij}\n556: $$\n557: \n558: where $\\text{IG}(e_i)$ are IG neighbors of episode $i$ and $\\Delta x_{ij} = x_j - x_i$.\n559: \n560: Let $\\varepsilon_c = \\sqrt{T/\\gamma}$ be the thermal coherence length (typical IG edge length). Then:\n561: \n562: $$\n563: M_i = \\varepsilon_c^2 \\cdot D_{\\text{reg}}(x_i) \\cdot \\nabla \\log \\sqrt{\\det g(x_i)} + O(\\varepsilon_c^3)\n564: $$\n565: \n566: where:\n567: - $D_{\\text{reg}}(x_i) = g(x_i)^{-1}$ is the regularized diffusion tensor\n568: - $\\nabla \\log \\sqrt{\\det g} = \\frac{1}{2\\sqrt{\\det g}} \\nabla(\\det g) = \\frac{1}{2} g^{ij} \\partial_k g_{ij}$ is the **divergence of the metric connection**\n569: \n570: **Physical interpretation:** The first moment encodes the **drift term** from the volume factor in the stationary distribution, which is precisely the Christoffel symbol of the second kind:\n571: \n572: $$\n573: \\Gamma^i_{jj} = \\frac{1}{2} g^{ik} \\partial_j g_{kj}\n574: $$\n575: \n576: **Consequence:** Connection coefficients are **not put in by hand** but **emerge from the algorithm**.\n577: "
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-126",
      "title": null,
      "start_line": 579,
      "end_line": 639,
      "header_lines": [],
      "content_start": 580,
      "content_end": 638,
      "content": "580: \n581: :::{prf:proof}\n582: **Step 1: Continuum Limit of First Moment**\n583: \n584: By Lemma {prf:ref}`lem-sum-to-integral-episodes`:\n585: \n586: $$\n587: M_i \\approx \\int_{B_{\\varepsilon_c}(x_i)} w(x - x_i) \\, (x - x_i) \\, \\rho_{\\text{spatial}}(x) \\, dx\n588: $$\n589: \n590: where $w(x - x_i) = \\exp(-\\|x - x_i\\|^2 / (2\\varepsilon_c^2))$ is the annealed kernel.\n591: \n592: **Step 2: Taylor Expansion of Density**\n593: \n594: In Riemannian normal coordinates $y = \\exp_{x_i}^{-1}(x)$:\n595: \n596: $$\n597: \\rho_{\\text{spatial}}(y) = \\sqrt{\\det g(y)} \\, e^{-U_{\\text{eff}}(y)/T}\n598: $$\n599: \n600: Expand around $y = 0$ (position $x_i$):\n601: \n602: $$\n603: \\sqrt{\\det g(y)} = \\sqrt{\\det g(0)} \\left( 1 + \\frac{1}{2} g^{ij}(0) \\partial_k g_{ij}(0) \\cdot y^k + O(\\|y\\|^2) \\right)\n604: $$\n605: \n606: $$\n607: e^{-U_{\\text{eff}}(y)/T} = e^{-U_{\\text{eff}}(0)/T} \\left( 1 - \\frac{1}{T} \\nabla U_{\\text{eff}}(0) \\cdot y + O(\\|y\\|^2) \\right)\n608: $$\n609: \n610: **Step 3: Gaussian Integral**\n611: \n612: For Gaussian weight $w(\\|y\\|) = \\exp(-\\|y\\|^2 / (2\\varepsilon_c^2))$, the integral of $y^i \\cdot y^k$ (first moment times linear term) gives:\n613: \n614: $$\n615: \\int y^i \\, w(\\|y\\|) \\, y^k \\, dy = 0 \\quad \\text{(odd function)}\n616: $$\n617: \n618: But the integral of $y^i \\times (\\text{gradient term})$ gives:\n619: \n620: $$\n621: \\int y^i \\, w(\\|y\\|) \\, \\left( \\partial_k \\sqrt{\\det g} \\right) y^k \\, dy \\propto \\varepsilon_c^2 \\delta^{ik} \\partial_k \\sqrt{\\det g}\n622: $$\n623: \n624: **Step 4: Identification**\n625: \n626: Combining and transforming back to original coordinates:\n627: \n628: $$\n629: M_i = \\varepsilon_c^2 \\cdot D(x_i) \\cdot \\nabla \\log \\sqrt{\\det g(x_i)} + O(\\varepsilon_c^3)\n630: $$\n631: \n632: where $D(x_i) = g(x_i)^{-1}$ is the diffusion tensor.\n633: \n634: The term $\\nabla \\log \\sqrt{\\det g}$ is precisely the **trace of the Christoffel connection**:\n635: \n636: $$\n637: \\nabla \\log \\sqrt{\\det g} = \\Gamma^i_{ji}\n638: $$",
      "metadata": {},
      "section": "## 2. Algorithmic Determination of Graph Structure",
      "raw_directive": "579: :::\n580: \n581: :::{prf:proof}\n582: **Step 1: Continuum Limit of First Moment**\n583: \n584: By Lemma {prf:ref}`lem-sum-to-integral-episodes`:\n585: \n586: $$\n587: M_i \\approx \\int_{B_{\\varepsilon_c}(x_i)} w(x - x_i) \\, (x - x_i) \\, \\rho_{\\text{spatial}}(x) \\, dx\n588: $$\n589: \n590: where $w(x - x_i) = \\exp(-\\|x - x_i\\|^2 / (2\\varepsilon_c^2))$ is the annealed kernel.\n591: \n592: **Step 2: Taylor Expansion of Density**\n593: \n594: In Riemannian normal coordinates $y = \\exp_{x_i}^{-1}(x)$:\n595: \n596: $$\n597: \\rho_{\\text{spatial}}(y) = \\sqrt{\\det g(y)} \\, e^{-U_{\\text{eff}}(y)/T}\n598: $$\n599: \n600: Expand around $y = 0$ (position $x_i$):\n601: \n602: $$\n603: \\sqrt{\\det g(y)} = \\sqrt{\\det g(0)} \\left( 1 + \\frac{1}{2} g^{ij}(0) \\partial_k g_{ij}(0) \\cdot y^k + O(\\|y\\|^2) \\right)\n604: $$\n605: \n606: $$\n607: e^{-U_{\\text{eff}}(y)/T} = e^{-U_{\\text{eff}}(0)/T} \\left( 1 - \\frac{1}{T} \\nabla U_{\\text{eff}}(0) \\cdot y + O(\\|y\\|^2) \\right)\n608: $$\n609: \n610: **Step 3: Gaussian Integral**\n611: \n612: For Gaussian weight $w(\\|y\\|) = \\exp(-\\|y\\|^2 / (2\\varepsilon_c^2))$, the integral of $y^i \\cdot y^k$ (first moment times linear term) gives:\n613: \n614: $$\n615: \\int y^i \\, w(\\|y\\|) \\, y^k \\, dy = 0 \\quad \\text{(odd function)}\n616: $$\n617: \n618: But the integral of $y^i \\times (\\text{gradient term})$ gives:\n619: \n620: $$\n621: \\int y^i \\, w(\\|y\\|) \\, \\left( \\partial_k \\sqrt{\\det g} \\right) y^k \\, dy \\propto \\varepsilon_c^2 \\delta^{ik} \\partial_k \\sqrt{\\det g}\n622: $$\n623: \n624: **Step 4: Identification**\n625: \n626: Combining and transforming back to original coordinates:\n627: \n628: $$\n629: M_i = \\varepsilon_c^2 \\cdot D(x_i) \\cdot \\nabla \\log \\sqrt{\\det g(x_i)} + O(\\varepsilon_c^3)\n630: $$\n631: \n632: where $D(x_i) = g(x_i)^{-1}$ is the diffusion tensor.\n633: \n634: The term $\\nabla \\log \\sqrt{\\det g}$ is precisely the **trace of the Christoffel connection**:\n635: \n636: $$\n637: \\nabla \\log \\sqrt{\\det g} = \\Gamma^i_{ji}\n638: $$\n639: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}