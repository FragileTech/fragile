{
  "chapter_index": 4,
  "section_id": "## 4. Operator Composition and Foster-Lyapunov Condition",
  "directive_count": 2,
  "hints": [
    {
      "directive_type": "theorem",
      "label": "thm-foster-lyapunov-adaptive",
      "title": "Foster-Lyapunov Condition for Adaptive Gas",
      "start_line": 1773,
      "end_line": 1786,
      "header_lines": [
        1774
      ],
      "content_start": 1776,
      "content_end": 1785,
      "content": "1776: :label: thm-foster-lyapunov-adaptive\n1777: \n1778: There exist coupling constants $c_V, c_B > 0$ such that the total Lyapunov function $V_{\\text{total}} = c_V V_{\\text{inter}} + c_B W_b$ satisfies:\n1779: \n1780: $$\n1781: \\mathbb{E}[V_{\\text{total}}(S''_1, S''_2) \\mid S_1, S_2] \\le (1 - \\kappa_{\\text{total}}) V_{\\text{total}}(S_1, S_2) + C_{\\text{total}}\n1782: $$\n1783: \n1784: where $S' = \\Psi_{\\text{clone}}(S)$, $S'' = \\Psi_{\\text{kin}}(S')$, and:\n1785: - $\\kappa_{\\text{total}} = O(\\min\\{\\gamma \\tau, \\kappa_x, c_{\\min}\\}) > 0$",
      "metadata": {
        "label": "thm-foster-lyapunov-adaptive"
      },
      "section": "## 4. Operator Composition and Foster-Lyapunov Condition",
      "raw_directive": "1773: ### 4.2. Synergistic Composition\n1774: \n1775: :::{prf:theorem} Foster-Lyapunov Condition for Adaptive Gas\n1776: :label: thm-foster-lyapunov-adaptive\n1777: \n1778: There exist coupling constants $c_V, c_B > 0$ such that the total Lyapunov function $V_{\\text{total}} = c_V V_{\\text{inter}} + c_B W_b$ satisfies:\n1779: \n1780: $$\n1781: \\mathbb{E}[V_{\\text{total}}(S''_1, S''_2) \\mid S_1, S_2] \\le (1 - \\kappa_{\\text{total}}) V_{\\text{total}}(S_1, S_2) + C_{\\text{total}}\n1782: $$\n1783: \n1784: where $S' = \\Psi_{\\text{clone}}(S)$, $S'' = \\Psi_{\\text{kin}}(S')$, and:\n1785: - $\\kappa_{\\text{total}} = O(\\min\\{\\gamma \\tau, \\kappa_x, c_{\\min}\\}) > 0$\n1786: - $C_{\\text{total}} < \\infty$"
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-33",
      "title": null,
      "start_line": 1788,
      "end_line": 1969,
      "header_lines": [
        1952
      ],
      "content_start": 1789,
      "content_end": 1968,
      "content": "1789: \n1790: :::{prf:proof}\n1791: This proof uses exact iterated expectations without first-order approximations.\n1792: \n1793: **Step 1: Notation and Tower Property**\n1794: \n1795: Let $S$ denote the initial coupled state $(S_1, S_2)$. The full update is:\n1796: \n1797: $$\n1798: S \\xrightarrow{\\Psi_{\\text{clone}}} S' \\xrightarrow{\\Psi_{\\text{kin}}} S''\n1799: $$\n1800: \n1801: By the tower property of conditional expectation:\n1802: \n1803: $$\n1804: \\mathbb{E}[V_{\\text{total}}(S'') \\mid S] = \\mathbb{E}[\\mathbb{E}[V_{\\text{total}}(S'') \\mid S'] \\mid S]\n1805: $$\n1806: \n1807: **Step 2: Kinetic Drift Inequalities (Inner Conditional Expectation)**\n1808: \n1809: From Chapter 3, for each component:\n1810: \n1811: $$\n1812: \\begin{aligned}\n1813: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S'] &\\le (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S') + C'_v \\tau \\\\\n1814: \\mathbb{E}[V_W(S'') \\mid S'] &\\le (1 - \\kappa'_W \\tau) V_W(S') + C'_W \\tau \\\\\n1815: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S'] &\\le V_{\\text{Var},x}(S') + C'_x \\tau \\\\\n1816: \\mathbb{E}[W_b(S'') \\mid S'] &\\le (1 - \\kappa'_b \\tau) W_b(S') + C'_b \\tau\n1817: \\end{aligned}\n1818: $$\n1819: \n1820: where $\\kappa'_W = O(\\min\\{\\gamma, c_{\\min}\\})$ and all constants are N-uniform.\n1821: \n1822: **Step 3: Cloning Drift Inequalities**\n1823: \n1824: From `03_cloning.md`:\n1825: \n1826: $$\n1827: \\begin{aligned}\n1828: \\mathbb{E}[V_{\\text{Var},x}(S') \\mid S] &\\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + C_x \\\\\n1829: \\mathbb{E}[V_{\\text{Var},v}(S') \\mid S] &\\le V_{\\text{Var},v}(S) + C_v \\\\\n1830: \\mathbb{E}[V_W(S') \\mid S] &\\le V_W(S) + C_W \\\\\n1831: \\mathbb{E}[W_b(S') \\mid S] &\\le (1 - \\kappa_b) W_b(S) + C_b\n1832: \\end{aligned}\n1833: $$\n1834: \n1835: where $\\kappa_x, \\kappa_b > 0$ and all constants are N-uniform.\n1836: \n1837: **Step 4: Compose via Tower Property (Component-by-Component)**\n1838: \n1839: **For $V_{\\text{Var},v}$:**\n1840: \n1841: $$\n1842: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S] = \\mathbb{E}[\\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S'] \\mid S]\n1843: $$\n1844: \n1845: $$\n1846: \\le \\mathbb{E}[(1 - 2\\gamma \\tau) V_{\\text{Var},v}(S') + C'_v \\tau \\mid S]\n1847: $$\n1848: \n1849: $$\n1850: = (1 - 2\\gamma \\tau) \\mathbb{E}[V_{\\text{Var},v}(S') \\mid S] + C'_v \\tau\n1851: $$\n1852: \n1853: $$\n1854: \\le (1 - 2\\gamma \\tau) [V_{\\text{Var},v}(S) + C_v] + C'_v \\tau\n1855: $$\n1856: \n1857: $$\n1858: = (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S) + [(1 - 2\\gamma \\tau) C_v + C'_v \\tau]\n1859: $$\n1860: \n1861: **For $V_W$:**\n1862: \n1863: $$\n1864: \\mathbb{E}[V_W(S'') \\mid S] \\le (1 - \\kappa'_W \\tau) \\mathbb{E}[V_W(S') \\mid S] + C'_W \\tau\n1865: $$\n1866: \n1867: $$\n1868: \\le (1 - \\kappa'_W \\tau) [V_W(S) + C_W] + C'_W \\tau\n1869: $$\n1870: \n1871: $$\n1872: = (1 - \\kappa'_W \\tau) V_W(S) + [(1 - \\kappa'_W \\tau) C_W + C'_W \\tau]\n1873: $$\n1874: \n1875: **For $V_{\\text{Var},x}$:**\n1876: \n1877: $$\n1878: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S] \\le \\mathbb{E}[V_{\\text{Var},x}(S') + C'_x \\tau \\mid S]\n1879: $$\n1880: \n1881: $$\n1882: = \\mathbb{E}[V_{\\text{Var},x}(S') \\mid S] + C'_x \\tau\n1883: $$\n1884: \n1885: $$\n1886: \\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + C_x + C'_x \\tau\n1887: $$\n1888: \n1889: **For $W_b$:**\n1890: \n1891: $$\n1892: \\mathbb{E}[W_b(S'') \\mid S] \\le (1 - \\kappa'_b \\tau) \\mathbb{E}[W_b(S') \\mid S] + C'_b \\tau\n1893: $$\n1894: \n1895: $$\n1896: \\le (1 - \\kappa'_b \\tau) [(1 - \\kappa_b) W_b(S) + C_b] + C'_b \\tau\n1897: $$\n1898: \n1899: $$\n1900: = (1 - \\kappa'_b \\tau)(1 - \\kappa_b) W_b(S) + [(1 - \\kappa'_b \\tau) C_b + C'_b \\tau]\n1901: $$\n1902: \n1903: $$\n1904: = [1 - (\\kappa'_b \\tau + \\kappa_b) + \\kappa'_b \\tau \\kappa_b] W_b(S) + C_b^{\\text{total}}\n1905: $$\n1906: \n1907: **Step 5: Construct Total Lyapunov Function**\n1908: \n1909: Define $V_{\\text{inter}} = V_W + V_{\\text{Var},x} + V_{\\text{Var},v}$ and $V_{\\text{total}} = c_V V_{\\text{inter}} + c_B W_b$ with coupling constants $c_V, c_B > 0$ to be chosen.\n1910: \n1911: From Step 4:\n1912: \n1913: $$\n1914: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S] \\le (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S) + \\bar{C}_v\n1915: $$\n1916: \n1917: $$\n1918: \\mathbb{E}[V_W(S'') \\mid S] \\le (1 - \\kappa'_W \\tau) V_W(S) + \\bar{C}_W\n1919: $$\n1920: \n1921: $$\n1922: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S] \\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + \\bar{C}_x\n1923: $$\n1924: \n1925: where $\\bar{C}_v, \\bar{C}_W, \\bar{C}_x < \\infty$ are the combined constants.\n1926: \n1927: **Step 6: Determine Effective Rates**\n1928: \n1929: For $V_{\\text{inter}}$, the **worst-case** (smallest) contraction rate among the three components determines convergence. However, we must account for the fact that cloning does not contract $V_W$ or $V_{\\text{Var},v}$ (only expands by bounded $C$), while kinetics do contract these.\n1930: \n1931: The effective rate for $V_{\\text{inter}}$ is determined by balancing:\n1932: - Kinetic contraction of $V_W, V_{\\text{Var},v}$: rates $\\kappa'_W \\tau, 2\\gamma\\tau$\n1933: - Cloning contraction of $V_{\\text{Var},x}$: rate $\\kappa_x$\n1934: \n1935: Choose coupling constants such that:\n1936: \n1937: $$\n1938: c_V = 1, \\quad c_B \\ge \\max\\left\\{ \\frac{C_x + C'_x \\tau}{\\kappa_b}, \\frac{\\bar{C}_v + \\bar{C}_W}{\\kappa'_b \\tau} \\right\\}\n1939: $$\n1940: \n1941: This ensures the boundary contraction dominates its expansion constants.\n1942: \n1943: **Step 7: Second-Order Term Analysis**\n1944: \n1945: The composition of boundary contraction rates yields (from Step 4):\n1946: \n1947: $$\n1948: 1 - (\\kappa'_b \\tau + \\kappa_b) + \\kappa_b \\kappa'_b \\tau = 1 - \\kappa_b - \\kappa'_b \\tau (1 - \\kappa_b)\n1949: $$\n1950: \n1951: The **second-order term** $\\kappa_b \\kappa'_b \\tau$ has a **positive** contribution to the coefficient (reduces the total contraction rate). However, this is actually **expected and correct** for composition of contractive operators:\n1952: \n1953: :::{admonition} Why the Second-Order Term Matters\n1954: :class: note\n1955: \n1956: When two contractive operators are composed, the total contraction is:\n1957: \n1958: $$\n1959: (1 - \\kappa_1)(1 - \\kappa_2) = 1 - \\kappa_1 - \\kappa_2 + \\kappa_1 \\kappa_2\n1960: $$\n1961: \n1962: The cross term $\\kappa_1 \\kappa_2 > 0$ represents **diminishing returns**: contracting an already-contracted state provides less absolute improvement.\n1963: \n1964: **Key insight**: Despite this diminishing return, the effective rate is still:\n1965: \n1966: $$\n1967: \\kappa_{\\text{eff}} = \\kappa_1 + \\kappa_2 - \\kappa_1 \\kappa_2 = \\kappa_1 + \\kappa_2 (1 - \\kappa_1)\n1968: $$",
      "metadata": {
        "class": "note"
      },
      "section": "## 4. Operator Composition and Foster-Lyapunov Condition",
      "raw_directive": "1788: :::\n1789: \n1790: :::{prf:proof}\n1791: This proof uses exact iterated expectations without first-order approximations.\n1792: \n1793: **Step 1: Notation and Tower Property**\n1794: \n1795: Let $S$ denote the initial coupled state $(S_1, S_2)$. The full update is:\n1796: \n1797: $$\n1798: S \\xrightarrow{\\Psi_{\\text{clone}}} S' \\xrightarrow{\\Psi_{\\text{kin}}} S''\n1799: $$\n1800: \n1801: By the tower property of conditional expectation:\n1802: \n1803: $$\n1804: \\mathbb{E}[V_{\\text{total}}(S'') \\mid S] = \\mathbb{E}[\\mathbb{E}[V_{\\text{total}}(S'') \\mid S'] \\mid S]\n1805: $$\n1806: \n1807: **Step 2: Kinetic Drift Inequalities (Inner Conditional Expectation)**\n1808: \n1809: From Chapter 3, for each component:\n1810: \n1811: $$\n1812: \\begin{aligned}\n1813: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S'] &\\le (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S') + C'_v \\tau \\\\\n1814: \\mathbb{E}[V_W(S'') \\mid S'] &\\le (1 - \\kappa'_W \\tau) V_W(S') + C'_W \\tau \\\\\n1815: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S'] &\\le V_{\\text{Var},x}(S') + C'_x \\tau \\\\\n1816: \\mathbb{E}[W_b(S'') \\mid S'] &\\le (1 - \\kappa'_b \\tau) W_b(S') + C'_b \\tau\n1817: \\end{aligned}\n1818: $$\n1819: \n1820: where $\\kappa'_W = O(\\min\\{\\gamma, c_{\\min}\\})$ and all constants are N-uniform.\n1821: \n1822: **Step 3: Cloning Drift Inequalities**\n1823: \n1824: From `03_cloning.md`:\n1825: \n1826: $$\n1827: \\begin{aligned}\n1828: \\mathbb{E}[V_{\\text{Var},x}(S') \\mid S] &\\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + C_x \\\\\n1829: \\mathbb{E}[V_{\\text{Var},v}(S') \\mid S] &\\le V_{\\text{Var},v}(S) + C_v \\\\\n1830: \\mathbb{E}[V_W(S') \\mid S] &\\le V_W(S) + C_W \\\\\n1831: \\mathbb{E}[W_b(S') \\mid S] &\\le (1 - \\kappa_b) W_b(S) + C_b\n1832: \\end{aligned}\n1833: $$\n1834: \n1835: where $\\kappa_x, \\kappa_b > 0$ and all constants are N-uniform.\n1836: \n1837: **Step 4: Compose via Tower Property (Component-by-Component)**\n1838: \n1839: **For $V_{\\text{Var},v}$:**\n1840: \n1841: $$\n1842: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S] = \\mathbb{E}[\\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S'] \\mid S]\n1843: $$\n1844: \n1845: $$\n1846: \\le \\mathbb{E}[(1 - 2\\gamma \\tau) V_{\\text{Var},v}(S') + C'_v \\tau \\mid S]\n1847: $$\n1848: \n1849: $$\n1850: = (1 - 2\\gamma \\tau) \\mathbb{E}[V_{\\text{Var},v}(S') \\mid S] + C'_v \\tau\n1851: $$\n1852: \n1853: $$\n1854: \\le (1 - 2\\gamma \\tau) [V_{\\text{Var},v}(S) + C_v] + C'_v \\tau\n1855: $$\n1856: \n1857: $$\n1858: = (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S) + [(1 - 2\\gamma \\tau) C_v + C'_v \\tau]\n1859: $$\n1860: \n1861: **For $V_W$:**\n1862: \n1863: $$\n1864: \\mathbb{E}[V_W(S'') \\mid S] \\le (1 - \\kappa'_W \\tau) \\mathbb{E}[V_W(S') \\mid S] + C'_W \\tau\n1865: $$\n1866: \n1867: $$\n1868: \\le (1 - \\kappa'_W \\tau) [V_W(S) + C_W] + C'_W \\tau\n1869: $$\n1870: \n1871: $$\n1872: = (1 - \\kappa'_W \\tau) V_W(S) + [(1 - \\kappa'_W \\tau) C_W + C'_W \\tau]\n1873: $$\n1874: \n1875: **For $V_{\\text{Var},x}$:**\n1876: \n1877: $$\n1878: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S] \\le \\mathbb{E}[V_{\\text{Var},x}(S') + C'_x \\tau \\mid S]\n1879: $$\n1880: \n1881: $$\n1882: = \\mathbb{E}[V_{\\text{Var},x}(S') \\mid S] + C'_x \\tau\n1883: $$\n1884: \n1885: $$\n1886: \\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + C_x + C'_x \\tau\n1887: $$\n1888: \n1889: **For $W_b$:**\n1890: \n1891: $$\n1892: \\mathbb{E}[W_b(S'') \\mid S] \\le (1 - \\kappa'_b \\tau) \\mathbb{E}[W_b(S') \\mid S] + C'_b \\tau\n1893: $$\n1894: \n1895: $$\n1896: \\le (1 - \\kappa'_b \\tau) [(1 - \\kappa_b) W_b(S) + C_b] + C'_b \\tau\n1897: $$\n1898: \n1899: $$\n1900: = (1 - \\kappa'_b \\tau)(1 - \\kappa_b) W_b(S) + [(1 - \\kappa'_b \\tau) C_b + C'_b \\tau]\n1901: $$\n1902: \n1903: $$\n1904: = [1 - (\\kappa'_b \\tau + \\kappa_b) + \\kappa'_b \\tau \\kappa_b] W_b(S) + C_b^{\\text{total}}\n1905: $$\n1906: \n1907: **Step 5: Construct Total Lyapunov Function**\n1908: \n1909: Define $V_{\\text{inter}} = V_W + V_{\\text{Var},x} + V_{\\text{Var},v}$ and $V_{\\text{total}} = c_V V_{\\text{inter}} + c_B W_b$ with coupling constants $c_V, c_B > 0$ to be chosen.\n1910: \n1911: From Step 4:\n1912: \n1913: $$\n1914: \\mathbb{E}[V_{\\text{Var},v}(S'') \\mid S] \\le (1 - 2\\gamma \\tau) V_{\\text{Var},v}(S) + \\bar{C}_v\n1915: $$\n1916: \n1917: $$\n1918: \\mathbb{E}[V_W(S'') \\mid S] \\le (1 - \\kappa'_W \\tau) V_W(S) + \\bar{C}_W\n1919: $$\n1920: \n1921: $$\n1922: \\mathbb{E}[V_{\\text{Var},x}(S'') \\mid S] \\le (1 - \\kappa_x) V_{\\text{Var},x}(S) + \\bar{C}_x\n1923: $$\n1924: \n1925: where $\\bar{C}_v, \\bar{C}_W, \\bar{C}_x < \\infty$ are the combined constants.\n1926: \n1927: **Step 6: Determine Effective Rates**\n1928: \n1929: For $V_{\\text{inter}}$, the **worst-case** (smallest) contraction rate among the three components determines convergence. However, we must account for the fact that cloning does not contract $V_W$ or $V_{\\text{Var},v}$ (only expands by bounded $C$), while kinetics do contract these.\n1930: \n1931: The effective rate for $V_{\\text{inter}}$ is determined by balancing:\n1932: - Kinetic contraction of $V_W, V_{\\text{Var},v}$: rates $\\kappa'_W \\tau, 2\\gamma\\tau$\n1933: - Cloning contraction of $V_{\\text{Var},x}$: rate $\\kappa_x$\n1934: \n1935: Choose coupling constants such that:\n1936: \n1937: $$\n1938: c_V = 1, \\quad c_B \\ge \\max\\left\\{ \\frac{C_x + C'_x \\tau}{\\kappa_b}, \\frac{\\bar{C}_v + \\bar{C}_W}{\\kappa'_b \\tau} \\right\\}\n1939: $$\n1940: \n1941: This ensures the boundary contraction dominates its expansion constants.\n1942: \n1943: **Step 7: Second-Order Term Analysis**\n1944: \n1945: The composition of boundary contraction rates yields (from Step 4):\n1946: \n1947: $$\n1948: 1 - (\\kappa'_b \\tau + \\kappa_b) + \\kappa_b \\kappa'_b \\tau = 1 - \\kappa_b - \\kappa'_b \\tau (1 - \\kappa_b)\n1949: $$\n1950: \n1951: The **second-order term** $\\kappa_b \\kappa'_b \\tau$ has a **positive** contribution to the coefficient (reduces the total contraction rate). However, this is actually **expected and correct** for composition of contractive operators:\n1952: \n1953: :::{admonition} Why the Second-Order Term Matters\n1954: :class: note\n1955: \n1956: When two contractive operators are composed, the total contraction is:\n1957: \n1958: $$\n1959: (1 - \\kappa_1)(1 - \\kappa_2) = 1 - \\kappa_1 - \\kappa_2 + \\kappa_1 \\kappa_2\n1960: $$\n1961: \n1962: The cross term $\\kappa_1 \\kappa_2 > 0$ represents **diminishing returns**: contracting an already-contracted state provides less absolute improvement.\n1963: \n1964: **Key insight**: Despite this diminishing return, the effective rate is still:\n1965: \n1966: $$\n1967: \\kappa_{\\text{eff}} = \\kappa_1 + \\kappa_2 - \\kappa_1 \\kappa_2 = \\kappa_1 + \\kappa_2 (1 - \\kappa_1)\n1968: $$\n1969: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}