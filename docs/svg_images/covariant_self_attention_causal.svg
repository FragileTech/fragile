<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 560" width="1000" height="560">
  <title>Covariant Self-Attention with Causal Mask</title>
  <desc>Block diagram showing query and memory projections, causal mask, softmax over J^-, and weighted sum output.</desc>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#334155" />
    </marker>
    <linearGradient id="blockBlue" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EFF6FF;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DBEAFE;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blockGreen" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ECFDF3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DCFCE7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blockSlate" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F8FAFC;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#E2E8F0;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blockAmber" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:1" />
    </linearGradient>
  </defs>

  <rect width="1000" height="560" fill="#F8FAFC" />

  <text x="500" y="34" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="20" font-weight="600" fill="#0F172A" text-anchor="middle">Covariant self-attention with causal mask</text>
  <text x="500" y="56" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="13" fill="#64748B" text-anchor="middle">Scores are computed with Wilson line transport and normalized only over J^-</text>

  <!-- Query path -->
  <rect x="60" y="70" width="210" height="60" rx="12" fill="url(#blockBlue)" stroke="#93C5FD" />
  <text x="165" y="98" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="13" fill="#1E3A8A" text-anchor="middle">Query state</text>
  <text x="165" y="115" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#1E3A8A" text-anchor="middle">(z, t)</text>

  <rect x="300" y="70" width="230" height="60" rx="12" fill="url(#blockBlue)" stroke="#93C5FD" />
  <text x="415" y="98" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#1E3A8A" text-anchor="middle">Q projection +</text>
  <text x="415" y="115" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#1E3A8A" text-anchor="middle">Wilson line U</text>

  <!-- Memory path -->
  <rect x="60" y="180" width="210" height="270" rx="12" fill="url(#blockGreen)" stroke="#86EFAC" />
  <text x="165" y="218" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="13" fill="#065F46" text-anchor="middle">Memory states</text>
  <text x="165" y="236" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#065F46" text-anchor="middle">(z', t')</text>

  <rect x="300" y="190" width="230" height="60" rx="12" fill="url(#blockGreen)" stroke="#86EFAC" />
  <text x="415" y="218" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#065F46" text-anchor="middle">K projection +</text>
  <text x="415" y="235" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#065F46" text-anchor="middle">Wilson line U</text>

  <rect x="300" y="390" width="230" height="60" rx="12" fill="url(#blockGreen)" stroke="#86EFAC" />
  <text x="415" y="418" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#065F46" text-anchor="middle">V projection +</text>
  <text x="415" y="435" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#065F46" text-anchor="middle">Wilson line U</text>

  <!-- Core attention blocks -->
  <rect x="580" y="70" width="230" height="170" rx="12" fill="url(#blockSlate)" stroke="#CBD5E1" />
  <text x="695" y="155" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#334155" text-anchor="middle">Score = QK^T / tau(z)</text>

  <rect x="580" y="255" width="230" height="50" rx="12" fill="url(#blockAmber)" stroke="#FBBF24" />
  <text x="695" y="285" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#92400E" text-anchor="middle">Causal mask M_causal</text>

  <rect x="580" y="320" width="230" height="50" rx="12" fill="url(#blockSlate)" stroke="#CBD5E1" />
  <text x="695" y="350" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#334155" text-anchor="middle">Softmax over J^-</text>

  <rect x="580" y="385" width="230" height="70" rx="12" fill="url(#blockSlate)" stroke="#CBD5E1" />
  <text x="695" y="415" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#334155" text-anchor="middle">Weighted</text>
  <text x="695" y="433" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#334155" text-anchor="middle">sum with V</text>

  <rect x="580" y="470" width="230" height="60" rx="12" fill="url(#blockBlue)" stroke="#93C5FD" />
  <text x="695" y="500" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="12" fill="#1E3A8A" text-anchor="middle">SelfAttn output</text>

  <!-- Arrows -->
  <line x1="270" y1="100" x2="300" y2="100" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="270" y1="220" x2="300" y2="220" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="270" y1="420" x2="300" y2="420" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />

  <line x1="530" y1="100" x2="580" y2="100" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="530" y1="220" x2="580" y2="220" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />

  <line x1="695" y1="240" x2="695" y2="255" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="695" y1="305" x2="695" y2="320" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="695" y1="370" x2="695" y2="385" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />

  <line x1="530" y1="420" x2="580" y2="420" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="695" y1="455" x2="695" y2="470" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" />

  <!-- Tau callout -->
  <circle cx="860" cy="90" r="13" fill="#E2E8F0" stroke="#CBD5E1" />
  <text x="860" y="95" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="10" fill="#334155" text-anchor="middle">tau</text>
  <line x1="860" y1="103" x2="810" y2="120" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrowhead)" />

  <!-- Mask callout -->
  <rect x="830" y="250" width="150" height="60" rx="10" fill="#F1F5F9" stroke="#CBD5E1" />
  <text x="905" y="275" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Mask derived from</text>
  <text x="905" y="293" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="11" fill="#475569" text-anchor="middle">light cone J^-(z,t)</text>
  <line x1="830" y1="280" x2="810" y2="280" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrowhead)" />
</svg>
