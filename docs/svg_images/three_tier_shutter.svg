<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 720" width="800" height="720">
  <title>The Three-Tier Shutter Hierarchy</title>
  <desc>Illustration of the (K, z_n, z_tex) decomposition in the Split VQ-VAE Shutter, showing information bottleneck and control-relevant separation</desc>

  <!-- Definitions -->
  <defs>
    <!-- Arrow markers -->
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1F2937"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8B5CF6"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3B82F6"/>
    </marker>
    <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9CA3AF"/>
    </marker>

    <!-- Gradients -->
    <linearGradient id="observationGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="encoderGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EFF6FF;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DBEAFE;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="bottleneckGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F3E8FF;stop-opacity:0.3" />
      <stop offset="50%" style="stop-color:#8B5CF6;stop-opacity:0.15" />
      <stop offset="100%" style="stop-color:#F3E8FF;stop-opacity:0.3" />
    </linearGradient>

    <!-- Pattern for high-dimensional data representation -->
    <pattern id="pixelPattern" patternUnits="userSpaceOnUse" width="8" height="8">
      <rect width="4" height="4" fill="#D1D5DB"/>
      <rect x="4" y="4" width="4" height="4" fill="#D1D5DB"/>
    </pattern>
  </defs>

  <!-- Background -->
  <rect width="800" height="720" fill="#FAFAFA"/>

  <!-- Title -->
  <g id="title">
    <text x="400" y="35" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="600" fill="#1F2937" text-anchor="middle">The Three-Tier Shutter Hierarchy</text>
    <text x="400" y="58" font-family="system-ui, -apple-system, sans-serif" font-size="13" fill="#6B7280" text-anchor="middle" font-style="italic">(K, z</text>
    <text x="432" y="62" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280" text-anchor="middle">n</text>
    <text x="445" y="58" font-family="system-ui, -apple-system, sans-serif" font-size="13" fill="#6B7280" text-anchor="middle" font-style="italic">, z</text>
    <text x="463" y="62" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280" text-anchor="middle">tex</text>
    <text x="485" y="58" font-family="system-ui, -apple-system, sans-serif" font-size="13" fill="#6B7280" text-anchor="middle" font-style="italic">) Decomposition</text>
  </g>

  <!-- ==================== RAW OBSERVATION ==================== -->
  <g id="raw-observation">
    <!-- Main box with pixel pattern to suggest high-dimensional data -->
    <rect x="250" y="85" width="300" height="80" rx="8" ry="8" fill="url(#observationGradient)" stroke="#D97706" stroke-width="2"/>

    <!-- Inner pattern suggesting high-dimensional pixels -->
    <rect x="265" y="100" width="120" height="50" rx="4" ry="4" fill="url(#pixelPattern)" opacity="0.5"/>
    <text x="325" y="130" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#92400E" text-anchor="middle">pixels/sensors</text>

    <!-- Label -->
    <text x="400" y="110" font-family="system-ui, -apple-system, sans-serif" font-size="15" font-weight="600" fill="#1F2937" text-anchor="middle">Raw Observation x</text>
    <text x="400" y="130" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#6B7280" text-anchor="middle">High-dimensional input</text>
    <text x="400" y="150" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#92400E" text-anchor="middle" font-style="italic">dim(x) >> dim(K)</text>
  </g>

  <!-- Arrow: Observation -> Encoder -->
  <g id="obs-to-encoder">
    <line x1="400" y1="165" x2="400" y2="200" stroke="#1F2937" stroke-width="2" marker-end="url(#arrow)"/>
  </g>

  <!-- ==================== ENCODER / SHUTTER ==================== -->
  <g id="encoder-shutter">
    <rect x="200" y="210" width="400" height="100" rx="10" ry="10" fill="url(#encoderGradient)" stroke="#2563EB" stroke-width="2.5"/>

    <text x="400" y="245" font-family="system-ui, -apple-system, sans-serif" font-size="17" font-weight="600" fill="#1F2937" text-anchor="middle">ENCODER / SHUTTER</text>
    <text x="400" y="268" font-family="system-ui, -apple-system, sans-serif" font-size="13" fill="#2563EB" text-anchor="middle">(Split VQ-VAE)</text>

    <!-- Internal components hint -->
    <g transform="translate(230, 278)">
      <rect x="0" y="0" width="70" height="22" rx="3" ry="3" fill="#DBEAFE" stroke="#93C5FD" stroke-width="1"/>
      <text x="35" y="15" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#1D4ED8" text-anchor="middle">Encoder</text>
    </g>
    <g transform="translate(310, 278)">
      <rect x="0" y="0" width="70" height="22" rx="3" ry="3" fill="#F3E8FF" stroke="#C4B5FD" stroke-width="1"/>
      <text x="35" y="15" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#7C3AED" text-anchor="middle">Quantizer</text>
    </g>
    <g transform="translate(390, 278)">
      <rect x="0" y="0" width="70" height="22" rx="3" ry="3" fill="#E0E7FF" stroke="#A5B4FC" stroke-width="1"/>
      <text x="35" y="15" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#4338CA" text-anchor="middle">Separator</text>
    </g>
    <g transform="translate(470, 278)">
      <rect x="0" y="0" width="70" height="22" rx="3" ry="3" fill="#F3F4F6" stroke="#D1D5DB" stroke-width="1"/>
      <text x="35" y="15" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#4B5563" text-anchor="middle">Residual</text>
    </g>
  </g>

  <!-- ==================== INFORMATION BOTTLENECK VISUAL ==================== -->
  <g id="bottleneck">
    <!-- Funnel shape suggesting information compression -->
    <path d="M200 310 L250 360 L550 360 L600 310" fill="url(#bottleneckGradient)" stroke="none"/>
    <path d="M200 310 L250 360" fill="none" stroke="#8B5CF6" stroke-width="1" stroke-dasharray="4,3" opacity="0.6"/>
    <path d="M600 310 L550 360" fill="none" stroke="#8B5CF6" stroke-width="1" stroke-dasharray="4,3" opacity="0.6"/>

    <!-- Bottleneck label -->
    <text x="400" y="345" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#7C3AED" text-anchor="middle" font-style="italic">Information Bottleneck</text>
  </g>

  <!-- ==================== THREE OUTPUT ARROWS ==================== -->
  <g id="output-arrows">
    <!-- Central split point -->
    <line x1="400" y1="310" x2="400" y2="360" stroke="#1F2937" stroke-width="2"/>

    <!-- Three-way split -->
    <line x1="175" y1="380" x2="625" y2="380" stroke="#1F2937" stroke-width="1.5"/>

    <!-- To K (leftmost) -->
    <line x1="175" y1="380" x2="175" y2="410" stroke="#8B5CF6" stroke-width="2" marker-end="url(#arrow-purple)"/>

    <!-- To z_n (middle) -->
    <line x1="400" y1="380" x2="400" y2="410" stroke="#3B82F6" stroke-width="2" marker-end="url(#arrow-blue)"/>

    <!-- To z_tex (rightmost) -->
    <line x1="625" y1="380" x2="625" y2="410" stroke="#9CA3AF" stroke-width="2" marker-end="url(#arrow-gray)"/>
  </g>

  <!-- ==================== K (MACRO REGISTER) ==================== -->
  <g id="k-macro">
    <rect x="75" y="420" width="200" height="165" rx="8" ry="8" fill="#FAF5FF" stroke="#8B5CF6" stroke-width="2.5"/>

    <!-- Header -->
    <rect x="75" y="420" width="200" height="35" rx="8" ry="8" fill="#8B5CF6"/>
    <rect x="75" y="447" width="200" height="10" fill="#8B5CF6"/>
    <text x="175" y="444" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="700" fill="white" text-anchor="middle">K</text>

    <!-- Subtitle -->
    <text x="175" y="475" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#7C3AED" text-anchor="middle">Macro Register</text>
    <text x="175" y="492" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#6B7280" text-anchor="middle">Discrete symbol</text>

    <!-- Codebook visualization -->
    <g transform="translate(110, 502)">
      <text x="65" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#7C3AED" text-anchor="middle">Codebook {e</text>
      <text x="107" y="3" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#7C3AED" text-anchor="middle">k</text>
      <text x="115" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#7C3AED" text-anchor="middle">}</text>

      <!-- Grid of codebook entries -->
      <g transform="translate(15, 8)">
        <rect x="0" y="0" width="18" height="18" rx="2" fill="#C4B5FD" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="22" y="0" width="18" height="18" rx="2" fill="#DDD6FE" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="44" y="0" width="18" height="18" rx="2" fill="#C4B5FD" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="66" y="0" width="18" height="18" rx="2" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="88" y="0" width="18" height="18" rx="2" fill="#DDD6FE" stroke="#8B5CF6" stroke-width="1"/>

        <rect x="0" y="22" width="18" height="18" rx="2" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="22" y="22" width="18" height="18" rx="2" fill="#C4B5FD" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="44" y="22" width="18" height="18" rx="2" fill="#8B5CF6" stroke="#7C3AED" stroke-width="1.5"/>
        <rect x="66" y="22" width="18" height="18" rx="2" fill="#DDD6FE" stroke="#8B5CF6" stroke-width="1"/>
        <rect x="88" y="22" width="18" height="18" rx="2" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1"/>

        <!-- Selected indicator -->
        <circle cx="53" cy="31" r="3" fill="white"/>
      </g>
    </g>

    <!-- Property -->
    <text x="175" y="570" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280" text-anchor="middle" font-style="italic">Control-relevant</text>
  </g>

  <!-- ==================== z_n (NUISANCE RESIDUAL) ==================== -->
  <g id="zn-nuisance">
    <rect x="300" y="420" width="200" height="165" rx="8" ry="8" fill="#EFF6FF" stroke="#3B82F6" stroke-width="2.5"/>

    <!-- Header -->
    <rect x="300" y="420" width="200" height="35" rx="8" ry="8" fill="#3B82F6"/>
    <rect x="300" y="447" width="200" height="10" fill="#3B82F6"/>
    <text x="400" y="444" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="700" fill="white" text-anchor="middle">z</text>
    <text x="412" y="448" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white" text-anchor="middle">n</text>

    <!-- Subtitle -->
    <text x="400" y="475" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#2563EB" text-anchor="middle">Nuisance Residual</text>
    <text x="400" y="492" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#6B7280" text-anchor="middle">Continuous, structured</text>

    <!-- Visual representation (wave/continuous) -->
    <g transform="translate(325, 505)">
      <path d="M0 25 Q 25 5, 50 25 Q 75 45, 100 25 Q 125 5, 150 25" fill="none" stroke="#3B82F6" stroke-width="2" opacity="0.7"/>
      <path d="M0 35 Q 25 20, 50 35 Q 75 50, 100 35 Q 125 20, 150 35" fill="none" stroke="#60A5FA" stroke-width="1.5" opacity="0.5"/>
    </g>

    <!-- Properties -->
    <text x="400" y="555" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280" text-anchor="middle">Pose / basis / disturbance</text>
    <text x="400" y="570" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280" text-anchor="middle" font-style="italic">Auditable, actuation</text>
  </g>

  <!-- ==================== z_tex (TEXTURE RESIDUAL) ==================== -->
  <g id="ztex-texture">
    <rect x="525" y="420" width="200" height="165" rx="8" ry="8" fill="#F9FAFB" stroke="#9CA3AF" stroke-width="2.5"/>

    <!-- Header -->
    <rect x="525" y="420" width="200" height="35" rx="8" ry="8" fill="#9CA3AF"/>
    <rect x="525" y="447" width="200" height="10" fill="#9CA3AF"/>
    <text x="625" y="444" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="700" fill="white" text-anchor="middle">z</text>
    <text x="640" y="448" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white" text-anchor="middle">tex</text>

    <!-- Subtitle -->
    <text x="625" y="475" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#6B7280" text-anchor="middle">Texture Residual</text>
    <text x="625" y="492" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF" text-anchor="middle">Continuous, high-entropy</text>

    <!-- Visual representation (noise/texture) -->
    <g transform="translate(555, 502)">
      <rect x="0" y="0" width="140" height="45" rx="3" fill="#F3F4F6"/>
      <!-- Random dots suggesting texture/noise -->
      <circle cx="12" cy="10" r="2" fill="#D1D5DB"/>
      <circle cx="28" cy="18" r="1.5" fill="#9CA3AF"/>
      <circle cx="45" cy="8" r="2" fill="#D1D5DB"/>
      <circle cx="62" cy="22" r="1.5" fill="#9CA3AF"/>
      <circle cx="78" cy="12" r="2" fill="#D1D5DB"/>
      <circle cx="95" cy="28" r="1.5" fill="#9CA3AF"/>
      <circle cx="112" cy="15" r="2" fill="#D1D5DB"/>
      <circle cx="128" cy="35" r="1.5" fill="#9CA3AF"/>
      <circle cx="20" cy="32" r="1.5" fill="#9CA3AF"/>
      <circle cx="55" cy="38" r="2" fill="#D1D5DB"/>
      <circle cx="88" cy="40" r="1.5" fill="#9CA3AF"/>
      <circle cx="105" cy="6" r="2" fill="#D1D5DB"/>
      <circle cx="35" cy="42" r="1.5" fill="#9CA3AF"/>
      <circle cx="72" cy="32" r="2" fill="#D1D5DB"/>
      <circle cx="120" cy="25" r="1.5" fill="#9CA3AF"/>
    </g>

    <!-- Properties -->
    <text x="625" y="555" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#9CA3AF" text-anchor="middle">Reconstruction only</text>
    <text x="625" y="570" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#9CA3AF" text-anchor="middle" font-style="italic">Firewall-restricted</text>
  </g>

  <!-- ==================== SEPARATION / FIREWALL ==================== -->
  <g id="firewall">
    <!-- Vertical dashed line between z_n and z_tex -->
    <line x1="512" y1="420" x2="512" y2="585" stroke="#EF4444" stroke-width="2" stroke-dasharray="8,4"/>
    <text x="512" y="600" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#EF4444" text-anchor="middle">FIREWALL</text>
  </g>

  <!-- ==================== BOTTOM ANNOTATIONS ==================== -->
  <g id="annotations">
    <!-- Control-relevant bracket -->
    <path d="M75 595 L75 605 L500 605 L500 595" fill="none" stroke="#2563EB" stroke-width="1.5"/>
    <text x="287" y="622" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#2563EB" text-anchor="middle">Control-Relevant (K, z</text>
    <text x="370" y="626" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#2563EB" text-anchor="middle">n</text>
    <text x="378" y="622" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#2563EB" text-anchor="middle">)</text>

    <!-- Reconstruction-only bracket -->
    <path d="M525 595 L525 605 L725 605 L725 595" fill="none" stroke="#9CA3AF" stroke-width="1.5"/>
    <text x="625" y="622" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="500" fill="#6B7280" text-anchor="middle">Reconstruction Only</text>

    <!-- Mathematical properties box -->
    <rect x="150" y="645" width="500" height="60" rx="8" ry="8" fill="#F9FAFB" stroke="#E5E7EB" stroke-width="1.5"/>
    <text x="400" y="665" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#1F2937" text-anchor="middle">Key Properties</text>

    <!-- Rate bound -->
    <text x="250" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#7C3AED" text-anchor="middle" font-style="italic">I(X; K)</text>
    <text x="290" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#1F2937" text-anchor="middle">&#8804;</text>
    <text x="315" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#7C3AED" text-anchor="middle" font-style="italic">H(K)</text>
    <text x="350" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#1F2937" text-anchor="middle">&#8804;</text>
    <text x="390" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#7C3AED" text-anchor="middle" font-style="italic">log|K|</text>

    <!-- Invariance -->
    <text x="530" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#1F2937" text-anchor="middle">Invariant to</text>
    <text x="610" y="688" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#2563EB" text-anchor="middle" font-style="italic">G</text>
    <text x="625" y="692" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#2563EB" text-anchor="middle">spatial</text>
  </g>

  <!-- ==================== LEGEND ==================== -->
  <g id="legend" transform="translate(630, 85)">
    <rect x="0" y="0" width="140" height="100" rx="6" ry="6" fill="#FAFAFA" stroke="#E5E7EB" stroke-width="1"/>
    <text x="70" y="18" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#6B7280" text-anchor="middle">LEGEND</text>

    <!-- K -->
    <rect x="15" y="30" width="20" height="12" rx="2" fill="#F3E8FF" stroke="#8B5CF6" stroke-width="1.5"/>
    <text x="45" y="40" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280">Discrete (K)</text>

    <!-- z_n -->
    <rect x="15" y="50" width="20" height="12" rx="2" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1.5"/>
    <text x="45" y="60" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280">Nuisance (z</text>
    <text x="87" y="63" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#6B7280">n</text>
    <text x="93" y="60" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280">)</text>

    <!-- z_tex -->
    <rect x="15" y="70" width="20" height="12" rx="2" fill="#F9FAFB" stroke="#9CA3AF" stroke-width="1.5"/>
    <text x="45" y="80" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280">Texture (z</text>
    <text x="84" y="83" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#6B7280">tex</text>
    <text x="98" y="80" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#6B7280">)</text>
  </g>

</svg>
