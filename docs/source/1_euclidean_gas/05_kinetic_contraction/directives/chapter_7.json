{
  "chapter_index": 7,
  "section_id": "## 7. Boundary Potential Contraction via Confining Potential",
  "directive_count": 4,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-boundary-potential-recall",
      "title": "Boundary Potential (Recall)",
      "start_line": 2758,
      "end_line": 2771,
      "header_lines": [
        2759
      ],
      "content_start": 2761,
      "content_end": 2770,
      "content": "2761: :label: def-boundary-potential-recall\n2762: \n2763: From 03_cloning.md Definition 3.3.1:\n2764: \n2765: $$\n2766: W_b(S_1, S_2) = \\frac{1}{N}\\sum_{k=1,2} \\sum_{i \\in \\mathcal{A}(S_k)} \\varphi_{\\text{barrier}}(x_{k,i})\n2767: \n2768: $$\n2769: \n2770: where $\\varphi_{\\text{barrier}}: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}_{\\geq 0}$ is the smooth barrier function that:",
      "metadata": {
        "label": "def-boundary-potential-recall"
      },
      "section": "## 7. Boundary Potential Contraction via Confining Potential",
      "references": [],
      "raw_directive": "2758: ### 7.2. Boundary Potential (Recall)\n2759: \n2760: :::{prf:definition} Boundary Potential (Recall)\n2761: :label: def-boundary-potential-recall\n2762: \n2763: From 03_cloning.md Definition 3.3.1:\n2764: \n2765: $$\n2766: W_b(S_1, S_2) = \\frac{1}{N}\\sum_{k=1,2} \\sum_{i \\in \\mathcal{A}(S_k)} \\varphi_{\\text{barrier}}(x_{k,i})\n2767: \n2768: $$\n2769: \n2770: where $\\varphi_{\\text{barrier}}: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}_{\\geq 0}$ is the smooth barrier function that:\n2771: - Equals zero in the safe interior"
    },
    {
      "directive_type": "theorem",
      "label": "thm-boundary-potential-contraction-kinetic",
      "title": "Boundary Potential Contraction Under Kinetic Operator",
      "start_line": 2775,
      "end_line": 2790,
      "header_lines": [
        2776
      ],
      "content_start": 2778,
      "content_end": 2789,
      "content": "2778: :label: thm-boundary-potential-contraction-kinetic\n2779: \n2780: Under the axioms of Chapter 3, particularly the confining potential axiom, the boundary potential satisfies:\n2781: \n2782: $$\n2783: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau\n2784: \n2785: $$\n2786: \n2787: where:\n2788: - $\\kappa_{\\text{pot}} > 0$ depends on the strength of the confining force near the boundary\n2789: - $C_{\\text{pot}}$ accounts for noise-induced boundary approach",
      "metadata": {
        "label": "thm-boundary-potential-contraction-kinetic"
      },
      "section": "## 7. Boundary Potential Contraction via Confining Potential",
      "references": [],
      "raw_directive": "2775: ### 7.3. Main Theorem: Potential-Driven Safety\n2776: \n2777: :::{prf:theorem} Boundary Potential Contraction Under Kinetic Operator\n2778: :label: thm-boundary-potential-contraction-kinetic\n2779: \n2780: Under the axioms of Chapter 3, particularly the confining potential axiom, the boundary potential satisfies:\n2781: \n2782: $$\n2783: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau\n2784: \n2785: $$\n2786: \n2787: where:\n2788: - $\\kappa_{\\text{pot}} > 0$ depends on the strength of the confining force near the boundary\n2789: - $C_{\\text{pot}}$ accounts for noise-induced boundary approach\n2790: "
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-boundary-potential-contraction-kinetic",
      "title": "Boundary Potential Contraction from Confining Force",
      "start_line": 2794,
      "end_line": 3170,
      "header_lines": [
        2795
      ],
      "content_start": 2796,
      "content_end": 3169,
      "content": "2796: :::{prf:proof} Boundary Potential Contraction from Confining Force\n2797: :label: proof-thm-boundary-potential-contraction-kinetic\n2798: **Proof (Velocity-Weighted Lyapunov with Corrected Signs).**\n2799: \n2800: This proof establishes that the confining potential $U$ creates negative drift for the boundary potential $W_b$ through alignment between the inward-pointing force $F = -\\nabla U$ and the outward-pointing barrier gradient $\\nabla\\varphi_{\\text{barrier}}$.\n2801: \n2802: **PART I: Barrier Function Specification**\n2803: \n2804: We use an **exponential-distance barrier** on a boundary layer to ensure controlled derivatives. Let $\\rho: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}$ be the **signed distance function**:\n2805: \n2806: $$\n2807: \\rho(x) = \\begin{cases}\n2808: -\\text{dist}(x, \\partial\\mathcal{X}_{\\text{valid}}) & \\text{if } x \\in \\mathcal{X}_{\\text{valid}} \\\\\n2809: 0 & \\text{if } x \\in \\partial\\mathcal{X}_{\\text{valid}}\n2810: \\end{cases}\n2811: \n2812: $$\n2813: \n2814: so $\\rho < 0$ in the interior and $\\nabla\\rho = \\vec{n}(x)$ (outward unit normal) near the boundary.\n2815: \n2816: **Barrier construction:** Fix $\\delta > 0$ (boundary layer width) and $c > 0$ (barrier strength). Define:\n2817: \n2818: $$\n2819: \\varphi_{\\text{barrier}}(x) = \\begin{cases}\n2820: 0 & \\text{if } \\rho(x) < -\\delta \\text{ (safe interior)} \\\\\n2821: \\exp\\left(\\frac{c \\cdot \\rho(x)}{\\delta}\\right) & \\text{if } -\\delta \\leq \\rho(x) < 0 \\text{ (boundary layer)} \\\\\n2822: +\\infty & \\text{if } x \\notin \\mathcal{X}_{\\text{valid}}\n2823: \\end{cases}\n2824: \n2825: $$\n2826: \n2827: with smooth transition at $\\rho = -\\delta$.\n2828: \n2829: **Geometric properties in the boundary layer** ($-\\delta \\leq \\rho < 0$):\n2830: \n2831: 1. **Gradient alignment:**\n2832: \n2833: $$\n2834: \\nabla\\varphi = \\frac{c}{\\delta} \\varphi \\cdot \\nabla\\rho = \\frac{c}{\\delta} \\varphi \\cdot \\vec{n}(x)\n2835: \n2836: $$\n2837: \n2838: where $\\vec{n}(x)$ is the outward unit normal. This gives:\n2839: \n2840: $$\n2841: \\|\\nabla\\varphi\\| = \\frac{c}{\\delta} \\varphi\n2842: \n2843: $$\n2844: \n2845: 2. **Hessian bound:** Assuming $\\mathcal{X}_{\\text{valid}}$ has $C^2$ boundary with bounded principal curvatures $\\|\\nabla\\vec{n}\\| \\leq K_{\\text{curv}}$:\n2846: \n2847: $$\n2848: \\nabla^2\\varphi = \\frac{c}{\\delta}\\varphi \\nabla\\vec{n} + \\left(\\frac{c}{\\delta}\\right)^2 \\varphi \\, \\vec{n}\\vec{n}^T\n2849: \n2850: $$\n2851: \n2852: Thus:\n2853: \n2854: $$\n2855: v^T (\\nabla^2\\varphi) v \\leq \\varphi \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\|v\\|^2\n2856: \n2857: $$\n2858: \n2859: **PART II: Compatibility Condition (Corrected Sign)**\n2860: \n2861: By {prf:ref}`axiom-confining-potential` part 4, the confining force satisfies:\n2862: \n2863: $$\n2864: \\langle \\vec{n}(x), F(x) \\rangle \\leq -\\alpha_{\\text{boundary}} \\quad \\text{for } \\text{dist}(x, \\partial\\mathcal{X}_{\\text{valid}}) < \\delta_{\\text{boundary}}\n2865: \n2866: $$\n2867: \n2868: where $\\vec{n}(x)$ is the **outward** unit normal.\n2869: \n2870: In the boundary layer, using $\\nabla\\varphi = \\frac{c}{\\delta}\\varphi \\cdot \\vec{n}$:\n2871: \n2872: $$\n2873: \\langle F(x), \\nabla\\varphi(x) \\rangle = \\frac{c}{\\delta}\\varphi(x) \\langle F(x), \\vec{n}(x) \\rangle \\leq -\\frac{c}{\\delta} \\alpha_{\\text{boundary}} \\varphi(x)\n2874: \n2875: $$\n2876: \n2877: **Key inequality (correct sign):**\n2878: \n2879: $$\n2880: \\langle F(x), \\nabla\\varphi(x) \\rangle \\leq -\\alpha_{\\text{align}} \\varphi(x)\n2881: \n2882: $$\n2883: \n2884: where $\\alpha_{\\text{align}} := \\frac{c}{\\delta} \\alpha_{\\text{boundary}} > 0$.\n2885: \n2886: **Physical interpretation:** The confining force $F$ points **inward** (toward safe region), the barrier gradient $\\nabla\\varphi$ points **outward** (away from safe region), so their inner product is **negative**. This creates the **negative drift** needed for contraction.\n2887: \n2888: **PART III: Velocity-Weighted Lyapunov Function**\n2889: \n2890: For particle $i$, define:\n2891: \n2892: $$\n2893: \\Phi_i := \\varphi_i + \\epsilon \\langle v_i, \\nabla\\varphi_i \\rangle\n2894: \n2895: $$\n2896: \n2897: where $\\varphi_i = \\varphi_{\\text{barrier}}(x_i)$ and $\\epsilon > 0$ is a coupling parameter (to be optimized).\n2898: \n2899: **Rationale:**\n2900: - $\\varphi_i$ measures current proximity to boundary\n2901: - $\\langle v_i, \\nabla\\varphi_i \\rangle$ measures velocity component **toward** boundary\n2902: - The coupling balances position and velocity contributions to achieve net contraction\n2903: \n2904: **PART IV: Generator Calculation (Corrected)**\n2905: \n2906: Apply the Fokker-Planck generator $\\mathcal{L}$ from {prf:ref}`def-generator`:\n2907: \n2908: $$\n2909: \\mathcal{L}f = v \\cdot \\nabla_x f + (F - \\gamma v) \\cdot \\nabla_v f + \\frac{1}{2}\\text{Tr}(A \\nabla_v^2 f)\n2910: \n2911: $$\n2912: \n2913: where $A = \\Sigma\\Sigma^T$ is the velocity diffusion matrix.\n2914: \n2915: **Term 1: Generator of $\\varphi_i$**\n2916: \n2917: Since $\\varphi_i = \\varphi(x_i)$ (no velocity dependence):\n2918: \n2919: $$\n2920: \\mathcal{L}\\varphi_i = v_i \\cdot \\nabla\\varphi_i + (F(x_i) - \\gamma v_i) \\cdot \\underbrace{\\nabla_v \\varphi_i}_{=0} + \\frac{1}{2}\\text{Tr}(A_i \\underbrace{\\nabla_v^2 \\varphi_i}_{=0})\n2921: \n2922: $$\n2923: \n2924: $$\n2925: = v_i \\cdot \\nabla\\varphi_i\n2926: \n2927: $$\n2928: \n2929: **Term 2: Generator of $\\langle v_i, \\nabla\\varphi_i \\rangle$ (CRITICAL CORRECTION)**\n2930: \n2931: Let $g(x, v) := \\langle v, \\nabla\\varphi(x) \\rangle$.\n2932: \n2933: **Velocity derivatives:**\n2934: \n2935: $$\n2936: \\nabla_v g = \\nabla\\varphi(x)\n2937: \n2938: $$\n2939: \n2940: $$\n2941: \\nabla_v^2 g = 0 \\quad \\text{(linear in } v \\text{, no second derivative!)}\n2942: \n2943: $$\n2944: \n2945: **Position derivatives:**\n2946: \n2947: $$\n2948: \\nabla_x g = (\\nabla^2\\varphi) v\n2949: \n2950: $$\n2951: \n2952: so:\n2953: \n2954: $$\n2955: v \\cdot \\nabla_x g = v^T (\\nabla^2\\varphi) v\n2956: \n2957: $$\n2958: \n2959: **Generator:**\n2960: \n2961: $$\n2962: \\mathcal{L}g = v^T (\\nabla^2\\varphi) v + (F - \\gamma v) \\cdot \\nabla\\varphi + \\frac{1}{2}\\text{Tr}(A \\underbrace{\\nabla_v^2 g}_{=0})\n2963: \n2964: $$\n2965: \n2966: $$\n2967: = v^T (\\nabla^2\\varphi) v + \\langle F, \\nabla\\varphi \\rangle - \\gamma \\langle v, \\nabla\\varphi \\rangle\n2968: \n2969: $$\n2970: \n2971: **Critical note:** The diffusion term vanishes because $g$ is **linear in $v$**, so $\\nabla_v^2 g = 0$. The original proof incorrectly included $\\frac{1}{2}\\text{Tr}(A \\nabla^2\\varphi)$, which mixes velocity diffusion with position Hessian \u2014 this is **wrong**.\n2972: \n2973: **PART V: Combine Terms**\n2974: \n2975: $$\n2976: \\mathcal{L}\\Phi_i = \\mathcal{L}\\varphi_i + \\epsilon \\mathcal{L}\\langle v_i, \\nabla\\varphi_i \\rangle\n2977: \n2978: $$\n2979: \n2980: $$\n2981: = v_i \\cdot \\nabla\\varphi_i + \\epsilon\\left[v_i^T (\\nabla^2\\varphi_i) v_i + \\langle F(x_i), \\nabla\\varphi_i \\rangle - \\gamma \\langle v_i, \\nabla\\varphi_i \\rangle\\right]\n2982: \n2983: $$\n2984: \n2985: $$\n2986: = (1 - \\epsilon\\gamma) \\langle v_i, \\nabla\\varphi_i \\rangle + \\epsilon \\langle F(x_i), \\nabla\\varphi_i \\rangle + \\epsilon v_i^T (\\nabla^2\\varphi_i) v_i\n2987: \n2988: $$\n2989: \n2990: **PART VI: Optimal Choice of $\\epsilon$**\n2991: \n2992: Choose $\\epsilon = \\frac{1}{\\gamma}$ to **completely eliminate** the cross-term:\n2993: \n2994: $$\n2995: 1 - \\epsilon\\gamma = 1 - \\frac{1}{\\gamma} \\cdot \\gamma = 0\n2996: \n2997: $$\n2998: \n2999: This gives:\n3000: \n3001: $$\n3002: \\mathcal{L}\\Phi_i = \\frac{1}{\\gamma}\\langle F(x_i), \\nabla\\varphi_i \\rangle + \\frac{1}{\\gamma} v_i^T (\\nabla^2\\varphi_i) v_i\n3003: \n3004: $$\n3005: \n3006: **PART VII: Apply Corrected Compatibility and Hessian Bounds**\n3007: \n3008: In the boundary layer ($-\\delta \\leq \\rho(x_i) < 0$):\n3009: \n3010: **Compatibility (corrected sign):**\n3011: \n3012: $$\n3013: \\langle F(x_i), \\nabla\\varphi_i \\rangle \\leq -\\alpha_{\\text{align}} \\varphi_i\n3014: \n3015: $$\n3016: \n3017: where $\\alpha_{\\text{align}} = \\frac{c}{\\delta} \\alpha_{\\text{boundary}}$.\n3018: \n3019: **Hessian bound:**\n3020: \n3021: $$\n3022: v_i^T (\\nabla^2\\varphi_i) v_i \\leq \\varphi_i \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\|v_i\\|^2\n3023: \n3024: $$\n3025: \n3026: Define:\n3027: \n3028: $$\n3029: K_{\\varphi} := \\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\n3030: \n3031: $$\n3032: \n3033: **PART VIII: Substitute and Bound**\n3034: \n3035: $$\n3036: \\mathcal{L}\\Phi_i \\leq \\frac{1}{\\gamma}\\left[-\\alpha_{\\text{align}} \\varphi_i + K_{\\varphi} \\varphi_i \\|v_i\\|^2\\right]\n3037: \n3038: $$\n3039: \n3040: $$\n3041: = \\frac{\\varphi_i}{\\gamma}\\left[K_{\\varphi} \\|v_i\\|^2 - \\alpha_{\\text{align}}\\right]\n3042: \n3043: $$\n3044: \n3045: **Velocity moment bound from Chapter 5:** By {prf:ref}`thm-velocity-variance-contraction-kinetic`, the kinetic operator maintains:\n3046: \n3047: $$\n3048: \\mathbb{E}[\\|v_i\\|^2] \\leq V_{\\text{Var},v}^{\\text{eq}} := \\frac{d\\sigma_{\\max}^2}{2\\gamma}\n3049: \n3050: $$\n3051: \n3052: for all $i$ in equilibrium (or near-equilibrium during drift analysis).\n3053: \n3054: **Taking expectation:**\n3055: \n3056: $$\n3057: \\mathbb{E}[\\mathcal{L}\\Phi_i] \\leq \\frac{\\varphi_i}{\\gamma}\\left[K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}} - \\alpha_{\\text{align}}\\right]\n3058: \n3059: $$\n3060: \n3061: **PART IX: Barrier Parameter Selection for Contraction**\n3062: \n3063: To ensure **negative drift**, we need:\n3064: \n3065: $$\n3066: K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}} < \\alpha_{\\text{align}}\n3067: \n3068: $$\n3069: \n3070: Substituting definitions:\n3071: \n3072: $$\n3073: \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\frac{d\\sigma_{\\max}^2}{2\\gamma} < \\frac{c}{\\delta} \\alpha_{\\text{boundary}}\n3074: \n3075: $$\n3076: \n3077: Multiply both sides by $\\frac{\\delta}{c}$ (assuming $c > 0$):\n3078: \n3079: $$\n3080: \\left[\\frac{c}{\\delta} + K_{\\text{curv}}\\right] \\frac{d\\sigma_{\\max}^2}{2\\gamma} < \\alpha_{\\text{boundary}}\n3081: \n3082: $$\n3083: \n3084: **Sufficient condition:** Choose $c$ small enough:\n3085: \n3086: $$\n3087: c < \\delta \\left[\\frac{2\\gamma \\alpha_{\\text{boundary}}}{d\\sigma_{\\max}^2} - K_{\\text{curv}}\\right]\n3088: \n3089: $$\n3090: \n3091: This is **always achievable** provided $\\alpha_{\\text{boundary}} > \\frac{K_{\\text{curv}} d\\sigma_{\\max}^2}{2\\gamma}$, which is guaranteed by {prf:ref}`axiom-confining-potential` part 4 for sufficiently strong confining potential.\n3092: \n3093: **Resulting contraction rate:**\n3094: \n3095: $$\n3096: \\kappa_{\\text{pot}} := \\frac{1}{\\gamma}\\left[\\alpha_{\\text{align}} - K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}}\\right] = \\frac{1}{\\gamma}\\left[\\frac{c}{\\delta}\\alpha_{\\text{boundary}} - \\left(\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta}K_{\\text{curv}}\\right)\\frac{d\\sigma_{\\max}^2}{2\\gamma}\\right] > 0\n3097: \n3098: $$\n3099: \n3100: **PART X: Aggregate Over All Particles**\n3101: \n3102: Sum over all particles:\n3103: \n3104: $$\n3105: \\sum_{k,i} \\mathbb{E}[\\mathcal{L}\\Phi_{k,i}] \\leq -\\kappa_{\\text{pot}} \\sum_{k,i} \\varphi_{k,i} + C_{\\text{interior}}\n3106: \n3107: $$\n3108: \n3109: where $C_{\\text{interior}}$ accounts for particles in the safe interior (where $\\varphi = 0$) and the smooth transition region.\n3110: \n3111: Recall:\n3112: \n3113: $$\n3114: W_b = \\frac{1}{N}\\sum_{k,i} \\varphi_{\\text{barrier}}(x_{k,i})\n3115: \n3116: $$\n3117: \n3118: Thus:\n3119: \n3120: $$\n3121: \\frac{1}{N}\\sum_{k,i} \\mathbb{E}[\\mathcal{L}\\Phi_{k,i}] \\leq -\\kappa_{\\text{pot}} W_b + C_{\\text{pot}}\n3122: \n3123: $$\n3124: \n3125: where $C_{\\text{pot}} = \\frac{C_{\\text{interior}}}{N}$ is independent of $W_b$ (depends only on geometry and equilibrium statistics).\n3126: \n3127: **PART XI: Discrete-Time Version**\n3128: \n3129: By {prf:ref}`thm-discretization` (Discrete-Time Inheritance of Generator Drift), the continuous-time drift translates to discrete-time:\n3130: \n3131: $$\n3132: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau + O(\\tau^2)\n3133: \n3134: $$\n3135: \n3136: For sufficiently small $\\tau$, the $O(\\tau^2)$ term is absorbed into the modified constant.\n3137: \n3138: **Final result:**\n3139: \n3140: $$\n3141: \\boxed{\\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau}\n3142: \n3143: $$\n3144: \n3145: **Explicit constants:**\n3146: \n3147: $$\n3148: \\kappa_{\\text{pot}} = \\frac{1}{\\gamma}\\left[\\frac{c}{\\delta}\\alpha_{\\text{boundary}} - \\left(\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta}K_{\\text{curv}}\\right)\\frac{d\\sigma_{\\max}^2}{2\\gamma}\\right]\n3149: \n3150: $$\n3151: \n3152: $$\n3153: C_{\\text{pot}} = O(1) \\quad \\text{(geometry-dependent)}\n3154: \n3155: $$\n3156: \n3157: **PART XII: Physical Interpretation**\n3158: \n3159: This result demonstrates:\n3160: \n3161: 1. **Confining force creates drift:** The negative alignment $\\langle F, \\nabla\\varphi \\rangle \\leq -\\alpha_{\\text{align}}\\varphi$ ensures particles near the boundary are pushed inward, creating negative drift in $\\varphi$.\n3162: \n3163: 2. **Velocity-weighted correction:** The term $\\epsilon\\langle v, \\nabla\\varphi \\rangle$ with $\\epsilon = \\frac{1}{\\gamma}$ captures particles **moving toward** the boundary, allowing the generator to act on both position and momentum.\n3164: \n3165: 3. **Hessian competition:** The Hessian term $v^T(\\nabla^2\\varphi)v$ represents curvature effects that can add positive drift. For small $c$ (weak barrier strength), this is dominated by the negative alignment term.\n3166: \n3167: 4. **Independent safety mechanism:** This contraction is **independent** of cloning \u2014 it's a fundamental property of the confining potential $U$. Combined with the Safe Harbor mechanism (03_cloning.md, Ch 11), this provides **layered defense** against extinction.\n3168: \n3169: 5. **Parameter tradeoff:** Smaller $c$ gives stronger contraction (larger $\\kappa_{\\text{pot}}$) but weaker barrier strength. The choice balances safety (keep $\\varphi$ finite) with convergence speed.",
      "metadata": {
        "label": "proof-thm-boundary-potential-contraction-kinetic"
      },
      "section": "## 7. Boundary Potential Contraction via Confining Potential",
      "references": [
        "axiom-confining-potential",
        "def-generator",
        "thm-velocity-variance-contraction-kinetic",
        "thm-discretization"
      ],
      "raw_directive": "2794: ### 7.4. Proof\n2795: \n2796: :::{prf:proof} Boundary Potential Contraction from Confining Force\n2797: :label: proof-thm-boundary-potential-contraction-kinetic\n2798: **Proof (Velocity-Weighted Lyapunov with Corrected Signs).**\n2799: \n2800: This proof establishes that the confining potential $U$ creates negative drift for the boundary potential $W_b$ through alignment between the inward-pointing force $F = -\\nabla U$ and the outward-pointing barrier gradient $\\nabla\\varphi_{\\text{barrier}}$.\n2801: \n2802: **PART I: Barrier Function Specification**\n2803: \n2804: We use an **exponential-distance barrier** on a boundary layer to ensure controlled derivatives. Let $\\rho: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}$ be the **signed distance function**:\n2805: \n2806: $$\n2807: \\rho(x) = \\begin{cases}\n2808: -\\text{dist}(x, \\partial\\mathcal{X}_{\\text{valid}}) & \\text{if } x \\in \\mathcal{X}_{\\text{valid}} \\\\\n2809: 0 & \\text{if } x \\in \\partial\\mathcal{X}_{\\text{valid}}\n2810: \\end{cases}\n2811: \n2812: $$\n2813: \n2814: so $\\rho < 0$ in the interior and $\\nabla\\rho = \\vec{n}(x)$ (outward unit normal) near the boundary.\n2815: \n2816: **Barrier construction:** Fix $\\delta > 0$ (boundary layer width) and $c > 0$ (barrier strength). Define:\n2817: \n2818: $$\n2819: \\varphi_{\\text{barrier}}(x) = \\begin{cases}\n2820: 0 & \\text{if } \\rho(x) < -\\delta \\text{ (safe interior)} \\\\\n2821: \\exp\\left(\\frac{c \\cdot \\rho(x)}{\\delta}\\right) & \\text{if } -\\delta \\leq \\rho(x) < 0 \\text{ (boundary layer)} \\\\\n2822: +\\infty & \\text{if } x \\notin \\mathcal{X}_{\\text{valid}}\n2823: \\end{cases}\n2824: \n2825: $$\n2826: \n2827: with smooth transition at $\\rho = -\\delta$.\n2828: \n2829: **Geometric properties in the boundary layer** ($-\\delta \\leq \\rho < 0$):\n2830: \n2831: 1. **Gradient alignment:**\n2832: \n2833: $$\n2834: \\nabla\\varphi = \\frac{c}{\\delta} \\varphi \\cdot \\nabla\\rho = \\frac{c}{\\delta} \\varphi \\cdot \\vec{n}(x)\n2835: \n2836: $$\n2837: \n2838: where $\\vec{n}(x)$ is the outward unit normal. This gives:\n2839: \n2840: $$\n2841: \\|\\nabla\\varphi\\| = \\frac{c}{\\delta} \\varphi\n2842: \n2843: $$\n2844: \n2845: 2. **Hessian bound:** Assuming $\\mathcal{X}_{\\text{valid}}$ has $C^2$ boundary with bounded principal curvatures $\\|\\nabla\\vec{n}\\| \\leq K_{\\text{curv}}$:\n2846: \n2847: $$\n2848: \\nabla^2\\varphi = \\frac{c}{\\delta}\\varphi \\nabla\\vec{n} + \\left(\\frac{c}{\\delta}\\right)^2 \\varphi \\, \\vec{n}\\vec{n}^T\n2849: \n2850: $$\n2851: \n2852: Thus:\n2853: \n2854: $$\n2855: v^T (\\nabla^2\\varphi) v \\leq \\varphi \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\|v\\|^2\n2856: \n2857: $$\n2858: \n2859: **PART II: Compatibility Condition (Corrected Sign)**\n2860: \n2861: By {prf:ref}`axiom-confining-potential` part 4, the confining force satisfies:\n2862: \n2863: $$\n2864: \\langle \\vec{n}(x), F(x) \\rangle \\leq -\\alpha_{\\text{boundary}} \\quad \\text{for } \\text{dist}(x, \\partial\\mathcal{X}_{\\text{valid}}) < \\delta_{\\text{boundary}}\n2865: \n2866: $$\n2867: \n2868: where $\\vec{n}(x)$ is the **outward** unit normal.\n2869: \n2870: In the boundary layer, using $\\nabla\\varphi = \\frac{c}{\\delta}\\varphi \\cdot \\vec{n}$:\n2871: \n2872: $$\n2873: \\langle F(x), \\nabla\\varphi(x) \\rangle = \\frac{c}{\\delta}\\varphi(x) \\langle F(x), \\vec{n}(x) \\rangle \\leq -\\frac{c}{\\delta} \\alpha_{\\text{boundary}} \\varphi(x)\n2874: \n2875: $$\n2876: \n2877: **Key inequality (correct sign):**\n2878: \n2879: $$\n2880: \\langle F(x), \\nabla\\varphi(x) \\rangle \\leq -\\alpha_{\\text{align}} \\varphi(x)\n2881: \n2882: $$\n2883: \n2884: where $\\alpha_{\\text{align}} := \\frac{c}{\\delta} \\alpha_{\\text{boundary}} > 0$.\n2885: \n2886: **Physical interpretation:** The confining force $F$ points **inward** (toward safe region), the barrier gradient $\\nabla\\varphi$ points **outward** (away from safe region), so their inner product is **negative**. This creates the **negative drift** needed for contraction.\n2887: \n2888: **PART III: Velocity-Weighted Lyapunov Function**\n2889: \n2890: For particle $i$, define:\n2891: \n2892: $$\n2893: \\Phi_i := \\varphi_i + \\epsilon \\langle v_i, \\nabla\\varphi_i \\rangle\n2894: \n2895: $$\n2896: \n2897: where $\\varphi_i = \\varphi_{\\text{barrier}}(x_i)$ and $\\epsilon > 0$ is a coupling parameter (to be optimized).\n2898: \n2899: **Rationale:**\n2900: - $\\varphi_i$ measures current proximity to boundary\n2901: - $\\langle v_i, \\nabla\\varphi_i \\rangle$ measures velocity component **toward** boundary\n2902: - The coupling balances position and velocity contributions to achieve net contraction\n2903: \n2904: **PART IV: Generator Calculation (Corrected)**\n2905: \n2906: Apply the Fokker-Planck generator $\\mathcal{L}$ from {prf:ref}`def-generator`:\n2907: \n2908: $$\n2909: \\mathcal{L}f = v \\cdot \\nabla_x f + (F - \\gamma v) \\cdot \\nabla_v f + \\frac{1}{2}\\text{Tr}(A \\nabla_v^2 f)\n2910: \n2911: $$\n2912: \n2913: where $A = \\Sigma\\Sigma^T$ is the velocity diffusion matrix.\n2914: \n2915: **Term 1: Generator of $\\varphi_i$**\n2916: \n2917: Since $\\varphi_i = \\varphi(x_i)$ (no velocity dependence):\n2918: \n2919: $$\n2920: \\mathcal{L}\\varphi_i = v_i \\cdot \\nabla\\varphi_i + (F(x_i) - \\gamma v_i) \\cdot \\underbrace{\\nabla_v \\varphi_i}_{=0} + \\frac{1}{2}\\text{Tr}(A_i \\underbrace{\\nabla_v^2 \\varphi_i}_{=0})\n2921: \n2922: $$\n2923: \n2924: $$\n2925: = v_i \\cdot \\nabla\\varphi_i\n2926: \n2927: $$\n2928: \n2929: **Term 2: Generator of $\\langle v_i, \\nabla\\varphi_i \\rangle$ (CRITICAL CORRECTION)**\n2930: \n2931: Let $g(x, v) := \\langle v, \\nabla\\varphi(x) \\rangle$.\n2932: \n2933: **Velocity derivatives:**\n2934: \n2935: $$\n2936: \\nabla_v g = \\nabla\\varphi(x)\n2937: \n2938: $$\n2939: \n2940: $$\n2941: \\nabla_v^2 g = 0 \\quad \\text{(linear in } v \\text{, no second derivative!)}\n2942: \n2943: $$\n2944: \n2945: **Position derivatives:**\n2946: \n2947: $$\n2948: \\nabla_x g = (\\nabla^2\\varphi) v\n2949: \n2950: $$\n2951: \n2952: so:\n2953: \n2954: $$\n2955: v \\cdot \\nabla_x g = v^T (\\nabla^2\\varphi) v\n2956: \n2957: $$\n2958: \n2959: **Generator:**\n2960: \n2961: $$\n2962: \\mathcal{L}g = v^T (\\nabla^2\\varphi) v + (F - \\gamma v) \\cdot \\nabla\\varphi + \\frac{1}{2}\\text{Tr}(A \\underbrace{\\nabla_v^2 g}_{=0})\n2963: \n2964: $$\n2965: \n2966: $$\n2967: = v^T (\\nabla^2\\varphi) v + \\langle F, \\nabla\\varphi \\rangle - \\gamma \\langle v, \\nabla\\varphi \\rangle\n2968: \n2969: $$\n2970: \n2971: **Critical note:** The diffusion term vanishes because $g$ is **linear in $v$**, so $\\nabla_v^2 g = 0$. The original proof incorrectly included $\\frac{1}{2}\\text{Tr}(A \\nabla^2\\varphi)$, which mixes velocity diffusion with position Hessian \u2014 this is **wrong**.\n2972: \n2973: **PART V: Combine Terms**\n2974: \n2975: $$\n2976: \\mathcal{L}\\Phi_i = \\mathcal{L}\\varphi_i + \\epsilon \\mathcal{L}\\langle v_i, \\nabla\\varphi_i \\rangle\n2977: \n2978: $$\n2979: \n2980: $$\n2981: = v_i \\cdot \\nabla\\varphi_i + \\epsilon\\left[v_i^T (\\nabla^2\\varphi_i) v_i + \\langle F(x_i), \\nabla\\varphi_i \\rangle - \\gamma \\langle v_i, \\nabla\\varphi_i \\rangle\\right]\n2982: \n2983: $$\n2984: \n2985: $$\n2986: = (1 - \\epsilon\\gamma) \\langle v_i, \\nabla\\varphi_i \\rangle + \\epsilon \\langle F(x_i), \\nabla\\varphi_i \\rangle + \\epsilon v_i^T (\\nabla^2\\varphi_i) v_i\n2987: \n2988: $$\n2989: \n2990: **PART VI: Optimal Choice of $\\epsilon$**\n2991: \n2992: Choose $\\epsilon = \\frac{1}{\\gamma}$ to **completely eliminate** the cross-term:\n2993: \n2994: $$\n2995: 1 - \\epsilon\\gamma = 1 - \\frac{1}{\\gamma} \\cdot \\gamma = 0\n2996: \n2997: $$\n2998: \n2999: This gives:\n3000: \n3001: $$\n3002: \\mathcal{L}\\Phi_i = \\frac{1}{\\gamma}\\langle F(x_i), \\nabla\\varphi_i \\rangle + \\frac{1}{\\gamma} v_i^T (\\nabla^2\\varphi_i) v_i\n3003: \n3004: $$\n3005: \n3006: **PART VII: Apply Corrected Compatibility and Hessian Bounds**\n3007: \n3008: In the boundary layer ($-\\delta \\leq \\rho(x_i) < 0$):\n3009: \n3010: **Compatibility (corrected sign):**\n3011: \n3012: $$\n3013: \\langle F(x_i), \\nabla\\varphi_i \\rangle \\leq -\\alpha_{\\text{align}} \\varphi_i\n3014: \n3015: $$\n3016: \n3017: where $\\alpha_{\\text{align}} = \\frac{c}{\\delta} \\alpha_{\\text{boundary}}$.\n3018: \n3019: **Hessian bound:**\n3020: \n3021: $$\n3022: v_i^T (\\nabla^2\\varphi_i) v_i \\leq \\varphi_i \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\|v_i\\|^2\n3023: \n3024: $$\n3025: \n3026: Define:\n3027: \n3028: $$\n3029: K_{\\varphi} := \\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\n3030: \n3031: $$\n3032: \n3033: **PART VIII: Substitute and Bound**\n3034: \n3035: $$\n3036: \\mathcal{L}\\Phi_i \\leq \\frac{1}{\\gamma}\\left[-\\alpha_{\\text{align}} \\varphi_i + K_{\\varphi} \\varphi_i \\|v_i\\|^2\\right]\n3037: \n3038: $$\n3039: \n3040: $$\n3041: = \\frac{\\varphi_i}{\\gamma}\\left[K_{\\varphi} \\|v_i\\|^2 - \\alpha_{\\text{align}}\\right]\n3042: \n3043: $$\n3044: \n3045: **Velocity moment bound from Chapter 5:** By {prf:ref}`thm-velocity-variance-contraction-kinetic`, the kinetic operator maintains:\n3046: \n3047: $$\n3048: \\mathbb{E}[\\|v_i\\|^2] \\leq V_{\\text{Var},v}^{\\text{eq}} := \\frac{d\\sigma_{\\max}^2}{2\\gamma}\n3049: \n3050: $$\n3051: \n3052: for all $i$ in equilibrium (or near-equilibrium during drift analysis).\n3053: \n3054: **Taking expectation:**\n3055: \n3056: $$\n3057: \\mathbb{E}[\\mathcal{L}\\Phi_i] \\leq \\frac{\\varphi_i}{\\gamma}\\left[K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}} - \\alpha_{\\text{align}}\\right]\n3058: \n3059: $$\n3060: \n3061: **PART IX: Barrier Parameter Selection for Contraction**\n3062: \n3063: To ensure **negative drift**, we need:\n3064: \n3065: $$\n3066: K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}} < \\alpha_{\\text{align}}\n3067: \n3068: $$\n3069: \n3070: Substituting definitions:\n3071: \n3072: $$\n3073: \\left[\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta} K_{\\text{curv}}\\right] \\frac{d\\sigma_{\\max}^2}{2\\gamma} < \\frac{c}{\\delta} \\alpha_{\\text{boundary}}\n3074: \n3075: $$\n3076: \n3077: Multiply both sides by $\\frac{\\delta}{c}$ (assuming $c > 0$):\n3078: \n3079: $$\n3080: \\left[\\frac{c}{\\delta} + K_{\\text{curv}}\\right] \\frac{d\\sigma_{\\max}^2}{2\\gamma} < \\alpha_{\\text{boundary}}\n3081: \n3082: $$\n3083: \n3084: **Sufficient condition:** Choose $c$ small enough:\n3085: \n3086: $$\n3087: c < \\delta \\left[\\frac{2\\gamma \\alpha_{\\text{boundary}}}{d\\sigma_{\\max}^2} - K_{\\text{curv}}\\right]\n3088: \n3089: $$\n3090: \n3091: This is **always achievable** provided $\\alpha_{\\text{boundary}} > \\frac{K_{\\text{curv}} d\\sigma_{\\max}^2}{2\\gamma}$, which is guaranteed by {prf:ref}`axiom-confining-potential` part 4 for sufficiently strong confining potential.\n3092: \n3093: **Resulting contraction rate:**\n3094: \n3095: $$\n3096: \\kappa_{\\text{pot}} := \\frac{1}{\\gamma}\\left[\\alpha_{\\text{align}} - K_{\\varphi} V_{\\text{Var},v}^{\\text{eq}}\\right] = \\frac{1}{\\gamma}\\left[\\frac{c}{\\delta}\\alpha_{\\text{boundary}} - \\left(\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta}K_{\\text{curv}}\\right)\\frac{d\\sigma_{\\max}^2}{2\\gamma}\\right] > 0\n3097: \n3098: $$\n3099: \n3100: **PART X: Aggregate Over All Particles**\n3101: \n3102: Sum over all particles:\n3103: \n3104: $$\n3105: \\sum_{k,i} \\mathbb{E}[\\mathcal{L}\\Phi_{k,i}] \\leq -\\kappa_{\\text{pot}} \\sum_{k,i} \\varphi_{k,i} + C_{\\text{interior}}\n3106: \n3107: $$\n3108: \n3109: where $C_{\\text{interior}}$ accounts for particles in the safe interior (where $\\varphi = 0$) and the smooth transition region.\n3110: \n3111: Recall:\n3112: \n3113: $$\n3114: W_b = \\frac{1}{N}\\sum_{k,i} \\varphi_{\\text{barrier}}(x_{k,i})\n3115: \n3116: $$\n3117: \n3118: Thus:\n3119: \n3120: $$\n3121: \\frac{1}{N}\\sum_{k,i} \\mathbb{E}[\\mathcal{L}\\Phi_{k,i}] \\leq -\\kappa_{\\text{pot}} W_b + C_{\\text{pot}}\n3122: \n3123: $$\n3124: \n3125: where $C_{\\text{pot}} = \\frac{C_{\\text{interior}}}{N}$ is independent of $W_b$ (depends only on geometry and equilibrium statistics).\n3126: \n3127: **PART XI: Discrete-Time Version**\n3128: \n3129: By {prf:ref}`thm-discretization` (Discrete-Time Inheritance of Generator Drift), the continuous-time drift translates to discrete-time:\n3130: \n3131: $$\n3132: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau + O(\\tau^2)\n3133: \n3134: $$\n3135: \n3136: For sufficiently small $\\tau$, the $O(\\tau^2)$ term is absorbed into the modified constant.\n3137: \n3138: **Final result:**\n3139: \n3140: $$\n3141: \\boxed{\\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}} \\tau}\n3142: \n3143: $$\n3144: \n3145: **Explicit constants:**\n3146: \n3147: $$\n3148: \\kappa_{\\text{pot}} = \\frac{1}{\\gamma}\\left[\\frac{c}{\\delta}\\alpha_{\\text{boundary}} - \\left(\\left(\\frac{c}{\\delta}\\right)^2 + \\frac{c}{\\delta}K_{\\text{curv}}\\right)\\frac{d\\sigma_{\\max}^2}{2\\gamma}\\right]\n3149: \n3150: $$\n3151: \n3152: $$\n3153: C_{\\text{pot}} = O(1) \\quad \\text{(geometry-dependent)}\n3154: \n3155: $$\n3156: \n3157: **PART XII: Physical Interpretation**\n3158: \n3159: This result demonstrates:\n3160: \n3161: 1. **Confining force creates drift:** The negative alignment $\\langle F, \\nabla\\varphi \\rangle \\leq -\\alpha_{\\text{align}}\\varphi$ ensures particles near the boundary are pushed inward, creating negative drift in $\\varphi$.\n3162: \n3163: 2. **Velocity-weighted correction:** The term $\\epsilon\\langle v, \\nabla\\varphi \\rangle$ with $\\epsilon = \\frac{1}{\\gamma}$ captures particles **moving toward** the boundary, allowing the generator to act on both position and momentum.\n3164: \n3165: 3. **Hessian competition:** The Hessian term $v^T(\\nabla^2\\varphi)v$ represents curvature effects that can add positive drift. For small $c$ (weak barrier strength), this is dominated by the negative alignment term.\n3166: \n3167: 4. **Independent safety mechanism:** This contraction is **independent** of cloning \u2014 it's a fundamental property of the confining potential $U$. Combined with the Safe Harbor mechanism (03_cloning.md, Ch 11), this provides **layered defense** against extinction.\n3168: \n3169: 5. **Parameter tradeoff:** Smaller $c$ gives stronger contraction (larger $\\kappa_{\\text{pot}}$) but weaker barrier strength. The choice balances safety (keep $\\varphi$ finite) with convergence speed.\n3170: "
    },
    {
      "directive_type": "corollary",
      "label": "cor-total-boundary-safety",
      "title": "Total Boundary Safety from Dual Mechanisms",
      "start_line": 3174,
      "end_line": 3201,
      "header_lines": [
        3175
      ],
      "content_start": 3177,
      "content_end": 3200,
      "content": "3177: :label: cor-total-boundary-safety\n3178: \n3179: Combining the Safe Harbor mechanism from cloning (03_cloning.md, Ch 11) with the confining potential:\n3180: \n3181: **From cloning:**\n3182: \n3183: $$\n3184: \\mathbb{E}_{\\text{clone}}[\\Delta W_b] \\leq -\\kappa_b W_b + C_b\n3185: \n3186: $$\n3187: \n3188: **From kinetics:**\n3189: \n3190: $$\n3191: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}}\\tau\n3192: \n3193: $$\n3194: \n3195: **Combined:**\n3196: \n3197: $$\n3198: \\mathbb{E}_{\\text{total}}[\\Delta W_b] \\leq -(\\kappa_b + \\kappa_{\\text{pot}}\\tau) W_b + (C_b + C_{\\text{pot}}\\tau)\n3199: \n3200: $$",
      "metadata": {
        "label": "cor-total-boundary-safety"
      },
      "section": "## 7. Boundary Potential Contraction via Confining Potential",
      "references": [],
      "raw_directive": "3174: ### 7.5. Layered Safety Architecture\n3175: \n3176: :::{prf:corollary} Total Boundary Safety from Dual Mechanisms\n3177: :label: cor-total-boundary-safety\n3178: \n3179: Combining the Safe Harbor mechanism from cloning (03_cloning.md, Ch 11) with the confining potential:\n3180: \n3181: **From cloning:**\n3182: \n3183: $$\n3184: \\mathbb{E}_{\\text{clone}}[\\Delta W_b] \\leq -\\kappa_b W_b + C_b\n3185: \n3186: $$\n3187: \n3188: **From kinetics:**\n3189: \n3190: $$\n3191: \\mathbb{E}_{\\text{kin}}[\\Delta W_b] \\leq -\\kappa_{\\text{pot}} W_b \\tau + C_{\\text{pot}}\\tau\n3192: \n3193: $$\n3194: \n3195: **Combined:**\n3196: \n3197: $$\n3198: \\mathbb{E}_{\\text{total}}[\\Delta W_b] \\leq -(\\kappa_b + \\kappa_{\\text{pot}}\\tau) W_b + (C_b + C_{\\text{pot}}\\tau)\n3199: \n3200: $$\n3201: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}