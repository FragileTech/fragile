{
  "document_id": "03_cloning",
  "stage": "directives",
  "directive_type": "definition",
  "generated_at": "2025-11-12T22:37:33.902023+00:00",
  "count": 36,
  "items": [
    {
      "directive_type": "definition",
      "label": "def-single-swarm-space",
      "title": "Single-Walker and Swarm State Spaces",
      "start_line": 106,
      "end_line": 128,
      "header_lines": [
        107
      ],
      "content_start": 109,
      "content_end": 127,
      "content": "109: :label: def-single-swarm-space\n110: \n111: 1.  A **walker** is a tuple $(x, s)$ ({prf:ref}`def-walker`), where $x \\in \\mathcal{X}$ is its position in a state space and $s \\in \\{0, 1\\}$ is its survival status. For the Euclidean Gas ({prf:ref}`def-euclidean-gas`), this is extended to include a velocity component, making the **full state** of a single walker a tuple $(x, v, s) \\in \\mathbb{R}^d \\times \\mathbb{R}^d \\times \\{0, 1\\}$. We refer to $(x,v)$ as the **kinematic state**.\n112: \n113: 2.  A **swarm ({prf:ref}`def-swarm-and-state-space`) configuration**, $S$, is an N-tuple of walker  states:\n114: \n115: \n116: \n117: $$\n118: S := \\left( (x_1, v_1, s_1), (x_2, v_2, s_2), \\dots, (x_N, v_N, s_N) \\right)\n119: $$\n120: \n121: 3.  The **single-swarm ({prf:ref}`def-swarm-and-state-space`) state space**, denoted $\\Sigma_N$, is the Cartesian product of the per-walker ({prf:ref}`def-walker`) state spaces:\n122: \n123: \n124: \n125: $$\n126: \\Sigma_N := \\left( \\mathbb{R}^d \\times \\mathbb{R}^d \\times \\{0, 1\\} \\right)^N.\n127: $$",
      "metadata": {
        "label": "def-single-swarm-space"
      },
      "section": "## 2. The Coupled State Space and State Differences",
      "references": [
        "def-walker",
        "def-euclidean-gas",
        "def-swarm-and-state-space",
        "def-barycentres-and-centered-vectors",
        "def-coupled-state-space",
        "def-swarm-aggregation-operator"
      ],
      "raw_directive": "106: The fundamental unit of the system is the walker ({prf:ref}`def-walker`), and a collection of these walkers constitutes a swarm ({prf:ref}`def-swarm-and-state-space`). We begin by defining their state spaces abstractly, in a manner consistent with the Fragile Gas framework.\n107: \n108: :::{prf:definition} Single-Walker and Swarm State Spaces\n109: :label: def-single-swarm-space\n110: \n111: 1.  A **walker** is a tuple $(x, s)$ ({prf:ref}`def-walker`), where $x \\in \\mathcal{X}$ is its position in a state space and $s \\in \\{0, 1\\}$ is its survival status. For the Euclidean Gas ({prf:ref}`def-euclidean-gas`), this is extended to include a velocity component, making the **full state** of a single walker a tuple $(x, v, s) \\in \\mathbb{R}^d \\times \\mathbb{R}^d \\times \\{0, 1\\}$. We refer to $(x,v)$ as the **kinematic state**.\n112: \n113: 2.  A **swarm ({prf:ref}`def-swarm-and-state-space`) configuration**, $S$, is an N-tuple of walker  states:\n114: \n115: \n116: \n117: $$\n118: S := \\left( (x_1, v_1, s_1), (x_2, v_2, s_2), \\dots, (x_N, v_N, s_N) \\right)\n119: $$\n120: \n121: 3.  The **single-swarm ({prf:ref}`def-swarm-and-state-space`) state space**, denoted $\\Sigma_N$, is the Cartesian product of the per-walker ({prf:ref}`def-walker`) state spaces:\n122: \n123: \n124: \n125: $$\n126: \\Sigma_N := \\left( \\mathbb{R}^d \\times \\mathbb{R}^d \\times \\{0, 1\\} \\right)^N.\n127: $$\n128: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 2,
        "chapter_file": "chapter_2.json",
        "section_id": "## 2. The Coupled State Space and State Differences"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-coupled-state-space",
      "title": "The Coupled State Space",
      "start_line": 145,
      "end_line": 161,
      "header_lines": [
        146
      ],
      "content_start": 148,
      "content_end": 160,
      "content": "148: :label: def-coupled-state-space\n149: \n150: The **coupled state space** for the Euclidean Gas ({prf:ref}`def-euclidean-gas`) is the Cartesian product $\\Sigma_N \\times \\Sigma_N$, where $\\Sigma_N$ is defined in {prf:ref}`def-single-swarm-space`. An element of this space is an ordered pair of swarm configurations, $(S_1, S_2)$, where:\n151: \n152: $$\n153: S_1 = \\left( (x_{1,1}, v_{1,1}, s_{1,1}), \\dots, (x_{1,N}, v_{1,N}, s_{1,N}) \\right) \\in \\Sigma_N,\n154: $$\n155: \n156: $$\n157: S_2 = \\left( (x_{2,1}, v_{2,1}, s_{2,1}), \\dots, (x_{2,N}, v_{2,N}, s_{2,N}) \\right) \\in \\Sigma_N.\n158: $$\n159: \n160: The convergence analysis proceeds by tracking the evolution of a Lyapunov function $V(S_1, S_2)$ across this coupled space.",
      "metadata": {
        "label": "def-coupled-state-space"
      },
      "section": "## 2. The Coupled State Space and State Differences",
      "references": [
        "def-euclidean-gas",
        "def-single-swarm-space",
        "def-coupled-cloning-expectation"
      ],
      "raw_directive": "145: This synchronous coupling is chosen because it is designed to minimize the distance between the two trajectories, making it the most suitable choice for proving a contraction. All expectations $\\mathbb{E}[\\cdot]$ in the subsequent analysis are taken with respect to this single, shared source of randomness.\n146: \n147: :::{prf:definition} The Coupled State Space\n148: :label: def-coupled-state-space\n149: \n150: The **coupled state space** for the Euclidean Gas ({prf:ref}`def-euclidean-gas`) is the Cartesian product $\\Sigma_N \\times \\Sigma_N$, where $\\Sigma_N$ is defined in {prf:ref}`def-single-swarm-space`. An element of this space is an ordered pair of swarm configurations, $(S_1, S_2)$, where:\n151: \n152: $$\n153: S_1 = \\left( (x_{1,1}, v_{1,1}, s_{1,1}), \\dots, (x_{1,N}, v_{1,N}, s_{1,N}) \\right) \\in \\Sigma_N,\n154: $$\n155: \n156: $$\n157: S_2 = \\left( (x_{2,1}, v_{2,1}, s_{2,1}), \\dots, (x_{2,N}, v_{2,N}, s_{2,N}) \\right) \\in \\Sigma_N.\n158: $$\n159: \n160: The convergence analysis proceeds by tracking the evolution of a Lyapunov function $V(S_1, S_2)$ across this coupled space.\n161: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 2,
        "chapter_file": "chapter_2.json",
        "section_id": "## 2. The Coupled State Space and State Differences"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-state-difference-vectors",
      "title": "State Difference Vectors",
      "start_line": 167,
      "end_line": 191,
      "header_lines": [
        168
      ],
      "content_start": 170,
      "content_end": 190,
      "content": "170: :label: def-state-difference-vectors\n171: \n172: For any element $(S_1, S_2) \\in \\Sigma_N \\times \\Sigma_N$, we define the **state difference vectors** for each walker ({prf:ref}`def-walker`) index $i \\in \\{1, \\ldots, N\\}$ as follows:\n173: \n174: 1.  The **position difference vector** for walker  $i$ is:\n175: \n176: \n177: \n178: $$\n179: \\Delta x_i := x_{1,i} - x_{2,i} \\in \\mathbb{R}^d\n180: $$\n181: \n182: 2.  The **velocity difference vector** for walker ({prf:ref}`def-walker`) $i$ is:\n183: \n184: \n185: \n186: $$\n187: \\Delta v_i := v_{1,i} - v_{2,i} \\in \\mathbb{R}^d\n188: $$\n189: \n190: The entire drift analysis will be formulated in terms of the norms and inner products of these $2N$ difference vectors. The objective is to show that, in expectation, the magnitudes of these vectors decrease over time, driving the two swarm ({prf:ref}`def-swarm-and-state-space`) trajectories together.",
      "metadata": {
        "label": "def-state-difference-vectors"
      },
      "section": "## 2. The Coupled State Space and State Differences",
      "references": [
        "def-walker",
        "def-swarm-and-state-space",
        "def-location-error-component"
      ],
      "raw_directive": "167: The core of the hypocoercive analysis is not the absolute state of the swarms, but the *difference* between them (measured element-wise). We formally define the vectors that capture this relative configuration.\n168: \n169: :::{prf:definition} State Difference Vectors\n170: :label: def-state-difference-vectors\n171: \n172: For any element $(S_1, S_2) \\in \\Sigma_N \\times \\Sigma_N$, we define the **state difference vectors** for each walker ({prf:ref}`def-walker`) index $i \\in \\{1, \\ldots, N\\}$ as follows:\n173: \n174: 1.  The **position difference vector** for walker  $i$ is:\n175: \n176: \n177: \n178: $$\n179: \\Delta x_i := x_{1,i} - x_{2,i} \\in \\mathbb{R}^d\n180: $$\n181: \n182: 2.  The **velocity difference vector** for walker ({prf:ref}`def-walker`) $i$ is:\n183: \n184: \n185: \n186: $$\n187: \\Delta v_i := v_{1,i} - v_{2,i} \\in \\mathbb{R}^d\n188: $$\n189: \n190: The entire drift analysis will be formulated in terms of the norms and inner products of these $2N$ difference vectors. The objective is to show that, in expectation, the magnitudes of these vectors decrease over time, driving the two swarm ({prf:ref}`def-swarm-and-state-space`) trajectories together.\n191: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 2,
        "chapter_file": "chapter_2.json",
        "section_id": "## 2. The Coupled State Space and State Differences"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-barycentres-and-centered-vectors",
      "title": "Barycentres and Centered Vectors (Alive Walkers Only)",
      "start_line": 373,
      "end_line": 426,
      "header_lines": [
        374,
        415
      ],
      "content_start": 376,
      "content_end": 425,
      "content": "376: :label: def-barycentres-and-centered-vectors\n377: \n378: For each swarm ({prf:ref}`def-swarm-and-state-space`) $k \\in \\{1, 2\\}$ (see {prf:ref}`def-single-swarm-space`) in a coupled state $(S_1, S_2)$, let $\\mathcal{A}(S_k)$ denote the set of alive walker ({prf:ref}`def-walker`) indices and let $k_{\\text{alive}} := |\\mathcal{A}(S_k)|$ denote the number of alive walkers in swarm $k$. We define:\n379: \n380: 1.  The **positional center of mass** (barycentre) **computed over alive walkers only**:\n381: \n382: \n383: \n384: $$\n385: \\mu_{x,k} := \\frac{1}{k_{\\text{alive}}}\\sum_{i \\in \\mathcal{A}(S_k)} x_{k,i}\n386: $$\n387: \n388: 2.  The **velocity center of mass** **computed over alive walkers only**:\n389: \n390: \n391: \n392: $$\n393: \\mu_{v,k} := \\frac{1}{k_{\\text{alive}}}\\sum_{i \\in \\mathcal{A}(S_k)} v_{k,i}\n394: $$\n395: \n396: The **centered vectors** represent the state of each **alive** walker ({prf:ref}`def-walker`) relative to its swarm ({prf:ref}`def-swarm-and-state-space`)'s center of mass:\n397: \n398: 1.  The **centered position vector** for alive walker  $i \\in \\mathcal{A}(S_k)$:\n399: \n400: \n401: \n402: $$\n403: \\delta_{x,k,i} := x_{k,i} - \\mu_{x,k}\n404: $$\n405: \n406: 2.  The **centered velocity vector** for alive walker $i \\in \\mathcal{A}(S_k)$:\n407: \n408: \n409: \n410: $$\n411: \\delta_{v,k,i} := v_{k,i} - \\mu_{v,k}\n412: $$\n413: \n414: **Convention**: Dead walkers ($i \\notin \\mathcal{A}(S_k)$) do not contribute to barycentres, variances, or any statistical quantities. By construction, the centered vectors for alive walkers in any swarm sum to zero: $\\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{x,k,i} = 0$ and $\\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{v,k,i} = 0$.\n415: \n416: :::{admonition} Rationale for Alive-Walker-Only Statistics\n417: :class: important\n418: \n419: Dead walkers retain their last known position $(x_i, v_i)$ but have status $s_i = 0$. Including them in statistical calculations would distort the geometric properties:\n420: \n421: 1. **Physical Interpretation**: Dead walkers represent \"failed\" exploration paths. Their positions are historical artifacts, not part of the current active swarm distribution.\n422: \n423: 2. **Cloning Operator Target**: The cloning operator $\\Psi_{\\text{clone}}$ acts on the fitness and geometric distribution of **alive** walkers. The variance it contracts is specifically the variance of the alive population.\n424: \n425: 3. **Measurement Consistency**: Distance-to-companion measurements ([](#sec:distance-measurement)) are computed from the alive-walker distribution. For consistency, all variance and barycentre calculations must use the same population.",
      "metadata": {
        "label": "def-barycentres-and-centered-vectors",
        "class": "important"
      },
      "section": "## 3. The Augmented Hypocoercive Lyapunov Function",
      "references": [
        "def-swarm-and-state-space",
        "def-single-swarm-space",
        "def-walker",
        "def-full-synergistic-lyapunov-function",
        "def-structural-error-component"
      ],
      "raw_directive": "373: We begin by formally defining the mathematical objects required for this decomposition.\n374: \n375: :::{prf:definition} Barycentres and Centered Vectors (Alive Walkers Only)\n376: :label: def-barycentres-and-centered-vectors\n377: \n378: For each swarm ({prf:ref}`def-swarm-and-state-space`) $k \\in \\{1, 2\\}$ (see {prf:ref}`def-single-swarm-space`) in a coupled state $(S_1, S_2)$, let $\\mathcal{A}(S_k)$ denote the set of alive walker ({prf:ref}`def-walker`) indices and let $k_{\\text{alive}} := |\\mathcal{A}(S_k)|$ denote the number of alive walkers in swarm $k$. We define:\n379: \n380: 1.  The **positional center of mass** (barycentre) **computed over alive walkers only**:\n381: \n382: \n383: \n384: $$\n385: \\mu_{x,k} := \\frac{1}{k_{\\text{alive}}}\\sum_{i \\in \\mathcal{A}(S_k)} x_{k,i}\n386: $$\n387: \n388: 2.  The **velocity center of mass** **computed over alive walkers only**:\n389: \n390: \n391: \n392: $$\n393: \\mu_{v,k} := \\frac{1}{k_{\\text{alive}}}\\sum_{i \\in \\mathcal{A}(S_k)} v_{k,i}\n394: $$\n395: \n396: The **centered vectors** represent the state of each **alive** walker ({prf:ref}`def-walker`) relative to its swarm ({prf:ref}`def-swarm-and-state-space`)'s center of mass:\n397: \n398: 1.  The **centered position vector** for alive walker  $i \\in \\mathcal{A}(S_k)$:\n399: \n400: \n401: \n402: $$\n403: \\delta_{x,k,i} := x_{k,i} - \\mu_{x,k}\n404: $$\n405: \n406: 2.  The **centered velocity vector** for alive walker $i \\in \\mathcal{A}(S_k)$:\n407: \n408: \n409: \n410: $$\n411: \\delta_{v,k,i} := v_{k,i} - \\mu_{v,k}\n412: $$\n413: \n414: **Convention**: Dead walkers ($i \\notin \\mathcal{A}(S_k)$) do not contribute to barycentres, variances, or any statistical quantities. By construction, the centered vectors for alive walkers in any swarm sum to zero: $\\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{x,k,i} = 0$ and $\\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{v,k,i} = 0$.\n415: \n416: :::{admonition} Rationale for Alive-Walker-Only Statistics\n417: :class: important\n418: \n419: Dead walkers retain their last known position $(x_i, v_i)$ but have status $s_i = 0$. Including them in statistical calculations would distort the geometric properties:\n420: \n421: 1. **Physical Interpretation**: Dead walkers represent \"failed\" exploration paths. Their positions are historical artifacts, not part of the current active swarm distribution.\n422: \n423: 2. **Cloning Operator Target**: The cloning operator $\\Psi_{\\text{clone}}$ acts on the fitness and geometric distribution of **alive** walkers. The variance it contracts is specifically the variance of the alive population.\n424: \n425: 3. **Measurement Consistency**: Distance-to-companion measurements ([](#sec:distance-measurement)) are computed from the alive-walker distribution. For consistency, all variance and barycentre calculations must use the same population.\n426: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 3. The Augmented Hypocoercive Lyapunov Function"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-location-error-component",
      "title": "The Location Error Component ($V_{\\text{loc}}$)",
      "start_line": 437,
      "end_line": 447,
      "header_lines": [
        438
      ],
      "content_start": 440,
      "content_end": 446,
      "content": "440: :label: def-location-error-component\n441: \n442: For any pair of swarm ({prf:ref}`def-swarm-and-state-space`) configurations $(S_1, S_2)$ with barycenters $(\\mu_{x,1}, \\mu_{v,1})$ and $(\\mu_{x,2}, \\mu_{v,2})$ (derived from {prf:ref}`def-state-difference-vectors`), the **location error component** is defined as:\n443: \n444: $$\n445: V_{\\text{loc}} := \\|\\Delta\\mu_x\\|^2 + \\lambda_v\\|\\Delta\\mu_v\\|^2 + b\\langle\\Delta\\mu_x, \\Delta\\mu_v\\rangle\n446: $$",
      "metadata": {
        "label": "def-location-error-component"
      },
      "section": "## 3. The Augmented Hypocoercive Lyapunov Function",
      "references": [
        "def-swarm-and-state-space",
        "def-state-difference-vectors"
      ],
      "raw_directive": "437: The distance between the swarms' centers of mass is an intrinsically permutation-invariant quantity. We define the location error as the hypocoercive quadratic form ({prf:ref}`def-hypocoercive-distance`) applied to the difference between the barycenters of the two swarms.\n438: \n439: :::{prf:definition} The Location Error Component ($V_{\\text{loc}}$)\n440: :label: def-location-error-component\n441: \n442: For any pair of swarm ({prf:ref}`def-swarm-and-state-space`) configurations $(S_1, S_2)$ with barycenters $(\\mu_{x,1}, \\mu_{v,1})$ and $(\\mu_{x,2}, \\mu_{v,2})$ (derived from {prf:ref}`def-state-difference-vectors`), the **location error component** is defined as:\n443: \n444: $$\n445: V_{\\text{loc}} := \\|\\Delta\\mu_x\\|^2 + \\lambda_v\\|\\Delta\\mu_v\\|^2 + b\\langle\\Delta\\mu_x, \\Delta\\mu_v\\rangle\n446: $$\n447: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 3. The Augmented Hypocoercive Lyapunov Function"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-structural-error-component",
      "title": "The Structural Error Component ($V_{\\text{struct}}$)",
      "start_line": 453,
      "end_line": 471,
      "header_lines": [
        454
      ],
      "content_start": 456,
      "content_end": 470,
      "content": "456: :label: def-structural-error-component\n457: \n458: Let $\\tilde{\\mu}_1$ and $\\tilde{\\mu}_2$ be the centered empirical measures of swarms $S_1$ and $S_2$ **computed over alive walkers only**:\n459: \n460: $$\n461: \\tilde{\\mu}_k := \\frac{1}{k_{\\text{alive}}} \\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{(\\delta_{x,k,i}, \\delta_{v,k,i})}\n462: $$\n463: \n464: where $k_{\\text{alive}} = |\\mathcal{A}(S_k)|$ is the number of alive walkers in swarm ({prf:ref}`def-swarm-and-state-space`) $k$, and $\\delta_{x,k,i}, \\delta_{v,k,i}$ are the centered vectors defined in {prf:ref}`def-barycentres-and-centered-vectors`.\n465: \n466: The **structural error component** $V_{\\text{struct}}$ is defined as the squared hypocoercive Wasserstein distance ({prf:ref}`def-hypocoercive-distance`) between these centered measures:\n467: \n468: $$\n469: V_{\\text{struct}} := W_h^2(\\tilde{\\mu}_1, \\tilde{\\mu}_2) = \\inf_{\\gamma \\in \\Gamma(\\tilde{\\mu}_1, \\tilde{\\mu}_2)} \\int c(\\delta_{z,1}, \\delta_{z,2}) \\, d\\gamma(\\delta_{z,1}, \\delta_{z,2})\n470: $$",
      "metadata": {
        "label": "def-structural-error-component"
      },
      "section": "## 3. The Augmented Hypocoercive Lyapunov Function",
      "references": [
        "def-swarm-and-state-space",
        "def-barycentres-and-centered-vectors",
        "def-hypocoercive-distance"
      ],
      "raw_directive": "453: The structural error measures the mismatch between the \"shapes\" of the two swarms. The shape of a swarm is described by the set of its centered vectors, $\\{\\delta_{z,k,i}\\}$. To compare these shapes in a permutation-invariant way, we find the **optimal matching** between the centered vectors of the two swarms and measure the residual error of that matching. This is equivalent to the hypocoercive Wasserstein distance ({prf:ref}`def-wasserstein-distance`) between the *centered empirical measures*.\n454: \n455: :::{prf:definition} The Structural Error Component ($V_{\\text{struct}}$)\n456: :label: def-structural-error-component\n457: \n458: Let $\\tilde{\\mu}_1$ and $\\tilde{\\mu}_2$ be the centered empirical measures of swarms $S_1$ and $S_2$ **computed over alive walkers only**:\n459: \n460: $$\n461: \\tilde{\\mu}_k := \\frac{1}{k_{\\text{alive}}} \\sum_{i \\in \\mathcal{A}(S_k)} \\delta_{(\\delta_{x,k,i}, \\delta_{v,k,i})}\n462: $$\n463: \n464: where $k_{\\text{alive}} = |\\mathcal{A}(S_k)|$ is the number of alive walkers in swarm ({prf:ref}`def-swarm-and-state-space`) $k$, and $\\delta_{x,k,i}, \\delta_{v,k,i}$ are the centered vectors defined in {prf:ref}`def-barycentres-and-centered-vectors`.\n465: \n466: The **structural error component** $V_{\\text{struct}}$ is defined as the squared hypocoercive Wasserstein distance ({prf:ref}`def-hypocoercive-distance`) between these centered measures:\n467: \n468: $$\n469: V_{\\text{struct}} := W_h^2(\\tilde{\\mu}_1, \\tilde{\\mu}_2) = \\inf_{\\gamma \\in \\Gamma(\\tilde{\\mu}_1, \\tilde{\\mu}_2)} \\int c(\\delta_{z,1}, \\delta_{z,2}) \\, d\\gamma(\\delta_{z,1}, \\delta_{z,2})\n470: $$\n471: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 3. The Augmented Hypocoercive Lyapunov Function"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-full-synergistic-lyapunov-function",
      "title": "The Full Synergistic Hypocoercive Lyapunov Function",
      "start_line": 757,
      "end_line": 862,
      "header_lines": [
        758,
        806
      ],
      "content_start": 760,
      "content_end": 861,
      "content": "760: :label: def-full-synergistic-lyapunov-function\n761: \n762: For any pair of swarm ({prf:ref}`def-swarm-and-state-space`) configurations $(S_1, S_2)$ with corresponding empirical measures $(\\mu_1, \\mu_2)$, the **total synergistic Lyapunov function** is defined as:\n763: \n764: $$\n765: V_{\\mathrm{total}}(S_1, S_2) := W_h^2(\\mu_1, \\mu_2) + c_V V_{Var}(S_1, S_2) + c_B W_b(S_1, S_2)\n766: $$\n767: \n768: where the intra-swarm ({prf:ref}`def-swarm-and-state-space`) variance term explicitly decomposes into positional and velocity components **summed over alive walkers only, but normalized by the total swarm size $N$**:\n769: \n770: $$\n771: V_{Var}(S_1, S_2) = V_{Var,x}(S_1, S_2) + \\lambda_v V_{Var,v}(S_1, S_2)\n772: $$\n773: \n774: with:\n775: \n776: $$\n777: \\begin{align*}\n778: V_{Var,x}(S_1, S_2) &:= \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\|\\delta_{x,1,i}\\|^2 + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\|\\delta_{x,2,i}\\|^2 \\\\\n779: V_{Var,v}(S_1, S_2) &:= \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\|\\delta_{v,1,i}\\|^2 + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\|\\delta_{v,2,i}\\|^2\n780: \\end{align*}\n781: $$\n782: \n783: where $N$ is the total swarm ({prf:ref}`def-swarm-and-state-space`) size, $\\mathcal{A}(S_k)$ is the set of alive walker ({prf:ref}`def-walker`) indices in swarm $k$, and $\\delta_{x,k,i}, \\delta_{v,k,i}$ are the centered vectors defined in {prf:ref}`def-barycentres-and-centered-vectors`.\n784: \n785: The function is a sum of three components:\n786: \n787: 1.  **The Inter-Swarm ({prf:ref}`def-swarm-and-state-space`) Error ($W_h^2$):** The squared hypocoercive 2-Wasserstein distance between the swarms' full empirical measures. This term quantifies the total permutation-invariant distance between the two swarms in phase space. As established in {prf:ref}`lem-wasserstein-decomposition`, this component can be exactly decomposed into:\n788:     *   A **Location Component ($V_{\\text{loc}}$)**, measuring the error between the swarm centers of mass.\n789:     *   A **Structural Component ($V_{\\text{struct}}$)**, measuring the mismatch in swarm shapes.\n790: \n791: 2.  **The Intra-Swarm Error ($V_{\\text{Var}}$):** The sum of the internal hypocoercive variances of each swarm. This term quantifies the internal dispersion or \"shape error\" *within* each individual swarm in phase space, measuring their lack of internal convergence in both position and velocity. This component is the primary target of the **synergistic dissipation framework**:\n792:     *   The **cloning operator** ($\\Psi_{\\text{clone}}$, analyzed in this document) provides powerful contraction of the positional variance component $V_{Var,x}$ but causes bounded expansion of the velocity variance component $V_{Var,v}$ through the velocity reset mechanism.\n793:     *   The **kinetic operator** ($\\Psi_{\\text{kin}}$, analyzed in the companion document) provides contraction of the velocity variance component $V_{Var,v}$ through Langevin dissipation but causes bounded expansion of the positional variance component $V_{Var,x}$ through diffusion.\n794:     *   When properly balanced, these two operators achieve **net contraction** of the total $V_{Var}$, enabling the system to converge in both position and velocity simultaneously.\n795: \n796: 3.  **The Boundary Potential ($W_b$):** A term that penalizes **alive** walkers approaching the boundary, constructed from the smooth barrier function $\\varphi_{\\text{barrier}}(x)$ defined in {prf:ref}`prop-barrier-existence`.\n797: \n798: \n799: $$\n800: W_b(S_1, S_2) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\varphi_{\\text{barrier}}(x_{1,i}) + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\varphi_{\\text{barrier}}(x_{2,i})\n801: $$\n802: \n803:     where $N$ is the total swarm size and $\\mathcal{A}(S_k)$ denotes the set of alive walker indices in swarm $k$. Note that dead walkers do not contribute to the boundary potential.\n804: \n805: The parameters $b$ and $\\lambda_v > 0$ are the **hypocoercive parameters**. The constants $c_V > 0$ and $c_B > 0$ are small, positive **coupling constants** used in the analysis to balance the contributions of the different error components in the final drift inequality.\n806: \n807: :::{admonition} Normalization by $N$ vs. $k_{\\text{alive}}$ in the Lyapunov Function\n808: :class: important\n809: \n810: The Lyapunov function components $V_{\\text{Var}}$ and $W_b$ are normalized by the **total swarm size $N$**, not by the number of alive walkers $k_{\\text{alive}}$. This design choice is critical for mathematical tractability and deserves careful explanation:\n811: \n812: **Why This Choice Differs from Algorithm Internals:**\n813: \n814: The algorithm's internal fitness calculations (z-scores, variance measurements used for cloning decisions) correctly use $k_{\\text{alive}}$-normalization to compute statistics over the current active population. This is the physically and statistically correct choice for **decision-making**, as it accurately characterizes the distribution of alive walkers at each step.\n815: \n816: However, the Lyapunov function serves a different purpose: it is an **analytical tool** designed to prove long-term stability through drift analysis. For this purpose, $N$-normalization is mathematically necessary.\n817: \n818: **The Mathematical Necessity:**\n819: \n820: Consider the one-step change in the variance component:\n821: \n822: $$\n823: \\Delta V_{\\text{Var}} = V_{\\text{Var}}(S_{t+1}) - V_{\\text{Var}}(S_t)\n824: $$\n825: \n826: If $V_{\\text{Var}}$ were normalized by $k_{\\text{alive}}$, the drift calculation would become:\n827: \n828: $$\n829: \\mathbb{E}[\\Delta V_{\\text{Var}}] = \\mathbb{E}\\left[\\frac{1}{k_{t+1}} \\sum_{i} \\|\\delta_{x,i}\\|^2_{t+1} - \\frac{1}{k_t} \\sum_{i} \\|\\delta_{x,i}\\|^2_t\\right]\n830: $$\n831: \n832: This expression involves the **ratio of correlated random variables**: both the sum of squares and the number of alive walkers change stochastically at each step, and these changes are strongly coupled (e.g., if a high-variance walker dies, both the numerator and denominator change). The expectation of such a ratio cannot be simplified, making rigorous drift bounds essentially impossible to derive.\n833: \n834: With $N$-normalization, the constant factor $1/N$ factors out of the expectation:\n835: \n836: $$\n837: \\mathbb{E}[\\Delta V_{\\text{Var}}] = \\frac{1}{N} \\mathbb{E}\\left[\\sum_{i} \\|\\delta_{x,i}\\|^2_{t+1} - \\sum_{i} \\|\\delta_{x,i}\\|^2_t\\right]\n838: $$\n839: \n840: This allows the analysis to focus entirely on $\\mathbb{E}[\\Delta \\text{SumOfSquares}]$, which is the direct effect of the cloning and kinetic operators on the swarm's kinematic state. This is precisely what the Keystone Principle and the hypocoercive analysis are designed to bound.\n841: \n842: **The Mean-Field Interpretation:**\n843: \n844: The $N$-normalized variance can be interpreted as:\n845: \n846: $$\n847: V_{\\text{Var},x}(S_k) = \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{k_{\\text{alive}}}{N} \\cdot \\text{Var}_{\\text{alive}}(S_k)\n848: $$\n849: \n850: This represents the **mean-field contribution to system disorder per walker slot**. It scales with the fraction of alive walkers, which is exactly the correct behavior: if only a small fraction of walkers remain alive, the system's total disorder (as measured by the Lyapunov function) should reflect this reduced active mass.\n851: \n852: **The Viability Requirement:**\n853: \n854: This normalization implicitly assumes that the swarm remains viable, meaning $k_{\\text{alive}}/N$ is bounded away from zero. This is guaranteed by the framework's design:\n855: - The Safe Harbor Axiom ensures existence of a desirable region away from boundaries\n856: - The contractive properties of the cloning operator (Keystone Principle) and the confining potential prevent swarm collapse\n857: - The Lyapunov analysis operates in the regime where the swarm is stable, with extinction probability exponentially small\n858: \n859: **Conclusion:**\n860: \n861: The separation between algorithmic calculations (using $k_{\\text{alive}}$) and analytical tools (using $N$) is not a compromise but a hallmark of rigorous mean-field analysis. The algorithm uses the physically optimal metric for real-time decisions, while the Lyapunov function uses the mathematically tractable metric for proving convergence. Both serve their respective purposes correctly.",
      "metadata": {
        "label": "def-full-synergistic-lyapunov-function",
        "class": "important"
      },
      "section": "## 3. The Augmented Hypocoercive Lyapunov Function",
      "references": [
        "def-swarm-and-state-space",
        "def-walker",
        "def-barycentres-and-centered-vectors",
        "lem-wasserstein-decomposition",
        "prop-barrier-existence",
        "def-boundary-potential-recall"
      ],
      "raw_directive": "757: With the permutation-invariant decomposition of the inter-swarm error established, we now define the full Lyapunov function. This **synergistic** function is constructed as a weighted sum of three distinct error components (see {prf:ref}`prop-lyapunov-necessity` for why this structure is mathematically necessary). It is designed to capture not only the distance *between* the swarms, but also the internal disorder *within* each swarm, which is the primary target of the cloning operator.\n758: \n759: :::{prf:definition} The Full Synergistic Hypocoercive Lyapunov Function\n760: :label: def-full-synergistic-lyapunov-function\n761: \n762: For any pair of swarm ({prf:ref}`def-swarm-and-state-space`) configurations $(S_1, S_2)$ with corresponding empirical measures $(\\mu_1, \\mu_2)$, the **total synergistic Lyapunov function** is defined as:\n763: \n764: $$\n765: V_{\\mathrm{total}}(S_1, S_2) := W_h^2(\\mu_1, \\mu_2) + c_V V_{Var}(S_1, S_2) + c_B W_b(S_1, S_2)\n766: $$\n767: \n768: where the intra-swarm ({prf:ref}`def-swarm-and-state-space`) variance term explicitly decomposes into positional and velocity components **summed over alive walkers only, but normalized by the total swarm size $N$**:\n769: \n770: $$\n771: V_{Var}(S_1, S_2) = V_{Var,x}(S_1, S_2) + \\lambda_v V_{Var,v}(S_1, S_2)\n772: $$\n773: \n774: with:\n775: \n776: $$\n777: \\begin{align*}\n778: V_{Var,x}(S_1, S_2) &:= \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\|\\delta_{x,1,i}\\|^2 + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\|\\delta_{x,2,i}\\|^2 \\\\\n779: V_{Var,v}(S_1, S_2) &:= \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\|\\delta_{v,1,i}\\|^2 + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\|\\delta_{v,2,i}\\|^2\n780: \\end{align*}\n781: $$\n782: \n783: where $N$ is the total swarm ({prf:ref}`def-swarm-and-state-space`) size, $\\mathcal{A}(S_k)$ is the set of alive walker ({prf:ref}`def-walker`) indices in swarm $k$, and $\\delta_{x,k,i}, \\delta_{v,k,i}$ are the centered vectors defined in {prf:ref}`def-barycentres-and-centered-vectors`.\n784: \n785: The function is a sum of three components:\n786: \n787: 1.  **The Inter-Swarm ({prf:ref}`def-swarm-and-state-space`) Error ($W_h^2$):** The squared hypocoercive 2-Wasserstein distance between the swarms' full empirical measures. This term quantifies the total permutation-invariant distance between the two swarms in phase space. As established in {prf:ref}`lem-wasserstein-decomposition`, this component can be exactly decomposed into:\n788:     *   A **Location Component ($V_{\\text{loc}}$)**, measuring the error between the swarm centers of mass.\n789:     *   A **Structural Component ($V_{\\text{struct}}$)**, measuring the mismatch in swarm shapes.\n790: \n791: 2.  **The Intra-Swarm Error ($V_{\\text{Var}}$):** The sum of the internal hypocoercive variances of each swarm. This term quantifies the internal dispersion or \"shape error\" *within* each individual swarm in phase space, measuring their lack of internal convergence in both position and velocity. This component is the primary target of the **synergistic dissipation framework**:\n792:     *   The **cloning operator** ($\\Psi_{\\text{clone}}$, analyzed in this document) provides powerful contraction of the positional variance component $V_{Var,x}$ but causes bounded expansion of the velocity variance component $V_{Var,v}$ through the velocity reset mechanism.\n793:     *   The **kinetic operator** ($\\Psi_{\\text{kin}}$, analyzed in the companion document) provides contraction of the velocity variance component $V_{Var,v}$ through Langevin dissipation but causes bounded expansion of the positional variance component $V_{Var,x}$ through diffusion.\n794:     *   When properly balanced, these two operators achieve **net contraction** of the total $V_{Var}$, enabling the system to converge in both position and velocity simultaneously.\n795: \n796: 3.  **The Boundary Potential ($W_b$):** A term that penalizes **alive** walkers approaching the boundary, constructed from the smooth barrier function $\\varphi_{\\text{barrier}}(x)$ defined in {prf:ref}`prop-barrier-existence`.\n797: \n798: \n799: $$\n800: W_b(S_1, S_2) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\varphi_{\\text{barrier}}(x_{1,i}) + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\varphi_{\\text{barrier}}(x_{2,i})\n801: $$\n802: \n803:     where $N$ is the total swarm size and $\\mathcal{A}(S_k)$ denotes the set of alive walker indices in swarm $k$. Note that dead walkers do not contribute to the boundary potential.\n804: \n805: The parameters $b$ and $\\lambda_v > 0$ are the **hypocoercive parameters**. The constants $c_V > 0$ and $c_B > 0$ are small, positive **coupling constants** used in the analysis to balance the contributions of the different error components in the final drift inequality.\n806: \n807: :::{admonition} Normalization by $N$ vs. $k_{\\text{alive}}$ in the Lyapunov Function\n808: :class: important\n809: \n810: The Lyapunov function components $V_{\\text{Var}}$ and $W_b$ are normalized by the **total swarm size $N$**, not by the number of alive walkers $k_{\\text{alive}}$. This design choice is critical for mathematical tractability and deserves careful explanation:\n811: \n812: **Why This Choice Differs from Algorithm Internals:**\n813: \n814: The algorithm's internal fitness calculations (z-scores, variance measurements used for cloning decisions) correctly use $k_{\\text{alive}}$-normalization to compute statistics over the current active population. This is the physically and statistically correct choice for **decision-making**, as it accurately characterizes the distribution of alive walkers at each step.\n815: \n816: However, the Lyapunov function serves a different purpose: it is an **analytical tool** designed to prove long-term stability through drift analysis. For this purpose, $N$-normalization is mathematically necessary.\n817: \n818: **The Mathematical Necessity:**\n819: \n820: Consider the one-step change in the variance component:\n821: \n822: $$\n823: \\Delta V_{\\text{Var}} = V_{\\text{Var}}(S_{t+1}) - V_{\\text{Var}}(S_t)\n824: $$\n825: \n826: If $V_{\\text{Var}}$ were normalized by $k_{\\text{alive}}$, the drift calculation would become:\n827: \n828: $$\n829: \\mathbb{E}[\\Delta V_{\\text{Var}}] = \\mathbb{E}\\left[\\frac{1}{k_{t+1}} \\sum_{i} \\|\\delta_{x,i}\\|^2_{t+1} - \\frac{1}{k_t} \\sum_{i} \\|\\delta_{x,i}\\|^2_t\\right]\n830: $$\n831: \n832: This expression involves the **ratio of correlated random variables**: both the sum of squares and the number of alive walkers change stochastically at each step, and these changes are strongly coupled (e.g., if a high-variance walker dies, both the numerator and denominator change). The expectation of such a ratio cannot be simplified, making rigorous drift bounds essentially impossible to derive.\n833: \n834: With $N$-normalization, the constant factor $1/N$ factors out of the expectation:\n835: \n836: $$\n837: \\mathbb{E}[\\Delta V_{\\text{Var}}] = \\frac{1}{N} \\mathbb{E}\\left[\\sum_{i} \\|\\delta_{x,i}\\|^2_{t+1} - \\sum_{i} \\|\\delta_{x,i}\\|^2_t\\right]\n838: $$\n839: \n840: This allows the analysis to focus entirely on $\\mathbb{E}[\\Delta \\text{SumOfSquares}]$, which is the direct effect of the cloning and kinetic operators on the swarm's kinematic state. This is precisely what the Keystone Principle and the hypocoercive analysis are designed to bound.\n841: \n842: **The Mean-Field Interpretation:**\n843: \n844: The $N$-normalized variance can be interpreted as:\n845: \n846: $$\n847: V_{\\text{Var},x}(S_k) = \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{k_{\\text{alive}}}{N} \\cdot \\text{Var}_{\\text{alive}}(S_k)\n848: $$\n849: \n850: This represents the **mean-field contribution to system disorder per walker slot**. It scales with the fraction of alive walkers, which is exactly the correct behavior: if only a small fraction of walkers remain alive, the system's total disorder (as measured by the Lyapunov function) should reflect this reduced active mass.\n851: \n852: **The Viability Requirement:**\n853: \n854: This normalization implicitly assumes that the swarm remains viable, meaning $k_{\\text{alive}}/N$ is bounded away from zero. This is guaranteed by the framework's design:\n855: - The Safe Harbor Axiom ensures existence of a desirable region away from boundaries\n856: - The contractive properties of the cloning operator (Keystone Principle) and the confining potential prevent swarm collapse\n857: - The Lyapunov analysis operates in the regime where the swarm is stable, with extinction probability exponentially small\n858: \n859: **Conclusion:**\n860: \n861: The separation between algorithmic calculations (using $k_{\\text{alive}}$) and analytical tools (using $N$) is not a compromise but a hallmark of rigorous mean-field analysis. The algorithm uses the physically optimal metric for real-time decisions, while the Lyapunov function uses the mathematically tractable metric for proving convergence. Both serve their respective purposes correctly.\n862: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 3. The Augmented Hypocoercive Lyapunov Function"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-variance-conversions",
      "title": "Variance Notation Conversion Formulas",
      "start_line": 869,
      "end_line": 912,
      "header_lines": [
        870
      ],
      "content_start": 872,
      "content_end": 911,
      "content": "872: :label: def-variance-conversions\n873: \n874: For a swarm ({prf:ref}`def-swarm-and-state-space`) $k$ with $k_{\\text{alive}} = |\\mathcal{A}(S_k)|$ alive walkers out of $N$ total walker ({prf:ref}`def-walker`) slots:\n875: \n876: **1. Un-normalized Sum of Squared Deviations:**\n877: \n878: $$\n879: S_k := \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2\n880: $$\n881: \n882: This is the total positional variance without any normalization.\n883: \n884: **2. Physical Internal Variance ($k$-normalized):**\n885: \n886: $$\n887: \\text{Var}_k(x) := \\frac{1}{k_{\\text{alive}}} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{S_k}{k_{\\text{alive}}}\n888: $$\n889: \n890: This is the average squared deviation per alive walker ({prf:ref}`def-walker`) - the standard statistical variance.\n891: \n892: **3. Lyapunov Variance Component ($N$-normalized):**\n893: \n894: $$\n895: V_{\\text{Var},x}(S_k) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{S_k}{N}\n896: $$\n897: \n898: This is the mean-field contribution to system disorder per walker ({prf:ref}`def-walker`) slot.\n899: \n900: **Conversion Formulas:**\n901: \n902: $$\n903: \\begin{aligned}\n904: S_k &= k_{\\text{alive}} \\cdot \\text{Var}_k(x) = N \\cdot V_{\\text{Var},x}(S_k) \\\\\n905: V_{\\text{Var},x}(S_k) &= \\frac{k_{\\text{alive}}}{N} \\cdot \\text{Var}_k(x) \\\\\n906: \\text{Var}_k(x) &= \\frac{N}{k_{\\text{alive}}} \\cdot V_{\\text{Var},x}(S_k)\n907: \\end{aligned}\n908: $$\n909: \n910: **When converting between notations in proofs:**\n911: - From $S_k$ to $V_{\\text{Var},x}$: **divide by $N$**",
      "metadata": {
        "label": "def-variance-conversions"
      },
      "section": "## 3. The Augmented Hypocoercive Lyapunov Function",
      "references": [
        "def-swarm-and-state-space",
        "def-walker"
      ],
      "raw_directive": "869: To ensure clarity throughout the proofs, we explicitly state the relationships between the three variance concepts used in this document:\n870: \n871: :::{prf:definition} Variance Notation Conversion Formulas\n872: :label: def-variance-conversions\n873: \n874: For a swarm ({prf:ref}`def-swarm-and-state-space`) $k$ with $k_{\\text{alive}} = |\\mathcal{A}(S_k)|$ alive walkers out of $N$ total walker ({prf:ref}`def-walker`) slots:\n875: \n876: **1. Un-normalized Sum of Squared Deviations:**\n877: \n878: $$\n879: S_k := \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2\n880: $$\n881: \n882: This is the total positional variance without any normalization.\n883: \n884: **2. Physical Internal Variance ($k$-normalized):**\n885: \n886: $$\n887: \\text{Var}_k(x) := \\frac{1}{k_{\\text{alive}}} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{S_k}{k_{\\text{alive}}}\n888: $$\n889: \n890: This is the average squared deviation per alive walker ({prf:ref}`def-walker`) - the standard statistical variance.\n891: \n892: **3. Lyapunov Variance Component ($N$-normalized):**\n893: \n894: $$\n895: V_{\\text{Var},x}(S_k) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|\\delta_{x,k,i}\\|^2 = \\frac{S_k}{N}\n896: $$\n897: \n898: This is the mean-field contribution to system disorder per walker ({prf:ref}`def-walker`) slot.\n899: \n900: **Conversion Formulas:**\n901: \n902: $$\n903: \\begin{aligned}\n904: S_k &= k_{\\text{alive}} \\cdot \\text{Var}_k(x) = N \\cdot V_{\\text{Var},x}(S_k) \\\\\n905: V_{\\text{Var},x}(S_k) &= \\frac{k_{\\text{alive}}}{N} \\cdot \\text{Var}_k(x) \\\\\n906: \\text{Var}_k(x) &= \\frac{N}{k_{\\text{alive}}} \\cdot V_{\\text{Var},x}(S_k)\n907: \\end{aligned}\n908: $$\n909: \n910: **When converting between notations in proofs:**\n911: - From $S_k$ to $V_{\\text{Var},x}$: **divide by $N$**\n912: - From $\\text{Var}_k(x)$ to $V_{\\text{Var},x}$: **multiply by $\\frac{k_{\\text{alive}}}{N}$**",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 3. The Augmented Hypocoercive Lyapunov Function"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-algorithmic-distance-metric",
      "title": "Algorithmic Distance for Companion Selection",
      "start_line": 1365,
      "end_line": 1377,
      "header_lines": [
        1366
      ],
      "content_start": 1368,
      "content_end": 1376,
      "content": "1368: :label: def-algorithmic-distance-metric\n1369: \n1370: For any two walkers $i$ and $j$ with states $(x_i, v_i)$ and $(x_j, v_j)$, the **algorithmic distance ({prf:ref}`def-alg-distance`)** between them is defined as:\n1371: \n1372: $$\n1373: d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2\n1374: $$\n1375: \n1376: where $\\lambda_{\\text{alg}} \\geq 0$ is a fixed algorithmic parameter that controls the relative importance of velocity similarity in the pairing and selection processes.",
      "metadata": {
        "label": "def-algorithmic-distance-metric"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-alg-distance",
        "def-greedy-pairing-algorithm",
        "def-spatial-pairing-operator-diversity"
      ],
      "raw_directive": "1365: Before defining the measurement operators, we must first establish the fundamental metric that quantifies proximity between walkers. This metric is central to all intra-swarm measurements in the algorithm, including companion selection for diversity measurement and companion selection for cloning.\n1366: \n1367: :::{prf:definition} Algorithmic Distance for Companion Selection\n1368: :label: def-algorithmic-distance-metric\n1369: \n1370: For any two walkers $i$ and $j$ with states $(x_i, v_i)$ and $(x_j, v_j)$, the **algorithmic distance ({prf:ref}`def-alg-distance`)** between them is defined as:\n1371: \n1372: $$\n1373: d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2\n1374: $$\n1375: \n1376: where $\\lambda_{\\text{alg}} \\geq 0$ is a fixed algorithmic parameter that controls the relative importance of velocity similarity in the pairing and selection processes.\n1377: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-spatial-pairing-operator-diversity",
      "title": "Spatially-Aware Pairing Operator (Idealized Model)",
      "start_line": 1409,
      "end_line": 1440,
      "header_lines": [
        1410
      ],
      "content_start": 1412,
      "content_end": 1439,
      "content": "1412: :label: def-spatial-pairing-operator-diversity\n1413: \n1414: Let $\\mathcal{S}_t$ be the current swarm ({prf:ref}`def-swarm-and-state-space`) state with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_t$ of size $k = |\\mathcal{A}_t|$. The idealized **Spatially-Aware Pairing Operator**, denoted $\\mathbb{P}_{\\text{pair}}$, maps the alive set $\\mathcal{A}_t$ to a probability distribution over the set of all possible perfect matchings, $\\mathcal{M}_k$.\n1415: \n1416: **Inputs:**\n1417: *   The alive set  of walkers, $\\mathcal{A}_t = \\{w_1, w_2, \\dots, w_k\\}$.\n1418: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1419: \n1420: **Operation:**\n1421: 1.  For every pair of distinct walkers $(w_i, w_j)$, an edge weight is assigned based on their phase-space proximity using the algorithmic distance ({prf:ref}`def-alg-distance`) metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1422: \n1423: \n1424: $$\n1425: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1426: $$\n1427: \n1428: 2.  The \"quality\" of a specific perfect matching `M` is the product of the weights of the edges it contains:\n1429: \n1430: \n1431: $$\n1432: W(M) := \\prod_{(i,j) \\in M} w_{ij}\n1433: $$\n1434: \n1435: 3.  The probability of selecting a specific matching `M` is given by its quality normalized by the sum of qualities over all possible matchings (the partition function):\n1436: \n1437: \n1438: $$\n1439: P(M) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}",
      "metadata": {
        "label": "def-spatial-pairing-operator-diversity"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-and-state-space",
        "def-alive-dead-sets",
        "def-alg-distance",
        "def-algorithmic-distance-metric"
      ],
      "raw_directive": "1409: For the purposes of theoretical analysis, it is useful to model the pairing as a single, collective draw from a probability distribution over all possible perfect matchings of the alive set. This idealized model captures the physical intent of the operatorâ€”to strongly favor pairings between walkers that are close in the algorithmic space.\n1410: \n1411: :::{prf:definition} Spatially-Aware Pairing Operator (Idealized Model)\n1412: :label: def-spatial-pairing-operator-diversity\n1413: \n1414: Let $\\mathcal{S}_t$ be the current swarm ({prf:ref}`def-swarm-and-state-space`) state with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_t$ of size $k = |\\mathcal{A}_t|$. The idealized **Spatially-Aware Pairing Operator**, denoted $\\mathbb{P}_{\\text{pair}}$, maps the alive set $\\mathcal{A}_t$ to a probability distribution over the set of all possible perfect matchings, $\\mathcal{M}_k$.\n1415: \n1416: **Inputs:**\n1417: *   The alive set  of walkers, $\\mathcal{A}_t = \\{w_1, w_2, \\dots, w_k\\}$.\n1418: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1419: \n1420: **Operation:**\n1421: 1.  For every pair of distinct walkers $(w_i, w_j)$, an edge weight is assigned based on their phase-space proximity using the algorithmic distance ({prf:ref}`def-alg-distance`) metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1422: \n1423: \n1424: $$\n1425: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1426: $$\n1427: \n1428: 2.  The \"quality\" of a specific perfect matching `M` is the product of the weights of the edges it contains:\n1429: \n1430: \n1431: $$\n1432: W(M) := \\prod_{(i,j) \\in M} w_{ij}\n1433: $$\n1434: \n1435: 3.  The probability of selecting a specific matching `M` is given by its quality normalized by the sum of qualities over all possible matchings (the partition function):\n1436: \n1437: \n1438: $$\n1439: P(M) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n1440: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-greedy-pairing-algorithm",
      "title": "Sequential Stochastic Greedy Pairing Operator",
      "start_line": 1448,
      "end_line": 1477,
      "header_lines": [
        1449
      ],
      "content_start": 1451,
      "content_end": 1476,
      "content": "1451: :label: def-greedy-pairing-algorithm\n1452: \n1453: Let `A_t` be the set of `k` alive walkers at time `t`. The pairing operator generates a **Companion Map**, `c: A_t â†’ A_t`, which is a perfect matching if `k` is even, or a maximal matching if `k` is odd.\n1454: \n1455: **Inputs:**\n1456: *   The set of alive walkers, `A_t = {w_1, w_2, ..., w_k}`.\n1457: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1458: \n1459: **Operation:**\n1460: 1.  Initialize a set of unpaired walkers `U â† A_t` and an empty companion map `c`.\n1461: 2.  While `|U| > 1`:\n1462:     a. Select and remove an arbitrary walker ({prf:ref}`def-walker`) `i` from `U`.\n1463:     b. For each remaining walker  $j \\in U$, calculate the selection weight based on phase-space proximity using the algorithmic distance ({prf:ref}`def-alg-distance`) metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1464: \n1465: \n1466: $$\n1467: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1468: $$\n1469: \n1470:     c. Form a probability distribution over $j \\in U$ where $P(\\text{choose } j) = w_{ij} / (\\sum_{l \\in U} w_{il})$.\n1471:     d. Sample a companion `c_i` for `i` from this distribution.\n1472:     e. Remove `c_i` from `U`.\n1473:     f. Set the pairing in the companion map: `c(i) â† c_i` and `c(c_i) â† i`.\n1474: 3.  Return the completed companion map `c`.\n1475: \n1476: **Complexity:** The outer loop runs `k/2` times. In each iteration, the weights and normalization factor are computed over the remaining walkers (at most `k-1`). The complexity is therefore `O(k^2)`, which is a feasible computation.",
      "metadata": {
        "label": "def-greedy-pairing-algorithm"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-walker",
        "def-alg-distance",
        "def-algorithmic-distance-metric",
        "lem-greedy-preserves-signal",
        "thm-geometry-guarantees-variance"
      ],
      "raw_directive": "1448: This algorithm builds the matching iteratively. It selects an unpaired walker, computes a probability distribution over all other currently unpaired walkers based on proximity, samples a companion, and removes the new pair from the pool. This reduces the computational complexity from factorial to quadratic, making it practical for large swarms.\n1449: \n1450: :::{prf:definition} Sequential Stochastic Greedy Pairing Operator\n1451: :label: def-greedy-pairing-algorithm\n1452: \n1453: Let `A_t` be the set of `k` alive walkers at time `t`. The pairing operator generates a **Companion Map**, `c: A_t â†’ A_t`, which is a perfect matching if `k` is even, or a maximal matching if `k` is odd.\n1454: \n1455: **Inputs:**\n1456: *   The set of alive walkers, `A_t = {w_1, w_2, ..., w_k}`.\n1457: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1458: \n1459: **Operation:**\n1460: 1.  Initialize a set of unpaired walkers `U â† A_t` and an empty companion map `c`.\n1461: 2.  While `|U| > 1`:\n1462:     a. Select and remove an arbitrary walker ({prf:ref}`def-walker`) `i` from `U`.\n1463:     b. For each remaining walker  $j \\in U$, calculate the selection weight based on phase-space proximity using the algorithmic distance ({prf:ref}`def-alg-distance`) metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1464: \n1465: \n1466: $$\n1467: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1468: $$\n1469: \n1470:     c. Form a probability distribution over $j \\in U$ where $P(\\text{choose } j) = w_{ij} / (\\sum_{l \\in U} w_{il})$.\n1471:     d. Sample a companion `c_i` for `i` from this distribution.\n1472:     e. Remove `c_i` from `U`.\n1473:     f. Set the pairing in the companion map: `c(i) â† c_i` and `c(c_i) â† i`.\n1474: 3.  Return the completed companion map `c`.\n1475: \n1476: **Complexity:** The outer loop runs `k/2` times. In each iteration, the weights and normalization factor are computed over the remaining walkers (at most `k-1`). The complexity is therefore `O(k^2)`, which is a feasible computation.\n1477: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-geometric-partition",
      "title": "Geometric Partitioning of High-Variance Swarms",
      "start_line": 1536,
      "end_line": 1546,
      "header_lines": [
        1537
      ],
      "content_start": 1539,
      "content_end": 1545,
      "content": "1539: :label: def-geometric-partition\n1540: \n1541: For a given interaction range $\\varepsilon$, we define a swarm ({prf:ref}`def-swarm-and-state-space`)'s phase-space structure based on local and global properties. As will be proven in **{prf:ref}`cor-vvarx-to-high-error-fraction`**, any swarm with sufficiently high variance (`Var(x) > R^{2}_var`) can be partitioned into two non-empty, N-uniform sets:\n1542: 1.  A **high-error set** `H_k`, whose members are **kinematically isolated** in phase space. This implies the existence of a distance $D_H(\\varepsilon) > 0$ such that for any $i \\in H_k$, all other walkers `j` are at an algorithmic distance ({prf:ref}`def-alg-distance`) $d_alg(i, j) > D_H(\\varepsilon)$.\n1543: 2.  A **low-error set** `L_k`, whose members are part of dense clusters in phase space. For any $j \\in L_k$, there is a non-empty subset of other walkers `C_j âŠ‚ L_k` of size $|C_j| \\geq f_c k$ (for some N-uniform `f_c > 0`) located within an algorithmic radius $R_L(\\varepsilon) < D_H(\\varepsilon)$.\n1544: \n1545: The existence and N-uniformity of these sets, their fractions, and their characteristic distances are the central results of the geometric analysis in Chapter 6. For this section, we take these as given structural properties of a high-variance swarm ({prf:ref}`def-swarm-and-state-space`).",
      "metadata": {
        "label": "def-geometric-partition"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-and-state-space",
        "cor-vvarx-to-high-error-fraction",
        "def-alg-distance",
        "lem-greedy-preserves-signal"
      ],
      "raw_directive": "1536: First, we must formalize the geometric partitioning of the swarm that is guaranteed to exist in a high-variance state, a result that will be proven in full detail in Chapter 6.\n1537: \n1538: :::{prf:definition} Geometric Partitioning of High-Variance Swarms\n1539: :label: def-geometric-partition\n1540: \n1541: For a given interaction range $\\varepsilon$, we define a swarm ({prf:ref}`def-swarm-and-state-space`)'s phase-space structure based on local and global properties. As will be proven in **{prf:ref}`cor-vvarx-to-high-error-fraction`**, any swarm with sufficiently high variance (`Var(x) > R^{2}_var`) can be partitioned into two non-empty, N-uniform sets:\n1542: 1.  A **high-error set** `H_k`, whose members are **kinematically isolated** in phase space. This implies the existence of a distance $D_H(\\varepsilon) > 0$ such that for any $i \\in H_k$, all other walkers `j` are at an algorithmic distance ({prf:ref}`def-alg-distance`) $d_alg(i, j) > D_H(\\varepsilon)$.\n1543: 2.  A **low-error set** `L_k`, whose members are part of dense clusters in phase space. For any $j \\in L_k$, there is a non-empty subset of other walkers `C_j âŠ‚ L_k` of size $|C_j| \\geq f_c k$ (for some N-uniform `f_c > 0`) located within an algorithmic radius $R_L(\\varepsilon) < D_H(\\varepsilon)$.\n1544: \n1545: The existence and N-uniformity of these sets, their fractions, and their characteristic distances are the central results of the geometric analysis in Chapter 6. For this section, we take these as given structural properties of a high-variance swarm ({prf:ref}`def-swarm-and-state-space`).\n1546: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-raw-value-operators",
      "title": "Raw Value Operators",
      "start_line": 1763,
      "end_line": 1785,
      "header_lines": [
        1764
      ],
      "content_start": 1766,
      "content_end": 1784,
      "content": "1766: :label: def-raw-value-operators\n1767: \n1768: 1.  **The Reward Measurement Operator ($V_R$):** The raw reward for each alive walker ({prf:ref}`def-walker`) `i` is its direct, individual measurement of the reward function, which explicitly includes both positional and velocity components:\n1769: \n1770: \n1771: $$\n1772: r_i := R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2\n1773: $$\n1774: \n1775:     where $R_{\\text{pos}}(x_i)$ is the positional reward and $c_{v\\_reg} > 0$ is the velocity regularization coefficient from {prf:ref}`axiom-velocity-regularization`.\n1776: \n1777: 2.  **The Paired Distance Measurement Operator ($V_D$):** Given the Companion Map `c(i)` generated by the pairing operator, the raw distance for each alive walker ({prf:ref}`def-walker`) `i` is deterministically defined as the algorithmic distance ({prf:ref}`def-alg-distance`) to its assigned companion:\n1778: \n1779: \n1780: $$\n1781: d_i := d_{\\text{alg}}(i, c(i))\n1782: $$\n1783: \n1784: For any walker ({prf:ref}`def-walker`) `j` that is dead, its raw values are deterministically zero: $r_j = 0$ and $d_j = 0$.",
      "metadata": {
        "label": "def-raw-value-operators"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-walker",
        "axiom-velocity-regularization",
        "def-alg-distance",
        "def-measurement-operator"
      ],
      "raw_directive": "1763: Once the Companion Map `c(i)` is fixed for the timestep by the pairing operator, the measurement of raw values for each walker becomes a deterministic process.\n1764: \n1765: :::{prf:definition} Raw Value Operators\n1766: :label: def-raw-value-operators\n1767: \n1768: 1.  **The Reward Measurement Operator ($V_R$):** The raw reward for each alive walker ({prf:ref}`def-walker`) `i` is its direct, individual measurement of the reward function, which explicitly includes both positional and velocity components:\n1769: \n1770: \n1771: $$\n1772: r_i := R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2\n1773: $$\n1774: \n1775:     where $R_{\\text{pos}}(x_i)$ is the positional reward and $c_{v\\_reg} > 0$ is the velocity regularization coefficient from {prf:ref}`axiom-velocity-regularization`.\n1776: \n1777: 2.  **The Paired Distance Measurement Operator ($V_D$):** Given the Companion Map `c(i)` generated by the pairing operator, the raw distance for each alive walker ({prf:ref}`def-walker`) `i` is deterministically defined as the algorithmic distance ({prf:ref}`def-alg-distance`) to its assigned companion:\n1778: \n1779: \n1780: $$\n1781: d_i := d_{\\text{alg}}(i, c(i))\n1782: $$\n1783: \n1784: For any walker ({prf:ref}`def-walker`) `j` that is dead, its raw values are deterministically zero: $r_j = 0$ and $d_j = 0$.\n1785: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-swarm-aggregation-operator",
      "title": "Swarm Aggregation Operator",
      "start_line": 1803,
      "end_line": 1809,
      "header_lines": [
        1804
      ],
      "content_start": 1806,
      "content_end": 1808,
      "content": "1806: :label: def-swarm-aggregation-operator\n1807: \n1808: A **Swarm ({prf:ref}`def-swarm-and-state-space`) Aggregation Operator**, $M$, maps the `k`-dimensional raw value vector $\\mathbf{v}_{\\mathcal{A}}$ from the alive set ({prf:ref}`def-alive-dead-sets`) of a swarm state $\\mathcal{S}$ (see {prf:ref}`def-single-swarm-space`) to a probability measure on $\\mathbb{R}$, $\\mu_{\\mathbf{v}} = M(\\mathcal{S}, \\mathbf{v}_{\\mathcal{A}})$. The moments of this measure define the swarm's collective statistics.",
      "metadata": {
        "label": "def-swarm-aggregation-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-and-state-space",
        "def-alive-dead-sets",
        "def-single-swarm-space",
        "def-standardization-operator"
      ],
      "raw_directive": "1803: This stage distills the raw reward and distance vectors from the `k` alive walkers into the summary statistics (mean and standard deviation) required for standardization.\n1804: \n1805: :::{prf:definition} Swarm Aggregation Operator\n1806: :label: def-swarm-aggregation-operator\n1807: \n1808: A **Swarm ({prf:ref}`def-swarm-and-state-space`) Aggregation Operator**, $M$, maps the `k`-dimensional raw value vector $\\mathbf{v}_{\\mathcal{A}}$ from the alive set ({prf:ref}`def-alive-dead-sets`) of a swarm state $\\mathcal{S}$ (see {prf:ref}`def-single-swarm-space`) to a probability measure on $\\mathbb{R}$, $\\mu_{\\mathbf{v}} = M(\\mathcal{S}, \\mathbf{v}_{\\mathcal{A}})$. The moments of this measure define the swarm's collective statistics.\n1809: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-patched-std-dev-function",
      "title": "Patched Standard Deviation Function",
      "start_line": 1818,
      "end_line": 1833,
      "header_lines": [
        1819
      ],
      "content_start": 1821,
      "content_end": 1832,
      "content": "1821: :label: def-patched-std-dev-function\n1822: \n1823: The **Patched Standard Deviation Function**, $\\sigma'_{\\text{patch}}: \\mathbb{R}_{\\ge 0} \\to \\mathbb{R}_{>0}$, is a $C^1$ smooth replacement for the standard square-root function, designed to be globally Lipschitz and bounded away from zero. It is defined piecewise in terms of the raw variance, $V := \\operatorname{Var}[\\mu_{\\mathbf{v}}]$:\n1824: \n1825: $$\n1826: \\sigma'_{\\text{patch}}(V) :=\n1827: \\begin{cases}\n1828: \\sqrt{\\kappa_{\\text{var,min}} + \\varepsilon_{\\mathrm{std}}^2}, & V \\le \\kappa_{\\text{var,min}} \\\\\n1829: P(V), & \\kappa_{\\text{var,min}} < V < 2\\kappa_{\\text{var,min}} \\\\\n1830: \\sqrt{V + \\varepsilon_{\\mathrm{std}}^2}, & V \\ge 2\\kappa_{\\text{var,min}}\n1831: \\end{cases}\n1832: $$",
      "metadata": {
        "label": "def-patched-std-dev-function"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1818: A critical component of this stage is the use of a robust, smooth function (see {prf:ref}`def-patched-std-dev-function`) to compute the standard deviation, which is essential for the stability of the entire pipeline.\n1819: \n1820: :::{prf:definition} Patched Standard Deviation Function\n1821: :label: def-patched-std-dev-function\n1822: \n1823: The **Patched Standard Deviation Function**, $\\sigma'_{\\text{patch}}: \\mathbb{R}_{\\ge 0} \\to \\mathbb{R}_{>0}$, is a $C^1$ smooth replacement for the standard square-root function, designed to be globally Lipschitz and bounded away from zero. It is defined piecewise in terms of the raw variance, $V := \\operatorname{Var}[\\mu_{\\mathbf{v}}]$:\n1824: \n1825: $$\n1826: \\sigma'_{\\text{patch}}(V) :=\n1827: \\begin{cases}\n1828: \\sqrt{\\kappa_{\\text{var,min}} + \\varepsilon_{\\mathrm{std}}^2}, & V \\le \\kappa_{\\text{var,min}} \\\\\n1829: P(V), & \\kappa_{\\text{var,min}} < V < 2\\kappa_{\\text{var,min}} \\\\\n1830: \\sqrt{V + \\varepsilon_{\\mathrm{std}}^2}, & V \\ge 2\\kappa_{\\text{var,min}}\n1831: \\end{cases}\n1832: $$\n1833: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-standardization-operator",
      "title": "N-Dimensional Standardization Operator",
      "start_line": 1844,
      "end_line": 1856,
      "header_lines": [
        1845
      ],
      "content_start": 1847,
      "content_end": 1855,
      "content": "1847: :label: def-standardization-operator\n1848: \n1849: The **N-Dimensional Standardization Operator ({prf:ref}`def-standardization-operator-n-dimensional`)**, $z$, maps a swarm ({prf:ref}`def-swarm-and-state-space`) state `S`, a raw value vector `v`, and an aggregation operator `M` to an N-dimensional vector of Z-scores.\n1850: \n1851: **Operation:**\n1852: 1.  Aggregate the alive components `v_A` using operator M (see {prf:ref}`def-swarm-aggregation-operator`) to get a measure $\\mu_v = M(S, v_A)$.\n1853: 2.  Compute the mean $\\mu_A = \\mathbb{E}[\\mu_v]$ and the **patched** standard deviation $\\sigma'_A = \\sigma'_{\\text{patch}}(\\text{Var}[\\mu_v])$ using the patching function (see {prf:ref}`lem-patching-properties`).\n1854: 3.  For each alive walker ({prf:ref}`def-walker`) `i`, compute its Z-score: $z_i = (v_i - \\mu_A) / \\sigma'_A$.\n1855: 4.  Assemble the final N-dimensional vector, setting components for dead walkers to zero.",
      "metadata": {
        "label": "def-standardization-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-standardization-operator-n-dimensional",
        "def-swarm-and-state-space",
        "def-swarm-aggregation-operator",
        "lem-patching-properties",
        "def-walker",
        "def-measurement-operator"
      ],
      "raw_directive": "1844: This operator uses the robust statistics from the previous stage to convert the raw value vectors into standardized Z-scores.\n1845: \n1846: :::{prf:definition} N-Dimensional Standardization Operator\n1847: :label: def-standardization-operator\n1848: \n1849: The **N-Dimensional Standardization Operator ({prf:ref}`def-standardization-operator-n-dimensional`)**, $z$, maps a swarm ({prf:ref}`def-swarm-and-state-space`) state `S`, a raw value vector `v`, and an aggregation operator `M` to an N-dimensional vector of Z-scores.\n1850: \n1851: **Operation:**\n1852: 1.  Aggregate the alive components `v_A` using operator M (see {prf:ref}`def-swarm-aggregation-operator`) to get a measure $\\mu_v = M(S, v_A)$.\n1853: 2.  Compute the mean $\\mu_A = \\mathbb{E}[\\mu_v]$ and the **patched** standard deviation $\\sigma'_A = \\sigma'_{\\text{patch}}(\\text{Var}[\\mu_v])$ using the patching function (see {prf:ref}`lem-patching-properties`).\n1854: 3.  For each alive walker ({prf:ref}`def-walker`) `i`, compute its Z-score: $z_i = (v_i - \\mu_A) / \\sigma'_A$.\n1855: 4.  Assemble the final N-dimensional vector, setting components for dead walkers to zero.\n1856: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-logistic-rescale",
      "title": "Canonical Logistic Rescale Function",
      "start_line": 1872,
      "end_line": 1881,
      "header_lines": [
        1873
      ],
      "content_start": 1875,
      "content_end": 1880,
      "content": "1875: :label: def-logistic-rescale\n1876: \n1877: The **Canonical Logistic Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`)**, $g_A: \\mathbb{R} \\to (0, 2)$, is defined as:\n1878: \n1879: $$\n1880: g_A(z) := \\frac{2}{1 + e^{-z}}",
      "metadata": {
        "label": "def-logistic-rescale"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-canonical-logistic-rescale-function-example"
      ],
      "raw_directive": "1872: :::\n1873: \n1874: :::{prf:definition} Canonical Logistic Rescale Function\n1875: :label: def-logistic-rescale\n1876: \n1877: The **Canonical Logistic Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`)**, $g_A: \\mathbb{R} \\to (0, 2)$, is defined as:\n1878: \n1879: $$\n1880: g_A(z) := \\frac{2}{1 + e^{-z}}\n1881: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-fitness-potential-operator",
      "title": "Fitness Potential Operator",
      "start_line": 1892,
      "end_line": 1912,
      "header_lines": [
        1893
      ],
      "content_start": 1895,
      "content_end": 1911,
      "content": "1895: :label: def-fitness-potential-operator\n1896: \n1897: The **Fitness Potential Operator**, $\\Phi_{\\text{pipeline}}$, maps a swarm ({prf:ref}`def-swarm-and-state-space`) state `S` and its raw measurement vectors `r` and `d` to the final N-dimensional fitness potential vector $\\mathbf{V}_{\\text{fit}}$.\n1898: \n1899: **Operation:**\n1900: 1.  Compute reward Z-scores: $\\mathbf{z}_r = z(S, \\mathbf{r}, R_{agg})$.\n1901: 2.  Compute distance Z-scores: $\\mathbf{z}_d = z(S, \\mathbf{d}, M_D)$.\n1902: 3.  For each alive walker ({prf:ref}`def-walker`) `i`, compute the rescaled components with the floor $\\eta$ using the Canonical Logistic Rescale Function (see {prf:ref}`lem-logistic-properties`):\n1903:     *   $r'_i := g_A(z_{r,i}) + \\eta$\n1904:     *   $d'_i := g_A(z_{d,i}) + \\eta$\n1905: 4.  Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n1906: \n1907: \n1908: \n1909: $$\n1910: V_i := (d'_i)^\\beta \\cdot (r'_i)^\\alpha\n1911: $$",
      "metadata": {
        "label": "def-fitness-potential-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-and-state-space",
        "def-walker",
        "lem-logistic-properties"
      ],
      "raw_directive": "1892: The final stage of the pipeline assembles the rescaled components from both the reward and diversity channels into the final fitness potential vector.\n1893: \n1894: :::{prf:definition} Fitness Potential Operator\n1895: :label: def-fitness-potential-operator\n1896: \n1897: The **Fitness Potential Operator**, $\\Phi_{\\text{pipeline}}$, maps a swarm ({prf:ref}`def-swarm-and-state-space`) state `S` and its raw measurement vectors `r` and `d` to the final N-dimensional fitness potential vector $\\mathbf{V}_{\\text{fit}}$.\n1898: \n1899: **Operation:**\n1900: 1.  Compute reward Z-scores: $\\mathbf{z}_r = z(S, \\mathbf{r}, R_{agg})$.\n1901: 2.  Compute distance Z-scores: $\\mathbf{z}_d = z(S, \\mathbf{d}, M_D)$.\n1902: 3.  For each alive walker ({prf:ref}`def-walker`) `i`, compute the rescaled components with the floor $\\eta$ using the Canonical Logistic Rescale Function (see {prf:ref}`lem-logistic-properties`):\n1903:     *   $r'_i := g_A(z_{r,i}) + \\eta$\n1904:     *   $d'_i := g_A(z_{d,i}) + \\eta$\n1905: 4.  Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n1906: \n1907: \n1908: \n1909: $$\n1910: V_i := (d'_i)^\\beta \\cdot (r'_i)^\\alpha\n1911: $$\n1912: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-companion-operator",
      "title": "Companion Selection Operator for Cloning",
      "start_line": 1962,
      "end_line": 1991,
      "header_lines": [
        1963
      ],
      "content_start": 1965,
      "content_end": 1990,
      "content": "1965: :label: def-cloning-companion-operator\n1966: \n1967: The first step of the cloning action is to select a companion. The **Companion Selection ({prf:ref}`def-companion-selection-measure`) Operator for Cloning** defines, for each walker ({prf:ref}`def-walker`) `i`, a probability measure $\\mathcal{C}_i(S)$ from which a companion `c_i` is sampled independently. This is a hybrid operator that uses the best available information for each type of walker.\n1968: \n1969: **Inputs:**\n1970: *   The swarm ({prf:ref}`def-swarm-and-state-space`) state `S`, which defines the set of alive walkers, $\\mathcal{A}_k$, and the set of dead walkers, $\\mathcal{D}_k$.\n1971: *   The interaction range for cloning, $\\varepsilon_c > 0$.\n1972: \n1973: **Operation:**\n1974: The definition of the measure $\\mathcal{C}_i(S)$ depends on the status of walker ({prf:ref}`def-walker`) `i`:\n1975: \n1976: 1.  **If `i` is an ALIVE walker  ($i \\in \\mathcal{A}_k$):**\n1977:     The selection is phase-space-aware and restricted to other alive walkers. For any other alive walker $j \\in \\mathcal{A}_k \\setminus \\{i\\}$, the probability of selection is given by a softmax distribution based on algorithmic distance:\n1978: \n1979: \n1980: $$\n1981: P(c_i=j \\mid i \\in \\mathcal{A}_k) := \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{l \\in \\mathcal{A}_k \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i, l)^2}{2\\epsilon_c^2}\\right)}\n1982: $$\n1983: \n1984: 2.  **If `i` is a DEAD walker ($i \\in \\mathcal{D}_k$):**\n1985:     The selection is a uniform random choice from the entire set of `k` alive walkers. For any alive walker $j \\in \\mathcal{A}_k$:\n1986: \n1987: \n1988: $$\n1989: P(c_i=j \\mid i \\in \\mathcal{D}_k) := \\frac{1}{k}\n1990: $$",
      "metadata": {
        "label": "def-cloning-companion-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-companion-selection-measure",
        "def-walker",
        "def-swarm-and-state-space",
        "def-decision-operator"
      ],
      "raw_directive": "1962: \n1963: #### 5.7.1 Companion Selection Operator for Cloning\n1964: :::{prf:definition} Companion Selection Operator for Cloning\n1965: :label: def-cloning-companion-operator\n1966: \n1967: The first step of the cloning action is to select a companion. The **Companion Selection ({prf:ref}`def-companion-selection-measure`) Operator for Cloning** defines, for each walker ({prf:ref}`def-walker`) `i`, a probability measure $\\mathcal{C}_i(S)$ from which a companion `c_i` is sampled independently. This is a hybrid operator that uses the best available information for each type of walker.\n1968: \n1969: **Inputs:**\n1970: *   The swarm ({prf:ref}`def-swarm-and-state-space`) state `S`, which defines the set of alive walkers, $\\mathcal{A}_k$, and the set of dead walkers, $\\mathcal{D}_k$.\n1971: *   The interaction range for cloning, $\\varepsilon_c > 0$.\n1972: \n1973: **Operation:**\n1974: The definition of the measure $\\mathcal{C}_i(S)$ depends on the status of walker ({prf:ref}`def-walker`) `i`:\n1975: \n1976: 1.  **If `i` is an ALIVE walker  ($i \\in \\mathcal{A}_k$):**\n1977:     The selection is phase-space-aware and restricted to other alive walkers. For any other alive walker $j \\in \\mathcal{A}_k \\setminus \\{i\\}$, the probability of selection is given by a softmax distribution based on algorithmic distance:\n1978: \n1979: \n1980: $$\n1981: P(c_i=j \\mid i \\in \\mathcal{A}_k) := \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{l \\in \\mathcal{A}_k \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i, l)^2}{2\\epsilon_c^2}\\right)}\n1982: $$\n1983: \n1984: 2.  **If `i` is a DEAD walker ($i \\in \\mathcal{D}_k$):**\n1985:     The selection is a uniform random choice from the entire set of `k` alive walkers. For any alive walker $j \\in \\mathcal{A}_k$:\n1986: \n1987: \n1988: $$\n1989: P(c_i=j \\mid i \\in \\mathcal{D}_k) := \\frac{1}{k}\n1990: $$\n1991: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-score",
      "title": "The Canonical Cloning Score",
      "start_line": 1994,
      "end_line": 2006,
      "header_lines": [
        1995
      ],
      "content_start": 1997,
      "content_end": 2005,
      "content": "1997: :label: def-cloning-score\n1998: \n1999: Once a companion `c_i` has been selected for walker ({prf:ref}`def-walker`) `i`, the **Canonical Cloning Score**, $S_i(c_i)$, is calculated as:\n2000: \n2001: $$\n2002: S_i(c_i) := \\frac{V_{\\text{fit},{c_i}} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\mathrm{clone}}}\n2003: $$\n2004: \n2005: where $V_{\\text{fit},i}$ is the fitness of walker ({prf:ref}`def-walker`) `i`, $V_{\\text{fit},{c_i}}$ is the fitness of its chosen companion, and $\\varepsilon_{\\mathrm{clone}} > 0$ is a small regularization constant.",
      "metadata": {
        "label": "def-cloning-score"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-walker",
        "def-cloning-decision",
        "def-cloning-probability"
      ],
      "raw_directive": "1994: \n1995: #### 5.7.2 Cloning Score\n1996: :::{prf:definition} The Canonical Cloning Score\n1997: :label: def-cloning-score\n1998: \n1999: Once a companion `c_i` has been selected for walker ({prf:ref}`def-walker`) `i`, the **Canonical Cloning Score**, $S_i(c_i)$, is calculated as:\n2000: \n2001: $$\n2002: S_i(c_i) := \\frac{V_{\\text{fit},{c_i}} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\mathrm{clone}}}\n2003: $$\n2004: \n2005: where $V_{\\text{fit},i}$ is the fitness of walker ({prf:ref}`def-walker`) `i`, $V_{\\text{fit},{c_i}}$ is the fitness of its chosen companion, and $\\varepsilon_{\\mathrm{clone}} > 0$ is a small regularization constant.\n2006: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-probability",
      "title": "Total Cloning Probability",
      "start_line": 2008,
      "end_line": 2024,
      "header_lines": [
        2009
      ],
      "content_start": 2011,
      "content_end": 2023,
      "content": "2011: :label: def-cloning-probability\n2012: \n2013: The **total cloning probability**, $p_i$, for a walker ({prf:ref}`def-walker`) `i` is its unconditional probability of being marked for cloning. This is the expectation of the cloning event taken over the random draws of both the companion `c_i` and the threshold `T_i`, where the score is defined by {prf:ref}`def-cloning-score`.\n2014: \n2015: $$\n2016: p_i := \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)} \\left[ \\mathbb{P}_{T_i \\sim U(0,p_{\\max})} \\left( S_i(c_i) > T_i \\right) \\right]\n2017: $$\n2018: \n2019: The inner probability, for a fixed companion, evaluates to $\\min(1, \\max(0, S_i(c_i)/p_{\\max}))$. This gives the final expression for the total cloning probability as an expectation over the choice of companion:\n2020: \n2021: $$\n2022: p_i = \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)}\\left[\\min\\left(1, \\max\\left(0, \\frac{S_i(c_i)}{p_{\\max}}\\right)\\right)\\right]\n2023: $$",
      "metadata": {
        "label": "def-cloning-probability"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-walker",
        "def-cloning-score"
      ],
      "raw_directive": "2008: :::\n2009: \n2010: :::{prf:definition} Total Cloning Probability\n2011: :label: def-cloning-probability\n2012: \n2013: The **total cloning probability**, $p_i$, for a walker ({prf:ref}`def-walker`) `i` is its unconditional probability of being marked for cloning. This is the expectation of the cloning event taken over the random draws of both the companion `c_i` and the threshold `T_i`, where the score is defined by {prf:ref}`def-cloning-score`.\n2014: \n2015: $$\n2016: p_i := \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)} \\left[ \\mathbb{P}_{T_i \\sim U(0,p_{\\max})} \\left( S_i(c_i) > T_i \\right) \\right]\n2017: $$\n2018: \n2019: The inner probability, for a fixed companion, evaluates to $\\min(1, \\max(0, S_i(c_i)/p_{\\max}))$. This gives the final expression for the total cloning probability as an expectation over the choice of companion:\n2020: \n2021: $$\n2022: p_i = \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)}\\left[\\min\\left(1, \\max\\left(0, \\frac{S_i(c_i)}{p_{\\max}}\\right)\\right)\\right]\n2023: $$\n2024: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-decision",
      "title": "The Stochastic Cloning Decision",
      "start_line": 2036,
      "end_line": 2040,
      "header_lines": [
        2037
      ],
      "content_start": 2039,
      "content_end": 2039,
      "content": "2039: :label: def-cloning-decision",
      "metadata": {
        "label": "def-cloning-decision"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-cloning-score",
        "def-walker"
      ],
      "raw_directive": "2036: #### 5.7.3  Cloning Decision\n2037: \n2038: :::{prf:definition} The Stochastic Cloning Decision\n2039: :label: def-cloning-decision\n2040: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-inelastic-collision-update",
      "title": "The Inelastic Collision State Update",
      "start_line": 2048,
      "end_line": 2109,
      "header_lines": [
        2049
      ],
      "content_start": 2051,
      "content_end": 2108,
      "content": "2051: :label: def-inelastic-collision-update\n2052: \n2053: Let the set of all walkers marked for cloning be `C_set`. For each cloner $i \\in C_set$, let `c_i` be its selected companion. The intermediate swarm ({prf:ref}`def-swarm-and-state-space`) state `S'` is constructed as follows.\n2054: \n2055: First, for each unique companion `c` in the swarm , we identify the set of all cloners that selected it:\n2056: \n2057: $$\n2058: I_c := \\{j \\in C_{set} \\mid c_j = c\\}\n2059: $$\n2060: \n2061: Let `M = |I_c|` be the number of walkers cloning from companion `c`. The update is then defined for each `(M+1)`-particle system consisting of the companion `c` and its set of cloners `I_c`.\n2062: \n2063: 1.  **Position Updates:**\n2064:     *   For each cloner $j \\in I_c$, its position is reset to that of its companion `c`, plus independent Gaussian jitter:\n2065: \n2066: \n2067: $$\n2068: x'_j := x_c + \\sigma_x \\zeta_j^x\n2069: $$\n2070: \n2071:     *   The position of the companion `c` is unchanged by this interaction: `x'_c := x_c`.\n2072: \n2073: 2.  **Velocity Updates (The Inelastic Collapse):**\n2074:     The velocities of all `M+1` interacting walkers are updated simultaneously in a process that conserves the group's total momentum.\n2075: \n2076:     *   **a. Center-of-Mass Velocity:** First, compute the center-of-mass velocity of the `(M+1)`-particle interacting system. This quantity is conserved throughout the collision.\n2077: \n2078: \n2079: $$\n2080: V_{COM, c} := \\frac{1}{M+1} \\left( v_c + \\sum_{j \\in I_c} v_j \\right)\n2081: $$\n2082: \n2083:     *   **b. Update Relative Velocities:** For each walker ({prf:ref}`def-walker`) `k` in the system ($k \\in I_c \\cup {c}$), its velocity relative to the CoM is `u_k = v_k - V_{COM,c}`. The new relative velocities `u'_k` are defined by a random rotation and a frictional contraction.\n2084:         Let $\\alpha_restitution \\in [0, 1]$ be a fixed algorithmic parameter representing the coefficient of restitution. For each `k`, let `R_k` be a random orthogonal transformation that isotropically rotates `u_k` (i.e., `R_k(u_k)` has the same magnitude as `u_k` but a uniformly random direction on the `(d-1)`-sphere). The new relative velocity is:\n2085: \n2086: \n2087: $$\n2088: u'_k := \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n2089: $$\n2090: \n2091:     *   **c. Return to Lab Frame:** The final velocities for all interacting walkers are then reconstructed:\n2092: \n2093: \n2094: $$\n2095: v'_k := V_{COM, c} + u'_k\n2096: $$\n2097: \n2098: 3.  **Uninvolved Walkers:** Any walker ({prf:ref}`def-walker`) `k` that is not a cloner and was not selected as a companion by any cloner has its state `(x_k, v_k)` unchanged.\n2099: \n2100: **Analysis of the Restitution Parameter $\\alpha_restitution$:**\n2101: \n2102: This model introduces $\\alpha_restitution$ as a crucial hyperparameter that controls the velocity variance expansion caused by the velocity reset mechanism during cloning.\n2103: \n2104: *   If **$\\alpha_restitution = 1$**, the collision is **perfectly elastic**. The magnitudes of the relative velocities are preserved (`||u'_k|| = ||u_k||`), and the total kinetic energy of the interacting system is conserved. In this regime, cloning redistributes kinetic energy among walkers but does not directly dissipate it. However, the velocity reset mechanism still causes bounded expansion of $V_{\\text{Var},v}$ as walkers' velocities are reset based on their companions.\n2105: \n2106: *   If **$\\alpha_restitution = 0$**, the collision is **perfectly inelastic**. All new relative velocities are zero (`u'_k = 0`), meaning all `M+1` walkers emerge with the identical center-of-mass velocity, `v'_k = V_{COM,c}`. This corresponds to the **maximum possible dissipation** of the group's internal kinetic energy while still conserving total momentum. In this regime, the velocity variance expansion is minimized, as all walkers in a cloning group collapse to a single velocity.\n2107: \n2108: *   If **$\\alpha_restitution \\in (0, 1)$**, the cloning event has **intermediate dissipation**. The internal kinetic energy of the interacting group is reduced by a factor of $\\alpha_restitution^{2}$. This parameter provides a tunable mechanism for controlling the trade-off between maintaining kinetic diversity and bounding velocity variance expansion.",
      "metadata": {
        "label": "def-inelastic-collision-update"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-and-state-space",
        "def-walker",
        "def-kinetic-operator"
      ],
      "raw_directive": "2048: This model handles the complex but common scenario where multiple \"cloners\" (either unfit alive walkers or dead walkers being revived) select the same high-fitness walker as their companion. Instead of a series of pairwise interactions, all cloners associated with a single companion are treated as a single interacting system that undergoes a simultaneous, momentum-conserving \"inelastic collapse.\" This process includes a tunable parameter for energy dissipation, allowing the cloning operator itself to act as a powerful mechanism for controlling the swarm's kinetic energy.\n2049: \n2050: :::{prf:definition} The Inelastic Collision State Update\n2051: :label: def-inelastic-collision-update\n2052: \n2053: Let the set of all walkers marked for cloning be `C_set`. For each cloner $i \\in C_set$, let `c_i` be its selected companion. The intermediate swarm ({prf:ref}`def-swarm-and-state-space`) state `S'` is constructed as follows.\n2054: \n2055: First, for each unique companion `c` in the swarm , we identify the set of all cloners that selected it:\n2056: \n2057: $$\n2058: I_c := \\{j \\in C_{set} \\mid c_j = c\\}\n2059: $$\n2060: \n2061: Let `M = |I_c|` be the number of walkers cloning from companion `c`. The update is then defined for each `(M+1)`-particle system consisting of the companion `c` and its set of cloners `I_c`.\n2062: \n2063: 1.  **Position Updates:**\n2064:     *   For each cloner $j \\in I_c$, its position is reset to that of its companion `c`, plus independent Gaussian jitter:\n2065: \n2066: \n2067: $$\n2068: x'_j := x_c + \\sigma_x \\zeta_j^x\n2069: $$\n2070: \n2071:     *   The position of the companion `c` is unchanged by this interaction: `x'_c := x_c`.\n2072: \n2073: 2.  **Velocity Updates (The Inelastic Collapse):**\n2074:     The velocities of all `M+1` interacting walkers are updated simultaneously in a process that conserves the group's total momentum.\n2075: \n2076:     *   **a. Center-of-Mass Velocity:** First, compute the center-of-mass velocity of the `(M+1)`-particle interacting system. This quantity is conserved throughout the collision.\n2077: \n2078: \n2079: $$\n2080: V_{COM, c} := \\frac{1}{M+1} \\left( v_c + \\sum_{j \\in I_c} v_j \\right)\n2081: $$\n2082: \n2083:     *   **b. Update Relative Velocities:** For each walker ({prf:ref}`def-walker`) `k` in the system ($k \\in I_c \\cup {c}$), its velocity relative to the CoM is `u_k = v_k - V_{COM,c}`. The new relative velocities `u'_k` are defined by a random rotation and a frictional contraction.\n2084:         Let $\\alpha_restitution \\in [0, 1]$ be a fixed algorithmic parameter representing the coefficient of restitution. For each `k`, let `R_k` be a random orthogonal transformation that isotropically rotates `u_k` (i.e., `R_k(u_k)` has the same magnitude as `u_k` but a uniformly random direction on the `(d-1)`-sphere). The new relative velocity is:\n2085: \n2086: \n2087: $$\n2088: u'_k := \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n2089: $$\n2090: \n2091:     *   **c. Return to Lab Frame:** The final velocities for all interacting walkers are then reconstructed:\n2092: \n2093: \n2094: $$\n2095: v'_k := V_{COM, c} + u'_k\n2096: $$\n2097: \n2098: 3.  **Uninvolved Walkers:** Any walker ({prf:ref}`def-walker`) `k` that is not a cloner and was not selected as a companion by any cloner has its state `(x_k, v_k)` unchanged.\n2099: \n2100: **Analysis of the Restitution Parameter $\\alpha_restitution$:**\n2101: \n2102: This model introduces $\\alpha_restitution$ as a crucial hyperparameter that controls the velocity variance expansion caused by the velocity reset mechanism during cloning.\n2103: \n2104: *   If **$\\alpha_restitution = 1$**, the collision is **perfectly elastic**. The magnitudes of the relative velocities are preserved (`||u'_k|| = ||u_k||`), and the total kinetic energy of the interacting system is conserved. In this regime, cloning redistributes kinetic energy among walkers but does not directly dissipate it. However, the velocity reset mechanism still causes bounded expansion of $V_{\\text{Var},v}$ as walkers' velocities are reset based on their companions.\n2105: \n2106: *   If **$\\alpha_restitution = 0$**, the collision is **perfectly inelastic**. All new relative velocities are zero (`u'_k = 0`), meaning all `M+1` walkers emerge with the identical center-of-mass velocity, `v'_k = V_{COM,c}`. This corresponds to the **maximum possible dissipation** of the group's internal kinetic energy while still conserving total momentum. In this regime, the velocity variance expansion is minimized, as all walkers in a cloning group collapse to a single velocity.\n2107: \n2108: *   If **$\\alpha_restitution \\in (0, 1)$**, the cloning event has **intermediate dissipation**. The internal kinetic energy of the interacting group is reduced by a factor of $\\alpha_restitution^{2}$. This parameter provides a tunable mechanism for controlling the trade-off between maintaining kinetic diversity and bounding velocity variance expansion.\n2109: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 5. The Measurement and Interaction Pipeline"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-unified-high-low-error-sets",
      "title": "The Unified High-Error and Low-Error Sets",
      "start_line": 2402,
      "end_line": 2446,
      "header_lines": [
        2403
      ],
      "content_start": 2405,
      "content_end": 2445,
      "content": "2405: :label: def-unified-high-low-error-sets\n2406: \n2407: For a given swarm ({prf:ref}`def-swarm-and-state-space`) `k` with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ ($k \\ge 2$), we define a partition into a unified high-error set $H_k(\\epsilon)$ and a unified low-error set $L_k(\\epsilon)$ using a **clustering-based approach** that applies uniformly across all interaction regimes. This unified approach captures both global outlier structure and local phase-space clustering through a single consistent mechanism.\n2408: \n2409: **Phase-Space Clustering Construction:**\n2410: \n2411: The construction proceeds in four steps:\n2412: \n2413: 1.  **Clustering:** Partition the alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ into disjoint clusters $\\{G_1, \\ldots, G_M\\}$ using complete-linkage hierarchical clustering with a maximum cluster diameter $D_{\\text{diam}}(\\epsilon) := c_d \\cdot \\epsilon$ (where $c_d > 0$ is a fixed constant, typically $c_d = 2$). Each cluster $G_m$ satisfies:\n2414: \n2415: $$\n2416: \\text{diam}(G_m) := \\max_{i,j \\in G_m} d_{\\text{alg}}(i, j) \\le D_{\\text{diam}}(\\epsilon)\n2417: $$\n2418: \n2419: where $d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2$ is the algorithmic phase-space distance.\n2420: \n2421: 2.  **Statistical Validity Constraint:** To ensure that cluster-level statistics are meaningful, we impose a minimum cluster size requirement. Let $k_{\\min} := \\max(5, \\lceil 0.05k \\rceil)$ be the minimum statistically valid cluster size. All clusters with $|G_m| < k_{\\min}$ are marked as **invalid** and their walkers are automatically included in the high-error set (as they represent statistically unreliable outlier configurations).\n2422: \n2423: 3.  **Outlier Cluster Identification:** For each valid cluster $G_m$ (with $|G_m| \\ge k_{\\min}$), compute its center of mass in phase space: $(\\mu_{x,m}, \\mu_{v,m})$. Compute the between-cluster hypocoercive variance contribution:\n2424: \n2425: $$\n2426: \\text{Contrib}(G_m) := |G_m| \\left(\\|\\mu_{x,m} - \\mu_x\\|^2 + \\lambda_v \\|\\mu_{v,m} - \\mu_v\\|^2\\right)\n2427: $$\n2428: \n2429: where $(\\mu_x, \\mu_v)$ is the global center of mass. Sort valid clusters by $\\text{Contrib}(G_m)$ in descending order, and let $O_M \\subseteq \\{1, \\ldots, M\\}$ be the smallest set of cluster indices (among valid clusters) whose cumulative contribution meets or exceeds a fraction $(1-\\varepsilon_O)$ of the total contribution from valid clusters (where $\\varepsilon_O \\in (0, 1)$ is a fixed structural parameter, typically $\\varepsilon_O = 0.1$):\n2430: \n2431: $$\n2432: \\sum_{m \\in O_M} \\text{Contrib}(G_m) \\ge (1-\\varepsilon_O) \\sum_{\\substack{m=1 \\\\ |G_m| \\ge k_{\\min}}}^M \\text{Contrib}(G_m)\n2433: $$\n2434: \n2435: 4.  **Unified High-Error Set Construction:** The unified high-error set is the union of all walkers in outlier clusters plus all walkers in invalid clusters:\n2436: \n2437: $$\n2438: H_k(\\epsilon) := \\left(\\bigcup_{m \\in O_M} G_m\\right) \\cup \\left(\\bigcup_{\\substack{m: |G_m| < k_{\\min}}} G_m\\right)\n2439: $$\n2440: \n2441: The **Unified Low-Error Set** is the complement:\n2442: \n2443: $$\n2444: L_k(\\epsilon) := \\mathcal{A}_k \\setminus H_k(\\epsilon)\n2445: $$",
      "metadata": {
        "label": "def-unified-high-low-error-sets"
      },
      "section": "## 6. The Geometry of Error: From System Error to a Guaranteed Geometric Structure",
      "references": [
        "def-swarm-and-state-space",
        "def-alive-dead-sets",
        "def-fitness-potential-operator",
        "def-geometric-partition"
      ],
      "raw_directive": "2402: Therefore, this section formally defines these sets based on the swarm's full **phase-space configuration**. We will partition the swarm based on two distinct phase-space measures: global kinematic dispersion and local phase-space density. These definitions create the crucial link between the state of the swarm and the signals measured by the algorithm. The remainder of the Keystone analysis will then be dedicated to proving that high *positional* variance is a sufficient condition to force a non-trivial number of walkers into these *phase-space* defined error sets.\n2403: \n2404: :::{prf:definition} The Unified High-Error and Low-Error Sets\n2405: :label: def-unified-high-low-error-sets\n2406: \n2407: For a given swarm ({prf:ref}`def-swarm-and-state-space`) `k` with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ ($k \\ge 2$), we define a partition into a unified high-error set $H_k(\\epsilon)$ and a unified low-error set $L_k(\\epsilon)$ using a **clustering-based approach** that applies uniformly across all interaction regimes. This unified approach captures both global outlier structure and local phase-space clustering through a single consistent mechanism.\n2408: \n2409: **Phase-Space Clustering Construction:**\n2410: \n2411: The construction proceeds in four steps:\n2412: \n2413: 1.  **Clustering:** Partition the alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ into disjoint clusters $\\{G_1, \\ldots, G_M\\}$ using complete-linkage hierarchical clustering with a maximum cluster diameter $D_{\\text{diam}}(\\epsilon) := c_d \\cdot \\epsilon$ (where $c_d > 0$ is a fixed constant, typically $c_d = 2$). Each cluster $G_m$ satisfies:\n2414: \n2415: $$\n2416: \\text{diam}(G_m) := \\max_{i,j \\in G_m} d_{\\text{alg}}(i, j) \\le D_{\\text{diam}}(\\epsilon)\n2417: $$\n2418: \n2419: where $d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2$ is the algorithmic phase-space distance.\n2420: \n2421: 2.  **Statistical Validity Constraint:** To ensure that cluster-level statistics are meaningful, we impose a minimum cluster size requirement. Let $k_{\\min} := \\max(5, \\lceil 0.05k \\rceil)$ be the minimum statistically valid cluster size. All clusters with $|G_m| < k_{\\min}$ are marked as **invalid** and their walkers are automatically included in the high-error set (as they represent statistically unreliable outlier configurations).\n2422: \n2423: 3.  **Outlier Cluster Identification:** For each valid cluster $G_m$ (with $|G_m| \\ge k_{\\min}$), compute its center of mass in phase space: $(\\mu_{x,m}, \\mu_{v,m})$. Compute the between-cluster hypocoercive variance contribution:\n2424: \n2425: $$\n2426: \\text{Contrib}(G_m) := |G_m| \\left(\\|\\mu_{x,m} - \\mu_x\\|^2 + \\lambda_v \\|\\mu_{v,m} - \\mu_v\\|^2\\right)\n2427: $$\n2428: \n2429: where $(\\mu_x, \\mu_v)$ is the global center of mass. Sort valid clusters by $\\text{Contrib}(G_m)$ in descending order, and let $O_M \\subseteq \\{1, \\ldots, M\\}$ be the smallest set of cluster indices (among valid clusters) whose cumulative contribution meets or exceeds a fraction $(1-\\varepsilon_O)$ of the total contribution from valid clusters (where $\\varepsilon_O \\in (0, 1)$ is a fixed structural parameter, typically $\\varepsilon_O = 0.1$):\n2430: \n2431: $$\n2432: \\sum_{m \\in O_M} \\text{Contrib}(G_m) \\ge (1-\\varepsilon_O) \\sum_{\\substack{m=1 \\\\ |G_m| \\ge k_{\\min}}}^M \\text{Contrib}(G_m)\n2433: $$\n2434: \n2435: 4.  **Unified High-Error Set Construction:** The unified high-error set is the union of all walkers in outlier clusters plus all walkers in invalid clusters:\n2436: \n2437: $$\n2438: H_k(\\epsilon) := \\left(\\bigcup_{m \\in O_M} G_m\\right) \\cup \\left(\\bigcup_{\\substack{m: |G_m| < k_{\\min}}} G_m\\right)\n2439: $$\n2440: \n2441: The **Unified Low-Error Set** is the complement:\n2442: \n2443: $$\n2444: L_k(\\epsilon) := \\mathcal{A}_k \\setminus H_k(\\epsilon)\n2445: $$\n2446: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 6. The Geometry of Error: From System Error to a Guaranteed Geometric Structure"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-max-patched-std",
      "title": "Maximum Patched Standard Deviation",
      "start_line": 3689,
      "end_line": 3699,
      "header_lines": [
        3690
      ],
      "content_start": 3692,
      "content_end": 3698,
      "content": "3692: :label: def-max-patched-std\n3693: \n3694: Let $V_{\\max}$ be the uniform upper bound on a raw measurement's absolute value (either $V_{\\max}^{(R)}$ for rewards or $D_{\\text{valid}}$ for distances). The **maximum patched standard deviation**, $\\sigma'_{\\max}$, is the maximum value that the patched standard deviation function can attain over its entire possible input domain.\n3695: \n3696: $$\n3697: \\sigma'_{\\max} := \\sup_{0 \\le V \\le V_{\\max}^2} \\sigma'_{\\mathrm{patch}}(V)\n3698: $$",
      "metadata": {
        "label": "def-max-patched-std"
      },
      "section": "## 7. The Corrective Nature of Fitness: From Signal Generation to Intelligent Adaptation",
      "references": [],
      "raw_directive": "3689: The first component we must bound is the denominator of the standardization formula. The following definition establishes a uniform upper bound on the patched standard deviation (see {prf:ref}`def-patched-std-dev-function`).\n3690: \n3691: :::{prf:definition} Maximum Patched Standard Deviation\n3692: :label: def-max-patched-std\n3693: \n3694: Let $V_{\\max}$ be the uniform upper bound on a raw measurement's absolute value (either $V_{\\max}^{(R)}$ for rewards or $D_{\\text{valid}}$ for distances). The **maximum patched standard deviation**, $\\sigma'_{\\max}$, is the maximum value that the patched standard deviation function can attain over its entire possible input domain.\n3695: \n3696: $$\n3697: \\sigma'_{\\max} := \\sup_{0 \\le V \\le V_{\\max}^2} \\sigma'_{\\mathrm{patch}}(V)\n3698: $$\n3699: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 7. The Corrective Nature of Fitness: From Signal Generation to Intelligent Adaptation"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-unfit-set",
      "title": "The Unfit Set",
      "start_line": 4594,
      "end_line": 4603,
      "header_lines": [
        4595
      ],
      "content_start": 4597,
      "content_end": 4602,
      "content": "4597: :label: def-unfit-set\n4598: \n4599: For a given swarm ({prf:ref}`def-swarm-and-state-space`) `k` with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ and a calculated fitness potential vector $(V_{k,i})_{i \\in \\mathcal{A}_k}$, the **unfit set**, $U_k$, is the subset of alive walkers whose fitness potential is less than or equal to the swarm's mean fitness potential, $\\mu_{V,k} = \\frac{1}{k}\\sum_{j \\in \\mathcal{A}_k} V_{k,j}$.\n4600: \n4601: $$\n4602: U_k := \\{i \\in \\mathcal{A}_k \\mid V_{k,i} \\le \\mu_{V,k}\\}",
      "metadata": {
        "label": "def-unfit-set"
      },
      "section": "## 7. The Corrective Nature of Fitness: From Signal Generation to Intelligent Adaptation",
      "references": [
        "def-swarm-and-state-space",
        "def-alive-dead-sets"
      ],
      "raw_directive": "4594: The first pillar of the overlap proof is to show that the fitness signal generated by a high-error swarm is a collective phenomenon. A large `V_struct` implies a large internal variance, which is guaranteed to produce a non-vanishing raw measurement variance ([](#thm-geometry-guarantees-variance)). This raw signal robustly propagates through the measurement pipeline to create a guaranteed microscopic gap in the final fitness potentials, ensuring a non-trivial overall fitness range, $\\kappa_V,gap(\\varepsilon) > 0$. The following lemma proves that such a gap cannot be explained by a single unusually fit or unfit walker; it necessitates a statistically significant imbalance in the fitness distribution of the entire population.\n4595: \n4596: :::{prf:definition} The Unfit Set\n4597: :label: def-unfit-set\n4598: \n4599: For a given swarm ({prf:ref}`def-swarm-and-state-space`) `k` with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}_k$ and a calculated fitness potential vector $(V_{k,i})_{i \\in \\mathcal{A}_k}$, the **unfit set**, $U_k$, is the subset of alive walkers whose fitness potential is less than or equal to the swarm's mean fitness potential, $\\mu_{V,k} = \\frac{1}{k}\\sum_{j \\in \\mathcal{A}_k} V_{k,j}$.\n4600: \n4601: $$\n4602: U_k := \\{i \\in \\mathcal{A}_k \\mid V_{k,i} \\le \\mu_{V,k}\\}\n4603: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 7. The Corrective Nature of Fitness: From Signal Generation to Intelligent Adaptation"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-critical-target-set",
      "title": "The Critical Target Set",
      "start_line": 4798,
      "end_line": 4810,
      "header_lines": [
        4799
      ],
      "content_start": 4801,
      "content_end": 4809,
      "content": "4801: :label: def-critical-target-set\n4802: \n4803: For a state in the high-error regime, let $k$ be the index of the high-variance swarm ({prf:ref}`def-swarm-and-state-space`). The **critical target set**, $I_{\\text{target}}$, is the set of walkers that are simultaneously stably alive, unfit in swarm $k$, and high-error in swarm $k$.\n4804: \n4805: $$\n4806: I_{\\text{target}} := I_{11} \\cap U_k \\cap H_k(\\epsilon)\n4807: $$\n4808: \n4809: The guaranteed existence of a substantial, non-vanishing overlap between the unfit and high-error sets, as proven in [](#thm-unfit-high-error-overlap-fraction), ensures that this critical target set is non-empty and contains a non-vanishing, N-uniform fraction of the alive population. The subsequent proofs will now proceed by demonstrating that the corrective cloning pressure is concentrated on this specific target set (Section 8.3) and that this same set is responsible for a substantial fraction of the total system error (Section 8.4).",
      "metadata": {
        "label": "def-critical-target-set"
      },
      "section": "## 8. The N-Uniform Quantitative Keystone Lemma",
      "references": [
        "def-swarm-and-state-space",
        "cor-cloning-pressure-target-set"
      ],
      "raw_directive": "4798: The analysis in Chapter 7 proved that this high-variance swarm $k$ contains a non-vanishing fraction of \"unfit\" walkers ($U_k$) and a non-vanishing fraction of \"high-error\" walkers ($H_k$), and that these two sets have a substantial overlap. The final step of the Keystone proof is to show that the corrective cloning action is concentrated on the walkers that are simultaneously members of all three critical sets: those that are alive in both swarms (and thus can contribute to the contractive force), those that are unfit (and thus targeted for cloning), and those that are high-error (and thus the source of the problem). We formally define this intersection as our target set.\n4799: \n4800: :::{prf:definition} The Critical Target Set\n4801: :label: def-critical-target-set\n4802: \n4803: For a state in the high-error regime, let $k$ be the index of the high-variance swarm ({prf:ref}`def-swarm-and-state-space`). The **critical target set**, $I_{\\text{target}}$, is the set of walkers that are simultaneously stably alive, unfit in swarm $k$, and high-error in swarm $k$.\n4804: \n4805: $$\n4806: I_{\\text{target}} := I_{11} \\cap U_k \\cap H_k(\\epsilon)\n4807: $$\n4808: \n4809: The guaranteed existence of a substantial, non-vanishing overlap between the unfit and high-error sets, as proven in [](#thm-unfit-high-error-overlap-fraction), ensures that this critical target set is non-empty and contains a non-vanishing, N-uniform fraction of the alive population. The subsequent proofs will now proceed by demonstrating that the corrective cloning pressure is concentrated on this specific target set (Section 8.3) and that this same set is responsible for a substantial fraction of the total system error (Section 8.4).\n4810: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 8. The N-Uniform Quantitative Keystone Lemma"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-operator-formal",
      "title": "The Cloning Operator $\\Psi_{\\text{clone}}$",
      "start_line": 5846,
      "end_line": 5876,
      "header_lines": [
        5847
      ],
      "content_start": 5849,
      "content_end": 5875,
      "content": "5849: :label: def-cloning-operator-formal\n5850: \n5851: The **cloning operator ({prf:ref}`def-cloning-operator`)** $\\Psi_{\\text{clone}}$ is a Markov transition kernel on the swarm ({prf:ref}`def-swarm-and-state-space`) state space $\\Sigma_N$. For any input swarm configuration $S \\in \\Sigma_N$, it produces a probability measure $\\Psi_{\\text{clone}}(S, \\cdot)$ on $\\Sigma_N$.\n5852: \n5853: **Domain and Range:**\n5854: - **Input:** A swarm  configuration $S = ((x_1, v_1, s_1), \\ldots, (x_N, v_N, s_N)) \\in \\Sigma_N$ with at least one alive walker ({prf:ref}`def-walker`) ($|\\mathcal{A}(S)| \\geq 1$).\n5855: - **Output:** A probability measure over swarm ({prf:ref}`def-swarm-and-state-space`) configurations $S' \\in \\Sigma_N$ where all walkers have status $s'_i = 1$ (the intermediate, all-alive configuration).\n5856: \n5857: **Stochastic Structure:**\n5858: \n5859: The operator is defined by a composition of deterministic and stochastic sub-operators (see {prf:ref}`thm-cloning-operator-composition` for the rigorous compositional representation):\n5860: \n5861: $$\n5862: \\Psi_{\\text{clone}} = \\Psi_{\\text{update}} \\circ \\Psi_{\\text{decision}} \\circ \\Psi_{\\text{fitness}} \\circ \\Psi_{\\text{measure}}\n5863: $$\n5864: \n5865: where each sub-operator is defined in the subsequent sections.\n5866: \n5867: **Key Property - All-Alive Output:**\n5868: \n5869: By construction, the output configuration $S' \\sim \\Psi_{\\text{clone}}(S, \\cdot)$ satisfies:\n5870: \n5871: $$\n5872: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n5873: $$\n5874: \n5875: This guarantees that the cloning stage produces a viable swarm ready for the subsequent kinetic evolution, with dead walkers either revived (if the input had dead walkers) or persisting (if already alive).",
      "metadata": {
        "label": "def-cloning-operator-formal"
      },
      "section": "## 9.2. The Cloning Operator as a Markov Kernel",
      "references": [
        "def-cloning-operator",
        "def-swarm-and-state-space",
        "def-walker",
        "thm-cloning-operator-composition",
        "thm-complete-cloning-drift"
      ],
      "raw_directive": "5846: We begin with the highest-level definition of the operator as a mathematical object.\n5847: \n5848: :::{prf:definition} The Cloning Operator $\\Psi_{\\text{clone}}$\n5849: :label: def-cloning-operator-formal\n5850: \n5851: The **cloning operator ({prf:ref}`def-cloning-operator`)** $\\Psi_{\\text{clone}}$ is a Markov transition kernel on the swarm ({prf:ref}`def-swarm-and-state-space`) state space $\\Sigma_N$. For any input swarm configuration $S \\in \\Sigma_N$, it produces a probability measure $\\Psi_{\\text{clone}}(S, \\cdot)$ on $\\Sigma_N$.\n5852: \n5853: **Domain and Range:**\n5854: - **Input:** A swarm  configuration $S = ((x_1, v_1, s_1), \\ldots, (x_N, v_N, s_N)) \\in \\Sigma_N$ with at least one alive walker ({prf:ref}`def-walker`) ($|\\mathcal{A}(S)| \\geq 1$).\n5855: - **Output:** A probability measure over swarm ({prf:ref}`def-swarm-and-state-space`) configurations $S' \\in \\Sigma_N$ where all walkers have status $s'_i = 1$ (the intermediate, all-alive configuration).\n5856: \n5857: **Stochastic Structure:**\n5858: \n5859: The operator is defined by a composition of deterministic and stochastic sub-operators (see {prf:ref}`thm-cloning-operator-composition` for the rigorous compositional representation):\n5860: \n5861: $$\n5862: \\Psi_{\\text{clone}} = \\Psi_{\\text{update}} \\circ \\Psi_{\\text{decision}} \\circ \\Psi_{\\text{fitness}} \\circ \\Psi_{\\text{measure}}\n5863: $$\n5864: \n5865: where each sub-operator is defined in the subsequent sections.\n5866: \n5867: **Key Property - All-Alive Output:**\n5868: \n5869: By construction, the output configuration $S' \\sim \\Psi_{\\text{clone}}(S, \\cdot)$ satisfies:\n5870: \n5871: $$\n5872: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n5873: $$\n5874: \n5875: This guarantees that the cloning stage produces a viable swarm ready for the subsequent kinetic evolution, with dead walkers either revived (if the input had dead walkers) or persisting (if already alive).\n5876: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 9.2. The Cloning Operator as a Markov Kernel"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-measurement-operator",
      "title": "The Measurement Operator",
      "start_line": 5895,
      "end_line": 5927,
      "header_lines": [
        5896
      ],
      "content_start": 5898,
      "content_end": 5926,
      "content": "5898: :label: def-measurement-operator\n5899: \n5900: For input swarm ({prf:ref}`def-swarm-and-state-space`) $S$ with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5901: \n5902: **Input:** Swarm  configuration $S$\n5903: \n5904: **Stochastic Process:**\n5905: \n5906: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5907: \n5908: \n5909: $$\n5910: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5911: $$\n5912: \n5913: 2. **Raw Distance Vector** (see {prf:ref}`def-raw-value-operators`): For each alive walker ({prf:ref}`def-walker`) $i \\in \\mathcal{A}(S)$, compute:\n5914: \n5915: \n5916: $$\n5917: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5918: $$\n5919: \n5920: \n5921:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5922: \n5923: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5924: \n5925: **Key Properties:**\n5926: - The pairing $\\pi$ is sampled once per swarm ({prf:ref}`def-swarm-and-state-space`), creating correlations between measurements",
      "metadata": {
        "label": "def-measurement-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-swarm-and-state-space",
        "def-alive-dead-sets",
        "def-standardization-operator",
        "def-raw-value-operators",
        "def-walker"
      ],
      "raw_directive": "5895: The first stage (as discussed in Section 5.3) generates the stochastic diversity measurements that form the foundation of the fitness evaluation.\n5896: \n5897: :::{prf:definition} The Measurement Operator\n5898: :label: def-measurement-operator\n5899: \n5900: For input swarm ({prf:ref}`def-swarm-and-state-space`) $S$ with alive set ({prf:ref}`def-alive-dead-sets`) $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5901: \n5902: **Input:** Swarm  configuration $S$\n5903: \n5904: **Stochastic Process:**\n5905: \n5906: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5907: \n5908: \n5909: $$\n5910: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5911: $$\n5912: \n5913: 2. **Raw Distance Vector** (see {prf:ref}`def-raw-value-operators`): For each alive walker ({prf:ref}`def-walker`) $i \\in \\mathcal{A}(S)$, compute:\n5914: \n5915: \n5916: $$\n5917: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5918: $$\n5919: \n5920: \n5921:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5922: \n5923: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5924: \n5925: **Key Properties:**\n5926: - The pairing $\\pi$ is sampled once per swarm ({prf:ref}`def-swarm-and-state-space`), creating correlations between measurements\n5927: - The distribution of $\\mathbf{d}$ depends only on $S$ and the algorithmic parameters $(\\epsilon_p, \\ell_p)$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 9.3. Decomposition into Sub-Operators"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-fitness-operator",
      "title": "The Fitness Evaluation Operator",
      "start_line": 5942,
      "end_line": 6013,
      "header_lines": [
        5943
      ],
      "content_start": 5945,
      "content_end": 6012,
      "content": "5945: :label: def-fitness-operator\n5946: \n5947: **Input:**\n5948: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n5949: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5950: \n5951: **Deterministic Computation:**\n5952: \n5953: 1. **Boundary Proximity:** For each walker ({prf:ref}`def-walker`) $i$, compute:\n5954: \n5955: \n5956: $$\n5957: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5958: $$\n5959: \n5960:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5961: \n5962: 2. **Rescaling:** Apply the rescale function ({prf:ref}`def-canonical-logistic-rescale-function-example`) with floor $\\eta > 0$:\n5963: \n5964: \n5965: $$\n5966: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5967: $$\n5968: \n5969: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5970: \n5971: \n5972: $$\n5973: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5974: $$\n5975: \n5976: \n5977: \n5978: $$\n5979: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5980: $$\n5981: \n5982: \n5983:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5984: \n5985: \n5986: $$\n5987: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5988: $$\n5989: \n5990: \n5991:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5992: \n5993: 4. **Fitness Potential:** For each walker ({prf:ref}`def-walker`) $i$, compute:\n5994: \n5995:    a. Apply the Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`) $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5996:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5997:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5998: \n5999:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n6000: \n6001: \n6002: $$\n6003: V_{\\text{fit},i} = \\begin{cases}\n6004:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n6005:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n6006:       \\end{cases}\n6007: $$\n6008: \n6009: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n6010: \n6011: **Key Properties:**\n6012: - The operator is deterministic given $S$ and $\\mathbf{d}$",
      "metadata": {
        "label": "def-fitness-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-swarm-and-state-space",
        "def-walker",
        "def-canonical-logistic-rescale-function-example",
        "lem-potential-bounds"
      ],
      "raw_directive": "5942: This deterministic operator (implementing the pipeline from Chapter 5) transforms raw measurements into fitness potentials.\n5943: \n5944: :::{prf:definition} The Fitness Evaluation Operator\n5945: :label: def-fitness-operator\n5946: \n5947: **Input:**\n5948: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n5949: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5950: \n5951: **Deterministic Computation:**\n5952: \n5953: 1. **Boundary Proximity:** For each walker ({prf:ref}`def-walker`) $i$, compute:\n5954: \n5955: \n5956: $$\n5957: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5958: $$\n5959: \n5960:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5961: \n5962: 2. **Rescaling:** Apply the rescale function ({prf:ref}`def-canonical-logistic-rescale-function-example`) with floor $\\eta > 0$:\n5963: \n5964: \n5965: $$\n5966: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5967: $$\n5968: \n5969: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5970: \n5971: \n5972: $$\n5973: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5974: $$\n5975: \n5976: \n5977: \n5978: $$\n5979: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5980: $$\n5981: \n5982: \n5983:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5984: \n5985: \n5986: $$\n5987: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5988: $$\n5989: \n5990: \n5991:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5992: \n5993: 4. **Fitness Potential:** For each walker ({prf:ref}`def-walker`) $i$, compute:\n5994: \n5995:    a. Apply the Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`) $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5996:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5997:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5998: \n5999:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n6000: \n6001: \n6002: $$\n6003: V_{\\text{fit},i} = \\begin{cases}\n6004:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n6005:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n6006:       \\end{cases}\n6007: $$\n6008: \n6009: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n6010: \n6011: **Key Properties:**\n6012: - The operator is deterministic given $S$ and $\\mathbf{d}$\n6013: - Bounded: $V_{\\text{fit},i} \\in [0, V_{\\text{pot,max}}]$ for alive walkers, where $V_{\\text{pot,max}} = (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 9.3. Decomposition into Sub-Operators"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-decision-operator",
      "title": "The Cloning Decision Operator",
      "start_line": 6019,
      "end_line": 6071,
      "header_lines": [
        6020
      ],
      "content_start": 6022,
      "content_end": 6070,
      "content": "6022: :label: def-decision-operator\n6023: \n6024: **Input:**\n6025: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n6026: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n6027: \n6028: **Stochastic Process:**\n6029: \n6030: For each walker ({prf:ref}`def-walker`) $i \\in \\{1, \\ldots, N\\}$:\n6031: \n6032: 1. **Companion Selection ({prf:ref}`def-companion-selection-measure`)** (see {prf:ref}`def-cloning-companion-operator`):\n6033: \n6034:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n6035: \n6036: \n6037: $$\n6038: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n6039: $$\n6040: \n6041: \n6042:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6043: \n6044: \n6045: $$\n6046: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6047: $$\n6048: \n6049: 2. **Cloning Score:** Compute the score based on fitness difference:\n6050: \n6051: \n6052: $$\n6053: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6054: $$\n6055: \n6056: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6057: \n6058:    Walker ({prf:ref}`def-walker`) $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6059: \n6060: **Output:**\n6061: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6062: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6063: \n6064: **Total Cloning Probability:**\n6065: \n6066: The key quantity for drift analysis is the **total probability** that walker ({prf:ref}`def-walker`) $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6067: \n6068: $$\n6069: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6070: $$",
      "metadata": {
        "label": "def-decision-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-swarm-and-state-space",
        "def-walker",
        "def-companion-selection-measure",
        "def-cloning-companion-operator",
        "lem-quantitative-keystone"
      ],
      "raw_directive": "6019: This stochastic operator (formalized from {prf:ref}`def-cloning-decision`) determines which walkers will clone and which will persist.\n6020: \n6021: :::{prf:definition} The Cloning Decision Operator\n6022: :label: def-decision-operator\n6023: \n6024: **Input:**\n6025: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n6026: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n6027: \n6028: **Stochastic Process:**\n6029: \n6030: For each walker ({prf:ref}`def-walker`) $i \\in \\{1, \\ldots, N\\}$:\n6031: \n6032: 1. **Companion Selection ({prf:ref}`def-companion-selection-measure`)** (see {prf:ref}`def-cloning-companion-operator`):\n6033: \n6034:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n6035: \n6036: \n6037: $$\n6038: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n6039: $$\n6040: \n6041: \n6042:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6043: \n6044: \n6045: $$\n6046: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6047: $$\n6048: \n6049: 2. **Cloning Score:** Compute the score based on fitness difference:\n6050: \n6051: \n6052: $$\n6053: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6054: $$\n6055: \n6056: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6057: \n6058:    Walker ({prf:ref}`def-walker`) $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6059: \n6060: **Output:**\n6061: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6062: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6063: \n6064: **Total Cloning Probability:**\n6065: \n6066: The key quantity for drift analysis is the **total probability** that walker ({prf:ref}`def-walker`) $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6067: \n6068: $$\n6069: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6070: $$\n6071: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 9.3. Decomposition into Sub-Operators"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-update-operator",
      "title": "The State Update Operator",
      "start_line": 6106,
      "end_line": 6198,
      "header_lines": [
        6107
      ],
      "content_start": 6109,
      "content_end": 6197,
      "content": "6109: :label: def-update-operator\n6110: \n6111: The state update operator implements the inelastic collision model (see {prf:ref}`def-inelastic-collision-update`) to update walker ({prf:ref}`def-walker`) states after cloning decisions.\n6112: \n6113: **Input:**\n6114: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n6115: - Companion vector $\\mathbf{c}$\n6116: - Action vector $\\mathbf{a}$\n6117: \n6118: **Deterministic Grouping:**\n6119: \n6120: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6121: \n6122: $$\n6123: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6124: $$\n6125: \n6126: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6127: \n6128: **Stochastic State Update:**\n6129: \n6130: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6131: \n6132: 1. **Position Updates:**\n6133: \n6134:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6135: \n6136: \n6137: $$\n6138: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6139: $$\n6140: \n6141: \n6142:    Companion position is unchanged: $x'_j = x_j$\n6143: \n6144: 2. **Velocity Updates (The Inelastic Collision):**\n6145: \n6146:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6147: \n6148:    **a. Center-of-Mass Velocity:**\n6149: \n6150: \n6151: $$\n6152: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6153: $$\n6154: \n6155: \n6156:    **b. Update Relative Velocities:**\n6157: \n6158:    For each walker ({prf:ref}`def-walker`) $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6159: \n6160: \n6161: $$\n6162: u_k = v_k - V_{\\text{COM},j}\n6163: $$\n6164: \n6165: \n6166:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6167: \n6168: \n6169: $$\n6170: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6171: $$\n6172: \n6173: \n6174:    **c. Return to Lab Frame:**\n6175: \n6176: \n6177: $$\n6178: v'_k = V_{\\text{COM},j} + u'_k\n6179: $$\n6180: \n6181: 3. **Persisting Walkers:**\n6182: \n6183:    For walkers with $a_i = \\text{persist}$:\n6184: \n6185: \n6186: $$\n6187: x'_i = x_i, \\quad v'_i = v_i\n6188: $$\n6189: \n6190: 4. **Status Update:**\n6191: \n6192:    All walkers in the output are alive:\n6193: \n6194: \n6195: $$\n6196: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6197: $$",
      "metadata": {
        "label": "def-update-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-inelastic-collision-update",
        "def-walker",
        "def-swarm-and-state-space"
      ],
      "raw_directive": "6106: The final stage executes the cloning actions, producing the output swarm configuration.\n6107: \n6108: :::{prf:definition} The State Update Operator\n6109: :label: def-update-operator\n6110: \n6111: The state update operator implements the inelastic collision model (see {prf:ref}`def-inelastic-collision-update`) to update walker ({prf:ref}`def-walker`) states after cloning decisions.\n6112: \n6113: **Input:**\n6114: - Swarm ({prf:ref}`def-swarm-and-state-space`) configuration $S$\n6115: - Companion vector $\\mathbf{c}$\n6116: - Action vector $\\mathbf{a}$\n6117: \n6118: **Deterministic Grouping:**\n6119: \n6120: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6121: \n6122: $$\n6123: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6124: $$\n6125: \n6126: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6127: \n6128: **Stochastic State Update:**\n6129: \n6130: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6131: \n6132: 1. **Position Updates:**\n6133: \n6134:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6135: \n6136: \n6137: $$\n6138: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6139: $$\n6140: \n6141: \n6142:    Companion position is unchanged: $x'_j = x_j$\n6143: \n6144: 2. **Velocity Updates (The Inelastic Collision):**\n6145: \n6146:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6147: \n6148:    **a. Center-of-Mass Velocity:**\n6149: \n6150: \n6151: $$\n6152: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6153: $$\n6154: \n6155: \n6156:    **b. Update Relative Velocities:**\n6157: \n6158:    For each walker ({prf:ref}`def-walker`) $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6159: \n6160: \n6161: $$\n6162: u_k = v_k - V_{\\text{COM},j}\n6163: $$\n6164: \n6165: \n6166:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6167: \n6168: \n6169: $$\n6170: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6171: $$\n6172: \n6173: \n6174:    **c. Return to Lab Frame:**\n6175: \n6176: \n6177: $$\n6178: v'_k = V_{\\text{COM},j} + u'_k\n6179: $$\n6180: \n6181: 3. **Persisting Walkers:**\n6182: \n6183:    For walkers with $a_i = \\text{persist}$:\n6184: \n6185: \n6186: $$\n6187: x'_i = x_i, \\quad v'_i = v_i\n6188: $$\n6189: \n6190: 4. **Status Update:**\n6191: \n6192:    All walkers in the output are alive:\n6193: \n6194: \n6195: $$\n6196: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6197: $$\n6198: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 9.3. Decomposition into Sub-Operators"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-key-operator-outputs",
      "title": "Key Operator Outputs",
      "start_line": 6250,
      "end_line": 6290,
      "header_lines": [
        6251
      ],
      "content_start": 6253,
      "content_end": 6289,
      "content": "6253: :label: def-key-operator-outputs\n6254: \n6255: For input swarm ({prf:ref}`def-swarm-and-state-space`) $S$ and output swarm $S' \\sim \\Psi_{\\text{clone}}(S, \\cdot)$, the following quantities are central to the drift analysis:\n6256: \n6257: 1. **Total Cloning Probability:** For each walker ({prf:ref}`def-walker`) $i$:\n6258: \n6259: \n6260: $$\n6261: p_i = P(\\text{walker ({prf:ref}`def-walker`) } i \\text{ clones} \\mid S)\n6262: $$\n6263: \n6264: 2. **Position Displacement:** For each walker  $i$:\n6265: \n6266: \n6267: $$\n6268: \\Delta x_i := x'_i - x_i\n6269: $$\n6270: \n6271:    For cloners, $\\Delta x_i = x_{c_i} - x_i + \\sigma_x \\zeta_i^x$ where $\\zeta_i^x \\sim \\mathcal{N}(0, I_d)$.\n6272: \n6273: 3. **Velocity Perturbation:** For each walker ({prf:ref}`def-walker`) $i$ that participates in a cloning event:\n6274: \n6275: \n6276: $$\n6277: \\Delta v_i := v'_i - v_i\n6278: $$\n6279: \n6280:    This arises from the inelastic collision model. The expected squared velocity change depends on:\n6281:    - The center-of-mass shift: $\\mathbb{E}[\\|V_{\\text{COM},j} - v_i\\|^2]$\n6282:    - The restitution coefficient: $\\alpha_{\\text{restitution}}$\n6283:    - The random rotation: $R_i$\n6284: \n6285: 4. **Centered Displacements:** For coupled swarms $(S_1, S_2)$:\n6286: \n6287: \n6288: $$\n6289: \\Delta\\delta_{x,i} := \\delta_{x,1,i} - \\delta_{x,2,i}",
      "metadata": {
        "label": "def-key-operator-outputs"
      },
      "section": "## 9.5. Key Quantities for Drift Analysis",
      "references": [
        "def-swarm-and-state-space",
        "def-walker"
      ],
      "raw_directive": "6250: We conclude by highlighting the critical quantities (see {prf:ref}`def-key-operator-outputs`) that will be used in the subsequent drift analysis.\n6251: \n6252: :::{prf:definition} Key Operator Outputs\n6253: :label: def-key-operator-outputs\n6254: \n6255: For input swarm ({prf:ref}`def-swarm-and-state-space`) $S$ and output swarm $S' \\sim \\Psi_{\\text{clone}}(S, \\cdot)$, the following quantities are central to the drift analysis:\n6256: \n6257: 1. **Total Cloning Probability:** For each walker ({prf:ref}`def-walker`) $i$:\n6258: \n6259: \n6260: $$\n6261: p_i = P(\\text{walker ({prf:ref}`def-walker`) } i \\text{ clones} \\mid S)\n6262: $$\n6263: \n6264: 2. **Position Displacement:** For each walker  $i$:\n6265: \n6266: \n6267: $$\n6268: \\Delta x_i := x'_i - x_i\n6269: $$\n6270: \n6271:    For cloners, $\\Delta x_i = x_{c_i} - x_i + \\sigma_x \\zeta_i^x$ where $\\zeta_i^x \\sim \\mathcal{N}(0, I_d)$.\n6272: \n6273: 3. **Velocity Perturbation:** For each walker ({prf:ref}`def-walker`) $i$ that participates in a cloning event:\n6274: \n6275: \n6276: $$\n6277: \\Delta v_i := v'_i - v_i\n6278: $$\n6279: \n6280:    This arises from the inelastic collision model. The expected squared velocity change depends on:\n6281:    - The center-of-mass shift: $\\mathbb{E}[\\|V_{\\text{COM},j} - v_i\\|^2]$\n6282:    - The restitution coefficient: $\\alpha_{\\text{restitution}}$\n6283:    - The random rotation: $R_i$\n6284: \n6285: 4. **Centered Displacements:** For coupled swarms $(S_1, S_2)$:\n6286: \n6287: \n6288: $$\n6289: \\Delta\\delta_{x,i} := \\delta_{x,1,i} - \\delta_{x,2,i}\n6290: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 13,
        "chapter_file": "chapter_13.json",
        "section_id": "## 9.5. Key Quantities for Drift Analysis"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-coupled-cloning-expectation",
      "title": "Coupled Cloning Expectation",
      "start_line": 6370,
      "end_line": 6387,
      "header_lines": [
        6371
      ],
      "content_start": 6373,
      "content_end": 6386,
      "content": "6373: :label: def-coupled-cloning-expectation\n6374: \n6375: Consider two swarms $(S_1, S_2)$ in the coupled state space (see {prf:ref}`def-coupled-state-space`). Let $(S'_1, S'_2)$ be the output swarms after applying $\\Psi_{\\text{clone}}$ to each independently, using **synchronous coupling** of all randomness:\n6376: \n6377: - Same PRNG seeds for companion selection ({prf:ref}`def-companion-selection-measure`)\n6378: - Same pairing algorithm random choices\n6379: - Same threshold samples $T_i$ for each walker ({prf:ref}`def-walker`) index $i$\n6380: - Same Gaussian jitters $\\zeta_i^x$ for position updates (when both walkers clone)\n6381: - Same rotation operators $R_i$ for velocity collisions (when both walkers participate in collisions)\n6382: \n6383: For any function $f: \\Sigma_N \\times \\Sigma_N \\to \\mathbb{R}$, the **coupled cloning expectation** is:\n6384: \n6385: $$\n6386: \\mathbb{E}_{\\text{clone}}[f(S'_1, S'_2) \\mid S_1, S_2] := \\mathbb{E}[f(S'_1, S'_2) \\mid S_1, S_2, \\text{coupling}]",
      "metadata": {
        "label": "def-coupled-cloning-expectation"
      },
      "section": "## 10.2. The Coupled Expectation Framework",
      "references": [
        "def-coupled-state-space",
        "def-companion-selection-measure",
        "def-walker"
      ],
      "raw_directive": "6370: To analyze the drift of the Lyapunov function components, we work with two copies of the swarm evolving under synchronous coupling.\n6371: \n6372: :::{prf:definition} Coupled Cloning Expectation\n6373: :label: def-coupled-cloning-expectation\n6374: \n6375: Consider two swarms $(S_1, S_2)$ in the coupled state space (see {prf:ref}`def-coupled-state-space`). Let $(S'_1, S'_2)$ be the output swarms after applying $\\Psi_{\\text{clone}}$ to each independently, using **synchronous coupling** of all randomness:\n6376: \n6377: - Same PRNG seeds for companion selection ({prf:ref}`def-companion-selection-measure`)\n6378: - Same pairing algorithm random choices\n6379: - Same threshold samples $T_i$ for each walker ({prf:ref}`def-walker`) index $i$\n6380: - Same Gaussian jitters $\\zeta_i^x$ for position updates (when both walkers clone)\n6381: - Same rotation operators $R_i$ for velocity collisions (when both walkers participate in collisions)\n6382: \n6383: For any function $f: \\Sigma_N \\times \\Sigma_N \\to \\mathbb{R}$, the **coupled cloning expectation** is:\n6384: \n6385: $$\n6386: \\mathbb{E}_{\\text{clone}}[f(S'_1, S'_2) \\mid S_1, S_2] := \\mathbb{E}[f(S'_1, S'_2) \\mid S_1, S_2, \\text{coupling}]\n6387: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 16,
        "chapter_file": "chapter_16.json",
        "section_id": "## 10.2. The Coupled Expectation Framework"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-boundary-potential-recall",
      "title": "Boundary Potential Component (Recall)",
      "start_line": 7096,
      "end_line": 7114,
      "header_lines": [
        7097
      ],
      "content_start": 7099,
      "content_end": 7113,
      "content": "7099: :label: def-boundary-potential-recall\n7100: \n7101: From {prf:ref}`def-full-synergistic-lyapunov-function`, the boundary potential is:\n7102: \n7103: $$\n7104: W_b(S_1, S_2) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\varphi_{\\text{barrier}}(x_{1,i}) + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\varphi_{\\text{barrier}}(x_{2,i})\n7105: $$\n7106: \n7107: where $\\varphi_{\\text{barrier}}: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}_{\\geq 0}$ is the smooth barrier function satisfying:\n7108: \n7109: 1. **Interior safety:** $\\varphi_{\\text{barrier}}(x) = 0$ for $x$ in the safe interior region (distance $> \\delta_{\\text{safe}}$ from boundary)\n7110: \n7111: 2. **Boundary growth:** $\\varphi_{\\text{barrier}}(x) \\to \\infty$ as $x \\to \\partial \\mathcal{X}_{\\text{valid}}$\n7112: \n7113: 3. **Smoothness:** $\\varphi_{\\text{barrier}} \\in C^2(\\mathcal{X}_{\\text{valid}})$ with bounded derivatives in the interior",
      "metadata": {
        "label": "def-boundary-potential-recall"
      },
      "section": "## 11.2. The Boundary Barrier and Fitness Gradient",
      "references": [
        "def-full-synergistic-lyapunov-function",
        "prop-barrier-existence"
      ],
      "raw_directive": "7096: ### 11.2.1. The Barrier Function\n7097: \n7098: :::{prf:definition} Boundary Potential Component (Recall)\n7099: :label: def-boundary-potential-recall\n7100: \n7101: From {prf:ref}`def-full-synergistic-lyapunov-function`, the boundary potential is:\n7102: \n7103: $$\n7104: W_b(S_1, S_2) := \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_1)} \\varphi_{\\text{barrier}}(x_{1,i}) + \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_2)} \\varphi_{\\text{barrier}}(x_{2,i})\n7105: $$\n7106: \n7107: where $\\varphi_{\\text{barrier}}: \\mathcal{X}_{\\text{valid}} \\to \\mathbb{R}_{\\geq 0}$ is the smooth barrier function satisfying:\n7108: \n7109: 1. **Interior safety:** $\\varphi_{\\text{barrier}}(x) = 0$ for $x$ in the safe interior region (distance $> \\delta_{\\text{safe}}$ from boundary)\n7110: \n7111: 2. **Boundary growth:** $\\varphi_{\\text{barrier}}(x) \\to \\infty$ as $x \\to \\partial \\mathcal{X}_{\\text{valid}}$\n7112: \n7113: 3. **Smoothness:** $\\varphi_{\\text{barrier}} \\in C^2(\\mathcal{X}_{\\text{valid}})$ with bounded derivatives in the interior\n7114: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 23,
        "chapter_file": "chapter_23.json",
        "section_id": "## 11.2. The Boundary Barrier and Fitness Gradient"
      }
    },
    {
      "directive_type": "definition",
      "label": "def-boundary-exposed-set",
      "title": "The Boundary-Exposed Set",
      "start_line": 7304,
      "end_line": 7321,
      "header_lines": [
        7305
      ],
      "content_start": 7307,
      "content_end": 7320,
      "content": "7307: :label: def-boundary-exposed-set\n7308: \n7309: For a swarm ({prf:ref}`def-swarm-and-state-space`) $S$ and a threshold $\\phi_{\\text{thresh}} > 0$, the **boundary-exposed set** is:\n7310: \n7311: $$\n7312: \\mathcal{E}_{\\text{boundary}}(S) := \\{i \\in \\mathcal{A}(S) : \\varphi_{\\text{barrier}}(x_i) > \\phi_{\\text{thresh}}\\}\n7313: $$\n7314: \n7315: These are alive walkers whose barrier penalty exceeds the threshold, indicating dangerous proximity to the boundary.\n7316: \n7317: The **boundary-exposed mass** is:\n7318: \n7319: $$\n7320: M_{\\text{boundary}}(S) := \\frac{1}{N} \\sum_{i \\in \\mathcal{E}_{\\text{boundary}}(S)} \\varphi_{\\text{barrier}}(x_i)",
      "metadata": {
        "label": "def-boundary-exposed-set"
      },
      "section": "## 11.2. The Boundary Barrier and Fitness Gradient",
      "references": [
        "def-swarm-and-state-space"
      ],
      "raw_directive": "7304: We now formalize the set of walkers (see {prf:ref}`def-boundary-exposed-set`) that are in danger due to boundary proximity.\n7305: \n7306: :::{prf:definition} The Boundary-Exposed Set\n7307: :label: def-boundary-exposed-set\n7308: \n7309: For a swarm ({prf:ref}`def-swarm-and-state-space`) $S$ and a threshold $\\phi_{\\text{thresh}} > 0$, the **boundary-exposed set** is:\n7310: \n7311: $$\n7312: \\mathcal{E}_{\\text{boundary}}(S) := \\{i \\in \\mathcal{A}(S) : \\varphi_{\\text{barrier}}(x_i) > \\phi_{\\text{thresh}}\\}\n7313: $$\n7314: \n7315: These are alive walkers whose barrier penalty exceeds the threshold, indicating dangerous proximity to the boundary.\n7316: \n7317: The **boundary-exposed mass** is:\n7318: \n7319: $$\n7320: M_{\\text{boundary}}(S) := \\frac{1}{N} \\sum_{i \\in \\mathcal{E}_{\\text{boundary}}(S)} \\varphi_{\\text{barrier}}(x_i)\n7321: $$",
      "_registry_context": {
        "stage": "directives",
        "document_id": "03_cloning",
        "chapter_index": 23,
        "chapter_file": "chapter_23.json",
        "section_id": "## 11.2. The Boundary Barrier and Fitness Gradient"
      }
    }
  ]
}