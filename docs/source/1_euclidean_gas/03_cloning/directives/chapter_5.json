{
  "chapter_index": 5,
  "section_id": "## 5. The Measurement and Interaction Pipeline",
  "directive_count": 25,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-algorithmic-distance-metric",
      "title": "Algorithmic Distance for Companion Selection",
      "start_line": 1349,
      "end_line": 1359,
      "header_lines": [
        1350
      ],
      "content_start": 1352,
      "content_end": 1358,
      "content": "1352: :label: def-algorithmic-distance-metric\n1353: \n1354: For any two walkers $i$ and $j$ with states $(x_i, v_i)$ and $(x_j, v_j)$, the **algorithmic distance** between them is defined as:\n1355: \n1356: $$\n1357: d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2\n1358: $$",
      "metadata": {
        "label": "def-algorithmic-distance-metric"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1349: Before defining the measurement operators, we must first establish the fundamental metric that quantifies proximity between walkers. This metric is central to all intra-swarm measurements in the algorithm, including companion selection for diversity measurement and companion selection for cloning.\n1350: \n1351: :::{prf:definition} Algorithmic Distance for Companion Selection\n1352: :label: def-algorithmic-distance-metric\n1353: \n1354: For any two walkers $i$ and $j$ with states $(x_i, v_i)$ and $(x_j, v_j)$, the **algorithmic distance** between them is defined as:\n1355: \n1356: $$\n1357: d_{\\text{alg}}(i, j)^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2\n1358: $$\n1359: "
    },
    {
      "directive_type": "definition",
      "label": "def-spatial-pairing-operator-diversity",
      "title": "Spatially-Aware Pairing Operator (Idealized Model)",
      "start_line": 1391,
      "end_line": 1422,
      "header_lines": [
        1392
      ],
      "content_start": 1394,
      "content_end": 1421,
      "content": "1394: :label: def-spatial-pairing-operator-diversity\n1395: \n1396: Let $\\mathcal{S}_t$ be the current swarm state with alive set $\\mathcal{A}_t$ of size $k = |\\mathcal{A}_t|$. The idealized **Spatially-Aware Pairing Operator**, denoted $\\mathbb{P}_{\\text{pair}}$, maps the alive set $\\mathcal{A}_t$ to a probability distribution over the set of all possible perfect matchings, $\\mathcal{M}_k$.\n1397: \n1398: **Inputs:**\n1399: *   The alive set of walkers, $\\mathcal{A}_t = \\{w_1, w_2, \\dots, w_k\\}$.\n1400: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1401: \n1402: **Operation:**\n1403: 1.  For every pair of distinct walkers $(w_i, w_j)$, an edge weight is assigned based on their phase-space proximity using the algorithmic distance metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1404: \n1405: \n1406: $$\n1407: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1408: $$\n1409: \n1410: 2.  The \"quality\" of a specific perfect matching `M` is the product of the weights of the edges it contains:\n1411: \n1412: \n1413: $$\n1414: W(M) := \\prod_{(i,j) \\in M} w_{ij}\n1415: $$\n1416: \n1417: 3.  The probability of selecting a specific matching `M` is given by its quality normalized by the sum of qualities over all possible matchings (the partition function):\n1418: \n1419: \n1420: $$\n1421: P(M) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}",
      "metadata": {
        "label": "def-spatial-pairing-operator-diversity"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-algorithmic-distance-metric"
      ],
      "raw_directive": "1391: For the purposes of theoretical analysis, it is useful to model the pairing as a single, collective draw from a probability distribution over all possible perfect matchings of the alive set. This idealized model captures the physical intent of the operator\u2014to strongly favor pairings between walkers that are close in the algorithmic space.\n1392: \n1393: :::{prf:definition} Spatially-Aware Pairing Operator (Idealized Model)\n1394: :label: def-spatial-pairing-operator-diversity\n1395: \n1396: Let $\\mathcal{S}_t$ be the current swarm state with alive set $\\mathcal{A}_t$ of size $k = |\\mathcal{A}_t|$. The idealized **Spatially-Aware Pairing Operator**, denoted $\\mathbb{P}_{\\text{pair}}$, maps the alive set $\\mathcal{A}_t$ to a probability distribution over the set of all possible perfect matchings, $\\mathcal{M}_k$.\n1397: \n1398: **Inputs:**\n1399: *   The alive set of walkers, $\\mathcal{A}_t = \\{w_1, w_2, \\dots, w_k\\}$.\n1400: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1401: \n1402: **Operation:**\n1403: 1.  For every pair of distinct walkers $(w_i, w_j)$, an edge weight is assigned based on their phase-space proximity using the algorithmic distance metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1404: \n1405: \n1406: $$\n1407: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1408: $$\n1409: \n1410: 2.  The \"quality\" of a specific perfect matching `M` is the product of the weights of the edges it contains:\n1411: \n1412: \n1413: $$\n1414: W(M) := \\prod_{(i,j) \\in M} w_{ij}\n1415: $$\n1416: \n1417: 3.  The probability of selecting a specific matching `M` is given by its quality normalized by the sum of qualities over all possible matchings (the partition function):\n1418: \n1419: \n1420: $$\n1421: P(M) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n1422: $$"
    },
    {
      "directive_type": "definition",
      "label": "def-greedy-pairing-algorithm",
      "title": "Sequential Stochastic Greedy Pairing Operator",
      "start_line": 1430,
      "end_line": 1457,
      "header_lines": [
        1431
      ],
      "content_start": 1433,
      "content_end": 1456,
      "content": "1433: :label: def-greedy-pairing-algorithm\n1434: \n1435: Let `A_t` be the set of `k` alive walkers at time `t`. The pairing operator generates a **Companion Map**, `c: A_t \u2192 A_t`, which is a perfect matching if `k` is even, or a maximal matching if `k` is odd.\n1436: \n1437: **Inputs:**\n1438: *   The set of alive walkers, `A_t = {w_1, w_2, ..., w_k}`.\n1439: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1440: \n1441: **Operation:**\n1442: 1.  Initialize a set of unpaired walkers `U \u2190 A_t` and an empty companion map `c`.\n1443: 2.  While `|U| > 1`:\n1444:     a. Select and remove an arbitrary walker `i` from `U`.\n1445:     b. For each remaining walker $j \\in U$, calculate the selection weight based on phase-space proximity using the algorithmic distance metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1446: \n1447: \n1448: $$\n1449: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1450: $$\n1451: \n1452:     c. Form a probability distribution over $j \\in U$ where $P(\\text{choose } j) = w_{ij} / (\\sum_{l \\in U} w_{il})$.\n1453:     d. Sample a companion `c_i` for `i` from this distribution.\n1454:     e. Remove `c_i` from `U`.\n1455:     f. Set the pairing in the companion map: `c(i) \u2190 c_i` and `c(c_i) \u2190 i`.\n1456: 3.  Return the completed companion map `c`.",
      "metadata": {
        "label": "def-greedy-pairing-algorithm"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-algorithmic-distance-metric"
      ],
      "raw_directive": "1430: This algorithm builds the matching iteratively. It selects an unpaired walker, computes a probability distribution over all other currently unpaired walkers based on proximity, samples a companion, and removes the new pair from the pool. This reduces the computational complexity from factorial to quadratic, making it practical for large swarms.\n1431: \n1432: :::{prf:definition} Sequential Stochastic Greedy Pairing Operator\n1433: :label: def-greedy-pairing-algorithm\n1434: \n1435: Let `A_t` be the set of `k` alive walkers at time `t`. The pairing operator generates a **Companion Map**, `c: A_t \u2192 A_t`, which is a perfect matching if `k` is even, or a maximal matching if `k` is odd.\n1436: \n1437: **Inputs:**\n1438: *   The set of alive walkers, `A_t = {w_1, w_2, ..., w_k}`.\n1439: *   $\\varepsilon_d > 0$ (The Interaction Range for Diversity).\n1440: \n1441: **Operation:**\n1442: 1.  Initialize a set of unpaired walkers `U \u2190 A_t` and an empty companion map `c`.\n1443: 2.  While `|U| > 1`:\n1444:     a. Select and remove an arbitrary walker `i` from `U`.\n1445:     b. For each remaining walker $j \\in U$, calculate the selection weight based on phase-space proximity using the algorithmic distance metric (see {prf:ref}`def-algorithmic-distance-metric`):\n1446: \n1447: \n1448: $$\n1449: w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_d^2}\\right)\n1450: $$\n1451: \n1452:     c. Form a probability distribution over $j \\in U$ where $P(\\text{choose } j) = w_{ij} / (\\sum_{l \\in U} w_{il})$.\n1453:     d. Sample a companion `c_i` for `i` from this distribution.\n1454:     e. Remove `c_i` from `U`.\n1455:     f. Set the pairing in the companion map: `c(i) \u2190 c_i` and `c(c_i) \u2190 i`.\n1456: 3.  Return the completed companion map `c`.\n1457: "
    },
    {
      "directive_type": "algorithm",
      "label": "alg-greedy-pairing",
      "title": "Sequential Stochastic Greedy Pairing Algorithm",
      "start_line": 1461,
      "end_line": 1500,
      "header_lines": [
        1462
      ],
      "content_start": 1464,
      "content_end": 1499,
      "content": "1464: :label: alg-greedy-pairing\n1465: \n1466: ALGORITHM: GreedyPairing(alive_walkers, epsilon_d)\n1467: -------------------------------------------------\n1468: INPUT:\n1469:   alive_walkers: A list of k walker objects.\n1470:   epsilon_d: The interaction range for diversity.\n1471: OUTPUT:\n1472:   companion_map: A dictionary representing the pairing.\n1473: \n1474: 1.  unpaired_set \u2190 a set containing all walkers from alive_walkers\n1475: 2.  companion_map \u2190 an empty dictionary\n1476: \n1477: 3.  WHILE len(unpaired_set) > 1:\n1478: 4.      i \u2190 unpaired_set.pop()  // Select and remove a walker\n1479: \n1480: 5.      // Prepare to compute the probability distribution\n1481: 6.      companions \u2190 list(unpaired_set)\n1482: 7.      weights \u2190 empty list of floats\n1483: 8.\n1484: 9.      FOR j IN companions:\n1485: 10.         dist_sq = algorithmic_distance(i.state, j.state)^2\n1486: 11.         weight = exp(-dist_sq / (2 * epsilon_d^2))\n1487: 12.         weights.append(weight)\n1488: \n1489: 13.     // Normalize weights to get probabilities\n1490: 14.     total_weight = sum(weights)\n1491: 15.     probabilities = [w / total_weight for w in weights]\n1492: \n1493: 16.     // Sample the companion based on the probabilities\n1494: 17.     c_i \u2190 sample_from(companions, probabilities)\n1495: \n1496: 18.     // Finalize the pair\n1497: 19.     unpaired_set.remove(c_i)\n1498: 20.     companion_map[i] \u2190 c_i\n1499: 21.     companion_map[c_i] \u2190 i",
      "metadata": {
        "label": "alg-greedy-pairing"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1461: The following pseudocode provides a concrete implementation of this operator.\n1462: \n1463: :::{prf:algorithm} Sequential Stochastic Greedy Pairing Algorithm\n1464: :label: alg-greedy-pairing\n1465: \n1466: ALGORITHM: GreedyPairing(alive_walkers, epsilon_d)\n1467: -------------------------------------------------\n1468: INPUT:\n1469:   alive_walkers: A list of k walker objects.\n1470:   epsilon_d: The interaction range for diversity.\n1471: OUTPUT:\n1472:   companion_map: A dictionary representing the pairing.\n1473: \n1474: 1.  unpaired_set \u2190 a set containing all walkers from alive_walkers\n1475: 2.  companion_map \u2190 an empty dictionary\n1476: \n1477: 3.  WHILE len(unpaired_set) > 1:\n1478: 4.      i \u2190 unpaired_set.pop()  // Select and remove a walker\n1479: \n1480: 5.      // Prepare to compute the probability distribution\n1481: 6.      companions \u2190 list(unpaired_set)\n1482: 7.      weights \u2190 empty list of floats\n1483: 8.\n1484: 9.      FOR j IN companions:\n1485: 10.         dist_sq = algorithmic_distance(i.state, j.state)^2\n1486: 11.         weight = exp(-dist_sq / (2 * epsilon_d^2))\n1487: 12.         weights.append(weight)\n1488: \n1489: 13.     // Normalize weights to get probabilities\n1490: 14.     total_weight = sum(weights)\n1491: 15.     probabilities = [w / total_weight for w in weights]\n1492: \n1493: 16.     // Sample the companion based on the probabilities\n1494: 17.     c_i \u2190 sample_from(companions, probabilities)\n1495: \n1496: 18.     // Finalize the pair\n1497: 19.     unpaired_set.remove(c_i)\n1498: 20.     companion_map[i] \u2190 c_i\n1499: 21.     companion_map[c_i] \u2190 i\n1500: "
    },
    {
      "directive_type": "definition",
      "label": "def-geometric-partition",
      "title": "Geometric Partitioning of High-Variance Swarms",
      "start_line": 1516,
      "end_line": 1524,
      "header_lines": [
        1517
      ],
      "content_start": 1519,
      "content_end": 1523,
      "content": "1519: :label: def-geometric-partition\n1520: \n1521: For a given interaction range $\\varepsilon$, we define a swarm's phase-space structure based on local and global properties. As will be proven in **{prf:ref}`cor-vvarx-to-high-error-fraction`**, any swarm with sufficiently high variance (`Var(x) > R^{2}_var`) can be partitioned into two non-empty, N-uniform sets:\n1522: 1.  A **high-error set** `H_k`, whose members are **kinematically isolated** in phase space. This implies the existence of a distance $D_H(\\varepsilon) > 0$ such that for any $i \\in H_k$, all other walkers `j` are at an algorithmic distance $d_alg(i, j) > D_H(\\varepsilon)$.\n1523: 2.  A **low-error set** `L_k`, whose members are part of dense clusters in phase space. For any $j \\in L_k$, there is a non-empty subset of other walkers `C_j \u2282 L_k` of size $|C_j| \\geq f_c k$ (for some N-uniform `f_c > 0`) located within an algorithmic radius $R_L(\\varepsilon) < D_H(\\varepsilon)$.",
      "metadata": {
        "label": "def-geometric-partition"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "cor-vvarx-to-high-error-fraction"
      ],
      "raw_directive": "1516: First, we must formalize the geometric partitioning of the swarm that is guaranteed to exist in a high-variance state, a result that will be proven in full detail in Chapter 6.\n1517: \n1518: :::{prf:definition} Geometric Partitioning of High-Variance Swarms\n1519: :label: def-geometric-partition\n1520: \n1521: For a given interaction range $\\varepsilon$, we define a swarm's phase-space structure based on local and global properties. As will be proven in **{prf:ref}`cor-vvarx-to-high-error-fraction`**, any swarm with sufficiently high variance (`Var(x) > R^{2}_var`) can be partitioned into two non-empty, N-uniform sets:\n1522: 1.  A **high-error set** `H_k`, whose members are **kinematically isolated** in phase space. This implies the existence of a distance $D_H(\\varepsilon) > 0$ such that for any $i \\in H_k$, all other walkers `j` are at an algorithmic distance $d_alg(i, j) > D_H(\\varepsilon)$.\n1523: 2.  A **low-error set** `L_k`, whose members are part of dense clusters in phase space. For any $j \\in L_k$, there is a non-empty subset of other walkers `C_j \u2282 L_k` of size $|C_j| \\geq f_c k$ (for some N-uniform `f_c > 0`) located within an algorithmic radius $R_L(\\varepsilon) < D_H(\\varepsilon)$.\n1524: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-greedy-preserves-signal",
      "title": "Greedy Pairing Guarantees Signal Separation",
      "start_line": 1528,
      "end_line": 1550,
      "header_lines": [
        1529
      ],
      "content_start": 1531,
      "content_end": 1549,
      "content": "1531: :label: lem-greedy-preserves-signal\n1532: \n1533: Let a swarm be in a state with high internal variance, such that its alive walkers `A_k` are partitioned into a high-error set `H_k` and a low-error set `L_k` as per {prf:ref}`def-geometric-partition`.\n1534: \n1535: The Sequential Stochastic Greedy Pairing Operator ({prf:ref}`def-greedy-pairing-algorithm`) guarantees a statistical separation in the expected raw phase-space distance measurements for these two populations. Specifically, there exist N-uniform, $\\varepsilon$-dependent bounds such that:\n1536: \n1537: 1.  For any high-error walker $i \\in H_k$, its expected raw distance is large:\n1538: \n1539: \n1540: $$\n1541: \\mathbb{E}[d_i \\mid S_t, i \\in H_k] \\ge D_H(\\epsilon)\n1542: $$\n1543: \n1544: 2.  For any low-error walker $j \\in L_k$, its expected raw distance is small:\n1545: \n1546: \n1547: $$\n1548: \\mathbb{E}[d_j \\mid S_t, j \\in L_k] \\le R_L(\\epsilon) + D_{\\mathrm{valid}} \\cdot c_k \\exp\\left(-\\frac{D_H(\\epsilon)^2 - R_L(\\epsilon)^2}{2\\epsilon^2}\\right)\n1549: $$",
      "metadata": {
        "label": "lem-greedy-preserves-signal"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-geometric-partition",
        "def-greedy-pairing-algorithm"
      ],
      "raw_directive": "1528: With these formal definitions, we can now prove that the practical pairing algorithm reliably detects this structure.\n1529: \n1530: :::{prf:lemma} Greedy Pairing Guarantees Signal Separation\n1531: :label: lem-greedy-preserves-signal\n1532: \n1533: Let a swarm be in a state with high internal variance, such that its alive walkers `A_k` are partitioned into a high-error set `H_k` and a low-error set `L_k` as per {prf:ref}`def-geometric-partition`.\n1534: \n1535: The Sequential Stochastic Greedy Pairing Operator ({prf:ref}`def-greedy-pairing-algorithm`) guarantees a statistical separation in the expected raw phase-space distance measurements for these two populations. Specifically, there exist N-uniform, $\\varepsilon$-dependent bounds such that:\n1536: \n1537: 1.  For any high-error walker $i \\in H_k$, its expected raw distance is large:\n1538: \n1539: \n1540: $$\n1541: \\mathbb{E}[d_i \\mid S_t, i \\in H_k] \\ge D_H(\\epsilon)\n1542: $$\n1543: \n1544: 2.  For any low-error walker $j \\in L_k$, its expected raw distance is small:\n1545: \n1546: \n1547: $$\n1548: \\mathbb{E}[d_j \\mid S_t, j \\in L_k] \\le R_L(\\epsilon) + D_{\\mathrm{valid}} \\cdot c_k \\exp\\left(-\\frac{D_H(\\epsilon)^2 - R_L(\\epsilon)^2}{2\\epsilon^2}\\right)\n1549: $$\n1550: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-greedy-preserves-signal",
      "title": null,
      "start_line": 1562,
      "end_line": 1735,
      "header_lines": [
        1563
      ],
      "content_start": 1564,
      "content_end": 1734,
      "content": "1564: :::{prf:proof}\n1565: :label: proof-lem-greedy-preserves-signal\n1566: **Proof.**\n1567: \n1568: The proof establishes rigorous probabilistic bounds on the expected distance measurements by carefully analyzing the sequential pairing process. We show that the geometric partition imposed by high variance creates an unavoidable statistical signature in the measurements, regardless of the pairing order.\n1569: \n1570: **Framework: Conditional Expectations and the Sequential Process.**\n1571: \n1572: The Sequential Stochastic Greedy Pairing algorithm builds the matching iteratively. At any stage of the algorithm, let $P_t$ denote the set of already-paired walkers and $U_t = \\mathcal{A}_k \\setminus P_t$ denote the set of unpaired walkers remaining. For a walker $i$ selected at stage $t$, the probability of pairing with walker $u \\in U_t \\setminus \\{i\\}$ is:\n1573: \n1574: $$\n1575: \\mathbb{P}(c_i = u \\mid U_t, i) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i,u)^2}{2\\epsilon_d^2}\\right)}{\\sum_{l \\in U_t \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i,l)^2}{2\\epsilon_d^2}\\right)} =: \\frac{w_{iu}}{Z_i(U_t)}\n1576: $$\n1577: \n1578: where $Z_i(U_t) = \\sum_{l \\in U_t \\setminus \\{i\\}} w_{il}$ is the partition function normalizing the softmax distribution.\n1579: \n1580: The conditional expected distance for walker $i$ given the remaining set $U_t$ is:\n1581: \n1582: $$\n1583: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] = \\sum_{u \\in U_t \\setminus \\{i\\}} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i)\n1584: $$\n1585: \n1586: The unconditional expected distance $\\mathbb{E}[d_i \\mid \\mathcal{S}_t, i]$ is obtained by averaging over all possible pairing histories that lead to $i$ being paired.\n1587: \n1588: **Key Insight:** The geometric properties of $H_k$ and $L_k$ (specifically, the separation constants $D_H(\\epsilon)$ and $R_L(\\epsilon)$) provide **uniform bounds** on these conditional expectations that are **independent of the pairing history** $P_t$. This history-independence is the crucial property that allows us to bound the full expectation.\n1589: \n1590: **Part 1: Rigorous Lower Bound for High-Error Walkers.**\n1591: \n1592: **Claim:** For any high-error walker $i \\in H_k$, $\\mathbb{E}[d_i \\mid \\mathcal{S}_t, i \\in H_k] \\geq D_H(\\epsilon) \\cdot \\mathbb{P}(\\text{pair with } L_k) + R_L(\\epsilon) \\cdot \\mathbb{P}(\\text{pair within } H_k)$.\n1593: \n1594: Since the low-error set $L_k$ contains a non-vanishing fraction of walkers ($|L_k| / k \\geq f_L > 0$), and pairing is done uniformly over unpaired walkers, the expected distance is bounded below.\n1595: \n1596: **Step 1.1: Geometric property from corrected {prf:ref}`lem-geometric-separation-of-partition`.**\n1597: \n1598: By {prf:ref}`lem-geometric-separation-of-partition` (corrected), for a high-error walker $i \\in H_k$:\n1599: - For any low-error walker $u \\in L_k$: $d_{\\text{alg}}(i, u) \\geq D_H(\\epsilon)$\n1600: - For any high-error walker in the same cluster: $d_{\\text{alg}}(i, u) \\leq R_L(\\epsilon)$\n1601: \n1602: This is a **deterministic geometric property** of the state $\\mathcal{S}_t$.\n1603: \n1604: **Step 1.2: Population-weighted bound on conditional expectations.**\n1605: \n1606: For any stage $t$ in the pairing process where $i \\in U_t$, partition the unpaired walkers:\n1607: - $U_L := U_t \\cap L_k$ (low-error walkers, far from $i$)\n1608: - $U_H := U_t \\cap H_k \\setminus \\{i\\}$ (other high-error walkers, may be close)\n1609: \n1610: The conditional expectation decomposes as:\n1611: \n1612: $$\n1613: \\begin{aligned}\n1614: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] &= \\sum_{u \\in U_L} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i) \\\\\n1615: &\\quad + \\sum_{u \\in U_H} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i)\n1616: \\end{aligned}\n1617: $$\n1618: \n1619: Using the geometric bounds:\n1620: \n1621: $$\n1622: \\begin{aligned}\n1623: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] &\\geq \\sum_{u \\in U_L} D_H(\\epsilon) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i) \\\\\n1624: &= D_H(\\epsilon) \\cdot \\mathbb{P}(c_i \\in U_L \\mid U_t, i)\n1625: \\end{aligned}\n1626: $$\n1627: \n1628: Since $|U_L| \\geq |L_k| - k/2 \\geq k \\cdot f_L - k/2 = k(f_L - 1/2) > 0$ for $f_L > 1/2$, the probability of pairing with a low-error walker is bounded below. This gives us a worst-case lower bound by considering the minimum over all possible unpaired sets $U_t$.\n1629: \n1630: **Step 1.3: History-independence and unconditional bound.**\n1631: \n1632: Since the bound $\\mathbb{E}[d_i \\mid U_t, i \\in U_t] \\geq D_H(\\epsilon)$ holds for **every possible set** $U_t$ containing $i$, it holds regardless of the specific pairing history. Taking the expectation over all possible pairing orders:\n1633: \n1634: $$\n1635: \\mathbb{E}[d_i \\mid \\mathcal{S}_t, i \\in H_k] = \\mathbb{E}_{U_t}\\left[\\mathbb{E}[d_i \\mid U_t, i \\in U_t]\\right] \\geq \\mathbb{E}_{U_t}[D_H(\\epsilon)] = D_H(\\epsilon)\n1636: $$\n1637: \n1638: This establishes the first claim. The bound is **N-uniform** because $D_H(\\epsilon)$ is an N-uniform geometric constant (proven in Chapter 6).\n1639: \n1640: **Part 2: Rigorous Upper Bound for Low-Error Walkers.**\n1641: \n1642: **Claim:** For any low-error walker $j \\in L_k$, $\\mathbb{E}[d_j \\mid \\mathcal{S}_t, j \\in L_k] \\leq R_L(\\epsilon) + (D_{\\text{valid}} - R_L(\\epsilon)) \\cdot c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right)$ where $c_k$ is N-uniform.\n1643: \n1644: **Step 2.1: Geometric property of low-error walkers.**\n1645: \n1646: By {prf:ref}`def-geometric-partition`, a walker $j \\in L_k$ has a **local cluster** $C_j \\subset L_k$ with the following properties:\n1647: - $|C_j| \\geq f_c k$ for an N-uniform constant $f_c > 0$\n1648: - For all $l \\in C_j$: $d_{\\text{alg}}(j, l) \\leq R_L(\\epsilon)$\n1649: - For all $m \\notin C_j$: $d_{\\text{alg}}(j, m) \\geq D_H(\\epsilon)$\n1650: \n1651: (Note: The last property follows from the fact that walkers outside the cluster must be either in $H_k$ or in other clusters, both of which are separated by at least $D_H(\\epsilon)$ by the geometric partition structure.)\n1652: \n1653: **Step 2.2: Worst-case cluster depletion bound.**\n1654: \n1655: At any stage $t$ of the pairing process, at most $\\lfloor k/2 \\rfloor$ pairs have been formed, removing at most $k$ walkers from consideration. In the worst case, all removed walkers could have been from $C_j$. Therefore:\n1656: \n1657: $$\n1658: |U_t \\cap C_j| \\geq |C_j| - k \\geq f_c k - k = k(f_c - 1)\n1659: $$\n1660: \n1661: For the axiom $f_c > 1/2$ to be meaningful, we typically have $f_c \\geq 2/3$, giving $|U_t \\cap C_j| \\geq k/3 > 0$ (strictly positive cluster survivors).\n1662: \n1663: **Step 2.3: Partition of available companions.**\n1664: \n1665: For $j$ being paired at stage $t$ with remaining set $U_t$, partition:\n1666: - $U_{\\text{in}} := U_t \\cap C_j$ (nearby cluster members)\n1667: - $U_{\\text{out}} := U_t \\setminus C_j$ (distant walkers)\n1668: \n1669: We have $|U_{\\text{in}}| \\geq k(f_c - 1) > 0$ and $|U_{\\text{out}}| \\leq k$.\n1670: \n1671: **Step 2.4: Bounding the normalization constant.**\n1672: \n1673: The partition function for $j$ satisfies:\n1674: \n1675: $$\n1676: \\begin{aligned}\n1677: Z_j(U_t) &= \\sum_{l \\in U_t \\setminus \\{j\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,l)^2}{2\\epsilon_d^2}\\right) \\\\\n1678: &= \\sum_{l \\in U_{\\text{in}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,l)^2}{2\\epsilon_d^2}\\right) + \\sum_{m \\in U_{\\text{out}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,m)^2}{2\\epsilon_d^2}\\right) \\\\\n1679: &\\geq \\sum_{l \\in U_{\\text{in}}} \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1680: &= |U_{\\text{in}}| \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1681: &\\geq k(f_c - 1) \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right)\n1682: \\end{aligned}\n1683: $$\n1684: \n1685: using $d_{\\text{alg}}(j,l) \\leq R_L(\\epsilon)$ for $l \\in U_{\\text{in}}$.\n1686: \n1687: **Step 2.5: Bounding the tail probability.**\n1688: \n1689: The probability of $j$ being paired with a distant walker is:\n1690: \n1691: $$\n1692: \\begin{aligned}\n1693: \\mathbb{P}(c_j \\in U_{\\text{out}} \\mid U_t, j) &= \\frac{\\sum_{m \\in U_{\\text{out}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,m)^2}{2\\epsilon_d^2}\\right)}{Z_j(U_t)} \\\\\n1694: &\\leq \\frac{|U_{\\text{out}}| \\exp\\left(-\\frac{D_H(\\epsilon)^2}{2\\epsilon_d^2}\\right)}{|U_{\\text{in}}| \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right)} \\\\\n1695: &\\leq \\frac{k}{k(f_c - 1)} \\exp\\left(-\\frac{D_H(\\epsilon)^2 - R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1696: &= \\frac{1}{f_c - 1} \\exp\\left(-\\frac{[D_H(\\epsilon) + R_L(\\epsilon)][D_H(\\epsilon) - R_L(\\epsilon)]}{2\\epsilon_d^2}\\right)\n1697: \\end{aligned}\n1698: $$\n1699: \n1700: Define $c_k := 1/(f_c - 1)$, which is N-uniform. Using $D_H(\\epsilon) + R_L(\\epsilon) \\geq D_H(\\epsilon) - R_L(\\epsilon)$ (since both are positive):\n1701: \n1702: $$\n1703: \\mathbb{P}(c_j \\in U_{\\text{out}} \\mid U_t, j) \\leq c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right) =: p_{\\text{tail}}\n1704: $$\n1705: \n1706: **Step 2.6: Bounding the conditional expected distance.**\n1707: \n1708: $$\n1709: \\begin{aligned}\n1710: \\mathbb{E}[d_j \\mid U_t, j] &= \\sum_{l \\in U_{\\text{in}}} d_{\\text{alg}}(j,l) \\mathbb{P}(c_j = l \\mid U_t, j) + \\sum_{m \\in U_{\\text{out}}} d_{\\text{alg}}(j,m) \\mathbb{P}(c_j = m \\mid U_t, j) \\\\\n1711: &\\leq R_L(\\epsilon) \\sum_{l \\in U_{\\text{in}}} \\mathbb{P}(c_j = l \\mid U_t, j) + D_{\\text{valid}} \\sum_{m \\in U_{\\text{out}}} \\mathbb{P}(c_j = m \\mid U_t, j) \\\\\n1712: &= R_L(\\epsilon) \\cdot [1 - p_{\\text{tail}}] + D_{\\text{valid}} \\cdot p_{\\text{tail}} \\\\\n1713: &= R_L(\\epsilon) + [D_{\\text{valid}} - R_L(\\epsilon)] p_{\\text{tail}}\n1714: \\end{aligned}\n1715: $$\n1716: \n1717: **Step 2.7: History-independence and unconditional bound.**\n1718: \n1719: The bound on $\\mathbb{E}[d_j \\mid U_t, j]$ holds for every possible set $U_t$ containing $j$, with the same constants. Therefore:\n1720: \n1721: $$\n1722: \\mathbb{E}[d_j \\mid \\mathcal{S}_t, j \\in L_k] \\leq R_L(\\epsilon) + [D_{\\text{valid}} - R_L(\\epsilon)] \\cdot c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right)\n1723: $$\n1724: \n1725: **Conclusion:**\n1726: \n1727: Both bounds are **N-uniform** because:\n1728: - $D_H(\\epsilon), R_L(\\epsilon)$ are N-uniform geometric constants (from Chapter 6)\n1729: - $f_c$ is an N-uniform population fraction (from Chapter 6)\n1730: - $c_k = 1/(f_c - 1)$ is therefore N-uniform\n1731: - $D_{\\text{valid}}$ is a fixed environmental parameter\n1732: - $\\epsilon_d$ is a fixed algorithmic parameter\n1733: \n1734: This completes the proof that the greedy pairing algorithm reliably detects the geometric partition structure.",
      "metadata": {
        "label": "proof-lem-greedy-preserves-signal"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "lem-geometric-separation-of-partition",
        "def-geometric-partition"
      ],
      "raw_directive": "1562: 3.  After completing Chapter 6, **return to this section** to verify the details of the proof, which will then be fully self-contained based on the established geometric results.\n1563: :::\n1564: :::{prf:proof}\n1565: :label: proof-lem-greedy-preserves-signal\n1566: **Proof.**\n1567: \n1568: The proof establishes rigorous probabilistic bounds on the expected distance measurements by carefully analyzing the sequential pairing process. We show that the geometric partition imposed by high variance creates an unavoidable statistical signature in the measurements, regardless of the pairing order.\n1569: \n1570: **Framework: Conditional Expectations and the Sequential Process.**\n1571: \n1572: The Sequential Stochastic Greedy Pairing algorithm builds the matching iteratively. At any stage of the algorithm, let $P_t$ denote the set of already-paired walkers and $U_t = \\mathcal{A}_k \\setminus P_t$ denote the set of unpaired walkers remaining. For a walker $i$ selected at stage $t$, the probability of pairing with walker $u \\in U_t \\setminus \\{i\\}$ is:\n1573: \n1574: $$\n1575: \\mathbb{P}(c_i = u \\mid U_t, i) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i,u)^2}{2\\epsilon_d^2}\\right)}{\\sum_{l \\in U_t \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i,l)^2}{2\\epsilon_d^2}\\right)} =: \\frac{w_{iu}}{Z_i(U_t)}\n1576: $$\n1577: \n1578: where $Z_i(U_t) = \\sum_{l \\in U_t \\setminus \\{i\\}} w_{il}$ is the partition function normalizing the softmax distribution.\n1579: \n1580: The conditional expected distance for walker $i$ given the remaining set $U_t$ is:\n1581: \n1582: $$\n1583: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] = \\sum_{u \\in U_t \\setminus \\{i\\}} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i)\n1584: $$\n1585: \n1586: The unconditional expected distance $\\mathbb{E}[d_i \\mid \\mathcal{S}_t, i]$ is obtained by averaging over all possible pairing histories that lead to $i$ being paired.\n1587: \n1588: **Key Insight:** The geometric properties of $H_k$ and $L_k$ (specifically, the separation constants $D_H(\\epsilon)$ and $R_L(\\epsilon)$) provide **uniform bounds** on these conditional expectations that are **independent of the pairing history** $P_t$. This history-independence is the crucial property that allows us to bound the full expectation.\n1589: \n1590: **Part 1: Rigorous Lower Bound for High-Error Walkers.**\n1591: \n1592: **Claim:** For any high-error walker $i \\in H_k$, $\\mathbb{E}[d_i \\mid \\mathcal{S}_t, i \\in H_k] \\geq D_H(\\epsilon) \\cdot \\mathbb{P}(\\text{pair with } L_k) + R_L(\\epsilon) \\cdot \\mathbb{P}(\\text{pair within } H_k)$.\n1593: \n1594: Since the low-error set $L_k$ contains a non-vanishing fraction of walkers ($|L_k| / k \\geq f_L > 0$), and pairing is done uniformly over unpaired walkers, the expected distance is bounded below.\n1595: \n1596: **Step 1.1: Geometric property from corrected {prf:ref}`lem-geometric-separation-of-partition`.**\n1597: \n1598: By {prf:ref}`lem-geometric-separation-of-partition` (corrected), for a high-error walker $i \\in H_k$:\n1599: - For any low-error walker $u \\in L_k$: $d_{\\text{alg}}(i, u) \\geq D_H(\\epsilon)$\n1600: - For any high-error walker in the same cluster: $d_{\\text{alg}}(i, u) \\leq R_L(\\epsilon)$\n1601: \n1602: This is a **deterministic geometric property** of the state $\\mathcal{S}_t$.\n1603: \n1604: **Step 1.2: Population-weighted bound on conditional expectations.**\n1605: \n1606: For any stage $t$ in the pairing process where $i \\in U_t$, partition the unpaired walkers:\n1607: - $U_L := U_t \\cap L_k$ (low-error walkers, far from $i$)\n1608: - $U_H := U_t \\cap H_k \\setminus \\{i\\}$ (other high-error walkers, may be close)\n1609: \n1610: The conditional expectation decomposes as:\n1611: \n1612: $$\n1613: \\begin{aligned}\n1614: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] &= \\sum_{u \\in U_L} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i) \\\\\n1615: &\\quad + \\sum_{u \\in U_H} d_{\\text{alg}}(i, u) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i)\n1616: \\end{aligned}\n1617: $$\n1618: \n1619: Using the geometric bounds:\n1620: \n1621: $$\n1622: \\begin{aligned}\n1623: \\mathbb{E}[d_i \\mid U_t, i \\in U_t] &\\geq \\sum_{u \\in U_L} D_H(\\epsilon) \\cdot \\mathbb{P}(c_i = u \\mid U_t, i) \\\\\n1624: &= D_H(\\epsilon) \\cdot \\mathbb{P}(c_i \\in U_L \\mid U_t, i)\n1625: \\end{aligned}\n1626: $$\n1627: \n1628: Since $|U_L| \\geq |L_k| - k/2 \\geq k \\cdot f_L - k/2 = k(f_L - 1/2) > 0$ for $f_L > 1/2$, the probability of pairing with a low-error walker is bounded below. This gives us a worst-case lower bound by considering the minimum over all possible unpaired sets $U_t$.\n1629: \n1630: **Step 1.3: History-independence and unconditional bound.**\n1631: \n1632: Since the bound $\\mathbb{E}[d_i \\mid U_t, i \\in U_t] \\geq D_H(\\epsilon)$ holds for **every possible set** $U_t$ containing $i$, it holds regardless of the specific pairing history. Taking the expectation over all possible pairing orders:\n1633: \n1634: $$\n1635: \\mathbb{E}[d_i \\mid \\mathcal{S}_t, i \\in H_k] = \\mathbb{E}_{U_t}\\left[\\mathbb{E}[d_i \\mid U_t, i \\in U_t]\\right] \\geq \\mathbb{E}_{U_t}[D_H(\\epsilon)] = D_H(\\epsilon)\n1636: $$\n1637: \n1638: This establishes the first claim. The bound is **N-uniform** because $D_H(\\epsilon)$ is an N-uniform geometric constant (proven in Chapter 6).\n1639: \n1640: **Part 2: Rigorous Upper Bound for Low-Error Walkers.**\n1641: \n1642: **Claim:** For any low-error walker $j \\in L_k$, $\\mathbb{E}[d_j \\mid \\mathcal{S}_t, j \\in L_k] \\leq R_L(\\epsilon) + (D_{\\text{valid}} - R_L(\\epsilon)) \\cdot c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right)$ where $c_k$ is N-uniform.\n1643: \n1644: **Step 2.1: Geometric property of low-error walkers.**\n1645: \n1646: By {prf:ref}`def-geometric-partition`, a walker $j \\in L_k$ has a **local cluster** $C_j \\subset L_k$ with the following properties:\n1647: - $|C_j| \\geq f_c k$ for an N-uniform constant $f_c > 0$\n1648: - For all $l \\in C_j$: $d_{\\text{alg}}(j, l) \\leq R_L(\\epsilon)$\n1649: - For all $m \\notin C_j$: $d_{\\text{alg}}(j, m) \\geq D_H(\\epsilon)$\n1650: \n1651: (Note: The last property follows from the fact that walkers outside the cluster must be either in $H_k$ or in other clusters, both of which are separated by at least $D_H(\\epsilon)$ by the geometric partition structure.)\n1652: \n1653: **Step 2.2: Worst-case cluster depletion bound.**\n1654: \n1655: At any stage $t$ of the pairing process, at most $\\lfloor k/2 \\rfloor$ pairs have been formed, removing at most $k$ walkers from consideration. In the worst case, all removed walkers could have been from $C_j$. Therefore:\n1656: \n1657: $$\n1658: |U_t \\cap C_j| \\geq |C_j| - k \\geq f_c k - k = k(f_c - 1)\n1659: $$\n1660: \n1661: For the axiom $f_c > 1/2$ to be meaningful, we typically have $f_c \\geq 2/3$, giving $|U_t \\cap C_j| \\geq k/3 > 0$ (strictly positive cluster survivors).\n1662: \n1663: **Step 2.3: Partition of available companions.**\n1664: \n1665: For $j$ being paired at stage $t$ with remaining set $U_t$, partition:\n1666: - $U_{\\text{in}} := U_t \\cap C_j$ (nearby cluster members)\n1667: - $U_{\\text{out}} := U_t \\setminus C_j$ (distant walkers)\n1668: \n1669: We have $|U_{\\text{in}}| \\geq k(f_c - 1) > 0$ and $|U_{\\text{out}}| \\leq k$.\n1670: \n1671: **Step 2.4: Bounding the normalization constant.**\n1672: \n1673: The partition function for $j$ satisfies:\n1674: \n1675: $$\n1676: \\begin{aligned}\n1677: Z_j(U_t) &= \\sum_{l \\in U_t \\setminus \\{j\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,l)^2}{2\\epsilon_d^2}\\right) \\\\\n1678: &= \\sum_{l \\in U_{\\text{in}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,l)^2}{2\\epsilon_d^2}\\right) + \\sum_{m \\in U_{\\text{out}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,m)^2}{2\\epsilon_d^2}\\right) \\\\\n1679: &\\geq \\sum_{l \\in U_{\\text{in}}} \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1680: &= |U_{\\text{in}}| \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1681: &\\geq k(f_c - 1) \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right)\n1682: \\end{aligned}\n1683: $$\n1684: \n1685: using $d_{\\text{alg}}(j,l) \\leq R_L(\\epsilon)$ for $l \\in U_{\\text{in}}$.\n1686: \n1687: **Step 2.5: Bounding the tail probability.**\n1688: \n1689: The probability of $j$ being paired with a distant walker is:\n1690: \n1691: $$\n1692: \\begin{aligned}\n1693: \\mathbb{P}(c_j \\in U_{\\text{out}} \\mid U_t, j) &= \\frac{\\sum_{m \\in U_{\\text{out}}} \\exp\\left(-\\frac{d_{\\text{alg}}(j,m)^2}{2\\epsilon_d^2}\\right)}{Z_j(U_t)} \\\\\n1694: &\\leq \\frac{|U_{\\text{out}}| \\exp\\left(-\\frac{D_H(\\epsilon)^2}{2\\epsilon_d^2}\\right)}{|U_{\\text{in}}| \\exp\\left(-\\frac{R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right)} \\\\\n1695: &\\leq \\frac{k}{k(f_c - 1)} \\exp\\left(-\\frac{D_H(\\epsilon)^2 - R_L(\\epsilon)^2}{2\\epsilon_d^2}\\right) \\\\\n1696: &= \\frac{1}{f_c - 1} \\exp\\left(-\\frac{[D_H(\\epsilon) + R_L(\\epsilon)][D_H(\\epsilon) - R_L(\\epsilon)]}{2\\epsilon_d^2}\\right)\n1697: \\end{aligned}\n1698: $$\n1699: \n1700: Define $c_k := 1/(f_c - 1)$, which is N-uniform. Using $D_H(\\epsilon) + R_L(\\epsilon) \\geq D_H(\\epsilon) - R_L(\\epsilon)$ (since both are positive):\n1701: \n1702: $$\n1703: \\mathbb{P}(c_j \\in U_{\\text{out}} \\mid U_t, j) \\leq c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right) =: p_{\\text{tail}}\n1704: $$\n1705: \n1706: **Step 2.6: Bounding the conditional expected distance.**\n1707: \n1708: $$\n1709: \\begin{aligned}\n1710: \\mathbb{E}[d_j \\mid U_t, j] &= \\sum_{l \\in U_{\\text{in}}} d_{\\text{alg}}(j,l) \\mathbb{P}(c_j = l \\mid U_t, j) + \\sum_{m \\in U_{\\text{out}}} d_{\\text{alg}}(j,m) \\mathbb{P}(c_j = m \\mid U_t, j) \\\\\n1711: &\\leq R_L(\\epsilon) \\sum_{l \\in U_{\\text{in}}} \\mathbb{P}(c_j = l \\mid U_t, j) + D_{\\text{valid}} \\sum_{m \\in U_{\\text{out}}} \\mathbb{P}(c_j = m \\mid U_t, j) \\\\\n1712: &= R_L(\\epsilon) \\cdot [1 - p_{\\text{tail}}] + D_{\\text{valid}} \\cdot p_{\\text{tail}} \\\\\n1713: &= R_L(\\epsilon) + [D_{\\text{valid}} - R_L(\\epsilon)] p_{\\text{tail}}\n1714: \\end{aligned}\n1715: $$\n1716: \n1717: **Step 2.7: History-independence and unconditional bound.**\n1718: \n1719: The bound on $\\mathbb{E}[d_j \\mid U_t, j]$ holds for every possible set $U_t$ containing $j$, with the same constants. Therefore:\n1720: \n1721: $$\n1722: \\mathbb{E}[d_j \\mid \\mathcal{S}_t, j \\in L_k] \\leq R_L(\\epsilon) + [D_{\\text{valid}} - R_L(\\epsilon)] \\cdot c_k \\exp\\left(-\\frac{[D_H(\\epsilon) - R_L(\\epsilon)]^2}{2\\epsilon_d^2}\\right)\n1723: $$\n1724: \n1725: **Conclusion:**\n1726: \n1727: Both bounds are **N-uniform** because:\n1728: - $D_H(\\epsilon), R_L(\\epsilon)$ are N-uniform geometric constants (from Chapter 6)\n1729: - $f_c$ is an N-uniform population fraction (from Chapter 6)\n1730: - $c_k = 1/(f_c - 1)$ is therefore N-uniform\n1731: - $D_{\\text{valid}}$ is a fixed environmental parameter\n1732: - $\\epsilon_d$ is a fixed algorithmic parameter\n1733: \n1734: This completes the proof that the greedy pairing algorithm reliably detects the geometric partition structure.\n1735: "
    },
    {
      "directive_type": "definition",
      "label": "def-raw-value-operators",
      "title": "Raw Value Operators",
      "start_line": 1741,
      "end_line": 1761,
      "header_lines": [
        1742
      ],
      "content_start": 1744,
      "content_end": 1760,
      "content": "1744: :label: def-raw-value-operators\n1745: \n1746: 1.  **The Reward Measurement Operator ($V_R$):** The raw reward for each alive walker `i` is its direct, individual measurement of the reward function, which explicitly includes both positional and velocity components:\n1747: \n1748: \n1749: $$\n1750: r_i := R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2\n1751: $$\n1752: \n1753:     where $R_{\\text{pos}}(x_i)$ is the positional reward and $c_{v\\_reg} > 0$ is the velocity regularization coefficient from {prf:ref}`axiom-velocity-regularization`.\n1754: \n1755: 2.  **The Paired Distance Measurement Operator ($V_D$):** Given the Companion Map `c(i)` generated by the pairing operator, the raw distance for each alive walker `i` is deterministically defined as the algorithmic distance to its assigned companion:\n1756: \n1757: \n1758: $$\n1759: d_i := d_{\\text{alg}}(i, c(i))\n1760: $$",
      "metadata": {
        "label": "def-raw-value-operators"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "axiom-velocity-regularization"
      ],
      "raw_directive": "1741: Once the Companion Map `c(i)` is fixed for the timestep by the pairing operator, the measurement of raw values for each walker becomes a deterministic process.\n1742: \n1743: :::{prf:definition} Raw Value Operators\n1744: :label: def-raw-value-operators\n1745: \n1746: 1.  **The Reward Measurement Operator ($V_R$):** The raw reward for each alive walker `i` is its direct, individual measurement of the reward function, which explicitly includes both positional and velocity components:\n1747: \n1748: \n1749: $$\n1750: r_i := R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2\n1751: $$\n1752: \n1753:     where $R_{\\text{pos}}(x_i)$ is the positional reward and $c_{v\\_reg} > 0$ is the velocity regularization coefficient from {prf:ref}`axiom-velocity-regularization`.\n1754: \n1755: 2.  **The Paired Distance Measurement Operator ($V_D$):** Given the Companion Map `c(i)` generated by the pairing operator, the raw distance for each alive walker `i` is deterministically defined as the algorithmic distance to its assigned companion:\n1756: \n1757: \n1758: $$\n1759: d_i := d_{\\text{alg}}(i, c(i))\n1760: $$\n1761: "
    },
    {
      "directive_type": "definition",
      "label": "def-swarm-aggregation-operator",
      "title": "Swarm Aggregation Operator",
      "start_line": 1779,
      "end_line": 1783,
      "header_lines": [
        1780
      ],
      "content_start": 1782,
      "content_end": 1782,
      "content": "1782: :label: def-swarm-aggregation-operator",
      "metadata": {
        "label": "def-swarm-aggregation-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-single-swarm-space"
      ],
      "raw_directive": "1779: This stage distills the raw reward and distance vectors from the `k` alive walkers into the summary statistics (mean and standard deviation) required for standardization.\n1780: \n1781: :::{prf:definition} Swarm Aggregation Operator\n1782: :label: def-swarm-aggregation-operator\n1783: "
    },
    {
      "directive_type": "definition",
      "label": "def-patched-std-dev-function",
      "title": "Patched Standard Deviation Function",
      "start_line": 1792,
      "end_line": 1807,
      "header_lines": [
        1793
      ],
      "content_start": 1795,
      "content_end": 1806,
      "content": "1795: :label: def-patched-std-dev-function\n1796: \n1797: The **Patched Standard Deviation Function**, $\\sigma'_{\\text{patch}}: \\mathbb{R}_{\\ge 0} \\to \\mathbb{R}_{>0}$, is a $C^1$ smooth replacement for the standard square-root function, designed to be globally Lipschitz and bounded away from zero. It is defined piecewise in terms of the raw variance, $V := \\operatorname{Var}[\\mu_{\\mathbf{v}}]$:\n1798: \n1799: $$\n1800: \\sigma'_{\\text{patch}}(V) :=\n1801: \\begin{cases}\n1802: \\sqrt{\\kappa_{\\text{var,min}} + \\varepsilon_{\\mathrm{std}}^2}, & V \\le \\kappa_{\\text{var,min}} \\\\\n1803: P(V), & \\kappa_{\\text{var,min}} < V < 2\\kappa_{\\text{var,min}} \\\\\n1804: \\sqrt{V + \\varepsilon_{\\mathrm{std}}^2}, & V \\ge 2\\kappa_{\\text{var,min}}\n1805: \\end{cases}\n1806: $$",
      "metadata": {
        "label": "def-patched-std-dev-function"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1792: A critical component of this stage is the use of a robust, smooth function (see {prf:ref}`def-patched-std-dev-function`) to compute the standard deviation, which is essential for the stability of the entire pipeline.\n1793: \n1794: :::{prf:definition} Patched Standard Deviation Function\n1795: :label: def-patched-std-dev-function\n1796: \n1797: The **Patched Standard Deviation Function**, $\\sigma'_{\\text{patch}}: \\mathbb{R}_{\\ge 0} \\to \\mathbb{R}_{>0}$, is a $C^1$ smooth replacement for the standard square-root function, designed to be globally Lipschitz and bounded away from zero. It is defined piecewise in terms of the raw variance, $V := \\operatorname{Var}[\\mu_{\\mathbf{v}}]$:\n1798: \n1799: $$\n1800: \\sigma'_{\\text{patch}}(V) :=\n1801: \\begin{cases}\n1802: \\sqrt{\\kappa_{\\text{var,min}} + \\varepsilon_{\\mathrm{std}}^2}, & V \\le \\kappa_{\\text{var,min}} \\\\\n1803: P(V), & \\kappa_{\\text{var,min}} < V < 2\\kappa_{\\text{var,min}} \\\\\n1804: \\sqrt{V + \\varepsilon_{\\mathrm{std}}^2}, & V \\ge 2\\kappa_{\\text{var,min}}\n1805: \\end{cases}\n1806: $$\n1807: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-patching-properties",
      "title": "Properties of the Patching Function",
      "start_line": 1809,
      "end_line": 1812,
      "header_lines": [
        1810
      ],
      "content_start": 1811,
      "content_end": 1811,
      "content": "1811: :::{prf:lemma} Properties of the Patching Function",
      "metadata": {
        "label": "lem-patching-properties"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1809: :::\n1810: \n1811: :::{prf:lemma} Properties of the Patching Function\n1812: :label: lem-patching-properties"
    },
    {
      "directive_type": "definition",
      "label": "def-standardization-operator",
      "title": "N-Dimensional Standardization Operator",
      "start_line": 1818,
      "end_line": 1828,
      "header_lines": [
        1819
      ],
      "content_start": 1821,
      "content_end": 1827,
      "content": "1821: :label: def-standardization-operator\n1822: \n1823: The **N-Dimensional Standardization Operator**, $z$, maps a swarm state `S`, a raw value vector `v`, and an aggregation operator `M` to an N-dimensional vector of Z-scores.\n1824: \n1825: **Operation:**\n1826: 1.  Aggregate the alive components `v_A` using operator M (see {prf:ref}`def-swarm-aggregation-operator`) to get a measure $\\mu_v = M(S, v_A)$.\n1827: 2.  Compute the mean $\\mu_A = \\mathbb{E}[\\mu_v]$ and the **patched** standard deviation $\\sigma'_A = \\sigma'_{\\text{patch}}(\\text{Var}[\\mu_v])$ using the patching function (see {prf:ref}`lem-patching-properties`).",
      "metadata": {
        "label": "def-standardization-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-swarm-aggregation-operator",
        "lem-patching-properties"
      ],
      "raw_directive": "1818: This operator uses the robust statistics from the previous stage to convert the raw value vectors into standardized Z-scores.\n1819: \n1820: :::{prf:definition} N-Dimensional Standardization Operator\n1821: :label: def-standardization-operator\n1822: \n1823: The **N-Dimensional Standardization Operator**, $z$, maps a swarm state `S`, a raw value vector `v`, and an aggregation operator `M` to an N-dimensional vector of Z-scores.\n1824: \n1825: **Operation:**\n1826: 1.  Aggregate the alive components `v_A` using operator M (see {prf:ref}`def-swarm-aggregation-operator`) to get a measure $\\mu_v = M(S, v_A)$.\n1827: 2.  Compute the mean $\\mu_A = \\mathbb{E}[\\mu_v]$ and the **patched** standard deviation $\\sigma'_A = \\sigma'_{\\text{patch}}(\\text{Var}[\\mu_v])$ using the patching function (see {prf:ref}`lem-patching-properties`).\n1828: 3.  For each alive walker `i`, compute its Z-score: $z_i = (v_i - \\mu_A) / \\sigma'_A$."
    },
    {
      "directive_type": "lemma",
      "label": "lem-compact-support-z-scores",
      "title": "Compact Support of Standardized Scores",
      "start_line": 1830,
      "end_line": 1833,
      "header_lines": [
        1831
      ],
      "content_start": 1832,
      "content_end": 1832,
      "content": "1832: :::{prf:lemma} Compact Support of Standardized Scores",
      "metadata": {
        "label": "lem-compact-support-z-scores"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "lem-patching-properties"
      ],
      "raw_directive": "1830: :::\n1831: \n1832: :::{prf:lemma} Compact Support of Standardized Scores\n1833: :label: lem-compact-support-z-scores"
    },
    {
      "directive_type": "definition",
      "label": "def-logistic-rescale",
      "title": "Canonical Logistic Rescale Function",
      "start_line": 1844,
      "end_line": 1853,
      "header_lines": [
        1845
      ],
      "content_start": 1847,
      "content_end": 1852,
      "content": "1847: :label: def-logistic-rescale\n1848: \n1849: The **Canonical Logistic Rescale Function**, $g_A: \\mathbb{R} \\to (0, 2)$, is defined as:\n1850: \n1851: $$\n1852: g_A(z) := \\frac{2}{1 + e^{-z}}",
      "metadata": {
        "label": "def-logistic-rescale"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1844: :::\n1845: \n1846: :::{prf:definition} Canonical Logistic Rescale Function\n1847: :label: def-logistic-rescale\n1848: \n1849: The **Canonical Logistic Rescale Function**, $g_A: \\mathbb{R} \\to (0, 2)$, is defined as:\n1850: \n1851: $$\n1852: g_A(z) := \\frac{2}{1 + e^{-z}}\n1853: $$"
    },
    {
      "directive_type": "lemma",
      "label": "lem-logistic-properties",
      "title": "Verification of Axiomatic Properties",
      "start_line": 1855,
      "end_line": 1858,
      "header_lines": [
        1856
      ],
      "content_start": 1857,
      "content_end": 1857,
      "content": "1857: :::{prf:lemma} Verification of Axiomatic Properties",
      "metadata": {
        "label": "lem-logistic-properties"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1855: :::\n1856: \n1857: :::{prf:lemma} Verification of Axiomatic Properties\n1858: :label: lem-logistic-properties"
    },
    {
      "directive_type": "definition",
      "label": "def-fitness-potential-operator",
      "title": "Fitness Potential Operator",
      "start_line": 1864,
      "end_line": 1884,
      "header_lines": [
        1865
      ],
      "content_start": 1867,
      "content_end": 1883,
      "content": "1867: :label: def-fitness-potential-operator\n1868: \n1869: The **Fitness Potential Operator**, $\\Phi_{\\text{pipeline}}$, maps a swarm state `S` and its raw measurement vectors `r` and `d` to the final N-dimensional fitness potential vector $\\mathbf{V}_{\\text{fit}}$.\n1870: \n1871: **Operation:**\n1872: 1.  Compute reward Z-scores: $\\mathbf{z}_r = z(S, \\mathbf{r}, R_{agg})$.\n1873: 2.  Compute distance Z-scores: $\\mathbf{z}_d = z(S, \\mathbf{d}, M_D)$.\n1874: 3.  For each alive walker `i`, compute the rescaled components with the floor $\\eta$ using the Canonical Logistic Rescale Function (see {prf:ref}`lem-logistic-properties`):\n1875:     *   $r'_i := g_A(z_{r,i}) + \\eta$\n1876:     *   $d'_i := g_A(z_{d,i}) + \\eta$\n1877: 4.  Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n1878: \n1879: \n1880: \n1881: $$\n1882: V_i := (d'_i)^\\beta \\cdot (r'_i)^\\alpha\n1883: $$",
      "metadata": {
        "label": "def-fitness-potential-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "lem-logistic-properties"
      ],
      "raw_directive": "1864: The final stage of the pipeline assembles the rescaled components from both the reward and diversity channels into the final fitness potential vector.\n1865: \n1866: :::{prf:definition} Fitness Potential Operator\n1867: :label: def-fitness-potential-operator\n1868: \n1869: The **Fitness Potential Operator**, $\\Phi_{\\text{pipeline}}$, maps a swarm state `S` and its raw measurement vectors `r` and `d` to the final N-dimensional fitness potential vector $\\mathbf{V}_{\\text{fit}}$.\n1870: \n1871: **Operation:**\n1872: 1.  Compute reward Z-scores: $\\mathbf{z}_r = z(S, \\mathbf{r}, R_{agg})$.\n1873: 2.  Compute distance Z-scores: $\\mathbf{z}_d = z(S, \\mathbf{d}, M_D)$.\n1874: 3.  For each alive walker `i`, compute the rescaled components with the floor $\\eta$ using the Canonical Logistic Rescale Function (see {prf:ref}`lem-logistic-properties`):\n1875:     *   $r'_i := g_A(z_{r,i}) + \\eta$\n1876:     *   $d'_i := g_A(z_{d,i}) + \\eta$\n1877: 4.  Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n1878: \n1879: \n1880: \n1881: $$\n1882: V_i := (d'_i)^\\beta \\cdot (r'_i)^\\alpha\n1883: $$\n1884: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-potential-bounds",
      "title": "Uniform Bounds of the Fitness Potential",
      "start_line": 1886,
      "end_line": 1892,
      "header_lines": [
        1887
      ],
      "content_start": 1889,
      "content_end": 1891,
      "content": "1889: :label: lem-potential-bounds\n1890: \n1891: Any non-zero fitness potential $V_i$ generated by this pipeline is uniformly bounded within a compact interval $[V_{\\text{pot,min}}, V_{\\text{pot,max}}]$. The bounds are state-independent constants defined by the algorithmic parameters (using properties from {prf:ref}`lem-logistic-properties`):",
      "metadata": {
        "label": "lem-potential-bounds"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "lem-logistic-properties"
      ],
      "raw_directive": "1886: :::\n1887: \n1888: :::{prf:lemma} Uniform Bounds of the Fitness Potential\n1889: :label: lem-potential-bounds\n1890: \n1891: Any non-zero fitness potential $V_i$ generated by this pipeline is uniformly bounded within a compact interval $[V_{\\text{pot,min}}, V_{\\text{pot,max}}]$. The bounds are state-independent constants defined by the algorithmic parameters (using properties from {prf:ref}`lem-logistic-properties`):\n1892: *   $V_{\\text{pot,min}} := \\eta^{\\alpha+\\beta}$"
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-potential-bounds",
      "title": null,
      "start_line": 1893,
      "end_line": 1925,
      "header_lines": [
        1894
      ],
      "content_start": 1896,
      "content_end": 1924,
      "content": "1896: :label: proof-lem-potential-bounds\n1897: \n1898: **Proof.**\n1899: \n1900: The proof follows directly from the definition of the multiplicative potential and the bounded properties of its components.\n1901: \n1902: The rescaled components, $r'_i = g_A(z_{r,i}) + \\eta$ and $d'_i = g_A(z_{d,i}) + \\eta$, are strictly positive and bounded. The rescale function $g_A(z)$ has a range of $(g_{A,\\min}, g_{A,\\max}]$. Since $\\eta > 0$, the components are bounded on the interval $(g_{A,\\min} + \\eta, g_{A,\\max} + \\eta]$. For simplicity and rigor, we use the absolute bounds $(\\eta, g_{A,\\max} + \\eta]$.\n1903: \n1904: **Lower Bound ($V_{\\text{pot,min}}$):** The fitness potential $V_i$ is a product of positive terms raised to non-negative powers ($\\alpha, \\beta \\geq 0$). It is minimized when each component is at its minimum possible value.\n1905: \n1906: $$\n1907: V_i \\ge (\\eta)^{\\beta} \\cdot (\\eta)^{\\alpha} = \\eta^{\\alpha+\\beta}\n1908: $$\n1909: \n1910: Therefore, the uniform lower bound is $V_{\\text{pot,min}} := \\eta^{\\alpha+\\beta}$.\n1911: \n1912: **Upper Bound ($V_{\\text{pot,max}}$):** The potential is maximized when each component is at its maximum possible value.\n1913: \n1914: $$\n1915: V_i \\le (g_{A,\\max} + \\eta)^{\\beta} \\cdot (g_{A,\\max} + \\eta)^{\\alpha} = (g_{A,\\max} + \\eta)^{\\alpha+\\beta}\n1916: $$\n1917: \n1918: Therefore, the uniform upper bound is $V_{\\text{pot,max}} := (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$.\n1919: \n1920: **Uniformity:**\n1921: \n1922: Since $g_A$ is bounded and $\\eta$ is a finite positive constant, both $V_{\\text{pot,min}}$ and $V_{\\text{pot,max}}$ are finite, positive, state-independent constants. They are independent of the swarm size $N$, the current state, or any dynamical variables.\n1923: \n1924: This completes the proof.",
      "metadata": {
        "label": "proof-lem-potential-bounds"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1893: *   $V_{\\text{pot,max}} := (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$\n1894: :::\n1895: :::{prf:proof}\n1896: :label: proof-lem-potential-bounds\n1897: \n1898: **Proof.**\n1899: \n1900: The proof follows directly from the definition of the multiplicative potential and the bounded properties of its components.\n1901: \n1902: The rescaled components, $r'_i = g_A(z_{r,i}) + \\eta$ and $d'_i = g_A(z_{d,i}) + \\eta$, are strictly positive and bounded. The rescale function $g_A(z)$ has a range of $(g_{A,\\min}, g_{A,\\max}]$. Since $\\eta > 0$, the components are bounded on the interval $(g_{A,\\min} + \\eta, g_{A,\\max} + \\eta]$. For simplicity and rigor, we use the absolute bounds $(\\eta, g_{A,\\max} + \\eta]$.\n1903: \n1904: **Lower Bound ($V_{\\text{pot,min}}$):** The fitness potential $V_i$ is a product of positive terms raised to non-negative powers ($\\alpha, \\beta \\geq 0$). It is minimized when each component is at its minimum possible value.\n1905: \n1906: $$\n1907: V_i \\ge (\\eta)^{\\beta} \\cdot (\\eta)^{\\alpha} = \\eta^{\\alpha+\\beta}\n1908: $$\n1909: \n1910: Therefore, the uniform lower bound is $V_{\\text{pot,min}} := \\eta^{\\alpha+\\beta}$.\n1911: \n1912: **Upper Bound ($V_{\\text{pot,max}}$):** The potential is maximized when each component is at its maximum possible value.\n1913: \n1914: $$\n1915: V_i \\le (g_{A,\\max} + \\eta)^{\\beta} \\cdot (g_{A,\\max} + \\eta)^{\\alpha} = (g_{A,\\max} + \\eta)^{\\alpha+\\beta}\n1916: $$\n1917: \n1918: Therefore, the uniform upper bound is $V_{\\text{pot,max}} := (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$.\n1919: \n1920: **Uniformity:**\n1921: \n1922: Since $g_A$ is bounded and $\\eta$ is a finite positive constant, both $V_{\\text{pot,min}}$ and $V_{\\text{pot,max}}$ are finite, positive, state-independent constants. They are independent of the swarm size $N$, the current state, or any dynamical variables.\n1923: \n1924: This completes the proof.\n1925: "
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-companion-operator",
      "title": "Companion Selection Operator for Cloning",
      "start_line": 1934,
      "end_line": 1962,
      "header_lines": [
        1935
      ],
      "content_start": 1937,
      "content_end": 1961,
      "content": "1937: :label: def-cloning-companion-operator\n1938: \n1939: The first step of the cloning action is to select a companion. The **Companion Selection Operator for Cloning** defines, for each walker `i`, a probability measure $\\mathcal{C}_i(S)$ from which a companion `c_i` is sampled independently. This is a hybrid operator that uses the best available information for each type of walker.\n1940: \n1941: **Inputs:**\n1942: *   The swarm state `S`, which defines the set of alive walkers, $\\mathcal{A}_k$, and the set of dead walkers, $\\mathcal{D}_k$.\n1943: *   The interaction range for cloning, $\\varepsilon_c > 0$.\n1944: \n1945: **Operation:**\n1946: The definition of the measure $\\mathcal{C}_i(S)$ depends on the status of walker `i`:\n1947: \n1948: 1.  **If `i` is an ALIVE walker ($i \\in \\mathcal{A}_k$):**\n1949:     The selection is phase-space-aware and restricted to other alive walkers. For any other alive walker $j \\in \\mathcal{A}_k \\setminus \\{i\\}$, the probability of selection is given by a softmax distribution based on algorithmic distance:\n1950: \n1951: \n1952: $$\n1953: P(c_i=j \\mid i \\in \\mathcal{A}_k) := \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{l \\in \\mathcal{A}_k \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i, l)^2}{2\\epsilon_c^2}\\right)}\n1954: $$\n1955: \n1956: 2.  **If `i` is a DEAD walker ($i \\in \\mathcal{D}_k$):**\n1957:     The selection is a uniform random choice from the entire set of `k` alive walkers. For any alive walker $j \\in \\mathcal{A}_k$:\n1958: \n1959: \n1960: $$\n1961: P(c_i=j \\mid i \\in \\mathcal{D}_k) := \\frac{1}{k}",
      "metadata": {
        "label": "def-cloning-companion-operator"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1934: \n1935: #### 5.7.1 Companion Selection Operator for Cloning\n1936: :::{prf:definition} Companion Selection Operator for Cloning\n1937: :label: def-cloning-companion-operator\n1938: \n1939: The first step of the cloning action is to select a companion. The **Companion Selection Operator for Cloning** defines, for each walker `i`, a probability measure $\\mathcal{C}_i(S)$ from which a companion `c_i` is sampled independently. This is a hybrid operator that uses the best available information for each type of walker.\n1940: \n1941: **Inputs:**\n1942: *   The swarm state `S`, which defines the set of alive walkers, $\\mathcal{A}_k$, and the set of dead walkers, $\\mathcal{D}_k$.\n1943: *   The interaction range for cloning, $\\varepsilon_c > 0$.\n1944: \n1945: **Operation:**\n1946: The definition of the measure $\\mathcal{C}_i(S)$ depends on the status of walker `i`:\n1947: \n1948: 1.  **If `i` is an ALIVE walker ($i \\in \\mathcal{A}_k$):**\n1949:     The selection is phase-space-aware and restricted to other alive walkers. For any other alive walker $j \\in \\mathcal{A}_k \\setminus \\{i\\}$, the probability of selection is given by a softmax distribution based on algorithmic distance:\n1950: \n1951: \n1952: $$\n1953: P(c_i=j \\mid i \\in \\mathcal{A}_k) := \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{l \\in \\mathcal{A}_k \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(i, l)^2}{2\\epsilon_c^2}\\right)}\n1954: $$\n1955: \n1956: 2.  **If `i` is a DEAD walker ($i \\in \\mathcal{D}_k$):**\n1957:     The selection is a uniform random choice from the entire set of `k` alive walkers. For any alive walker $j \\in \\mathcal{A}_k$:\n1958: \n1959: \n1960: $$\n1961: P(c_i=j \\mid i \\in \\mathcal{D}_k) := \\frac{1}{k}\n1962: $$"
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-score",
      "title": "The Canonical Cloning Score",
      "start_line": 1965,
      "end_line": 1975,
      "header_lines": [
        1966
      ],
      "content_start": 1968,
      "content_end": 1974,
      "content": "1968: :label: def-cloning-score\n1969: \n1970: Once a companion `c_i` has been selected for walker `i`, the **Canonical Cloning Score**, $S_i(c_i)$, is calculated as:\n1971: \n1972: $$\n1973: S_i(c_i) := \\frac{V_{\\text{fit},{c_i}} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\mathrm{clone}}}\n1974: $$",
      "metadata": {
        "label": "def-cloning-score"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "1965: \n1966: #### 5.7.2 Cloning Score\n1967: :::{prf:definition} The Canonical Cloning Score\n1968: :label: def-cloning-score\n1969: \n1970: Once a companion `c_i` has been selected for walker `i`, the **Canonical Cloning Score**, $S_i(c_i)$, is calculated as:\n1971: \n1972: $$\n1973: S_i(c_i) := \\frac{V_{\\text{fit},{c_i}} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\mathrm{clone}}}\n1974: $$\n1975: "
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-probability",
      "title": "Total Cloning Probability",
      "start_line": 1977,
      "end_line": 1993,
      "header_lines": [
        1978
      ],
      "content_start": 1980,
      "content_end": 1992,
      "content": "1980: :label: def-cloning-probability\n1981: \n1982: The **total cloning probability**, $p_i$, for a walker `i` is its unconditional probability of being marked for cloning. This is the expectation of the cloning event taken over the random draws of both the companion `c_i` and the threshold `T_i`, where the score is defined by {prf:ref}`def-cloning-score`.\n1983: \n1984: $$\n1985: p_i := \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)} \\left[ \\mathbb{P}_{T_i \\sim U(0,p_{\\max})} \\left( S_i(c_i) > T_i \\right) \\right]\n1986: $$\n1987: \n1988: The inner probability, for a fixed companion, evaluates to $\\min(1, \\max(0, S_i(c_i)/p_{\\max}))$. This gives the final expression for the total cloning probability as an expectation over the choice of companion:\n1989: \n1990: $$\n1991: p_i = \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)}\\left[\\min\\left(1, \\max\\left(0, \\frac{S_i(c_i)}{p_{\\max}}\\right)\\right)\\right]\n1992: $$",
      "metadata": {
        "label": "def-cloning-probability"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-cloning-score"
      ],
      "raw_directive": "1977: :::\n1978: \n1979: :::{prf:definition} Total Cloning Probability\n1980: :label: def-cloning-probability\n1981: \n1982: The **total cloning probability**, $p_i$, for a walker `i` is its unconditional probability of being marked for cloning. This is the expectation of the cloning event taken over the random draws of both the companion `c_i` and the threshold `T_i`, where the score is defined by {prf:ref}`def-cloning-score`.\n1983: \n1984: $$\n1985: p_i := \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)} \\left[ \\mathbb{P}_{T_i \\sim U(0,p_{\\max})} \\left( S_i(c_i) > T_i \\right) \\right]\n1986: $$\n1987: \n1988: The inner probability, for a fixed companion, evaluates to $\\min(1, \\max(0, S_i(c_i)/p_{\\max}))$. This gives the final expression for the total cloning probability as an expectation over the choice of companion:\n1989: \n1990: $$\n1991: p_i = \\mathbb{E}_{c_i \\sim \\mathcal{C}_i(S)}\\left[\\min\\left(1, \\max\\left(0, \\frac{S_i(c_i)}{p_{\\max}}\\right)\\right)\\right]\n1992: $$\n1993: "
    },
    {
      "directive_type": "definition",
      "label": "def-cloning-decision",
      "title": "The Stochastic Cloning Decision",
      "start_line": 2005,
      "end_line": 2009,
      "header_lines": [
        2006
      ],
      "content_start": 2008,
      "content_end": 2008,
      "content": "2008: :label: def-cloning-decision",
      "metadata": {
        "label": "def-cloning-decision"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "def-cloning-score"
      ],
      "raw_directive": "2005: #### 5.7.3  Cloning Decision\n2006: \n2007: :::{prf:definition} The Stochastic Cloning Decision\n2008: :label: def-cloning-decision\n2009: "
    },
    {
      "directive_type": "definition",
      "label": "def-inelastic-collision-update",
      "title": "The Inelastic Collision State Update",
      "start_line": 2017,
      "end_line": 2078,
      "header_lines": [
        2018
      ],
      "content_start": 2020,
      "content_end": 2077,
      "content": "2020: :label: def-inelastic-collision-update\n2021: \n2022: Let the set of all walkers marked for cloning be `C_set`. For each cloner $i \\in C_set$, let `c_i` be its selected companion. The intermediate swarm state `S'` is constructed as follows.\n2023: \n2024: First, for each unique companion `c` in the swarm, we identify the set of all cloners that selected it:\n2025: \n2026: $$\n2027: I_c := \\{j \\in C_{set} \\mid c_j = c\\}\n2028: $$\n2029: \n2030: Let `M = |I_c|` be the number of walkers cloning from companion `c`. The update is then defined for each `(M+1)`-particle system consisting of the companion `c` and its set of cloners `I_c`.\n2031: \n2032: 1.  **Position Updates:**\n2033:     *   For each cloner $j \\in I_c$, its position is reset to that of its companion `c`, plus independent Gaussian jitter:\n2034: \n2035: \n2036: $$\n2037: x'_j := x_c + \\sigma_x \\zeta_j^x\n2038: $$\n2039: \n2040:     *   The position of the companion `c` is unchanged by this interaction: `x'_c := x_c`.\n2041: \n2042: 2.  **Velocity Updates (The Inelastic Collapse):**\n2043:     The velocities of all `M+1` interacting walkers are updated simultaneously in a process that conserves the group's total momentum.\n2044: \n2045:     *   **a. Center-of-Mass Velocity:** First, compute the center-of-mass velocity of the `(M+1)`-particle interacting system. This quantity is conserved throughout the collision.\n2046: \n2047: \n2048: $$\n2049: V_{COM, c} := \\frac{1}{M+1} \\left( v_c + \\sum_{j \\in I_c} v_j \\right)\n2050: $$\n2051: \n2052:     *   **b. Update Relative Velocities:** For each walker `k` in the system ($k \\in I_c \\cup {c}$), its velocity relative to the CoM is `u_k = v_k - V_{COM,c}`. The new relative velocities `u'_k` are defined by a random rotation and a frictional contraction.\n2053:         Let $\\alpha_restitution \\in [0, 1]$ be a fixed algorithmic parameter representing the coefficient of restitution. For each `k`, let `R_k` be a random orthogonal transformation that isotropically rotates `u_k` (i.e., `R_k(u_k)` has the same magnitude as `u_k` but a uniformly random direction on the `(d-1)`-sphere). The new relative velocity is:\n2054: \n2055: \n2056: $$\n2057: u'_k := \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n2058: $$\n2059: \n2060:     *   **c. Return to Lab Frame:** The final velocities for all interacting walkers are then reconstructed:\n2061: \n2062: \n2063: $$\n2064: v'_k := V_{COM, c} + u'_k\n2065: $$\n2066: \n2067: 3.  **Uninvolved Walkers:** Any walker `k` that is not a cloner and was not selected as a companion by any cloner has its state `(x_k, v_k)` unchanged.\n2068: \n2069: **Analysis of the Restitution Parameter $\\alpha_restitution$:**\n2070: \n2071: This model introduces $\\alpha_restitution$ as a crucial hyperparameter that controls the velocity variance expansion caused by the velocity reset mechanism during cloning.\n2072: \n2073: *   If **$\\alpha_restitution = 1$**, the collision is **perfectly elastic**. The magnitudes of the relative velocities are preserved (`||u'_k|| = ||u_k||`), and the total kinetic energy of the interacting system is conserved. In this regime, cloning redistributes kinetic energy among walkers but does not directly dissipate it. However, the velocity reset mechanism still causes bounded expansion of $V_{\\text{Var},v}$ as walkers' velocities are reset based on their companions.\n2074: \n2075: *   If **$\\alpha_restitution = 0$**, the collision is **perfectly inelastic**. All new relative velocities are zero (`u'_k = 0`), meaning all `M+1` walkers emerge with the identical center-of-mass velocity, `v'_k = V_{COM,c}`. This corresponds to the **maximum possible dissipation** of the group's internal kinetic energy while still conserving total momentum. In this regime, the velocity variance expansion is minimized, as all walkers in a cloning group collapse to a single velocity.\n2076: \n2077: *   If **$\\alpha_restitution \\in (0, 1)$**, the cloning event has **intermediate dissipation**. The internal kinetic energy of the interacting group is reduced by a factor of $\\alpha_restitution^{2}$. This parameter provides a tunable mechanism for controlling the trade-off between maintaining kinetic diversity and bounding velocity variance expansion.",
      "metadata": {
        "label": "def-inelastic-collision-update"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "2017: This model handles the complex but common scenario where multiple \"cloners\" (either unfit alive walkers or dead walkers being revived) select the same high-fitness walker as their companion. Instead of a series of pairwise interactions, all cloners associated with a single companion are treated as a single interacting system that undergoes a simultaneous, momentum-conserving \"inelastic collapse.\" This process includes a tunable parameter for energy dissipation, allowing the cloning operator itself to act as a powerful mechanism for controlling the swarm's kinetic energy.\n2018: \n2019: :::{prf:definition} The Inelastic Collision State Update\n2020: :label: def-inelastic-collision-update\n2021: \n2022: Let the set of all walkers marked for cloning be `C_set`. For each cloner $i \\in C_set$, let `c_i` be its selected companion. The intermediate swarm state `S'` is constructed as follows.\n2023: \n2024: First, for each unique companion `c` in the swarm, we identify the set of all cloners that selected it:\n2025: \n2026: $$\n2027: I_c := \\{j \\in C_{set} \\mid c_j = c\\}\n2028: $$\n2029: \n2030: Let `M = |I_c|` be the number of walkers cloning from companion `c`. The update is then defined for each `(M+1)`-particle system consisting of the companion `c` and its set of cloners `I_c`.\n2031: \n2032: 1.  **Position Updates:**\n2033:     *   For each cloner $j \\in I_c$, its position is reset to that of its companion `c`, plus independent Gaussian jitter:\n2034: \n2035: \n2036: $$\n2037: x'_j := x_c + \\sigma_x \\zeta_j^x\n2038: $$\n2039: \n2040:     *   The position of the companion `c` is unchanged by this interaction: `x'_c := x_c`.\n2041: \n2042: 2.  **Velocity Updates (The Inelastic Collapse):**\n2043:     The velocities of all `M+1` interacting walkers are updated simultaneously in a process that conserves the group's total momentum.\n2044: \n2045:     *   **a. Center-of-Mass Velocity:** First, compute the center-of-mass velocity of the `(M+1)`-particle interacting system. This quantity is conserved throughout the collision.\n2046: \n2047: \n2048: $$\n2049: V_{COM, c} := \\frac{1}{M+1} \\left( v_c + \\sum_{j \\in I_c} v_j \\right)\n2050: $$\n2051: \n2052:     *   **b. Update Relative Velocities:** For each walker `k` in the system ($k \\in I_c \\cup {c}$), its velocity relative to the CoM is `u_k = v_k - V_{COM,c}`. The new relative velocities `u'_k` are defined by a random rotation and a frictional contraction.\n2053:         Let $\\alpha_restitution \\in [0, 1]$ be a fixed algorithmic parameter representing the coefficient of restitution. For each `k`, let `R_k` be a random orthogonal transformation that isotropically rotates `u_k` (i.e., `R_k(u_k)` has the same magnitude as `u_k` but a uniformly random direction on the `(d-1)`-sphere). The new relative velocity is:\n2054: \n2055: \n2056: $$\n2057: u'_k := \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n2058: $$\n2059: \n2060:     *   **c. Return to Lab Frame:** The final velocities for all interacting walkers are then reconstructed:\n2061: \n2062: \n2063: $$\n2064: v'_k := V_{COM, c} + u'_k\n2065: $$\n2066: \n2067: 3.  **Uninvolved Walkers:** Any walker `k` that is not a cloner and was not selected as a companion by any cloner has its state `(x_k, v_k)` unchanged.\n2068: \n2069: **Analysis of the Restitution Parameter $\\alpha_restitution$:**\n2070: \n2071: This model introduces $\\alpha_restitution$ as a crucial hyperparameter that controls the velocity variance expansion caused by the velocity reset mechanism during cloning.\n2072: \n2073: *   If **$\\alpha_restitution = 1$**, the collision is **perfectly elastic**. The magnitudes of the relative velocities are preserved (`||u'_k|| = ||u_k||`), and the total kinetic energy of the interacting system is conserved. In this regime, cloning redistributes kinetic energy among walkers but does not directly dissipate it. However, the velocity reset mechanism still causes bounded expansion of $V_{\\text{Var},v}$ as walkers' velocities are reset based on their companions.\n2074: \n2075: *   If **$\\alpha_restitution = 0$**, the collision is **perfectly inelastic**. All new relative velocities are zero (`u'_k = 0`), meaning all `M+1` walkers emerge with the identical center-of-mass velocity, `v'_k = V_{COM,c}`. This corresponds to the **maximum possible dissipation** of the group's internal kinetic energy while still conserving total momentum. In this regime, the velocity variance expansion is minimized, as all walkers in a cloning group collapse to a single velocity.\n2076: \n2077: *   If **$\\alpha_restitution \\in (0, 1)$**, the cloning event has **intermediate dissipation**. The internal kinetic energy of the interacting group is reduced by a factor of $\\alpha_restitution^{2}$. This parameter provides a tunable mechanism for controlling the trade-off between maintaining kinetic diversity and bounding velocity variance expansion.\n2078: "
    },
    {
      "directive_type": "proposition",
      "label": "prop-bounded-velocity-expansion",
      "title": "Bounded Velocity Variance Expansion from Cloning",
      "start_line": 2084,
      "end_line": 2094,
      "header_lines": [
        2085
      ],
      "content_start": 2087,
      "content_end": 2093,
      "content": "2087: :label: prop-bounded-velocity-expansion\n2088: \n2089: For any cloning event where a fraction $f_{\\text{clone}}$ of walkers are cloned with restitution coefficient $\\alpha_{\\text{restitution}}$, the change in internal velocity variance from the velocity resets is bounded:\n2090: \n2091: $$\n2092: \\Delta V_{Var,v} \\leq f_{\\text{clone}} \\cdot C_{\\text{reset}} \\cdot V_{\\max,\\text{KE}}\n2093: $$",
      "metadata": {
        "label": "prop-bounded-velocity-expansion"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [],
      "raw_directive": "2084: The following proposition formalizes the key property that enables the synergistic dissipation framework: the expansion of velocity variance caused by cloning is uniformly bounded.\n2085: \n2086: :::{prf:proposition} Bounded Velocity Variance Expansion from Cloning\n2087: :label: prop-bounded-velocity-expansion\n2088: \n2089: For any cloning event where a fraction $f_{\\text{clone}}$ of walkers are cloned with restitution coefficient $\\alpha_{\\text{restitution}}$, the change in internal velocity variance from the velocity resets is bounded:\n2090: \n2091: $$\n2092: \\Delta V_{Var,v} \\leq f_{\\text{clone}} \\cdot C_{\\text{reset}} \\cdot V_{\\max,\\text{KE}}\n2093: $$\n2094: "
    },
    {
      "directive_type": "proof",
      "label": "proof-prop-bounded-velocity-expansion",
      "title": null,
      "start_line": 2096,
      "end_line": 2273,
      "header_lines": [
        2097
      ],
      "content_start": 2098,
      "content_end": 2272,
      "content": "2098: :::{prf:proof}\n2099: :label: proof-prop-bounded-velocity-expansion\n2100: **Proof:**\n2101: \n2102: We will prove that the one-step change in the velocity variance component $V_{Var,v}$ due to cloning is bounded by a state-independent constant. The proof proceeds in four parts: (1) establish the domain of possible velocities, (2) bound the per-walker variance change from velocity reset, (3) bound the total variance change across all cloned walkers, and (4) verify that all bounds are state-independent through the velocity regularization mechanism.\n2103: \n2104: **Part 1: The Velocity Domain and Its Diameter**\n2105: \n2106: By the compactness of the valid position domain $\\mathcal{X}_{\\text{valid}}$ and the Lipschitz continuity of the drift field (see {prf:ref}`axiom-lipschitz-fields`), the velocity domain is implicitly bounded. Specifically:\n2107: \n2108: 1. The kinetic operator includes a friction term $-\\gamma v$ and a bounded drift field $F(x)$ with $\\|F(x)\\| \\leq F_{\\max}$ for all $x \\in \\mathcal{X}_{\\text{valid}}$.\n2109: \n2110: 2. The velocity regularization term in {prf:ref}`axiom-velocity-regularization` ensures walkers with $\\|v\\|^2 > V_{\\text{thresh}}^2$ have extremely low fitness and are preferentially cloned, where $V_{\\text{thresh}}$ is determined by the balance between the positional reward scale and the regularization coefficient $c_{v\\_reg}$.\n2111: \n2112: 3. These mechanisms ensure that in any viable swarm state (where extinction probability is negligible), all walker velocities satisfy $\\|v_i\\| \\leq V_{\\max}$ for a finite constant:\n2113: \n2114: $$\n2115: V_{\\max}^2 := \\max\\left\\{ \\frac{2F_{\\max}}{\\gamma}, V_{\\text{thresh}}^2 \\right\\}\n2116: $$\n2117: \n2118: This bound is **state-independent**, depending only on the domain geometry ($F_{\\max}$), algorithmic parameters ($\\gamma$, $c_{v\\_reg}$), and the reward scale.\n2119: \n2120: **Part 2: Bounding the Per-Walker Variance Change**\n2121: \n2122: Consider a single walker $i$ that is cloned at step $t$. Let $v_i^{\\text{old}}$ be its velocity before cloning and $v_i^{\\text{new}}$ be its velocity after the inelastic collision reset. Let $\\mu_v^{\\text{old}}$ and $\\mu_v^{\\text{new}}$ be the velocity barycentres before and after cloning.\n2123: \n2124: The contribution of walker $i$ to the velocity variance changes as:\n2125: \n2126: $$\n2127: \\Delta_i := \\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2\n2128: $$\n2129: \n2130: We bound this change using the triangle inequality and the velocity domain bounds. First, note that:\n2131: \n2132: $$\n2133: \\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 \\leq 2\\|v_i^{\\text{new}}\\|^2 + 2\\|\\mu_v^{\\text{new}}\\|^2 \\leq 2V_{\\max}^2 + 2V_{\\max}^2 = 4V_{\\max}^2\n2134: $$\n2135: \n2136: Similarly, $\\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2 \\geq 0$. Therefore:\n2137: \n2138: $$\n2139: \\Delta_i \\leq 4V_{\\max}^2\n2140: $$\n2141: \n2142: However, this is a worst-case bound. We can obtain a tighter bound by analyzing the inelastic collision mechanism directly.\n2143: \n2144: **Step 2a: The Inelastic Collision Model**\n2145: \n2146: When walker $i$ is cloned, it participates in an inelastic collision with $M$ companion walkers. Let $v_i^{\\text{old}}$ and $\\{v_j^{\\text{comp}}\\}_{j=1}^M$ be the velocities of the participants. The center-of-mass velocity is:\n2147: \n2148: $$\n2149: V_{\\text{COM}} = \\frac{1}{M+1}\\left(v_i^{\\text{old}} + \\sum_{j=1}^M v_j^{\\text{comp}}\\right)\n2150: $$\n2151: \n2152: The new velocity is computed via:\n2153: \n2154: $$\n2155: v_i^{\\text{new}} = V_{\\text{COM}} + \\alpha_{\\text{restitution}} \\cdot R(u_i)\n2156: $$\n2157: \n2158: where $u_i = v_i^{\\text{old}} - V_{\\text{COM}}$ is the old relative velocity and $R$ is a random rotation. The magnitude change is bounded by:\n2159: \n2160: $$\n2161: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq \\|v_i^{\\text{new}} - V_{\\text{COM}}\\|^2 + \\|V_{\\text{COM}} - v_i^{\\text{old}}\\|^2\n2162: $$\n2163: \n2164: Since $\\|v_i^{\\text{new}} - V_{\\text{COM}}\\| = \\alpha_{\\text{restitution}} \\|u_i\\|$ and $\\|V_{\\text{COM}} - v_i^{\\text{old}}\\| = \\|u_i\\|$:\n2165: \n2166: $$\n2167: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq (\\alpha_{\\text{restitution}}^2 + 1) \\|u_i\\|^2\n2168: $$\n2169: \n2170: The relative velocity magnitude is bounded by:\n2171: \n2172: $$\n2173: \\|u_i\\| = \\|v_i^{\\text{old}} - V_{\\text{COM}}\\| \\leq \\|v_i^{\\text{old}}\\| + \\|V_{\\text{COM}}\\| \\leq V_{\\max} + V_{\\max} = 2V_{\\max}\n2174: $$\n2175: \n2176: Therefore:\n2177: \n2178: $$\n2179: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq 4(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2\n2180: $$\n2181: \n2182: **Part 3: Total Variance Change from All Cloned Walkers**\n2183: \n2184: The velocity variance component of the Lyapunov function is defined (with $N$-normalization) as:\n2185: \n2186: $$\n2187: V_{Var,v}(S_k) = \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|v_i - \\mu_v\\|^2\n2188: $$\n2189: \n2190: When a cloning event occurs, let $\\mathcal{C} \\subset \\mathcal{A}(S_k)$ be the set of walkers that are cloned, with $|\\mathcal{C}| = n_{\\text{clone}}$. The change in $V_{Var,v}$ can be decomposed into three contributions:\n2191: \n2192: 1. **Direct variance change from velocity resets** (cloned walkers)\n2193: 2. **Barycentre shift effect** (changes $\\mu_v$, affecting all walkers)\n2194: 3. **Status changes** (deaths and revivals)\n2195: \n2196: We bound each contribution separately.\n2197: \n2198: **Contribution 1 (Direct Reset):** For each cloned walker $i \\in \\mathcal{C}$, the velocity changes from $v_i^{\\text{old}}$ to $v_i^{\\text{new}}$. Using the squared-norm expansion:\n2199: \n2200: $$\n2201: \\begin{aligned}\n2202: &\\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2 \\\\\n2203: &= \\|v_i^{\\text{new}}\\|^2 - 2\\langle v_i^{\\text{new}}, \\mu_v^{\\text{new}}\\rangle + \\|\\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}}\\|^2 + 2\\langle v_i^{\\text{old}}, \\mu_v^{\\text{old}}\\rangle - \\|\\mu_v^{\\text{old}}\\|^2\n2204: \\end{aligned}\n2205: $$\n2206: \n2207: This can be bounded using the fact that $\\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq 4(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2$ and $\\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\|^2$ is also bounded by a similar expression (since the barycentre is an average of velocities, all bounded by $V_{\\max}$).\n2208: \n2209: Through careful algebraic expansion (using $\\|a - b\\|^2 = \\|a\\|^2 - 2\\langle a, b\\rangle + \\|b\\|^2$) and the triangle inequality:\n2210: \n2211: $$\n2212: \\left|\\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2\\right| \\leq 8(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2 + 8V_{\\max}^2 = 8(\\alpha_{\\text{restitution}}^2 + 2) V_{\\max}^2\n2213: $$\n2214: \n2215: **Contribution 2 (Barycentre Shift):** The barycentre shift affects all $k_{\\text{alive}}$ walkers. The magnitude of the shift is bounded by:\n2216: \n2217: $$\n2218: \\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\| \\leq \\frac{n_{\\text{clone}}}{k_{\\text{alive}}} \\cdot 2V_{\\max}\n2219: $$\n2220: \n2221: The contribution to variance change from barycentre shift across all walkers is bounded by:\n2222: \n2223: $$\n2224: \\left|\\frac{1}{N}\\sum_{i \\in \\mathcal{A}} \\left(\\|v_i - \\mu_v^{\\text{new}}\\|^2 - \\|v_i - \\mu_v^{\\text{old}}\\|^2\\right)\\right| \\leq \\frac{k_{\\text{alive}}}{N} \\cdot 4V_{\\max} \\cdot \\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\| \\leq \\frac{8n_{\\text{clone}}V_{\\max}^2}{N}\n2225: $$\n2226: \n2227: **Contribution 3 (Status Changes):** Dead walkers contribute zero to the sum. When a walker revives, it adds a term $\\frac{1}{N}\\|v_i - \\mu_v\\|^2 \\leq \\frac{4V_{\\max}^2}{N}$. The number of revivals equals the number of deaths, which is at most $n_{\\text{clone}}$.\n2228: \n2229: **Total Bound:** Combining all contributions:\n2230: \n2231: $$\n2232: \\begin{aligned}\n2233: |\\Delta V_{Var,v}| &\\leq \\frac{n_{\\text{clone}}}{N} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 2) V_{\\max}^2 + \\frac{8n_{\\text{clone}}V_{\\max}^2}{N} + \\frac{4n_{\\text{clone}}V_{\\max}^2}{N} \\\\\n2234: &= \\frac{n_{\\text{clone}}}{N} \\cdot \\left[8(\\alpha_{\\text{restitution}}^2 + 2) + 8 + 4\\right] V_{\\max}^2 \\\\\n2235: &= \\frac{n_{\\text{clone}}}{N} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 4) V_{\\max}^2\n2236: \\end{aligned}\n2237: $$\n2238: \n2239: Since $n_{\\text{clone}} = f_{\\text{clone}} \\cdot N$ by definition:\n2240: \n2241: $$\n2242: |\\Delta V_{Var,v}| \\leq f_{\\text{clone}} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 4) V_{\\max}^2\n2243: $$\n2244: \n2245: **Part 4: State-Independence of the Bound**\n2246: \n2247: The bound depends only on:\n2248: - $f_{\\text{clone}}$: the cloning fraction (algorithmic parameter)\n2249: - $\\alpha_{\\text{restitution}}$: the restitution coefficient (algorithmic parameter)\n2250: - $V_{\\max}^2$: the velocity domain bound\n2251: \n2252: The critical claim is that $V_{\\max}$ is state-independent. This is guaranteed by {prf:ref}`axiom-velocity-regularization`. Any walker with $\\|v_i\\|^2 \\gg V_{\\text{thresh}}^2$ has reward:\n2253: \n2254: $$\n2255: R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2 \\ll R_{\\text{pos}}(x_i) - c_{v\\_reg} V_{\\text{thresh}}^2\n2256: $$\n2257: \n2258: making it extremely unfit and a prime target for cloning. This feedback mechanism prevents velocity runaway, ensuring $V_{\\max}$ remains a true constant.\n2259: \n2260: **Conclusion:** Setting:\n2261: \n2262: $$\n2263: C_{\\text{reset}} := 8(\\alpha_{\\text{restitution}}^2 + 4), \\quad V_{\\max,\\text{KE}} := V_{\\max}^2\n2264: $$\n2265: \n2266: we have proven:\n2267: \n2268: $$\n2269: \\Delta V_{Var,v} \\leq f_{\\text{clone}} \\cdot C_{\\text{reset}} \\cdot V_{\\max,\\text{KE}}\n2270: $$\n2271: \n2272: where both $C_{\\text{reset}}$ and $V_{\\max,\\text{KE}}$ are state-independent constants depending only on algorithmic parameters and domain geometry.",
      "metadata": {
        "label": "proof-prop-bounded-velocity-expansion"
      },
      "section": "## 5. The Measurement and Interaction Pipeline",
      "references": [
        "axiom-lipschitz-fields",
        "axiom-velocity-regularization"
      ],
      "raw_directive": "2096: :::\n2097: \n2098: :::{prf:proof}\n2099: :label: proof-prop-bounded-velocity-expansion\n2100: **Proof:**\n2101: \n2102: We will prove that the one-step change in the velocity variance component $V_{Var,v}$ due to cloning is bounded by a state-independent constant. The proof proceeds in four parts: (1) establish the domain of possible velocities, (2) bound the per-walker variance change from velocity reset, (3) bound the total variance change across all cloned walkers, and (4) verify that all bounds are state-independent through the velocity regularization mechanism.\n2103: \n2104: **Part 1: The Velocity Domain and Its Diameter**\n2105: \n2106: By the compactness of the valid position domain $\\mathcal{X}_{\\text{valid}}$ and the Lipschitz continuity of the drift field (see {prf:ref}`axiom-lipschitz-fields`), the velocity domain is implicitly bounded. Specifically:\n2107: \n2108: 1. The kinetic operator includes a friction term $-\\gamma v$ and a bounded drift field $F(x)$ with $\\|F(x)\\| \\leq F_{\\max}$ for all $x \\in \\mathcal{X}_{\\text{valid}}$.\n2109: \n2110: 2. The velocity regularization term in {prf:ref}`axiom-velocity-regularization` ensures walkers with $\\|v\\|^2 > V_{\\text{thresh}}^2$ have extremely low fitness and are preferentially cloned, where $V_{\\text{thresh}}$ is determined by the balance between the positional reward scale and the regularization coefficient $c_{v\\_reg}$.\n2111: \n2112: 3. These mechanisms ensure that in any viable swarm state (where extinction probability is negligible), all walker velocities satisfy $\\|v_i\\| \\leq V_{\\max}$ for a finite constant:\n2113: \n2114: $$\n2115: V_{\\max}^2 := \\max\\left\\{ \\frac{2F_{\\max}}{\\gamma}, V_{\\text{thresh}}^2 \\right\\}\n2116: $$\n2117: \n2118: This bound is **state-independent**, depending only on the domain geometry ($F_{\\max}$), algorithmic parameters ($\\gamma$, $c_{v\\_reg}$), and the reward scale.\n2119: \n2120: **Part 2: Bounding the Per-Walker Variance Change**\n2121: \n2122: Consider a single walker $i$ that is cloned at step $t$. Let $v_i^{\\text{old}}$ be its velocity before cloning and $v_i^{\\text{new}}$ be its velocity after the inelastic collision reset. Let $\\mu_v^{\\text{old}}$ and $\\mu_v^{\\text{new}}$ be the velocity barycentres before and after cloning.\n2123: \n2124: The contribution of walker $i$ to the velocity variance changes as:\n2125: \n2126: $$\n2127: \\Delta_i := \\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2\n2128: $$\n2129: \n2130: We bound this change using the triangle inequality and the velocity domain bounds. First, note that:\n2131: \n2132: $$\n2133: \\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 \\leq 2\\|v_i^{\\text{new}}\\|^2 + 2\\|\\mu_v^{\\text{new}}\\|^2 \\leq 2V_{\\max}^2 + 2V_{\\max}^2 = 4V_{\\max}^2\n2134: $$\n2135: \n2136: Similarly, $\\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2 \\geq 0$. Therefore:\n2137: \n2138: $$\n2139: \\Delta_i \\leq 4V_{\\max}^2\n2140: $$\n2141: \n2142: However, this is a worst-case bound. We can obtain a tighter bound by analyzing the inelastic collision mechanism directly.\n2143: \n2144: **Step 2a: The Inelastic Collision Model**\n2145: \n2146: When walker $i$ is cloned, it participates in an inelastic collision with $M$ companion walkers. Let $v_i^{\\text{old}}$ and $\\{v_j^{\\text{comp}}\\}_{j=1}^M$ be the velocities of the participants. The center-of-mass velocity is:\n2147: \n2148: $$\n2149: V_{\\text{COM}} = \\frac{1}{M+1}\\left(v_i^{\\text{old}} + \\sum_{j=1}^M v_j^{\\text{comp}}\\right)\n2150: $$\n2151: \n2152: The new velocity is computed via:\n2153: \n2154: $$\n2155: v_i^{\\text{new}} = V_{\\text{COM}} + \\alpha_{\\text{restitution}} \\cdot R(u_i)\n2156: $$\n2157: \n2158: where $u_i = v_i^{\\text{old}} - V_{\\text{COM}}$ is the old relative velocity and $R$ is a random rotation. The magnitude change is bounded by:\n2159: \n2160: $$\n2161: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq \\|v_i^{\\text{new}} - V_{\\text{COM}}\\|^2 + \\|V_{\\text{COM}} - v_i^{\\text{old}}\\|^2\n2162: $$\n2163: \n2164: Since $\\|v_i^{\\text{new}} - V_{\\text{COM}}\\| = \\alpha_{\\text{restitution}} \\|u_i\\|$ and $\\|V_{\\text{COM}} - v_i^{\\text{old}}\\| = \\|u_i\\|$:\n2165: \n2166: $$\n2167: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq (\\alpha_{\\text{restitution}}^2 + 1) \\|u_i\\|^2\n2168: $$\n2169: \n2170: The relative velocity magnitude is bounded by:\n2171: \n2172: $$\n2173: \\|u_i\\| = \\|v_i^{\\text{old}} - V_{\\text{COM}}\\| \\leq \\|v_i^{\\text{old}}\\| + \\|V_{\\text{COM}}\\| \\leq V_{\\max} + V_{\\max} = 2V_{\\max}\n2174: $$\n2175: \n2176: Therefore:\n2177: \n2178: $$\n2179: \\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq 4(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2\n2180: $$\n2181: \n2182: **Part 3: Total Variance Change from All Cloned Walkers**\n2183: \n2184: The velocity variance component of the Lyapunov function is defined (with $N$-normalization) as:\n2185: \n2186: $$\n2187: V_{Var,v}(S_k) = \\frac{1}{N} \\sum_{i \\in \\mathcal{A}(S_k)} \\|v_i - \\mu_v\\|^2\n2188: $$\n2189: \n2190: When a cloning event occurs, let $\\mathcal{C} \\subset \\mathcal{A}(S_k)$ be the set of walkers that are cloned, with $|\\mathcal{C}| = n_{\\text{clone}}$. The change in $V_{Var,v}$ can be decomposed into three contributions:\n2191: \n2192: 1. **Direct variance change from velocity resets** (cloned walkers)\n2193: 2. **Barycentre shift effect** (changes $\\mu_v$, affecting all walkers)\n2194: 3. **Status changes** (deaths and revivals)\n2195: \n2196: We bound each contribution separately.\n2197: \n2198: **Contribution 1 (Direct Reset):** For each cloned walker $i \\in \\mathcal{C}$, the velocity changes from $v_i^{\\text{old}}$ to $v_i^{\\text{new}}$. Using the squared-norm expansion:\n2199: \n2200: $$\n2201: \\begin{aligned}\n2202: &\\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2 \\\\\n2203: &= \\|v_i^{\\text{new}}\\|^2 - 2\\langle v_i^{\\text{new}}, \\mu_v^{\\text{new}}\\rangle + \\|\\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}}\\|^2 + 2\\langle v_i^{\\text{old}}, \\mu_v^{\\text{old}}\\rangle - \\|\\mu_v^{\\text{old}}\\|^2\n2204: \\end{aligned}\n2205: $$\n2206: \n2207: This can be bounded using the fact that $\\|v_i^{\\text{new}} - v_i^{\\text{old}}\\|^2 \\leq 4(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2$ and $\\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\|^2$ is also bounded by a similar expression (since the barycentre is an average of velocities, all bounded by $V_{\\max}$).\n2208: \n2209: Through careful algebraic expansion (using $\\|a - b\\|^2 = \\|a\\|^2 - 2\\langle a, b\\rangle + \\|b\\|^2$) and the triangle inequality:\n2210: \n2211: $$\n2212: \\left|\\|v_i^{\\text{new}} - \\mu_v^{\\text{new}}\\|^2 - \\|v_i^{\\text{old}} - \\mu_v^{\\text{old}}\\|^2\\right| \\leq 8(\\alpha_{\\text{restitution}}^2 + 1) V_{\\max}^2 + 8V_{\\max}^2 = 8(\\alpha_{\\text{restitution}}^2 + 2) V_{\\max}^2\n2213: $$\n2214: \n2215: **Contribution 2 (Barycentre Shift):** The barycentre shift affects all $k_{\\text{alive}}$ walkers. The magnitude of the shift is bounded by:\n2216: \n2217: $$\n2218: \\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\| \\leq \\frac{n_{\\text{clone}}}{k_{\\text{alive}}} \\cdot 2V_{\\max}\n2219: $$\n2220: \n2221: The contribution to variance change from barycentre shift across all walkers is bounded by:\n2222: \n2223: $$\n2224: \\left|\\frac{1}{N}\\sum_{i \\in \\mathcal{A}} \\left(\\|v_i - \\mu_v^{\\text{new}}\\|^2 - \\|v_i - \\mu_v^{\\text{old}}\\|^2\\right)\\right| \\leq \\frac{k_{\\text{alive}}}{N} \\cdot 4V_{\\max} \\cdot \\|\\mu_v^{\\text{new}} - \\mu_v^{\\text{old}}\\| \\leq \\frac{8n_{\\text{clone}}V_{\\max}^2}{N}\n2225: $$\n2226: \n2227: **Contribution 3 (Status Changes):** Dead walkers contribute zero to the sum. When a walker revives, it adds a term $\\frac{1}{N}\\|v_i - \\mu_v\\|^2 \\leq \\frac{4V_{\\max}^2}{N}$. The number of revivals equals the number of deaths, which is at most $n_{\\text{clone}}$.\n2228: \n2229: **Total Bound:** Combining all contributions:\n2230: \n2231: $$\n2232: \\begin{aligned}\n2233: |\\Delta V_{Var,v}| &\\leq \\frac{n_{\\text{clone}}}{N} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 2) V_{\\max}^2 + \\frac{8n_{\\text{clone}}V_{\\max}^2}{N} + \\frac{4n_{\\text{clone}}V_{\\max}^2}{N} \\\\\n2234: &= \\frac{n_{\\text{clone}}}{N} \\cdot \\left[8(\\alpha_{\\text{restitution}}^2 + 2) + 8 + 4\\right] V_{\\max}^2 \\\\\n2235: &= \\frac{n_{\\text{clone}}}{N} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 4) V_{\\max}^2\n2236: \\end{aligned}\n2237: $$\n2238: \n2239: Since $n_{\\text{clone}} = f_{\\text{clone}} \\cdot N$ by definition:\n2240: \n2241: $$\n2242: |\\Delta V_{Var,v}| \\leq f_{\\text{clone}} \\cdot 8(\\alpha_{\\text{restitution}}^2 + 4) V_{\\max}^2\n2243: $$\n2244: \n2245: **Part 4: State-Independence of the Bound**\n2246: \n2247: The bound depends only on:\n2248: - $f_{\\text{clone}}$: the cloning fraction (algorithmic parameter)\n2249: - $\\alpha_{\\text{restitution}}$: the restitution coefficient (algorithmic parameter)\n2250: - $V_{\\max}^2$: the velocity domain bound\n2251: \n2252: The critical claim is that $V_{\\max}$ is state-independent. This is guaranteed by {prf:ref}`axiom-velocity-regularization`. Any walker with $\\|v_i\\|^2 \\gg V_{\\text{thresh}}^2$ has reward:\n2253: \n2254: $$\n2255: R(x_i, v_i) = R_{\\text{pos}}(x_i) - c_{v\\_reg} \\|v_i\\|^2 \\ll R_{\\text{pos}}(x_i) - c_{v\\_reg} V_{\\text{thresh}}^2\n2256: $$\n2257: \n2258: making it extremely unfit and a prime target for cloning. This feedback mechanism prevents velocity runaway, ensuring $V_{\\max}$ remains a true constant.\n2259: \n2260: **Conclusion:** Setting:\n2261: \n2262: $$\n2263: C_{\\text{reset}} := 8(\\alpha_{\\text{restitution}}^2 + 4), \\quad V_{\\max,\\text{KE}} := V_{\\max}^2\n2264: $$\n2265: \n2266: we have proven:\n2267: \n2268: $$\n2269: \\Delta V_{Var,v} \\leq f_{\\text{clone}} \\cdot C_{\\text{reset}} \\cdot V_{\\max,\\text{KE}}\n2270: $$\n2271: \n2272: where both $C_{\\text{reset}}$ and $V_{\\max,\\text{KE}}$ are state-independent constants depending only on algorithmic parameters and domain geometry.\n2273: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}