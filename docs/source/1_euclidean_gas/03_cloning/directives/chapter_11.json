{
  "chapter_index": 11,
  "section_id": "## 9.3. Decomposition into Sub-Operators",
  "directive_count": 8,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-measurement-operator",
      "title": "The Measurement Operator",
      "start_line": 5895,
      "end_line": 5927,
      "header_lines": [
        5896
      ],
      "content_start": 5898,
      "content_end": 5926,
      "content": "5898: :label: def-measurement-operator\n5899: \n5900: For input swarm $S$ with alive set $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5901: \n5902: **Input:** Swarm configuration $S$\n5903: \n5904: **Stochastic Process:**\n5905: \n5906: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5907: \n5908: \n5909: $$\n5910: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5911: $$\n5912: \n5913: 2. **Raw Distance Vector** (see {prf:ref}`def-raw-value-operators`): For each alive walker $i \\in \\mathcal{A}(S)$, compute:\n5914: \n5915: \n5916: $$\n5917: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5918: $$\n5919: \n5920: \n5921:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5922: \n5923: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5924: \n5925: **Key Properties:**\n5926: - The pairing $\\pi$ is sampled once per swarm, creating correlations between measurements",
      "metadata": {
        "label": "def-measurement-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-standardization-operator",
        "def-raw-value-operators"
      ],
      "raw_directive": "5895: The first stage (as discussed in Section 5.3) generates the stochastic diversity measurements that form the foundation of the fitness evaluation.\n5896: \n5897: :::{prf:definition} The Measurement Operator\n5898: :label: def-measurement-operator\n5899: \n5900: For input swarm $S$ with alive set $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5901: \n5902: **Input:** Swarm configuration $S$\n5903: \n5904: **Stochastic Process:**\n5905: \n5906: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5907: \n5908: \n5909: $$\n5910: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5911: $$\n5912: \n5913: 2. **Raw Distance Vector** (see {prf:ref}`def-raw-value-operators`): For each alive walker $i \\in \\mathcal{A}(S)$, compute:\n5914: \n5915: \n5916: $$\n5917: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5918: $$\n5919: \n5920: \n5921:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5922: \n5923: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5924: \n5925: **Key Properties:**\n5926: - The pairing $\\pi$ is sampled once per swarm, creating correlations between measurements\n5927: - The distribution of $\\mathbf{d}$ depends only on $S$ and the algorithmic parameters $(\\epsilon_p, \\ell_p)$"
    },
    {
      "directive_type": "remark",
      "label": "rem-measurement-coupling",
      "title": "Stochastic Coupling for Drift Analysis",
      "start_line": 5929,
      "end_line": 5936,
      "header_lines": [
        5930
      ],
      "content_start": 5932,
      "content_end": 5935,
      "content": "5932: :label: rem-measurement-coupling\n5933: \n5934: When analyzing two swarms $(S_1, S_2)$ in the drift analysis (Chapters 10-11), we use **synchronous coupling** of the randomness:\n5935: - The same random pairing algorithm is applied to both swarms",
      "metadata": {
        "label": "rem-measurement-coupling"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "5929: :::\n5930: \n5931: :::{prf:remark} Stochastic Coupling for Drift Analysis\n5932: :label: rem-measurement-coupling\n5933: \n5934: When analyzing two swarms $(S_1, S_2)$ in the drift analysis (Chapters 10-11), we use **synchronous coupling** of the randomness:\n5935: - The same random pairing algorithm is applied to both swarms\n5936: - The PRNG streams are coupled so that walker $i$ in swarm 1 and walker $i$ in swarm 2 use the same random seed"
    },
    {
      "directive_type": "definition",
      "label": "def-fitness-operator",
      "title": "The Fitness Evaluation Operator",
      "start_line": 5942,
      "end_line": 6013,
      "header_lines": [
        5943
      ],
      "content_start": 5945,
      "content_end": 6012,
      "content": "5945: :label: def-fitness-operator\n5946: \n5947: **Input:**\n5948: - Swarm configuration $S$\n5949: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5950: \n5951: **Deterministic Computation:**\n5952: \n5953: 1. **Boundary Proximity:** For each walker $i$, compute:\n5954: \n5955: \n5956: $$\n5957: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5958: $$\n5959: \n5960:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5961: \n5962: 2. **Rescaling:** Apply the rescale function with floor $\\eta > 0$:\n5963: \n5964: \n5965: $$\n5966: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5967: $$\n5968: \n5969: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5970: \n5971: \n5972: $$\n5973: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5974: $$\n5975: \n5976: \n5977: \n5978: $$\n5979: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5980: $$\n5981: \n5982: \n5983:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5984: \n5985: \n5986: $$\n5987: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5988: $$\n5989: \n5990: \n5991:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5992: \n5993: 4. **Fitness Potential:** For each walker $i$, compute:\n5994: \n5995:    a. Apply the Rescale Function $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5996:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5997:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5998: \n5999:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n6000: \n6001: \n6002: $$\n6003: V_{\\text{fit},i} = \\begin{cases}\n6004:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n6005:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n6006:       \\end{cases}\n6007: $$\n6008: \n6009: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n6010: \n6011: **Key Properties:**\n6012: - The operator is deterministic given $S$ and $\\mathbf{d}$",
      "metadata": {
        "label": "def-fitness-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "lem-potential-bounds"
      ],
      "raw_directive": "5942: This deterministic operator (implementing the pipeline from Chapter 5) transforms raw measurements into fitness potentials.\n5943: \n5944: :::{prf:definition} The Fitness Evaluation Operator\n5945: :label: def-fitness-operator\n5946: \n5947: **Input:**\n5948: - Swarm configuration $S$\n5949: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5950: \n5951: **Deterministic Computation:**\n5952: \n5953: 1. **Boundary Proximity:** For each walker $i$, compute:\n5954: \n5955: \n5956: $$\n5957: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5958: $$\n5959: \n5960:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5961: \n5962: 2. **Rescaling:** Apply the rescale function with floor $\\eta > 0$:\n5963: \n5964: \n5965: $$\n5966: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5967: $$\n5968: \n5969: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5970: \n5971: \n5972: $$\n5973: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5974: $$\n5975: \n5976: \n5977: \n5978: $$\n5979: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5980: $$\n5981: \n5982: \n5983:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5984: \n5985: \n5986: $$\n5987: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5988: $$\n5989: \n5990: \n5991:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5992: \n5993: 4. **Fitness Potential:** For each walker $i$, compute:\n5994: \n5995:    a. Apply the Rescale Function $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5996:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5997:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5998: \n5999:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n6000: \n6001: \n6002: $$\n6003: V_{\\text{fit},i} = \\begin{cases}\n6004:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n6005:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n6006:       \\end{cases}\n6007: $$\n6008: \n6009: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n6010: \n6011: **Key Properties:**\n6012: - The operator is deterministic given $S$ and $\\mathbf{d}$\n6013: - Bounded: $V_{\\text{fit},i} \\in [0, V_{\\text{pot,max}}]$ for alive walkers, where $V_{\\text{pot,max}} = (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$"
    },
    {
      "directive_type": "definition",
      "label": "def-decision-operator",
      "title": "The Cloning Decision Operator",
      "start_line": 6019,
      "end_line": 6071,
      "header_lines": [
        6020
      ],
      "content_start": 6022,
      "content_end": 6070,
      "content": "6022: :label: def-decision-operator\n6023: \n6024: **Input:**\n6025: - Swarm configuration $S$\n6026: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n6027: \n6028: **Stochastic Process:**\n6029: \n6030: For each walker $i \\in \\{1, \\ldots, N\\}$:\n6031: \n6032: 1. **Companion Selection** (see {prf:ref}`def-cloning-companion-operator`):\n6033: \n6034:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n6035: \n6036: \n6037: $$\n6038: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n6039: $$\n6040: \n6041: \n6042:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6043: \n6044: \n6045: $$\n6046: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6047: $$\n6048: \n6049: 2. **Cloning Score:** Compute the score based on fitness difference:\n6050: \n6051: \n6052: $$\n6053: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6054: $$\n6055: \n6056: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6057: \n6058:    Walker $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6059: \n6060: **Output:**\n6061: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6062: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6063: \n6064: **Total Cloning Probability:**\n6065: \n6066: The key quantity for drift analysis is the **total probability** that walker $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6067: \n6068: $$\n6069: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6070: $$",
      "metadata": {
        "label": "def-decision-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-cloning-companion-operator",
        "lem-quantitative-keystone"
      ],
      "raw_directive": "6019: This stochastic operator (formalized from {prf:ref}`def-cloning-decision`) determines which walkers will clone and which will persist.\n6020: \n6021: :::{prf:definition} The Cloning Decision Operator\n6022: :label: def-decision-operator\n6023: \n6024: **Input:**\n6025: - Swarm configuration $S$\n6026: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n6027: \n6028: **Stochastic Process:**\n6029: \n6030: For each walker $i \\in \\{1, \\ldots, N\\}$:\n6031: \n6032: 1. **Companion Selection** (see {prf:ref}`def-cloning-companion-operator`):\n6033: \n6034:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n6035: \n6036: \n6037: $$\n6038: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n6039: $$\n6040: \n6041: \n6042:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6043: \n6044: \n6045: $$\n6046: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6047: $$\n6048: \n6049: 2. **Cloning Score:** Compute the score based on fitness difference:\n6050: \n6051: \n6052: $$\n6053: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6054: $$\n6055: \n6056: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6057: \n6058:    Walker $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6059: \n6060: **Output:**\n6061: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6062: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6063: \n6064: **Total Cloning Probability:**\n6065: \n6066: The key quantity for drift analysis is the **total probability** that walker $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6067: \n6068: $$\n6069: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6070: $$\n6071: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-dead-walker-clone-prob",
      "title": "Total Cloning Probability for Dead Walkers",
      "start_line": 6073,
      "end_line": 6082,
      "header_lines": [
        6074
      ],
      "content_start": 6076,
      "content_end": 6081,
      "content": "6076: :label: lem-dead-walker-clone-prob\n6077: \n6078: Under the Axiom of Guaranteed Revival ($\\varepsilon_{\\text{clone}} \\cdot p_{\\max} < \\eta^{\\alpha+\\beta}$), any dead walker clones with probability 1:\n6079: \n6080: $$\n6081: i \\in \\mathcal{D}(S) \\implies p_i = 1",
      "metadata": {
        "label": "lem-dead-walker-clone-prob"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "6073: :::\n6074: \n6075: :::{prf:lemma} Total Cloning Probability for Dead Walkers\n6076: :label: lem-dead-walker-clone-prob\n6077: \n6078: Under the Axiom of Guaranteed Revival ($\\varepsilon_{\\text{clone}} \\cdot p_{\\max} < \\eta^{\\alpha+\\beta}$), any dead walker clones with probability 1:\n6079: \n6080: $$\n6081: i \\in \\mathcal{D}(S) \\implies p_i = 1\n6082: $$"
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-dead-walker-clone-prob",
      "title": null,
      "start_line": 6084,
      "end_line": 6100,
      "header_lines": [
        6085
      ],
      "content_start": 6087,
      "content_end": 6099,
      "content": "6087: :label: proof-lem-dead-walker-clone-prob\n6088: \n6089: For a dead walker $i$, the fitness potential is $V_{\\text{fit},i} = 0$. Any alive companion $c_i$ has $V_{\\text{fit},c_i} \\geq \\eta^{\\alpha+\\beta}$ by {prf:ref}`lem-potential-bounds`.\n6090: \n6091: The cloning score is:\n6092: \n6093: $$\n6094: S_i = \\frac{V_{\\text{fit},c_i} - 0}{0 + \\varepsilon_{\\text{clone}}} = \\frac{V_{\\text{fit},c_i}}{\\varepsilon_{\\text{clone}}} \\geq \\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}}\n6095: $$\n6096: \n6097: By the revival axiom: $\\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}} > p_{\\max}$\n6098: \n6099: Since $T_i \\in [0, p_{\\max}]$, we have $S_i > T_i$ with probability 1.",
      "metadata": {
        "label": "proof-lem-dead-walker-clone-prob"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "lem-potential-bounds"
      ],
      "raw_directive": "6084: :::\n6085: \n6086: :::{prf:proof}\n6087: :label: proof-lem-dead-walker-clone-prob\n6088: \n6089: For a dead walker $i$, the fitness potential is $V_{\\text{fit},i} = 0$. Any alive companion $c_i$ has $V_{\\text{fit},c_i} \\geq \\eta^{\\alpha+\\beta}$ by {prf:ref}`lem-potential-bounds`.\n6090: \n6091: The cloning score is:\n6092: \n6093: $$\n6094: S_i = \\frac{V_{\\text{fit},c_i} - 0}{0 + \\varepsilon_{\\text{clone}}} = \\frac{V_{\\text{fit},c_i}}{\\varepsilon_{\\text{clone}}} \\geq \\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}}\n6095: $$\n6096: \n6097: By the revival axiom: $\\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}} > p_{\\max}$\n6098: \n6099: Since $T_i \\in [0, p_{\\max}]$, we have $S_i > T_i$ with probability 1.\n6100: "
    },
    {
      "directive_type": "definition",
      "label": "def-update-operator",
      "title": "The State Update Operator",
      "start_line": 6106,
      "end_line": 6198,
      "header_lines": [
        6107
      ],
      "content_start": 6109,
      "content_end": 6197,
      "content": "6109: :label: def-update-operator\n6110: \n6111: The state update operator implements the inelastic collision model (see {prf:ref}`def-inelastic-collision-update`) to update walker states after cloning decisions.\n6112: \n6113: **Input:**\n6114: - Swarm configuration $S$\n6115: - Companion vector $\\mathbf{c}$\n6116: - Action vector $\\mathbf{a}$\n6117: \n6118: **Deterministic Grouping:**\n6119: \n6120: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6121: \n6122: $$\n6123: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6124: $$\n6125: \n6126: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6127: \n6128: **Stochastic State Update:**\n6129: \n6130: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6131: \n6132: 1. **Position Updates:**\n6133: \n6134:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6135: \n6136: \n6137: $$\n6138: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6139: $$\n6140: \n6141: \n6142:    Companion position is unchanged: $x'_j = x_j$\n6143: \n6144: 2. **Velocity Updates (The Inelastic Collision):**\n6145: \n6146:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6147: \n6148:    **a. Center-of-Mass Velocity:**\n6149: \n6150: \n6151: $$\n6152: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6153: $$\n6154: \n6155: \n6156:    **b. Update Relative Velocities:**\n6157: \n6158:    For each walker $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6159: \n6160: \n6161: $$\n6162: u_k = v_k - V_{\\text{COM},j}\n6163: $$\n6164: \n6165: \n6166:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6167: \n6168: \n6169: $$\n6170: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6171: $$\n6172: \n6173: \n6174:    **c. Return to Lab Frame:**\n6175: \n6176: \n6177: $$\n6178: v'_k = V_{\\text{COM},j} + u'_k\n6179: $$\n6180: \n6181: 3. **Persisting Walkers:**\n6182: \n6183:    For walkers with $a_i = \\text{persist}$:\n6184: \n6185: \n6186: $$\n6187: x'_i = x_i, \\quad v'_i = v_i\n6188: $$\n6189: \n6190: 4. **Status Update:**\n6191: \n6192:    All walkers in the output are alive:\n6193: \n6194: \n6195: $$\n6196: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6197: $$",
      "metadata": {
        "label": "def-update-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-inelastic-collision-update"
      ],
      "raw_directive": "6106: The final stage executes the cloning actions, producing the output swarm configuration.\n6107: \n6108: :::{prf:definition} The State Update Operator\n6109: :label: def-update-operator\n6110: \n6111: The state update operator implements the inelastic collision model (see {prf:ref}`def-inelastic-collision-update`) to update walker states after cloning decisions.\n6112: \n6113: **Input:**\n6114: - Swarm configuration $S$\n6115: - Companion vector $\\mathbf{c}$\n6116: - Action vector $\\mathbf{a}$\n6117: \n6118: **Deterministic Grouping:**\n6119: \n6120: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6121: \n6122: $$\n6123: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6124: $$\n6125: \n6126: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6127: \n6128: **Stochastic State Update:**\n6129: \n6130: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6131: \n6132: 1. **Position Updates:**\n6133: \n6134:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6135: \n6136: \n6137: $$\n6138: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6139: $$\n6140: \n6141: \n6142:    Companion position is unchanged: $x'_j = x_j$\n6143: \n6144: 2. **Velocity Updates (The Inelastic Collision):**\n6145: \n6146:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6147: \n6148:    **a. Center-of-Mass Velocity:**\n6149: \n6150: \n6151: $$\n6152: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6153: $$\n6154: \n6155: \n6156:    **b. Update Relative Velocities:**\n6157: \n6158:    For each walker $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6159: \n6160: \n6161: $$\n6162: u_k = v_k - V_{\\text{COM},j}\n6163: $$\n6164: \n6165: \n6166:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6167: \n6168: \n6169: $$\n6170: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6171: $$\n6172: \n6173: \n6174:    **c. Return to Lab Frame:**\n6175: \n6176: \n6177: $$\n6178: v'_k = V_{\\text{COM},j} + u'_k\n6179: $$\n6180: \n6181: 3. **Persisting Walkers:**\n6182: \n6183:    For walkers with $a_i = \\text{persist}$:\n6184: \n6185: \n6186: $$\n6187: x'_i = x_i, \\quad v'_i = v_i\n6188: $$\n6189: \n6190: 4. **Status Update:**\n6191: \n6192:    All walkers in the output are alive:\n6193: \n6194: \n6195: $$\n6196: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6197: $$\n6198: "
    },
    {
      "directive_type": "remark",
      "label": "rem-position-velocity-update-difference",
      "title": "Position Jitter vs. Velocity Collision Model",
      "start_line": 6200,
      "end_line": 6214,
      "header_lines": [
        6201
      ],
      "content_start": 6203,
      "content_end": 6213,
      "content": "6203: :label: rem-position-velocity-update-difference\n6204: \n6205: The cloning operator treats positions and velocities asymmetrically:\n6206: \n6207: 1. **Position:** Stochastic Gaussian jitter with variance $\\sigma_x^2$ breaks spatial correlations between swarms in the drift analysis.\n6208: \n6209: 2. **Velocity:** Deterministic inelastic collision model (with random rotation) conserves momentum and provides controlled energy dissipation via $\\alpha_{\\text{restitution}}$.\n6210: \n6211: This design choice has important implications:\n6212: \n6213: - **Positional desynchronization** comes from explicit Gaussian noise $\\mathcal{N}(0, \\sigma_x^2 I_d)$",
      "metadata": {
        "label": "rem-position-velocity-update-difference"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "6200: :::\n6201: \n6202: :::{prf:remark} Position Jitter vs. Velocity Collision Model\n6203: :label: rem-position-velocity-update-difference\n6204: \n6205: The cloning operator treats positions and velocities asymmetrically:\n6206: \n6207: 1. **Position:** Stochastic Gaussian jitter with variance $\\sigma_x^2$ breaks spatial correlations between swarms in the drift analysis.\n6208: \n6209: 2. **Velocity:** Deterministic inelastic collision model (with random rotation) conserves momentum and provides controlled energy dissipation via $\\alpha_{\\text{restitution}}$.\n6210: \n6211: This design choice has important implications:\n6212: \n6213: - **Positional desynchronization** comes from explicit Gaussian noise $\\mathcal{N}(0, \\sigma_x^2 I_d)$\n6214: - **Velocity desynchronization** comes from the random rotations $R_k$ in the collision model, which randomize velocity directions while preserving or reducing magnitudes"
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}