{
  "chapter_index": 11,
  "section_id": "## 9.3. Decomposition into Sub-Operators",
  "directive_count": 8,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-measurement-operator",
      "title": "The Measurement Operator",
      "start_line": 5853,
      "end_line": 5885,
      "header_lines": [
        5854
      ],
      "content_start": 5856,
      "content_end": 5884,
      "content": "5856: :label: def-measurement-operator\n5857: \n5858: For input swarm $S$ with alive set $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5859: \n5860: **Input:** Swarm configuration $S$\n5861: \n5862: **Stochastic Process:**\n5863: \n5864: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5865: \n5866: \n5867: $$\n5868: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5869: $$\n5870: \n5871: 2. **Raw Distance Vector:** For each alive walker $i \\in \\mathcal{A}(S)$, compute:\n5872: \n5873: \n5874: $$\n5875: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5876: $$\n5877: \n5878: \n5879:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5880: \n5881: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5882: \n5883: **Key Properties:**\n5884: - The pairing $\\pi$ is sampled once per swarm, creating correlations between measurements",
      "metadata": {
        "label": "def-measurement-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "def-standardization-operator"
      ],
      "raw_directive": "5853: The first stage generates the stochastic diversity measurements that form the foundation of the fitness evaluation.\n5854: \n5855: :::{prf:definition} The Measurement Operator\n5856: :label: def-measurement-operator\n5857: \n5858: For input swarm $S$ with alive set $\\mathcal{A}(S)$ of size $k = |\\mathcal{A}(S)|$:\n5859: \n5860: **Input:** Swarm configuration $S$\n5861: \n5862: **Stochastic Process:**\n5863: \n5864: 1. **Companion Pairing:** Sample a pairing $\\pi: \\mathcal{A}(S) \\to \\mathcal{A}(S)$ from the spatially-aware random pairing distribution ({prf:ref}`def-standardization-operator`):\n5865: \n5866: \n5867: $$\n5868: \\pi \\sim P_{\\text{pair}}(S, \\cdot)\n5869: $$\n5870: \n5871: 2. **Raw Distance Vector:** For each alive walker $i \\in \\mathcal{A}(S)$, compute:\n5872: \n5873: \n5874: $$\n5875: d_i = d_{\\text{alg}}(x_i, x_{\\pi(i)})\n5876: $$\n5877: \n5878: \n5879:    For dead walkers $i \\notin \\mathcal{A}(S)$, set $d_i = 0$ deterministically.\n5880: \n5881: **Output:** The $N$-dimensional raw distance vector $\\mathbf{d} = (d_1, \\ldots, d_N) \\in \\mathbb{R}^N_{\\geq 0}$\n5882: \n5883: **Key Properties:**\n5884: - The pairing $\\pi$ is sampled once per swarm, creating correlations between measurements\n5885: - The distribution of $\\mathbf{d}$ depends only on $S$ and the algorithmic parameters $(\\epsilon_p, \\ell_p)$"
    },
    {
      "directive_type": "remark",
      "label": "rem-measurement-coupling",
      "title": "Stochastic Coupling for Drift Analysis",
      "start_line": 5887,
      "end_line": 5894,
      "header_lines": [
        5888
      ],
      "content_start": 5890,
      "content_end": 5893,
      "content": "5890: :label: rem-measurement-coupling\n5891: \n5892: When analyzing two swarms $(S_1, S_2)$ in the drift analysis (Chapters 10-11), we use **synchronous coupling** of the randomness:\n5893: - The same random pairing algorithm is applied to both swarms",
      "metadata": {
        "label": "rem-measurement-coupling"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "5887: :::\n5888: \n5889: :::{prf:remark} Stochastic Coupling for Drift Analysis\n5890: :label: rem-measurement-coupling\n5891: \n5892: When analyzing two swarms $(S_1, S_2)$ in the drift analysis (Chapters 10-11), we use **synchronous coupling** of the randomness:\n5893: - The same random pairing algorithm is applied to both swarms\n5894: - The PRNG streams are coupled so that walker $i$ in swarm 1 and walker $i$ in swarm 2 use the same random seed"
    },
    {
      "directive_type": "definition",
      "label": "def-fitness-operator",
      "title": "The Fitness Evaluation Operator",
      "start_line": 5900,
      "end_line": 5971,
      "header_lines": [
        5901
      ],
      "content_start": 5903,
      "content_end": 5970,
      "content": "5903: :label: def-fitness-operator\n5904: \n5905: **Input:**\n5906: - Swarm configuration $S$\n5907: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5908: \n5909: **Deterministic Computation:**\n5910: \n5911: 1. **Boundary Proximity:** For each walker $i$, compute:\n5912: \n5913: \n5914: $$\n5915: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5916: $$\n5917: \n5918:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5919: \n5920: 2. **Rescaling:** Apply the rescale function with floor $\\eta > 0$:\n5921: \n5922: \n5923: $$\n5924: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5925: $$\n5926: \n5927: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5928: \n5929: \n5930: $$\n5931: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5932: $$\n5933: \n5934: \n5935: \n5936: $$\n5937: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5938: $$\n5939: \n5940: \n5941:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5942: \n5943: \n5944: $$\n5945: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5946: $$\n5947: \n5948: \n5949:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5950: \n5951: 4. **Fitness Potential:** For each walker $i$, compute:\n5952: \n5953:    a. Apply the Rescale Function $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5954:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5955:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5956: \n5957:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n5958: \n5959: \n5960: $$\n5961: V_{\\text{fit},i} = \\begin{cases}\n5962:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n5963:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n5964:       \\end{cases}\n5965: $$\n5966: \n5967: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n5968: \n5969: **Key Properties:**\n5970: - The operator is deterministic given $S$ and $\\mathbf{d}$",
      "metadata": {
        "label": "def-fitness-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "lem-potential-bounds"
      ],
      "raw_directive": "5900: This deterministic operator transforms raw measurements into fitness potentials.\n5901: \n5902: :::{prf:definition} The Fitness Evaluation Operator\n5903: :label: def-fitness-operator\n5904: \n5905: **Input:**\n5906: - Swarm configuration $S$\n5907: - Raw distance vector $\\mathbf{d} \\in \\mathbb{R}^N_{\\geq 0}$\n5908: \n5909: **Deterministic Computation:**\n5910: \n5911: 1. **Boundary Proximity:** For each walker $i$, compute:\n5912: \n5913: \n5914: $$\n5915: r_i = g_A(x_i) = \\varphi_{\\text{barrier}}(x_i)\n5916: $$\n5917: \n5918:    yielding the raw reward vector $\\mathbf{r} = (r_1, \\ldots, r_N)$.\n5919: \n5920: 2. **Rescaling:** Apply the rescale function with floor $\\eta > 0$:\n5921: \n5922: \n5923: $$\n5924: \\tilde{d}_i = d_i + \\eta, \\quad \\tilde{r}_i = r_i + \\eta\n5925: $$\n5926: \n5927: 3. **Z-Score Normalization:** Compute empirical means and standard deviations over **alive walkers only**:\n5928: \n5929: \n5930: $$\n5931: \\bar{d} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{d}_i, \\quad \\sigma_d = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{d}_i - \\bar{d})^2}\n5932: $$\n5933: \n5934: \n5935: \n5936: $$\n5937: \\bar{r} = \\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} \\tilde{r}_i, \\quad \\sigma_r = \\sqrt{\\frac{1}{k}\\sum_{i \\in \\mathcal{A}(S)} (\\tilde{r}_i - \\bar{r})^2}\n5938: $$\n5939: \n5940: \n5941:    For alive walkers $i \\in \\mathcal{A}(S)$:\n5942: \n5943: \n5944: $$\n5945: z_{d,i} = \\frac{\\tilde{d}_i - \\bar{d}}{\\sigma_d + \\sigma_{\\text{stab}}}, \\quad z_{r,i} = \\frac{\\tilde{r}_i - \\bar{r}}{\\sigma_r + \\sigma_{\\text{stab}}}\n5946: $$\n5947: \n5948: \n5949:    For dead walkers, set $z_{d,i} = z_{r,i} = 0$.\n5950: \n5951: 4. **Fitness Potential:** For each walker $i$, compute:\n5952: \n5953:    a. Apply the Rescale Function $g_A$ and add the floor $\\eta$ to create the rescaled components:\n5954:       - $r'_i := g_A(z_{r,i}) + \\eta$\n5955:       - $d'_i := g_A(z_{d,i}) + \\eta$\n5956: \n5957:    b. Combine the components using the dynamics weights $\\alpha$ and $\\beta$:\n5958: \n5959: \n5960: $$\n5961: V_{\\text{fit},i} = \\begin{cases}\n5962:       (d'_i)^{\\beta} \\cdot (r'_i)^{\\alpha} & \\text{if } i \\in \\mathcal{A}(S) \\\\\n5963:       0 & \\text{if } i \\notin \\mathcal{A}(S)\n5964:       \\end{cases}\n5965: $$\n5966: \n5967: **Output:** The fitness potential vector $\\mathbf{V}_{\\text{fit}} = (V_{\\text{fit},1}, \\ldots, V_{\\text{fit},N}) \\in \\mathbb{R}^N_{\\geq 0}$\n5968: \n5969: **Key Properties:**\n5970: - The operator is deterministic given $S$ and $\\mathbf{d}$\n5971: - Bounded: $V_{\\text{fit},i} \\in [0, V_{\\text{pot,max}}]$ for alive walkers, where $V_{\\text{pot,max}} = (g_{A,\\max} + \\eta)^{\\alpha+\\beta}$"
    },
    {
      "directive_type": "definition",
      "label": "def-decision-operator",
      "title": "The Cloning Decision Operator",
      "start_line": 5977,
      "end_line": 6029,
      "header_lines": [
        5978
      ],
      "content_start": 5980,
      "content_end": 6028,
      "content": "5980: :label: def-decision-operator\n5981: \n5982: **Input:**\n5983: - Swarm configuration $S$\n5984: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n5985: \n5986: **Stochastic Process:**\n5987: \n5988: For each walker $i \\in \\{1, \\ldots, N\\}$:\n5989: \n5990: 1. **Companion Selection:**\n5991: \n5992:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n5993: \n5994: \n5995: $$\n5996: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n5997: $$\n5998: \n5999: \n6000:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6001: \n6002: \n6003: $$\n6004: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6005: $$\n6006: \n6007: 2. **Cloning Score:** Compute the score based on fitness difference:\n6008: \n6009: \n6010: $$\n6011: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6012: $$\n6013: \n6014: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6015: \n6016:    Walker $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6017: \n6018: **Output:**\n6019: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6020: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6021: \n6022: **Total Cloning Probability:**\n6023: \n6024: The key quantity for drift analysis is the **total probability** that walker $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6025: \n6026: $$\n6027: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6028: $$",
      "metadata": {
        "label": "def-decision-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "lem-quantitative-keystone"
      ],
      "raw_directive": "5977: This stochastic operator determines which walkers will clone and which will persist.\n5978: \n5979: :::{prf:definition} The Cloning Decision Operator\n5980: :label: def-decision-operator\n5981: \n5982: **Input:**\n5983: - Swarm configuration $S$\n5984: - Fitness potential vector $\\mathbf{V}_{\\text{fit}}$\n5985: \n5986: **Stochastic Process:**\n5987: \n5988: For each walker $i \\in \\{1, \\ldots, N\\}$:\n5989: \n5990: 1. **Companion Selection:**\n5991: \n5992:    - If $i \\in \\mathcal{A}(S)$ (alive): Sample companion $c_i$ from the softmax distribution over other alive walkers:\n5993: \n5994: \n5995: $$\n5996: P(c_i = j) = \\frac{\\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_j)^2}{2\\epsilon_c^2}\\right)}{\\sum_{\\ell \\in \\mathcal{A}(S) \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}(x_i, x_\\ell)^2}{2\\epsilon_c^2}\\right)} \\quad \\text{for } j \\in \\mathcal{A}(S) \\setminus \\{i\\}\n5997: $$\n5998: \n5999: \n6000:    - If $i \\in \\mathcal{D}(S)$ (dead): Sample companion uniformly from all alive walkers:\n6001: \n6002: \n6003: $$\n6004: P(c_i = j) = \\frac{1}{k} \\quad \\text{for all } j \\in \\mathcal{A}(S)\n6005: $$\n6006: \n6007: 2. **Cloning Score:** Compute the score based on fitness difference:\n6008: \n6009: \n6010: $$\n6011: S_i = \\frac{V_{\\text{fit},c_i} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n6012: $$\n6013: \n6014: 3. **Stochastic Decision:** Sample threshold $T_i \\sim \\text{Uniform}(0, p_{\\max})$ independently.\n6015: \n6016:    Walker $i$ is marked for **cloning** if $S_i > T_i$, otherwise marked to **persist**.\n6017: \n6018: **Output:**\n6019: - Companion assignment vector $\\mathbf{c} = (c_1, \\ldots, c_N)$\n6020: - Binary action vector $\\mathbf{a} = (a_1, \\ldots, a_N)$ where $a_i \\in \\{\\text{clone}, \\text{persist}\\}$\n6021: \n6022: **Total Cloning Probability:**\n6023: \n6024: The key quantity for drift analysis is the **total probability** that walker $i$ clones, averaging over all randomness in companion selection and threshold sampling:\n6025: \n6026: $$\n6027: p_i := P(\\text{walker } i \\text{ clones} \\mid S, \\mathbf{V}_{\\text{fit}})\n6028: $$\n6029: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-dead-walker-clone-prob",
      "title": "Total Cloning Probability for Dead Walkers",
      "start_line": 6031,
      "end_line": 6040,
      "header_lines": [
        6032
      ],
      "content_start": 6034,
      "content_end": 6039,
      "content": "6034: :label: lem-dead-walker-clone-prob\n6035: \n6036: Under the Axiom of Guaranteed Revival ($\\varepsilon_{\\text{clone}} \\cdot p_{\\max} < \\eta^{\\alpha+\\beta}$), any dead walker clones with probability 1:\n6037: \n6038: $$\n6039: i \\in \\mathcal{D}(S) \\implies p_i = 1",
      "metadata": {
        "label": "lem-dead-walker-clone-prob"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "6031: :::\n6032: \n6033: :::{prf:lemma} Total Cloning Probability for Dead Walkers\n6034: :label: lem-dead-walker-clone-prob\n6035: \n6036: Under the Axiom of Guaranteed Revival ($\\varepsilon_{\\text{clone}} \\cdot p_{\\max} < \\eta^{\\alpha+\\beta}$), any dead walker clones with probability 1:\n6037: \n6038: $$\n6039: i \\in \\mathcal{D}(S) \\implies p_i = 1\n6040: $$"
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-dead-walker-clone-prob",
      "title": null,
      "start_line": 6042,
      "end_line": 6058,
      "header_lines": [
        6043
      ],
      "content_start": 6045,
      "content_end": 6057,
      "content": "6045: :label: proof-lem-dead-walker-clone-prob\n6046: \n6047: For a dead walker $i$, the fitness potential is $V_{\\text{fit},i} = 0$. Any alive companion $c_i$ has $V_{\\text{fit},c_i} \\geq \\eta^{\\alpha+\\beta}$ by {prf:ref}`lem-potential-bounds`.\n6048: \n6049: The cloning score is:\n6050: \n6051: $$\n6052: S_i = \\frac{V_{\\text{fit},c_i} - 0}{0 + \\varepsilon_{\\text{clone}}} = \\frac{V_{\\text{fit},c_i}}{\\varepsilon_{\\text{clone}}} \\geq \\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}}\n6053: $$\n6054: \n6055: By the revival axiom: $\\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}} > p_{\\max}$\n6056: \n6057: Since $T_i \\in [0, p_{\\max}]$, we have $S_i > T_i$ with probability 1.",
      "metadata": {
        "label": "proof-lem-dead-walker-clone-prob"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [
        "lem-potential-bounds"
      ],
      "raw_directive": "6042: :::\n6043: \n6044: :::{prf:proof}\n6045: :label: proof-lem-dead-walker-clone-prob\n6046: \n6047: For a dead walker $i$, the fitness potential is $V_{\\text{fit},i} = 0$. Any alive companion $c_i$ has $V_{\\text{fit},c_i} \\geq \\eta^{\\alpha+\\beta}$ by {prf:ref}`lem-potential-bounds`.\n6048: \n6049: The cloning score is:\n6050: \n6051: $$\n6052: S_i = \\frac{V_{\\text{fit},c_i} - 0}{0 + \\varepsilon_{\\text{clone}}} = \\frac{V_{\\text{fit},c_i}}{\\varepsilon_{\\text{clone}}} \\geq \\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}}\n6053: $$\n6054: \n6055: By the revival axiom: $\\frac{\\eta^{\\alpha+\\beta}}{\\varepsilon_{\\text{clone}}} > p_{\\max}$\n6056: \n6057: Since $T_i \\in [0, p_{\\max}]$, we have $S_i > T_i$ with probability 1.\n6058: "
    },
    {
      "directive_type": "definition",
      "label": "def-update-operator",
      "title": "The State Update Operator",
      "start_line": 6064,
      "end_line": 6154,
      "header_lines": [
        6065
      ],
      "content_start": 6067,
      "content_end": 6153,
      "content": "6067: :label: def-update-operator\n6068: \n6069: **Input:**\n6070: - Swarm configuration $S$\n6071: - Companion vector $\\mathbf{c}$\n6072: - Action vector $\\mathbf{a}$\n6073: \n6074: **Deterministic Grouping:**\n6075: \n6076: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6077: \n6078: $$\n6079: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6080: $$\n6081: \n6082: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6083: \n6084: **Stochastic State Update:**\n6085: \n6086: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6087: \n6088: 1. **Position Updates:**\n6089: \n6090:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6091: \n6092: \n6093: $$\n6094: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6095: $$\n6096: \n6097: \n6098:    Companion position is unchanged: $x'_j = x_j$\n6099: \n6100: 2. **Velocity Updates (The Inelastic Collision):**\n6101: \n6102:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6103: \n6104:    **a. Center-of-Mass Velocity:**\n6105: \n6106: \n6107: $$\n6108: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6109: $$\n6110: \n6111: \n6112:    **b. Update Relative Velocities:**\n6113: \n6114:    For each walker $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6115: \n6116: \n6117: $$\n6118: u_k = v_k - V_{\\text{COM},j}\n6119: $$\n6120: \n6121: \n6122:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6123: \n6124: \n6125: $$\n6126: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6127: $$\n6128: \n6129: \n6130:    **c. Return to Lab Frame:**\n6131: \n6132: \n6133: $$\n6134: v'_k = V_{\\text{COM},j} + u'_k\n6135: $$\n6136: \n6137: 3. **Persisting Walkers:**\n6138: \n6139:    For walkers with $a_i = \\text{persist}$:\n6140: \n6141: \n6142: $$\n6143: x'_i = x_i, \\quad v'_i = v_i\n6144: $$\n6145: \n6146: 4. **Status Update:**\n6147: \n6148:    All walkers in the output are alive:\n6149: \n6150: \n6151: $$\n6152: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6153: $$",
      "metadata": {
        "label": "def-update-operator"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "6064: The final stage executes the cloning actions, producing the output swarm configuration.\n6065: \n6066: :::{prf:definition} The State Update Operator\n6067: :label: def-update-operator\n6068: \n6069: **Input:**\n6070: - Swarm configuration $S$\n6071: - Companion vector $\\mathbf{c}$\n6072: - Action vector $\\mathbf{a}$\n6073: \n6074: **Deterministic Grouping:**\n6075: \n6076: For each unique companion $j \\in \\mathcal{A}(S)$, identify all walkers cloning from it:\n6077: \n6078: $$\n6079: I_j := \\{i \\in \\{1, \\ldots, N\\} : a_i = \\text{clone} \\text{ and } c_i = j\\}\n6080: $$\n6081: \n6082: Let $M_j = |I_j|$ be the number of cloners for companion $j$.\n6083: \n6084: **Stochastic State Update:**\n6085: \n6086: For each $(M_j + 1)$-particle system consisting of companion $j$ and its cloners $I_j$:\n6087: \n6088: 1. **Position Updates:**\n6089: \n6090:    For each cloner $i \\in I_j$, the position is reset to the companion's position plus **Gaussian jitter**:\n6091: \n6092: \n6093: $$\n6094: x'_i = x_j + \\sigma_x \\zeta_i^x \\quad \\text{where } \\zeta_i^x \\sim \\mathcal{N}(0, I_d)\n6095: $$\n6096: \n6097: \n6098:    Companion position is unchanged: $x'_j = x_j$\n6099: \n6100: 2. **Velocity Updates (The Inelastic Collision):**\n6101: \n6102:    The velocities are updated through a momentum-conserving inelastic collision model. **There is NO Gaussian jitter added to velocities.**\n6103: \n6104:    **a. Center-of-Mass Velocity:**\n6105: \n6106: \n6107: $$\n6108: V_{\\text{COM},j} = \\frac{1}{M_j + 1}\\left(v_j + \\sum_{i \\in I_j} v_i\\right)\n6109: $$\n6110: \n6111: \n6112:    **b. Update Relative Velocities:**\n6113: \n6114:    For each walker $k \\in I_j \\cup \\{j\\}$, compute the relative velocity:\n6115: \n6116: \n6117: $$\n6118: u_k = v_k - V_{\\text{COM},j}\n6119: $$\n6120: \n6121: \n6122:    Sample a random orthogonal transformation $R_k$ that isotropically rotates $u_k$ (uniformly random direction on the $(d-1)$-sphere, preserving magnitude). The new relative velocity is:\n6123: \n6124: \n6125: $$\n6126: u'_k = \\alpha_{\\text{restitution}} \\cdot R_k(u_k)\n6127: $$\n6128: \n6129: \n6130:    **c. Return to Lab Frame:**\n6131: \n6132: \n6133: $$\n6134: v'_k = V_{\\text{COM},j} + u'_k\n6135: $$\n6136: \n6137: 3. **Persisting Walkers:**\n6138: \n6139:    For walkers with $a_i = \\text{persist}$:\n6140: \n6141: \n6142: $$\n6143: x'_i = x_i, \\quad v'_i = v_i\n6144: $$\n6145: \n6146: 4. **Status Update:**\n6147: \n6148:    All walkers in the output are alive:\n6149: \n6150: \n6151: $$\n6152: s'_i = 1 \\quad \\text{for all } i \\in \\{1, \\ldots, N\\}\n6153: $$\n6154: "
    },
    {
      "directive_type": "remark",
      "label": "rem-position-velocity-update-difference",
      "title": "Position Jitter vs. Velocity Collision Model",
      "start_line": 6156,
      "end_line": 6170,
      "header_lines": [
        6157
      ],
      "content_start": 6159,
      "content_end": 6169,
      "content": "6159: :label: rem-position-velocity-update-difference\n6160: \n6161: The cloning operator treats positions and velocities asymmetrically:\n6162: \n6163: 1. **Position:** Stochastic Gaussian jitter with variance $\\sigma_x^2$ breaks spatial correlations between swarms in the drift analysis.\n6164: \n6165: 2. **Velocity:** Deterministic inelastic collision model (with random rotation) conserves momentum and provides controlled energy dissipation via $\\alpha_{\\text{restitution}}$.\n6166: \n6167: This design choice has important implications:\n6168: \n6169: - **Positional desynchronization** comes from explicit Gaussian noise $\\mathcal{N}(0, \\sigma_x^2 I_d)$",
      "metadata": {
        "label": "rem-position-velocity-update-difference"
      },
      "section": "## 9.3. Decomposition into Sub-Operators",
      "references": [],
      "raw_directive": "6156: :::\n6157: \n6158: :::{prf:remark} Position Jitter vs. Velocity Collision Model\n6159: :label: rem-position-velocity-update-difference\n6160: \n6161: The cloning operator treats positions and velocities asymmetrically:\n6162: \n6163: 1. **Position:** Stochastic Gaussian jitter with variance $\\sigma_x^2$ breaks spatial correlations between swarms in the drift analysis.\n6164: \n6165: 2. **Velocity:** Deterministic inelastic collision model (with random rotation) conserves momentum and provides controlled energy dissipation via $\\alpha_{\\text{restitution}}$.\n6166: \n6167: This design choice has important implications:\n6168: \n6169: - **Positional desynchronization** comes from explicit Gaussian noise $\\mathcal{N}(0, \\sigma_x^2 I_d)$\n6170: - **Velocity desynchronization** comes from the random rotations $R_k$ in the collision model, which randomize velocity directions while preserving or reducing magnitudes"
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}