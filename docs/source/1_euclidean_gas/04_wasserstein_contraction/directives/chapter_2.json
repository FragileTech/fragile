{
  "chapter_index": 2,
  "section_id": "## 2. Cluster-Preserving Coupling",
  "directive_count": 5,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-target-complement",
      "title": "Target Set and Complement",
      "start_line": 144,
      "end_line": 179,
      "header_lines": [
        145
      ],
      "content_start": 147,
      "content_end": 178,
      "content": "147: :label: def-target-complement\n148: \n149: For a swarm $S_k$ with alive set $\\mathcal{A}_k$, define:\n150: \n151: **Target Set** (from [03_cloning](03_cloning), Section 8.2):\n152: \n153: $$\n154: I_k(\\varepsilon) := U_k \\cap H_k(\\varepsilon)\n155: \n156: $$\n157: where:\n158: - $U_k$ is the unfit set (Definition 7.6.1.0, line 4499): walkers with fitness $\\leq$ mean\n159: - $H_k(\\varepsilon)$ is the unified high-error set (Definition 6.3, line 2351): outlier clusters in phase space\n160: \n161: **Complement Set**:\n162: \n163: $$\n164: J_k(\\varepsilon) := \\mathcal{A}_k \\setminus I_k(\\varepsilon)\n165: \n166: $$\n167: \n168: **Population fractions**:\n169: \n170: $$\n171: f_I(\\varepsilon) := \\frac{|I_k|}{k}, \\quad f_J(\\varepsilon) := \\frac{|J_k|}{k} = 1 - f_I(\\varepsilon)\n172: \n173: $$\n174: \n175: **Guaranteed lower bound** (Theorem 7.6.1, line 4572):\n176: \n177: $$\n178: f_I(\\varepsilon) \\geq f_{UH}(\\varepsilon) > 0 \\quad \\text{(N-uniform)}",
      "metadata": {
        "label": "def-target-complement"
      },
      "section": "## 2. Cluster-Preserving Coupling",
      "raw_directive": "144: We first recall the cluster-based partition from [03_cloning](03_cloning).\n145: \n146: :::{prf:definition} Target Set and Complement\n147: :label: def-target-complement\n148: \n149: For a swarm $S_k$ with alive set $\\mathcal{A}_k$, define:\n150: \n151: **Target Set** (from [03_cloning](03_cloning), Section 8.2):\n152: \n153: $$\n154: I_k(\\varepsilon) := U_k \\cap H_k(\\varepsilon)\n155: \n156: $$\n157: where:\n158: - $U_k$ is the unfit set (Definition 7.6.1.0, line 4499): walkers with fitness $\\leq$ mean\n159: - $H_k(\\varepsilon)$ is the unified high-error set (Definition 6.3, line 2351): outlier clusters in phase space\n160: \n161: **Complement Set**:\n162: \n163: $$\n164: J_k(\\varepsilon) := \\mathcal{A}_k \\setminus I_k(\\varepsilon)\n165: \n166: $$\n167: \n168: **Population fractions**:\n169: \n170: $$\n171: f_I(\\varepsilon) := \\frac{|I_k|}{k}, \\quad f_J(\\varepsilon) := \\frac{|J_k|}{k} = 1 - f_I(\\varepsilon)\n172: \n173: $$\n174: \n175: **Guaranteed lower bound** (Theorem 7.6.1, line 4572):\n176: \n177: $$\n178: f_I(\\varepsilon) \\geq f_{UH}(\\varepsilon) > 0 \\quad \\text{(N-uniform)}\n179: "
    },
    {
      "directive_type": "remark",
      "label": "rem-why-target-sets",
      "title": "Why These Sets?",
      "start_line": 181,
      "end_line": 193,
      "header_lines": [
        182
      ],
      "content_start": 184,
      "content_end": 192,
      "content": "184: :label: rem-why-target-sets\n185: \n186: The target set $I_k$ represents the walkers that are:\n187: 1. **Unfit** ($U_k$): Lower than average fitness \u2192 high cloning probability\n188: 2. **High-error** ($H_k$): Geometrically outliers \u2192 contribute to structural error\n189: \n190: By Theorem 7.6.1 ([03_cloning](03_cloning), Section 7.6.2), the Stability Condition guarantees a **non-vanishing overlap** between these sets. This is the crucial population that:\n191: - Is **targeted** by the cloning mechanism (unfit)\n192: - **Causes** the structural error (high-error)",
      "metadata": {
        "label": "rem-why-target-sets"
      },
      "section": "## 2. Cluster-Preserving Coupling",
      "raw_directive": "181: :::\n182: \n183: :::{prf:remark} Why These Sets?\n184: :label: rem-why-target-sets\n185: \n186: The target set $I_k$ represents the walkers that are:\n187: 1. **Unfit** ($U_k$): Lower than average fitness \u2192 high cloning probability\n188: 2. **High-error** ($H_k$): Geometrically outliers \u2192 contribute to structural error\n189: \n190: By Theorem 7.6.1 ([03_cloning](03_cloning), Section 7.6.2), the Stability Condition guarantees a **non-vanishing overlap** between these sets. This is the crucial population that:\n191: - Is **targeted** by the cloning mechanism (unfit)\n192: - **Causes** the structural error (high-error)\n193: "
    },
    {
      "directive_type": "remark",
      "label": "rem-empirical-measures",
      "title": "Empirical Measures and Framework Properties",
      "start_line": 195,
      "end_line": 212,
      "header_lines": [
        196
      ],
      "content_start": 198,
      "content_end": 211,
      "content": "198: :label: rem-empirical-measures\n199: \n200: **Notational Precision**: This document analyzes the $N$-particle empirical measures $\\mu_1, \\mu_2$, which are discrete probability measures supported on $N$ walkers. The clustering algorithm, fitness function $F(x)$, and potential landscape are properties defined at the population level.\n201: \n202: **Relationship to Continuum Limit**: The fitness function $F(x)$ and its valley structure are properties of the continuum state space $\\mathcal{X}$, while the clusters $I_k, J_k$ are finite-sample objects constructed from the empirical distribution. The proofs in this document use properties of the limiting landscape (e.g., Confining Potential axiom, fitness valleys) to reason about finite-sample cluster behavior.\n203: \n204: **Approximation Errors**: For finite $N$, there are approximation errors $O(1/\\sqrt{N})$ when estimating continuum properties (like the potential $F(x)$) from empirical measures. These errors are absorbed into:\n205: 1. The noise term $C_W = O(d\\delta^2)$ in the contraction inequality\n206: 2. The clustering threshold $\\varepsilon$, which depends on $N$ implicitly through the error tolerance\n207: \n208: **N-Uniformity Justification**: The key result is that these finite-sample approximation errors do not affect the *sign* or *N-independence* of the contraction constant $\\kappa_W > 0$. This is because:\n209: - The clustering algorithm thresholds (Definition 6.3) are calibrated to maintain $O(1)$ cluster fractions\n210: - The framework axioms (Confining Potential, Environmental Richness) provide $O(1)$ landscape features that dominate the finite-sample noise\n211: - All critical bounds ($f_{UH}, p_u, c_{\\text{sep}}$) are proven N-uniform in [03_cloning](03_cloning) precisely to account for these approximation effects",
      "metadata": {
        "label": "rem-empirical-measures"
      },
      "section": "## 2. Cluster-Preserving Coupling",
      "raw_directive": "195: :::\n196: \n197: :::{prf:remark} Empirical Measures and Framework Properties\n198: :label: rem-empirical-measures\n199: \n200: **Notational Precision**: This document analyzes the $N$-particle empirical measures $\\mu_1, \\mu_2$, which are discrete probability measures supported on $N$ walkers. The clustering algorithm, fitness function $F(x)$, and potential landscape are properties defined at the population level.\n201: \n202: **Relationship to Continuum Limit**: The fitness function $F(x)$ and its valley structure are properties of the continuum state space $\\mathcal{X}$, while the clusters $I_k, J_k$ are finite-sample objects constructed from the empirical distribution. The proofs in this document use properties of the limiting landscape (e.g., Confining Potential axiom, fitness valleys) to reason about finite-sample cluster behavior.\n203: \n204: **Approximation Errors**: For finite $N$, there are approximation errors $O(1/\\sqrt{N})$ when estimating continuum properties (like the potential $F(x)$) from empirical measures. These errors are absorbed into:\n205: 1. The noise term $C_W = O(d\\delta^2)$ in the contraction inequality\n206: 2. The clustering threshold $\\varepsilon$, which depends on $N$ implicitly through the error tolerance\n207: \n208: **N-Uniformity Justification**: The key result is that these finite-sample approximation errors do not affect the *sign* or *N-independence* of the contraction constant $\\kappa_W > 0$. This is because:\n209: - The clustering algorithm thresholds (Definition 6.3) are calibrated to maintain $O(1)$ cluster fractions\n210: - The framework axioms (Confining Potential, Environmental Richness) provide $O(1)$ landscape features that dominate the finite-sample noise\n211: - All critical bounds ($f_{UH}, p_u, c_{\\text{sep}}$) are proven N-uniform in [03_cloning](03_cloning) precisely to account for these approximation effects\n212: "
    },
    {
      "directive_type": "definition",
      "label": "def-cluster-coupling",
      "title": "Cluster-Preserving Coupling",
      "start_line": 218,
      "end_line": 252,
      "header_lines": [
        219
      ],
      "content_start": 221,
      "content_end": 251,
      "content": "221: :label: def-cluster-coupling\n222: \n223: For two swarms $(S_1, S_2)$ with partitions $(I_1, J_1)$ and $(I_2, J_2)$, the **cluster-preserving coupling** evolves them to $(S_1', S_2')$ using the following procedure:\n224: \n225: **Step 1: Independent Cluster Partitions**\n226: \n227: For each swarm $k \\in \\{1, 2\\}$ independently:\n228: 1. Apply the clustering algorithm from Definition 6.3 in [03_cloning](03_cloning) with parameter $\\varepsilon$\n229: 2. Compute unfit set $U_k$ (walkers with $V_{k,i} \\leq \\mu_{V,k}$)\n230: 3. Form target set $I_k = U_k \\cap H_k(\\varepsilon)$ and complement $J_k$\n231: \n232: **Step 2: Population-Level Matching**\n233: \n234: Within each population pair $(I_1, I_2)$ and $(J_1, J_2)$:\n235: 1. Use any matching distribution (e.g., Gibbs, uniform, or optimal transport)\n236: 2. **Key**: We only care about **population-level expectations**, not individual matchings\n237: \n238: **Step 3: Shared Cloning Randomness**\n239: \n240: For each matched pair of walkers $(i_1, i_2)$:\n241: 1. Sample shared threshold: $T \\sim \\text{Uniform}(0, p_{\\max})$\n242: 2. Walker $i$ in swarm $k$ clones if $T < p_{k,i}$\n243: 3. If cloning, sample shared jitter: $\\zeta \\sim \\mathcal{N}(0, \\delta^2 I_d)$\n244: \n245: **Step 4: Update Positions**\n246: \n247: $$\n248: x'_{k,i} = \\begin{cases}\n249: x_{k, \\pi(i)} + \\zeta & \\text{if } T < p_{k,i} \\text{ (clone)} \\\\\n250: x_{k,i} & \\text{if } T \\geq p_{k,i} \\text{ (persist)}\n251: \\end{cases}",
      "metadata": {
        "label": "def-cluster-coupling"
      },
      "section": "## 2. Cluster-Preserving Coupling",
      "raw_directive": "218: Instead of coupling individual walkers, we couple at the **population level**.\n219: \n220: :::{prf:definition} Cluster-Preserving Coupling\n221: :label: def-cluster-coupling\n222: \n223: For two swarms $(S_1, S_2)$ with partitions $(I_1, J_1)$ and $(I_2, J_2)$, the **cluster-preserving coupling** evolves them to $(S_1', S_2')$ using the following procedure:\n224: \n225: **Step 1: Independent Cluster Partitions**\n226: \n227: For each swarm $k \\in \\{1, 2\\}$ independently:\n228: 1. Apply the clustering algorithm from Definition 6.3 in [03_cloning](03_cloning) with parameter $\\varepsilon$\n229: 2. Compute unfit set $U_k$ (walkers with $V_{k,i} \\leq \\mu_{V,k}$)\n230: 3. Form target set $I_k = U_k \\cap H_k(\\varepsilon)$ and complement $J_k$\n231: \n232: **Step 2: Population-Level Matching**\n233: \n234: Within each population pair $(I_1, I_2)$ and $(J_1, J_2)$:\n235: 1. Use any matching distribution (e.g., Gibbs, uniform, or optimal transport)\n236: 2. **Key**: We only care about **population-level expectations**, not individual matchings\n237: \n238: **Step 3: Shared Cloning Randomness**\n239: \n240: For each matched pair of walkers $(i_1, i_2)$:\n241: 1. Sample shared threshold: $T \\sim \\text{Uniform}(0, p_{\\max})$\n242: 2. Walker $i$ in swarm $k$ clones if $T < p_{k,i}$\n243: 3. If cloning, sample shared jitter: $\\zeta \\sim \\mathcal{N}(0, \\delta^2 I_d)$\n244: \n245: **Step 4: Update Positions**\n246: \n247: $$\n248: x'_{k,i} = \\begin{cases}\n249: x_{k, \\pi(i)} + \\zeta & \\text{if } T < p_{k,i} \\text{ (clone)} \\\\\n250: x_{k,i} & \\text{if } T \\geq p_{k,i} \\text{ (persist)}\n251: \\end{cases}\n252: "
    },
    {
      "directive_type": "remark",
      "label": "rem-coupling-advantages",
      "title": "Why This Coupling Works",
      "start_line": 254,
      "end_line": 266,
      "header_lines": [
        255
      ],
      "content_start": 257,
      "content_end": 265,
      "content": "257: :label: rem-coupling-advantages\n258: \n259: **Advantages over single-walker coupling**:\n260: \n261: 1. **No $q_{\\min}$ dependence**: We average over all possible matchings within each population. The population-level expectation is well-defined even though individual matching probabilities vanish.\n262: \n263: 2. **Robust to perturbations**: Small changes in individual walker positions don't affect the population partition (clusters are stable).\n264: \n265: 3. **Framework-consistent**: Uses the exact same cluster definitions (Definition 6.3) that appear in the Keystone Lemma proof.",
      "metadata": {
        "label": "rem-coupling-advantages"
      },
      "section": "## 2. Cluster-Preserving Coupling",
      "raw_directive": "254: :::\n255: \n256: :::{prf:remark} Why This Coupling Works\n257: :label: rem-coupling-advantages\n258: \n259: **Advantages over single-walker coupling**:\n260: \n261: 1. **No $q_{\\min}$ dependence**: We average over all possible matchings within each population. The population-level expectation is well-defined even though individual matching probabilities vanish.\n262: \n263: 2. **Robust to perturbations**: Small changes in individual walker positions don't affect the population partition (clusters are stable).\n264: \n265: 3. **Framework-consistent**: Uses the exact same cluster definitions (Definition 6.3) that appear in the Keystone Lemma proof.\n266: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}