{
  "chapter_index": 3,
  "section_id": "## 3. Definition: the Euclidean Gas",
  "directive_count": 1,
  "hints": [
    {
      "directive_type": "algorithm",
      "label": "alg-euclidean-gas",
      "title": "Euclidean Gas Update",
      "start_line": 153,
      "end_line": 199,
      "header_lines": [
        154
      ],
      "content_start": 156,
      "content_end": 198,
      "content": "156: :label: alg-euclidean-gas\n157: \n158: Given a swarm state $\\mathcal S_t=(w_1,\\dots,w_N)$ with walkers $w_i=(x_i,v_i,s_i)$, the Euclidean Gas performs one update as follows:\n159: \n160: 1.  **Cemetery check.** If all walkers are dead (no alive indices in $\\mathcal A_t$) return the cemetery state; otherwise continue.\n161: 2.  **Measurement stage.** For every alive walker $i\\in\\mathcal A_t$ sample a companion $c_{\\mathrm{pot}}(i)$ from the algorithmic distance-weighted kernel $\\mathbb C_\\epsilon(\\mathcal S_t,i)$, then compute raw reward $r_i:=R(x_i,v_i)$ and algorithmic distance $d_i:=d_{\\text{alg}}(i,c_{\\mathrm{pot}}(i))$ as defined in Section 3.3 and detailed in {ref}`Stage 2 <sec-eg-stage2>`.\n162: 3.  **Patched standardisation.** Aggregate the raw reward and distance vectors with the empirical operator and apply the regularized standard deviation from {prf:ref}`def-statistical-properties-measurement` to obtain standardized scores with floor $\\sigma'_{\\min,\\mathrm{patch}} = \\sqrt{\\kappa_{\\mathrm{var,min}}+\\varepsilon_{\\mathrm{std}}^2}$.\n163: 4.  **Logistic rescale.** Apply the Canonical Logistic Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`) to the standardized reward and distance components, producing positive outputs $r'_i$ and $d'_i$. Combine them with the canonical exponents to freeze the potential vector $V_{\\text{fit},i}=(d'_i)^\\beta (r'_i)^\\alpha$ with floor $\\eta^{\\alpha+\\beta}$.\n164: 5.  **Clone/Persist gate.** For each walker draw a clone companion $c_{\\mathrm{clone}}(i)$ from the same algorithmic distance-weighted kernel and threshold $T_i\\sim\\mathrm{Unif}(0,p_{\\max})$, compute the canonical score $S_i:=\\big(V_{\\text{fit},c_{\\mathrm{clone}}(i)}-V_{\\text{fit},i}\\big)/(V_{\\text{fit},i}+\\varepsilon_{\\mathrm{clone}})$, and clone when $S_i>T_i$. Cloned walkers are grouped by companion and undergo a momentum-conserving inelastic collision: positions reset to the companion's position plus Gaussian jitter ($\\sigma_x$), while velocities are updated via center-of-mass calculation with random rotation and restitution coefficient $\\alpha_{\\text{restitution}}$, as detailed in {ref}`Stage 3 <sec-eg-stage3>` and Definition 5.7.4 of `03_cloning.md`. Otherwise the walker persists unchanged. The intermediate swarm sets every status to alive before the kinetic step.\n165: 6.  **Kinetic perturbation.** Update each alive clone or survivor by applying the **BAOAB splitting integrator** for one step of underdamped Langevin dynamics with force $F(x)=\\nabla R_{\\mathrm{pos}}(x)$ and noise scales $(\\sigma_v,\\sigma_x)$.\n166: 7.  **Status refresh.** Set the new status $s_i^{(t+1)}=\\mathbf 1_{\\mathcal X_{\\mathrm{valid}}}(x_i^+)$ and output the updated swarm $\\mathcal S_{t+1}$.\n167: \n168: **Euclidean Gas Algorithm**\n169: \n170: $$\n171: \\begin{aligned}\n172: & \\textbf{Input:} \\mathcal S_t = \\{(x_i^{(t)}, v_i^{(t)}, s_i^{(t)})\\}_{i=1}^N\\text{; and parameters } \\alpha, \\beta, \\varepsilon_{\\mathrm{std}}, \\eta, \\tau, p_{\\max}, \\varepsilon_{\\mathrm{clone}}, \\sigma_x, \\alpha_{\\text{restitution}}, \\sigma_v, \\\\\n173: & \\qquad \\sigma'_{\\mathrm{patch}}, g_A, \\mathbb C_i, Q_{\\delta}, \\Psi_{\\mathrm{kin,BAOAB}}. \\\\\n174: & \\textbf{If } |\\mathcal A_t| = 0: \\textbf{ return } \\delta_{\\mathcal S_t} \\quad \\text{\\# Cemetery absorption} \\\\\n175: \\\\\n176: & \\underline{\\text{Stage 2a: Raw vectors on alive set}} \\\\\n177: & \\dots \\quad \\text{\\# Unchanged} \\\\\n178: \\\\\n179: & \\underline{\\text{Stage 2b: Patched standardisation}} \\\\\n180: & \\dots \\quad \\text{\\# Unchanged} \\\\\n181: \\\\\n182: & \\underline{\\text{Stage 2c: Logistic rescale of components}} \\\\\n183: & \\dots \\quad \\text{\\# Unchanged} \\\\\n184: \\\\\n185: & \\underline{\\text{Stage 2d: Assemble full vectors with floors}} \\\\\n186: & \\dots \\quad \\text{\\# Unchanged} \\\\\n187: \\\\\n188: & \\underline{\\text{Stage 3: Cloning transition}} \\\\\n189: & \\dots \\quad \\text{\\# Unchanged logic, produces } (x_i^{(t+\\frac{1}{2})}, v_i^{(t+\\frac{1}{2})}) \\\\\n190: \\\\\n191: & \\underline{\\text{Stage 4: Langevin perturbation and status refresh}} \\\\\n192: & \\mathcal S_{\\mathrm{pert}} \\sim \\Psi_{\\mathrm{kin,BAOAB}}(\\{(x_i^{(t+\\frac{1}{2})}, v_i^{(t+\\frac{1}{2})})\\}, \\cdot) \\quad \\text{\\# BAOAB Langevin step with velocity capping} \\\\\n193: & \\textbf{For each } i = 1..N: \\\\\n194: & \\quad (x_i^{(t+1)}, v_i^{(t+1)}) \\leftarrow \\text{draw from kinetic step output} \\\\\n195: & \\quad s_i^{(t+1)} \\leftarrow \\mathbf 1_{\\mathcal X_{\\mathrm{valid}}}(x_i^{(t+1)}) \\\\\n196: & \\textbf{Return } \\mathcal S_{t+1}\n197: \\end{aligned}\n198: ",
      "metadata": {
        "label": "alg-euclidean-gas"
      },
      "section": "## 3. Definition: the Euclidean Gas",
      "raw_directive": "153: ### **3.1 Euclidean Gas algorithm (canonical pipeline)**\n154: \n155: :::{prf:algorithm} Euclidean Gas Update\n156: :label: alg-euclidean-gas\n157: \n158: Given a swarm state $\\mathcal S_t=(w_1,\\dots,w_N)$ with walkers $w_i=(x_i,v_i,s_i)$, the Euclidean Gas performs one update as follows:\n159: \n160: 1.  **Cemetery check.** If all walkers are dead (no alive indices in $\\mathcal A_t$) return the cemetery state; otherwise continue.\n161: 2.  **Measurement stage.** For every alive walker $i\\in\\mathcal A_t$ sample a companion $c_{\\mathrm{pot}}(i)$ from the algorithmic distance-weighted kernel $\\mathbb C_\\epsilon(\\mathcal S_t,i)$, then compute raw reward $r_i:=R(x_i,v_i)$ and algorithmic distance $d_i:=d_{\\text{alg}}(i,c_{\\mathrm{pot}}(i))$ as defined in Section 3.3 and detailed in {ref}`Stage 2 <sec-eg-stage2>`.\n162: 3.  **Patched standardisation.** Aggregate the raw reward and distance vectors with the empirical operator and apply the regularized standard deviation from {prf:ref}`def-statistical-properties-measurement` to obtain standardized scores with floor $\\sigma'_{\\min,\\mathrm{patch}} = \\sqrt{\\kappa_{\\mathrm{var,min}}+\\varepsilon_{\\mathrm{std}}^2}$.\n163: 4.  **Logistic rescale.** Apply the Canonical Logistic Rescale Function ({prf:ref}`def-canonical-logistic-rescale-function-example`) to the standardized reward and distance components, producing positive outputs $r'_i$ and $d'_i$. Combine them with the canonical exponents to freeze the potential vector $V_{\\text{fit},i}=(d'_i)^\\beta (r'_i)^\\alpha$ with floor $\\eta^{\\alpha+\\beta}$.\n164: 5.  **Clone/Persist gate.** For each walker draw a clone companion $c_{\\mathrm{clone}}(i)$ from the same algorithmic distance-weighted kernel and threshold $T_i\\sim\\mathrm{Unif}(0,p_{\\max})$, compute the canonical score $S_i:=\\big(V_{\\text{fit},c_{\\mathrm{clone}}(i)}-V_{\\text{fit},i}\\big)/(V_{\\text{fit},i}+\\varepsilon_{\\mathrm{clone}})$, and clone when $S_i>T_i$. Cloned walkers are grouped by companion and undergo a momentum-conserving inelastic collision: positions reset to the companion's position plus Gaussian jitter ($\\sigma_x$), while velocities are updated via center-of-mass calculation with random rotation and restitution coefficient $\\alpha_{\\text{restitution}}$, as detailed in {ref}`Stage 3 <sec-eg-stage3>` and Definition 5.7.4 of `03_cloning.md`. Otherwise the walker persists unchanged. The intermediate swarm sets every status to alive before the kinetic step.\n165: 6.  **Kinetic perturbation.** Update each alive clone or survivor by applying the **BAOAB splitting integrator** for one step of underdamped Langevin dynamics with force $F(x)=\\nabla R_{\\mathrm{pos}}(x)$ and noise scales $(\\sigma_v,\\sigma_x)$.\n166: 7.  **Status refresh.** Set the new status $s_i^{(t+1)}=\\mathbf 1_{\\mathcal X_{\\mathrm{valid}}}(x_i^+)$ and output the updated swarm $\\mathcal S_{t+1}$.\n167: \n168: **Euclidean Gas Algorithm**\n169: \n170: $$\n171: \\begin{aligned}\n172: & \\textbf{Input:} \\mathcal S_t = \\{(x_i^{(t)}, v_i^{(t)}, s_i^{(t)})\\}_{i=1}^N\\text{; and parameters } \\alpha, \\beta, \\varepsilon_{\\mathrm{std}}, \\eta, \\tau, p_{\\max}, \\varepsilon_{\\mathrm{clone}}, \\sigma_x, \\alpha_{\\text{restitution}}, \\sigma_v, \\\\\n173: & \\qquad \\sigma'_{\\mathrm{patch}}, g_A, \\mathbb C_i, Q_{\\delta}, \\Psi_{\\mathrm{kin,BAOAB}}. \\\\\n174: & \\textbf{If } |\\mathcal A_t| = 0: \\textbf{ return } \\delta_{\\mathcal S_t} \\quad \\text{\\# Cemetery absorption} \\\\\n175: \\\\\n176: & \\underline{\\text{Stage 2a: Raw vectors on alive set}} \\\\\n177: & \\dots \\quad \\text{\\# Unchanged} \\\\\n178: \\\\\n179: & \\underline{\\text{Stage 2b: Patched standardisation}} \\\\\n180: & \\dots \\quad \\text{\\# Unchanged} \\\\\n181: \\\\\n182: & \\underline{\\text{Stage 2c: Logistic rescale of components}} \\\\\n183: & \\dots \\quad \\text{\\# Unchanged} \\\\\n184: \\\\\n185: & \\underline{\\text{Stage 2d: Assemble full vectors with floors}} \\\\\n186: & \\dots \\quad \\text{\\# Unchanged} \\\\\n187: \\\\\n188: & \\underline{\\text{Stage 3: Cloning transition}} \\\\\n189: & \\dots \\quad \\text{\\# Unchanged logic, produces } (x_i^{(t+\\frac{1}{2})}, v_i^{(t+\\frac{1}{2})}) \\\\\n190: \\\\\n191: & \\underline{\\text{Stage 4: Langevin perturbation and status refresh}} \\\\\n192: & \\mathcal S_{\\mathrm{pert}} \\sim \\Psi_{\\mathrm{kin,BAOAB}}(\\{(x_i^{(t+\\frac{1}{2})}, v_i^{(t+\\frac{1}{2})})\\}, \\cdot) \\quad \\text{\\# BAOAB Langevin step with velocity capping} \\\\\n193: & \\textbf{For each } i = 1..N: \\\\\n194: & \\quad (x_i^{(t+1)}, v_i^{(t+1)}) \\leftarrow \\text{draw from kinetic step output} \\\\\n195: & \\quad s_i^{(t+1)} \\leftarrow \\mathbf 1_{\\mathcal X_{\\mathrm{valid}}}(x_i^{(t+1)}) \\\\\n196: & \\textbf{Return } \\mathcal S_{t+1}\n197: \\end{aligned}\n198: \n199: $$"
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}