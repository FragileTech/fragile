<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 520" role="img" aria-label="Flow diagram of a Fractal Gas step: companion selection, fitness, cloning, kinetics, repeat">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f8fbff" />
      <stop offset="100%" stop-color="#eef2f7" />
    </linearGradient>
    <pattern id="dotGrid" width="36" height="36" patternUnits="userSpaceOnUse">
      <circle cx="2" cy="2" r="1.1" fill="#cbd5e1" opacity="0.32" />
    </pattern>
    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="5" flood-color="#0b1f33" flood-opacity="0.16" />
    </filter>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L12,6 L0,12 z" fill="#334155" />
    </marker>
  </defs>
  <style>
    .title { font-family: "IBM Plex Sans", "Source Sans Pro", "Helvetica Neue", Arial, sans-serif; font-size: 26px; fill: #102a43; font-weight: 600; }
    .panel { fill: #ffffff; stroke: #cbd5e1; stroke-width: 2; rx: 16; filter: url(#softShadow); }
    .panel-title { font-family: "IBM Plex Sans", "Source Sans Pro", "Helvetica Neue", Arial, sans-serif; font-size: 15px; font-weight: 600; fill: #102a43; }
    .panel-text { font-family: "IBM Plex Sans", "Source Sans Pro", "Helvetica Neue", Arial, sans-serif; font-size: 13px; fill: #475569; }
    .label { font-family: "IBM Plex Sans", "Source Sans Pro", "Helvetica Neue", Arial, sans-serif; font-size: 12px; fill: #475569; }
    .outline { stroke: #1f2937; stroke-width: 2; }
    .accent-blue { fill: #dbeafe; stroke: #2563eb; stroke-width: 2; }
    .accent-green { fill: #dcfce7; stroke: #2f9e44; stroke-width: 2; }
    .accent-orange { fill: #fff4d6; stroke: #f59f00; stroke-width: 2; }
    .accent-teal { fill: #ccfbf1; stroke: #0f766e; stroke-width: 2; }
    .accent-red { fill: #ffe3e3; stroke: #c92a2a; stroke-width: 2; }
    .arrow { stroke: #334155; stroke-width: 2.2; marker-end: url(#arrow); }
    .thin { stroke-width: 1.6; }
  </style>

  <rect width="1200" height="520" fill="url(#bg)" />
  <rect width="1200" height="520" fill="url(#dotGrid)" opacity="0.35" />

  <text x="60" y="60" class="title">Fractal Gas step at a glance</text>

  <rect x="60" y="130" width="200" height="260" class="panel" />
  <rect x="280" y="130" width="200" height="260" class="panel" />
  <rect x="500" y="130" width="200" height="260" class="panel" />
  <rect x="720" y="130" width="200" height="260" class="panel" />
  <rect x="940" y="130" width="200" height="260" class="panel" />

  <text x="160" y="160" class="panel-title" text-anchor="middle">Companion selection</text>
  <text x="380" y="160" class="panel-title" text-anchor="middle">Dual-channel fitness</text>
  <text x="600" y="160" class="panel-title" text-anchor="middle">Cloning + revival</text>
  <text x="820" y="160" class="panel-title" text-anchor="middle">Kinetics + boundary</text>
  <text x="1040" y="160" class="panel-title" text-anchor="middle">Repeat / keep N</text>

  <line x1="260" y1="260" x2="280" y2="260" class="arrow" />
  <line x1="480" y1="260" x2="500" y2="260" class="arrow" />
  <line x1="700" y1="260" x2="720" y2="260" class="arrow" />
  <line x1="920" y1="260" x2="940" y2="260" class="arrow" />

  <circle cx="160" cy="250" r="16" class="accent-blue" />
  <circle cx="115" cy="220" r="10" class="accent-blue" />
  <circle cx="205" cy="215" r="10" class="accent-blue" />
  <circle cx="110" cy="285" r="10" class="accent-blue" />
  <circle cx="210" cy="290" r="10" class="accent-blue" />
  <line x1="160" y1="250" x2="115" y2="220" class="outline thin" />
  <line x1="160" y1="250" x2="205" y2="215" class="arrow thin" />
  <line x1="160" y1="250" x2="110" y2="285" class="outline thin" />
  <line x1="160" y1="250" x2="210" y2="290" class="arrow thin" />
  <text x="200" y="200" class="label" text-anchor="end">distance companion</text>
  <text x="200" y="320" class="label" text-anchor="end">clone companion</text>
  <text x="160" y="360" class="panel-text" text-anchor="middle">soft kernel, two draws</text>

  <rect x="315" y="210" width="60" height="16" class="accent-orange" />
  <rect x="315" y="238" width="90" height="16" class="accent-green" />
  <rect x="315" y="274" width="140" height="28" class="accent-blue" />
  <text x="345" y="218" class="label" text-anchor="middle" dominant-baseline="middle">reward r_i</text>
  <text x="360" y="246" class="label" text-anchor="middle" dominant-baseline="middle">distance d_i</text>
  <text x="385" y="288" class="label" text-anchor="middle" dominant-baseline="middle">V_fit</text>
  <text x="380" y="360" class="panel-text" text-anchor="middle">standardize, multiply</text>

  <circle cx="545" cy="240" r="14" class="accent-green" />
  <circle cx="610" cy="240" r="12" class="accent-red" />
  <line x1="557" y1="240" x2="598" y2="240" class="outline" marker-end="url(#arrow)" />
  <circle cx="610" cy="290" r="12" class="accent-green" />
  <circle cx="635" cy="300" r="6" class="accent-green" opacity="0.7" />
  <circle cx="590" cy="305" r="6" class="accent-green" opacity="0.7" />
  <text x="600" y="360" class="panel-text" text-anchor="middle">clone low fitness</text>

  <line x1="770" y1="300" x2="870" y2="240" class="outline" marker-end="url(#arrow)" />
  <line x1="770" y1="300" x2="870" y2="330" class="outline" marker-end="url(#arrow)" />
  <line x1="830" y1="215" x2="830" y2="355" class="outline" stroke-dasharray="6 6" />
  <text x="820" y="360" class="panel-text" text-anchor="middle">move + kill check</text>

  <circle cx="1000" cy="250" r="10" class="accent-blue" />
  <circle cx="1030" cy="230" r="10" class="accent-blue" />
  <circle cx="1060" cy="250" r="10" class="accent-blue" />
  <circle cx="1030" cy="270" r="10" class="accent-blue" />
  <text x="975" y="305" class="label">N constant</text>
  <text x="1040" y="360" class="panel-text" text-anchor="middle">population conserved</text>
</svg>
