{
  "chapter_index": 4,
  "section_id": "## 4. Third Derivatives of Localization Weights",
  "directive_count": 2,
  "hints": [
    {
      "directive_type": "lemma",
      "label": "lem-weight-third-derivative",
      "title": "Third Derivative of Localization Weights",
      "start_line": 327,
      "end_line": 343,
      "header_lines": [
        328
      ],
      "content_start": 330,
      "content_end": 342,
      "content": "330: :label: lem-weight-third-derivative\n331: \n332: The localization weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$ satisfy:\n333: \n334: $$\n335: \\|\\nabla^3_{x_i} w_{ij}(\\rho)\\| \\le C_{w,3}(\\rho)\n336: $$\n337: \n338: where\n339: \n340: $$\n341: C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n342: $$",
      "metadata": {
        "label": "lem-weight-third-derivative"
      },
      "section": "## 4. Third Derivatives of Localization Weights",
      "raw_directive": "327: The localization weights $w_{ij}(\\rho)$ are the fundamental building blocks of the \ufffd-localized pipeline. We now establish bounds on their third derivatives.\n328: \n329: :::{prf:lemma} Third Derivative of Localization Weights\n330: :label: lem-weight-third-derivative\n331: \n332: The localization weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$ satisfy:\n333: \n334: $$\n335: \\|\\nabla^3_{x_i} w_{ij}(\\rho)\\| \\le C_{w,3}(\\rho)\n336: $$\n337: \n338: where\n339: \n340: $$\n341: C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n342: $$\n343: "
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-21",
      "title": null,
      "start_line": 345,
      "end_line": 426,
      "header_lines": [],
      "content_start": 346,
      "content_end": 425,
      "content": "346: \n347: :::{prf:proof}\n348: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n349: \n350: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n351: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n352: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n353: \n354: **Step 2: Derivatives of numerator.**\n355: By Assumption {prf:ref}`assump-c3-kernel`:\n356: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n357: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n358: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n359: \n360: **Step 3: Derivatives of denominator.**\n361: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n362: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n363: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n364: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n365: \n366: **Step 4: Apply quotient rule for third derivative.**\n367: \n368: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n369: \n370: $$\n371: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n372: $$\n373: \n374: plus additional terms. We bound each term:\n375: \n376: **Term 1:** $|\\nabla^3 u / v|$\n377: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n378: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n379: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n380: \n381: **Term 2:** $|3\\nabla u \\cdot \\nabla^2 v / v^2|$\n382: - Bound: $3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2) / v^2$\n383: - **Key insight**: The factor $k/v^2$ is **not** k-uniform naively. However, we use the telescoping property:\n384: \n385: Since $\\sum_{\\ell} K_\\rho(x_i, x_\\ell) = v$, we have $v = O(k)$ (more walkers \ufffd larger normalization). Thus $k/v^2 = O(1/k)$.\n386: \n387: More precisely: $v \\ge k \\cdot \\min_\\ell K_\\rho(x_i, x_\\ell) \\ge k \\cdot c_{\\min} > 0$ where $c_{\\min}$ depends on the kernel's minimum value on the domain.\n388: \n389: Therefore: $k/v^2 \\le k/(k \\cdot c_{\\min})^2 = 1/(k \\cdot c_{\\min}^2) \\le C/k$ for some constant $C$.\n390: \n391: **However**, the correct k-uniform bound uses the fact that $\\nabla^2 v$ itself involves a sum over $k$ terms, and after telescoping (see Step 5), the $k$-factors cancel.\n392: \n393: **Term 3-5:** Similar analysis for other terms in the quotient rule.\n394: \n395: **Step 5: Achieve k-uniformity via telescoping.**\n396: \n397: The naive bound from Step 4 appears to grow with $k$. To obtain k-uniformity, we exploit the constraint $\\sum_j w_{ij} = 1$.\n398: \n399: Differentiating this constraint three times:\n400: \n401: $$\n402: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n403: $$\n404: \n405: This means when we sum $\\nabla^3 w_{ij}$ over all $j$, terms involving the denominator $v = Z_i$ exactly cancel. The dominant contribution comes from:\n406: \n407: $$\n408: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{lower-order terms}\n409: $$\n410: \n411: where the lower-order terms involve products of derivatives of $K_\\rho$ with derivatives of $1/Z_i$.\n412: \n413: **Step 6: Explicit bound.**\n414: \n415: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n416: \n417: $$\n418: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n419: $$\n420: \n421: Absorbing constants and using conservative bounds:\n422: \n423: $$\n424: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n425: $$",
      "metadata": {},
      "section": "## 4. Third Derivatives of Localization Weights",
      "raw_directive": "345: :::\n346: \n347: :::{prf:proof}\n348: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n349: \n350: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n351: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n352: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n353: \n354: **Step 2: Derivatives of numerator.**\n355: By Assumption {prf:ref}`assump-c3-kernel`:\n356: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n357: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n358: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n359: \n360: **Step 3: Derivatives of denominator.**\n361: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n362: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n363: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n364: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n365: \n366: **Step 4: Apply quotient rule for third derivative.**\n367: \n368: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n369: \n370: $$\n371: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n372: $$\n373: \n374: plus additional terms. We bound each term:\n375: \n376: **Term 1:** $|\\nabla^3 u / v|$\n377: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n378: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n379: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n380: \n381: **Term 2:** $|3\\nabla u \\cdot \\nabla^2 v / v^2|$\n382: - Bound: $3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2) / v^2$\n383: - **Key insight**: The factor $k/v^2$ is **not** k-uniform naively. However, we use the telescoping property:\n384: \n385: Since $\\sum_{\\ell} K_\\rho(x_i, x_\\ell) = v$, we have $v = O(k)$ (more walkers \ufffd larger normalization). Thus $k/v^2 = O(1/k)$.\n386: \n387: More precisely: $v \\ge k \\cdot \\min_\\ell K_\\rho(x_i, x_\\ell) \\ge k \\cdot c_{\\min} > 0$ where $c_{\\min}$ depends on the kernel's minimum value on the domain.\n388: \n389: Therefore: $k/v^2 \\le k/(k \\cdot c_{\\min})^2 = 1/(k \\cdot c_{\\min}^2) \\le C/k$ for some constant $C$.\n390: \n391: **However**, the correct k-uniform bound uses the fact that $\\nabla^2 v$ itself involves a sum over $k$ terms, and after telescoping (see Step 5), the $k$-factors cancel.\n392: \n393: **Term 3-5:** Similar analysis for other terms in the quotient rule.\n394: \n395: **Step 5: Achieve k-uniformity via telescoping.**\n396: \n397: The naive bound from Step 4 appears to grow with $k$. To obtain k-uniformity, we exploit the constraint $\\sum_j w_{ij} = 1$.\n398: \n399: Differentiating this constraint three times:\n400: \n401: $$\n402: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n403: $$\n404: \n405: This means when we sum $\\nabla^3 w_{ij}$ over all $j$, terms involving the denominator $v = Z_i$ exactly cancel. The dominant contribution comes from:\n406: \n407: $$\n408: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{lower-order terms}\n409: $$\n410: \n411: where the lower-order terms involve products of derivatives of $K_\\rho$ with derivatives of $1/Z_i$.\n412: \n413: **Step 6: Explicit bound.**\n414: \n415: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n416: \n417: $$\n418: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n419: $$\n420: \n421: Absorbing constants and using conservative bounds:\n422: \n423: $$\n424: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n425: $$\n426: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}