{
  "document_id": "20_geometric_gas_cinf_regularity_full",
  "stage": "directives",
  "directive_type": "proof",
  "generated_at": "2025-11-08T17:16:20.316054+00:00",
  "count": 38,
  "items": [
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-285",
      "title": null,
      "start_line": 667,
      "end_line": 683,
      "header_lines": [],
      "content_start": 668,
      "content_end": 682,
      "content": "668: \n669: :::{prf:proof}\n670: **Proof sketch** (conservative case):\n671: \n672: The generator for the conservative Langevin dynamics is:\n673: \n674: $$\n675: \\mathcal{L} f = -\\psi(v) \\cdot \\nabla_x f + \\gamma v \\cdot \\nabla_v f + \\nabla_x V_{\\text{fit}} \\cdot \\nabla_v f + \\gamma T \\Delta_v f\n676: $$\n677: \n678: **Key steps**:\n679: 1. Lipschitz drift + non-degenerate diffusion ‚Üí semigroup maps L^‚àû to L^‚àû\n680: 2. Compactness of ùí≥ √ó V ‚Üí V_fit and kinetic energy uniformly bounded\n681: 3. Invariant density satisfies: œÅ_‚àû(x,v) ‚â§ C exp((V_fit(x) + ¬Ω‚Äñv‚Äñ¬≤)/(Œ≥T))\n682: 4. Since both terms in exponent are bounded ‚Üí œÅ_‚àû ‚â§ C_FK < ‚àû",
      "metadata": {},
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "667: :::\n668: \n669: :::{prf:proof}\n670: **Proof sketch** (conservative case):\n671: \n672: The generator for the conservative Langevin dynamics is:\n673: \n674: $$\n675: \\mathcal{L} f = -\\psi(v) \\cdot \\nabla_x f + \\gamma v \\cdot \\nabla_v f + \\nabla_x V_{\\text{fit}} \\cdot \\nabla_v f + \\gamma T \\Delta_v f\n676: $$\n677: \n678: **Key steps**:\n679: 1. Lipschitz drift + non-degenerate diffusion ‚Üí semigroup maps L^‚àû to L^‚àû\n680: 2. Compactness of ùí≥ √ó V ‚Üí V_fit and kinetic energy uniformly bounded\n681: 3. Invariant density satisfies: œÅ_‚àû(x,v) ‚â§ C exp((V_fit(x) + ¬Ω‚Äñv‚Äñ¬≤)/(Œ≥T))\n682: 4. Since both terms in exponent are bounded ‚Üí œÅ_‚àû ‚â§ C_FK < ‚àû\n683: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-450",
      "title": null,
      "start_line": 832,
      "end_line": 887,
      "header_lines": [],
      "content_start": 833,
      "content_end": 886,
      "content": "833: \n834: :::{prf:proof}\n835: **Direct proof from compactness and minimum walker requirement.**\n836: \n837: The proof uses ONLY primitive assumptions:\n838: 1. **Bounded domain**: $\\mathcal{X} \\times V$ is compact, so $D_{\\max} := \\text{diam}(\\mathcal{X} \\times V) < \\infty$\n839: 2. **Minimum walkers**: Cloning enforces $k \\geq k_{\\min} \\geq 2$ (at least 2 alive walkers)\n840: 3. **Self-exclusion**: By definition, walker $i$ cannot choose itself as companion\n841: \n842: **Step 1: Partition function structure.**\n843: \n844: The softmax partition function is:\n845: \n846: $$\n847: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n848: \n849: $$\n850: \n851: Since $k \\geq 2$, the set $\\mathcal{A} \\setminus \\{i\\}$ contains **at least one walker** $\\ell \\neq i$. Therefore, the sum has at least $k-1 \\geq 1$ term.\n852: \n853: **Step 2: Lower bound for each term.**\n854: \n855: For any walker $\\ell \\in \\mathcal{A} \\setminus \\{i\\}$:\n856: \n857: $$\n858: \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right)\n859: \n860: $$\n861: \n862: since $d_{\\text{alg}}(i,\\ell) \\leq D_{\\max}$ by compactness (worst case: $\\ell$ is at maximum distance from $i$).\n863: \n864: **Step 3: Combine to obtain lower bound.**\n865: \n866: Since $Z_i$ is a sum of at least one term, each at least $\\exp(-D_{\\max}^2/(2\\varepsilon_c^2))$:\n867: \n868: $$\n869: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n870: \n871: $$\n872: \n873: **Step 4: k-uniformity verification.**\n874: \n875: The bound $Z_{\\min}$ depends only on:\n876: - **Domain diameter** $D_{\\max}$ (geometric property of $\\mathcal{X} \\times V$)\n877: - **Companion scale** $\\varepsilon_c$ (algorithmic parameter)\n878: \n879: It does **not** depend on:\n880: - ‚úó Number of alive walkers $k$\n881: - ‚úó Total walker count $N$\n882: - ‚úó Walker positions $\\{(x_j, v_j)\\}_{j \\in \\mathcal{A}}$\n883: - ‚úó Fitness potential regularity\n884: - ‚úó Density bounds\n885: \n886: **Conclusion**: The partition function lower bound $Z_i \\geq Z_{\\min} > 0$ holds **for all walkers** $i \\in \\mathcal{A}$ and **all swarm configurations** with $k \\geq 2$. This is a **primitive geometric bound** requiring no regularity or density assumptions.",
      "metadata": {},
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "832: :::\n833: \n834: :::{prf:proof}\n835: **Direct proof from compactness and minimum walker requirement.**\n836: \n837: The proof uses ONLY primitive assumptions:\n838: 1. **Bounded domain**: $\\mathcal{X} \\times V$ is compact, so $D_{\\max} := \\text{diam}(\\mathcal{X} \\times V) < \\infty$\n839: 2. **Minimum walkers**: Cloning enforces $k \\geq k_{\\min} \\geq 2$ (at least 2 alive walkers)\n840: 3. **Self-exclusion**: By definition, walker $i$ cannot choose itself as companion\n841: \n842: **Step 1: Partition function structure.**\n843: \n844: The softmax partition function is:\n845: \n846: $$\n847: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n848: \n849: $$\n850: \n851: Since $k \\geq 2$, the set $\\mathcal{A} \\setminus \\{i\\}$ contains **at least one walker** $\\ell \\neq i$. Therefore, the sum has at least $k-1 \\geq 1$ term.\n852: \n853: **Step 2: Lower bound for each term.**\n854: \n855: For any walker $\\ell \\in \\mathcal{A} \\setminus \\{i\\}$:\n856: \n857: $$\n858: \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right)\n859: \n860: $$\n861: \n862: since $d_{\\text{alg}}(i,\\ell) \\leq D_{\\max}$ by compactness (worst case: $\\ell$ is at maximum distance from $i$).\n863: \n864: **Step 3: Combine to obtain lower bound.**\n865: \n866: Since $Z_i$ is a sum of at least one term, each at least $\\exp(-D_{\\max}^2/(2\\varepsilon_c^2))$:\n867: \n868: $$\n869: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n870: \n871: $$\n872: \n873: **Step 4: k-uniformity verification.**\n874: \n875: The bound $Z_{\\min}$ depends only on:\n876: - **Domain diameter** $D_{\\max}$ (geometric property of $\\mathcal{X} \\times V$)\n877: - **Companion scale** $\\varepsilon_c$ (algorithmic parameter)\n878: \n879: It does **not** depend on:\n880: - ‚úó Number of alive walkers $k$\n881: - ‚úó Total walker count $N$\n882: - ‚úó Walker positions $\\{(x_j, v_j)\\}_{j \\in \\mathcal{A}}$\n883: - ‚úó Fitness potential regularity\n884: - ‚úó Density bounds\n885: \n886: **Conclusion**: The partition function lower bound $Z_i \\geq Z_{\\min} > 0$ holds **for all walkers** $i \\in \\mathcal{A}$ and **all swarm configurations** with $k \\geq 2$. This is a **primitive geometric bound** requiring no regularity or density assumptions.\n887: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-536",
      "title": null,
      "start_line": 918,
      "end_line": 977,
      "header_lines": [],
      "content_start": 919,
      "content_end": 976,
      "content": "919: \n920: :::{prf:proof}\n921: **Proof Strategy**: We establish the deterministic packing bound by showing that configurations violating it have zero measure in the QSD.\n922: \n923: **Step 1: Ergodic QSD Characterization**\n924: \n925: By the Keystone Principle ({prf:ref}`doc-03-cloning`, Theorem 3.5), the Geometric Gas dynamics admit a unique QSD $\\pi_{\\text{QSD}}$ that is:\n926: 1. **Ergodic**: Irreducible and aperiodic on the conditioned state space\n927: 2. **Exponentially converging**: $\\|\\mu_t - \\pi_{\\text{QSD}}\\|_{\\text{TV}} \\leq C e^{-\\lambda t}$ for any initial distribution\n928: 3. **Fitness-weighted**: Higher fitness regions have higher probability, but all regions are explored\n929: \n930: **Step 2: Kinetic Diffusion Lower Bound on Separation**\n931: \n932: The kinetic operator with diffusion $D = T/\\gamma$ satisfies a **Gaussian concentration bound** (standard result from Fokker-Planck theory): For walkers $i, j$ at time $t$, the relative separation $R_{ij}(t) = \\|x_i(t) - x_j(t)\\|$ satisfies:\n933: \n934: $$\n935: \\mathbb{P}_{\\text{QSD}}\\left(R_{ij} < \\varepsilon\\right) \\leq C_{\\text{diff}} \\cdot \\frac{\\varepsilon^d}{\\text{Vol}(\\mathcal{X})}\n936: $$\n937: \n938: This ensures no delta-function clustering occurs in the QSD.\n939: \n940: **Step 3: Cloning Diversity Enhancement**\n941: \n942: The cloning operator amplifies kinetic separation. By {prf:ref}`doc-03-cloning`, Lemma 5.1.2 (Diversity Maintenance), walkers with low algorithmic diversity have death rate:\n943: \n944: $$\n945: \\lambda_{\\text{death}}(i) \\geq \\lambda_0 \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}(i, c(i))}{\\varepsilon_{\\text{pair}}}\\right)\n946: $$\n947: \n948: For clustered configurations where $m$ walkers satisfy $d_{\\text{alg}}(i,j) < r_{\\text{small}}$, the **total death rate** is exponentially enhanced: $\\Lambda_{\\text{cluster}} \\geq m \\cdot \\lambda_0 \\cdot e^{-r_{\\text{small}}/\\varepsilon_{\\text{pair}}} \\gg \\lambda_0$. This rapidly removes clustered states from the QSD.\n949: \n950: **Step 4: Uniform Density via Ergodic Theorem**\n951: \n952: By ergodicity, the QSD is the unique stationary measure. The density $\\rho_{\\text{phase}}^{\\text{QSD}}$ satisfies a **Fokker-Planck-Kolmogorov equation** with cloning source/sink terms. Standard elliptic regularity theory (Bogachev-Krylov-R√∂ckner, 2001) combined with:\n953: - Compactness of $\\mathcal{X} \\times V$ (velocity squashing, Lemma {prf:ref}`lem-velocity-squashing-compact-domain-full`)\n954: - Non-degenerate diffusion ($T > 0$)\n955: - Bounded drift ($\\|\\nabla V_{\\text{fit}}\\| \\leq L_V$ from C¬≥ regularity, {prf:ref}`doc-13-geometric-gas-c3-regularity`)\n956: \n957: implies:\n958: \n959: $$\n960: \\rho_{\\text{phase}}^{\\text{QSD}}(x,v) \\leq \\rho_{\\max} := C_{\\text{FK}}(\\gamma, T, L_V, V_{\\max}, \\text{Vol}(\\mathcal{X}))\n961: $$\n962: \n963: **Step 5: Deterministic Packing Bound**\n964: \n965: Combining Steps 2-4, for any configuration $(x,v)$ in the **support** of $\\pi_{\\text{QSD}}$:\n966: 1. Kinetic diffusion ensures no delta-function clustering (Step 2)\n967: 2. Cloning removes near-clustered states exponentially fast (Step 3)\n968: 3. Ergodicity ensures only \"typical\" configurations (satisfying density bound) have positive measure (Step 4)\n969: \n970: Therefore, **on the QSD support**, the local density is bounded by $\\rho_{\\max}$, which implies:\n971: \n972: $$\n973: \\#\\{j : d_{\\text{alg}}(i,j) \\leq r\\} \\leq \\int_{B(x_i, r)} \\rho_{\\text{phase}}^{\\text{QSD}}(y,u) \\, dy \\, du \\leq \\rho_{\\max} \\cdot \\text{Vol}(B(0, r))\n974: $$\n975: \n976: **Crucial Point**: Configurations violating this bound have **measure zero** in $\\pi_{\\text{QSD}}$ (by Steps 2-3, they are unstable and removed). Therefore, we can work with the bound deterministically on the QSD support.",
      "metadata": {},
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "918: :::\n919: \n920: :::{prf:proof}\n921: **Proof Strategy**: We establish the deterministic packing bound by showing that configurations violating it have zero measure in the QSD.\n922: \n923: **Step 1: Ergodic QSD Characterization**\n924: \n925: By the Keystone Principle ({prf:ref}`doc-03-cloning`, Theorem 3.5), the Geometric Gas dynamics admit a unique QSD $\\pi_{\\text{QSD}}$ that is:\n926: 1. **Ergodic**: Irreducible and aperiodic on the conditioned state space\n927: 2. **Exponentially converging**: $\\|\\mu_t - \\pi_{\\text{QSD}}\\|_{\\text{TV}} \\leq C e^{-\\lambda t}$ for any initial distribution\n928: 3. **Fitness-weighted**: Higher fitness regions have higher probability, but all regions are explored\n929: \n930: **Step 2: Kinetic Diffusion Lower Bound on Separation**\n931: \n932: The kinetic operator with diffusion $D = T/\\gamma$ satisfies a **Gaussian concentration bound** (standard result from Fokker-Planck theory): For walkers $i, j$ at time $t$, the relative separation $R_{ij}(t) = \\|x_i(t) - x_j(t)\\|$ satisfies:\n933: \n934: $$\n935: \\mathbb{P}_{\\text{QSD}}\\left(R_{ij} < \\varepsilon\\right) \\leq C_{\\text{diff}} \\cdot \\frac{\\varepsilon^d}{\\text{Vol}(\\mathcal{X})}\n936: $$\n937: \n938: This ensures no delta-function clustering occurs in the QSD.\n939: \n940: **Step 3: Cloning Diversity Enhancement**\n941: \n942: The cloning operator amplifies kinetic separation. By {prf:ref}`doc-03-cloning`, Lemma 5.1.2 (Diversity Maintenance), walkers with low algorithmic diversity have death rate:\n943: \n944: $$\n945: \\lambda_{\\text{death}}(i) \\geq \\lambda_0 \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}(i, c(i))}{\\varepsilon_{\\text{pair}}}\\right)\n946: $$\n947: \n948: For clustered configurations where $m$ walkers satisfy $d_{\\text{alg}}(i,j) < r_{\\text{small}}$, the **total death rate** is exponentially enhanced: $\\Lambda_{\\text{cluster}} \\geq m \\cdot \\lambda_0 \\cdot e^{-r_{\\text{small}}/\\varepsilon_{\\text{pair}}} \\gg \\lambda_0$. This rapidly removes clustered states from the QSD.\n949: \n950: **Step 4: Uniform Density via Ergodic Theorem**\n951: \n952: By ergodicity, the QSD is the unique stationary measure. The density $\\rho_{\\text{phase}}^{\\text{QSD}}$ satisfies a **Fokker-Planck-Kolmogorov equation** with cloning source/sink terms. Standard elliptic regularity theory (Bogachev-Krylov-R√∂ckner, 2001) combined with:\n953: - Compactness of $\\mathcal{X} \\times V$ (velocity squashing, Lemma {prf:ref}`lem-velocity-squashing-compact-domain-full`)\n954: - Non-degenerate diffusion ($T > 0$)\n955: - Bounded drift ($\\|\\nabla V_{\\text{fit}}\\| \\leq L_V$ from C¬≥ regularity, {prf:ref}`doc-13-geometric-gas-c3-regularity`)\n956: \n957: implies:\n958: \n959: $$\n960: \\rho_{\\text{phase}}^{\\text{QSD}}(x,v) \\leq \\rho_{\\max} := C_{\\text{FK}}(\\gamma, T, L_V, V_{\\max}, \\text{Vol}(\\mathcal{X}))\n961: $$\n962: \n963: **Step 5: Deterministic Packing Bound**\n964: \n965: Combining Steps 2-4, for any configuration $(x,v)$ in the **support** of $\\pi_{\\text{QSD}}$:\n966: 1. Kinetic diffusion ensures no delta-function clustering (Step 2)\n967: 2. Cloning removes near-clustered states exponentially fast (Step 3)\n968: 3. Ergodicity ensures only \"typical\" configurations (satisfying density bound) have positive measure (Step 4)\n969: \n970: Therefore, **on the QSD support**, the local density is bounded by $\\rho_{\\max}$, which implies:\n971: \n972: $$\n973: \\#\\{j : d_{\\text{alg}}(i,j) \\leq r\\} \\leq \\int_{B(x_i, r)} \\rho_{\\text{phase}}^{\\text{QSD}}(y,u) \\, dy \\, du \\leq \\rho_{\\max} \\cdot \\text{Vol}(B(0, r))\n974: $$\n975: \n976: **Crucial Point**: Configurations violating this bound have **measure zero** in $\\pi_{\\text{QSD}}$ (by Steps 2-3, they are unstable and removed). Therefore, we can work with the bound deterministically on the QSD support.\n977: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-651",
      "title": null,
      "start_line": 1033,
      "end_line": 1094,
      "header_lines": [],
      "content_start": 1034,
      "content_end": 1093,
      "content": "1034: \n1035: :::{prf:proof}\n1036: **Proof using deterministic packing bound.**\n1037: \n1038: By Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`, on the support of the QSD, the local density is bounded by $\\rho_{\\max}$ **deterministically** (no probabilistic qualifier). This immediately provides the sum-to-integral bound.\n1039: \n1040: **Step 1: Deterministic upper bound via integral.**\n1041: \n1042: For any non-negative weight function $w(y, u)$ and $|f| \\leq M$, on configurations in $\\text{supp}(\\pi_{\\text{QSD}})$:\n1043: \n1044: $$\n1045: \\begin{aligned}\n1046: \\sum_{j \\in \\mathcal{A}} f(x_j, v_j) \\, w(x_j, v_j)\n1047: &\\leq M \\sum_{j \\in \\mathcal{A}} w(x_j, v_j) \\\\\n1048: &\\leq M \\cdot \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} w(y, u) \\, dy \\, du\n1049: \\end{aligned}\n1050: \n1051: $$\n1052: \n1053: where the second inequality uses the deterministic packing bound from Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`.\n1054: \n1055: **Justification**: For any measurable set $S \\subset \\mathcal{X} \\times \\mathbb{R}^d$, the deterministic packing bound gives:\n1056: \n1057: $$\n1058: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(S)\n1059: \n1060: $$\n1061: \n1062: Partitioning the sum by level sets of $w$ and applying this bound yields the integral upper bound.\n1063: \n1064: **Step 2: Gaussian weight evaluation.**\n1065: \n1066: For the exponential weight $w(y,u) = \\exp(-d_{\\text{alg}}^2(i,(y,u))/(2\\varepsilon_c^2))$:\n1067: \n1068: $$\n1069: \\begin{aligned}\n1070: \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{\\|y - x_i\\|^2 + \\lambda_{\\text{alg}} \\|u - v_i\\|^2 + \\varepsilon_d^2}{2\\varepsilon_c^2}\\right) dy\\,du\n1071: &\\leq \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right) \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y\\|^2 + \\lambda_{\\text{alg}} \\|u\\|^2}{2\\varepsilon_c^2}\\right) dy\\,du \\\\\n1072: &= (2\\pi\\varepsilon_c^2)^d \\cdot \\lambda_{\\text{alg}}^{-d/2} \\cdot \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right)\n1073: \\end{aligned}\n1074: \n1075: $$\n1076: \n1077: (using Gaussian integral formula in $2d$ dimensions with rescaling).\n1078: \n1079: **Step 3: Deterministic k-uniformity.**\n1080: \n1081: The bound:\n1082: \n1083: $$\n1084: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_c^2}\\right)\n1085: \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n1086: \n1087: $$\n1088: \n1089: holds **deterministically** (on the entire QSD support) and depends only on:\n1090: - $\\rho_{\\max}$ (from Keystone ergodicity, Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`)\n1091: - $\\varepsilon_c$ (algorithmic parameter)\n1092: - $d$ (dimension)\n1093: - $\\lambda_{\\text{alg}}$ (distance metric parameter)",
      "metadata": {},
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "1033: :::\n1034: \n1035: :::{prf:proof}\n1036: **Proof using deterministic packing bound.**\n1037: \n1038: By Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`, on the support of the QSD, the local density is bounded by $\\rho_{\\max}$ **deterministically** (no probabilistic qualifier). This immediately provides the sum-to-integral bound.\n1039: \n1040: **Step 1: Deterministic upper bound via integral.**\n1041: \n1042: For any non-negative weight function $w(y, u)$ and $|f| \\leq M$, on configurations in $\\text{supp}(\\pi_{\\text{QSD}})$:\n1043: \n1044: $$\n1045: \\begin{aligned}\n1046: \\sum_{j \\in \\mathcal{A}} f(x_j, v_j) \\, w(x_j, v_j)\n1047: &\\leq M \\sum_{j \\in \\mathcal{A}} w(x_j, v_j) \\\\\n1048: &\\leq M \\cdot \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} w(y, u) \\, dy \\, du\n1049: \\end{aligned}\n1050: \n1051: $$\n1052: \n1053: where the second inequality uses the deterministic packing bound from Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`.\n1054: \n1055: **Justification**: For any measurable set $S \\subset \\mathcal{X} \\times \\mathbb{R}^d$, the deterministic packing bound gives:\n1056: \n1057: $$\n1058: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(S)\n1059: \n1060: $$\n1061: \n1062: Partitioning the sum by level sets of $w$ and applying this bound yields the integral upper bound.\n1063: \n1064: **Step 2: Gaussian weight evaluation.**\n1065: \n1066: For the exponential weight $w(y,u) = \\exp(-d_{\\text{alg}}^2(i,(y,u))/(2\\varepsilon_c^2))$:\n1067: \n1068: $$\n1069: \\begin{aligned}\n1070: \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{\\|y - x_i\\|^2 + \\lambda_{\\text{alg}} \\|u - v_i\\|^2 + \\varepsilon_d^2}{2\\varepsilon_c^2}\\right) dy\\,du\n1071: &\\leq \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right) \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y\\|^2 + \\lambda_{\\text{alg}} \\|u\\|^2}{2\\varepsilon_c^2}\\right) dy\\,du \\\\\n1072: &= (2\\pi\\varepsilon_c^2)^d \\cdot \\lambda_{\\text{alg}}^{-d/2} \\cdot \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right)\n1073: \\end{aligned}\n1074: \n1075: $$\n1076: \n1077: (using Gaussian integral formula in $2d$ dimensions with rescaling).\n1078: \n1079: **Step 3: Deterministic k-uniformity.**\n1080: \n1081: The bound:\n1082: \n1083: $$\n1084: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_c^2}\\right)\n1085: \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n1086: \n1087: $$\n1088: \n1089: holds **deterministically** (on the entire QSD support) and depends only on:\n1090: - $\\rho_{\\max}$ (from Keystone ergodicity, Lemma {prf:ref}`lem-deterministic-packing-from-keystone-full`)\n1091: - $\\varepsilon_c$ (algorithmic parameter)\n1092: - $d$ (dimension)\n1093: - $\\lambda_{\\text{alg}}$ (distance metric parameter)\n1094: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-97",
      "title": null,
      "start_line": 1220,
      "end_line": 1262,
      "header_lines": [],
      "content_start": 1221,
      "content_end": 1261,
      "content": "1221: \n1222: :::{prf:proof}\n1223: **Step 1: Derivatives of the bump function.**\n1224: \n1225: For the smooth cutoff $\\phi(r)$, standard calculus gives:\n1226: \n1227: $$\n1228: |\\phi^{(n)}(r)| \\leq C_\\phi \\cdot n! \\cdot R^{-n}\n1229: \n1230: $$\n1231: \n1232: where $C_\\phi$ is a universal constant (Gevrey-1 bounds for smooth compactly supported functions).\n1233: \n1234: **Step 2: Chain rule for $\\tilde{\\psi}_m$.**\n1235: \n1236: Since $\\tilde{\\psi}_m(x,v) = \\phi(d_{\\text{alg}}((x,v), (y_m, u_m)) / (2\\varepsilon_c))$, by Fa√† di Bruno formula:\n1237: \n1238: $$\n1239: \\|\\nabla^n \\tilde{\\psi}_m\\|_\\infty \\leq C'_\\phi \\cdot n! \\cdot (2\\varepsilon_c)^{-n}\n1240: \n1241: $$\n1242: \n1243: (using $\\|\\nabla^j d_{\\text{alg}}\\|_\\infty = \\mathcal{O}(1)$ for $j \\geq 1$ - see Lemma {prf:ref}`lem-dalg-derivative-bounds-full`).\n1244: \n1245: **Step 3: Quotient rule for $\\psi_m$.**\n1246: \n1247: The normalized partition function:\n1248: \n1249: $$\n1250: \\psi_m = \\frac{\\tilde{\\psi}_m}{\\sum_{m'} \\tilde{\\psi}_{m'}}\n1251: \n1252: $$\n1253: \n1254: By quotient rule, with denominator bounded below by $1$ (sum of at least one non-zero $\\tilde{\\psi}_{m'}$):\n1255: \n1256: $$\n1257: \\|\\nabla^n \\psi_m\\|_\\infty \\leq C_{\\psi,n} \\cdot \\varepsilon_c^{-n}\n1258: \n1259: $$\n1260: \n1261: where $C_{\\psi,n} = \\mathcal{O}(n!)$ absorbs the combinatorial factors from the quotient rule.",
      "metadata": {},
      "section": "## 3. Smooth Phase-Space Clustering",
      "raw_directive": "1220: :::\n1221: \n1222: :::{prf:proof}\n1223: **Step 1: Derivatives of the bump function.**\n1224: \n1225: For the smooth cutoff $\\phi(r)$, standard calculus gives:\n1226: \n1227: $$\n1228: |\\phi^{(n)}(r)| \\leq C_\\phi \\cdot n! \\cdot R^{-n}\n1229: \n1230: $$\n1231: \n1232: where $C_\\phi$ is a universal constant (Gevrey-1 bounds for smooth compactly supported functions).\n1233: \n1234: **Step 2: Chain rule for $\\tilde{\\psi}_m$.**\n1235: \n1236: Since $\\tilde{\\psi}_m(x,v) = \\phi(d_{\\text{alg}}((x,v), (y_m, u_m)) / (2\\varepsilon_c))$, by Fa√† di Bruno formula:\n1237: \n1238: $$\n1239: \\|\\nabla^n \\tilde{\\psi}_m\\|_\\infty \\leq C'_\\phi \\cdot n! \\cdot (2\\varepsilon_c)^{-n}\n1240: \n1241: $$\n1242: \n1243: (using $\\|\\nabla^j d_{\\text{alg}}\\|_\\infty = \\mathcal{O}(1)$ for $j \\geq 1$ - see Lemma {prf:ref}`lem-dalg-derivative-bounds-full`).\n1244: \n1245: **Step 3: Quotient rule for $\\psi_m$.**\n1246: \n1247: The normalized partition function:\n1248: \n1249: $$\n1250: \\psi_m = \\frac{\\tilde{\\psi}_m}{\\sum_{m'} \\tilde{\\psi}_{m'}}\n1251: \n1252: $$\n1253: \n1254: By quotient rule, with denominator bounded below by $1$ (sum of at least one non-zero $\\tilde{\\psi}_{m'}$):\n1255: \n1256: $$\n1257: \\|\\nabla^n \\psi_m\\|_\\infty \\leq C_{\\psi,n} \\cdot \\varepsilon_c^{-n}\n1258: \n1259: $$\n1260: \n1261: where $C_{\\psi,n} = \\mathcal{O}(n!)$ absorbs the combinatorial factors from the quotient rule.\n1262: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 3. Smooth Phase-Space Clustering"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-196",
      "title": null,
      "start_line": 1319,
      "end_line": 1357,
      "header_lines": [],
      "content_start": 1320,
      "content_end": 1356,
      "content": "1320: \n1321: :::{prf:proof}\n1322: This lemma establishes uniform bounds on the effective cluster size using density bounds and geometric measure theory.\n1323: \n1324: **Part 1: Upper bound via density and support**\n1325: \n1326: From {prf:ref}`def-effective-cluster-population-full`, $k_m^{\\text{eff}} = \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j)$. Since $\\psi_m$ has support only within distance $2\\varepsilon_c$ of cluster center $(y_m, u_m)$, only walkers in the phase-space ball $B(y_m, 2\\varepsilon_c)$ contribute.\n1327: \n1328: Under the uniform density bound {prf:ref}`assump-uniform-density-full`, the number of walkers in any ball $B$ satisfies:\n1329: \n1330: $$\n1331: \\#\\{j : (x_j, v_j) \\in B\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(B)\n1332: \n1333: $$\n1334: \n1335: The phase-space has dimension $2d$ (position + velocity), so:\n1336: \n1337: $$\n1338: \\text{Vol}(B(y_m, 2\\varepsilon_c)) = \\frac{\\pi^d}{d!} (2\\varepsilon_c)^{2d} = C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1339: \n1340: $$\n1341: \n1342: where $C_{\\text{vol}} = 2^{2d} \\pi^d / d!$. Therefore:\n1343: \n1344: $$\n1345: k_m^{\\text{eff}} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1346: \n1347: $$\n1348: \n1349: **Part 2: Total population conservation**\n1350: \n1351: The partition functions satisfy $\\sum_{m=1}^M \\psi_m(x, v) = 1$ (partition of unity). Summing over all clusters:\n1352: \n1353: $$\n1354: \\sum_{m=1}^M k_m^{\\text{eff}} = \\sum_{m=1}^M \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} \\sum_{m=1}^M \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} 1 = k\n1355: \n1356: $$",
      "metadata": {},
      "section": "## 3. Smooth Phase-Space Clustering",
      "raw_directive": "1319: :::\n1320: \n1321: :::{prf:proof}\n1322: This lemma establishes uniform bounds on the effective cluster size using density bounds and geometric measure theory.\n1323: \n1324: **Part 1: Upper bound via density and support**\n1325: \n1326: From {prf:ref}`def-effective-cluster-population-full`, $k_m^{\\text{eff}} = \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j)$. Since $\\psi_m$ has support only within distance $2\\varepsilon_c$ of cluster center $(y_m, u_m)$, only walkers in the phase-space ball $B(y_m, 2\\varepsilon_c)$ contribute.\n1327: \n1328: Under the uniform density bound {prf:ref}`assump-uniform-density-full`, the number of walkers in any ball $B$ satisfies:\n1329: \n1330: $$\n1331: \\#\\{j : (x_j, v_j) \\in B\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(B)\n1332: \n1333: $$\n1334: \n1335: The phase-space has dimension $2d$ (position + velocity), so:\n1336: \n1337: $$\n1338: \\text{Vol}(B(y_m, 2\\varepsilon_c)) = \\frac{\\pi^d}{d!} (2\\varepsilon_c)^{2d} = C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1339: \n1340: $$\n1341: \n1342: where $C_{\\text{vol}} = 2^{2d} \\pi^d / d!$. Therefore:\n1343: \n1344: $$\n1345: k_m^{\\text{eff}} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1346: \n1347: $$\n1348: \n1349: **Part 2: Total population conservation**\n1350: \n1351: The partition functions satisfy $\\sum_{m=1}^M \\psi_m(x, v) = 1$ (partition of unity). Summing over all clusters:\n1352: \n1353: $$\n1354: \\sum_{m=1}^M k_m^{\\text{eff}} = \\sum_{m=1}^M \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} \\sum_{m=1}^M \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} 1 = k\n1355: \n1356: $$\n1357: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 3. Smooth Phase-Space Clustering"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-16",
      "title": null,
      "start_line": 1378,
      "end_line": 1405,
      "header_lines": [],
      "content_start": 1379,
      "content_end": 1404,
      "content": "1379: \n1380: :::{prf:proof}\n1381: **Step 1: Partition function lower bound.**\n1382: \n1383: By {prf:ref}`lem-companion-availability-enforcement`, there exists $\\ell^* \\in \\mathcal{A} \\setminus \\{i\\}$ with $d_{\\text{alg}}(i, \\ell^*) \\leq R_{\\max}$.\n1384: \n1385: Therefore:\n1386: \n1387: $$\n1388: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\exp\\left(-\\frac{C_{\\text{comp}}^2}{2}\\right) =: Z_{\\min} > 0\n1389: \n1390: $$\n1391: \n1392: **Step 2: Tail probability.**\n1393: \n1394: For $R > R_{\\max}$:\n1395: \n1396: $$\n1397: \\begin{aligned}\n1398: \\mathbb{P}(d_{\\text{alg}}(i,c(i)) > R)\n1399: &= \\sum_{\\ell : d(i,\\ell) > R} \\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_c^2))}{Z_i} \\\\\n1400: &\\leq \\frac{k \\cdot \\exp(-R^2/(2\\varepsilon_c^2))}{Z_{\\min}} \\\\\n1401: &= k \\cdot \\exp\\left(-\\frac{R^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n1402: \\end{aligned}\n1403: \n1404: $$",
      "metadata": {},
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1378: :::\n1379: \n1380: :::{prf:proof}\n1381: **Step 1: Partition function lower bound.**\n1382: \n1383: By {prf:ref}`lem-companion-availability-enforcement`, there exists $\\ell^* \\in \\mathcal{A} \\setminus \\{i\\}$ with $d_{\\text{alg}}(i, \\ell^*) \\leq R_{\\max}$.\n1384: \n1385: Therefore:\n1386: \n1387: $$\n1388: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\exp\\left(-\\frac{C_{\\text{comp}}^2}{2}\\right) =: Z_{\\min} > 0\n1389: \n1390: $$\n1391: \n1392: **Step 2: Tail probability.**\n1393: \n1394: For $R > R_{\\max}$:\n1395: \n1396: $$\n1397: \\begin{aligned}\n1398: \\mathbb{P}(d_{\\text{alg}}(i,c(i)) > R)\n1399: &= \\sum_{\\ell : d(i,\\ell) > R} \\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_c^2))}{Z_i} \\\\\n1400: &\\leq \\frac{k \\cdot \\exp(-R^2/(2\\varepsilon_c^2))}{Z_{\\min}} \\\\\n1401: &= k \\cdot \\exp\\left(-\\frac{R^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n1402: \\end{aligned}\n1403: \n1404: $$\n1405: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-65",
      "title": null,
      "start_line": 1427,
      "end_line": 1436,
      "header_lines": [],
      "content_start": 1428,
      "content_end": 1435,
      "content": "1428: \n1429: :::{prf:proof}\n1430: Set the tail bound from {prf:ref}`lem-softmax-tail-corrected-full` equal to $1/k$:\n1431: \n1432: $$\n1433: k \\cdot \\exp\\left(-\\frac{R_{\\text{eff}}^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\frac{1}{k}\n1434: \n1435: $$",
      "metadata": {},
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1427: :::\n1428: \n1429: :::{prf:proof}\n1430: Set the tail bound from {prf:ref}`lem-softmax-tail-corrected-full` equal to $1/k$:\n1431: \n1432: $$\n1433: k \\cdot \\exp\\left(-\\frac{R_{\\text{eff}}^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\frac{1}{k}\n1434: \n1435: $$\n1436: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-98",
      "title": null,
      "start_line": 1460,
      "end_line": 1462,
      "header_lines": [],
      "content_start": 1461,
      "content_end": 1461,
      "content": "1461: ",
      "metadata": {},
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1460: :::\n1461: \n1462: :::{prf:proof}",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-127",
      "title": null,
      "start_line": 1489,
      "end_line": 1561,
      "header_lines": [],
      "content_start": 1490,
      "content_end": 1560,
      "content": "1490: \n1491: :::{prf:proof}\n1492: **Step 1: Structure of softmax probability.**\n1493: \n1494: $$\n1495: P(c(j) = \\ell) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))}{\\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_c^2))} =: \\frac{K_j^\\ell}{Z_j}\n1496: \n1497: $$\n1498: \n1499: where $K_j^\\ell = \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))$ and $Z_j = \\sum_{\\ell'} K_j^{\\ell'}$.\n1500: \n1501: **Step 2: First derivative via quotient rule.**\n1502: \n1503: $$\n1504: \\nabla_{x_i} P(c(j) = \\ell) = \\frac{(\\nabla_{x_i} K_j^\\ell) \\cdot Z_j - K_j^\\ell \\cdot (\\nabla_{x_i} Z_j)}{Z_j^2}\n1505: \n1506: $$\n1507: \n1508: For the Gaussian kernel:\n1509: \n1510: $$\n1511: \\nabla_{x_i} K_j^\\ell = K_j^\\ell \\cdot \\nabla_{x_i} \\left(-\\frac{d_{\\text{alg}}^2(j,\\ell)}{2\\varepsilon_c^2}\\right) = -\\frac{K_j^\\ell}{\\varepsilon_c^2} \\cdot d_{\\text{alg}}(j,\\ell) \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\n1512: \n1513: $$\n1514: \n1515: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\\| \\leq 1$. Therefore:\n1516: \n1517: $$\n1518: \\|\\nabla_{x_i} K_j^\\ell\\| \\leq \\frac{d_{\\text{alg}}(j,\\ell)}{\\varepsilon_c^2} \\cdot K_j^\\ell \\leq \\frac{1}{\\varepsilon_c} \\cdot K_j^\\ell\n1519: \n1520: $$\n1521: \n1522: (using $d_{\\text{alg}}/\\varepsilon_c \\ll 1$ for effective contributors).\n1523: \n1524: **Step 3: Partition function derivative.**\n1525: \n1526: $$\n1527: \\nabla_{x_i} Z_j = \\sum_{\\ell' \\neq j} \\nabla_{x_i} K_j^{\\ell'} = -\\frac{1}{\\varepsilon_c^2} \\sum_{\\ell'} K_j^{\\ell'} \\cdot d_{\\text{alg}}(j,\\ell') \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell')\n1528: \n1529: $$\n1530: \n1531: **Key observation**: If $i = j$ or $i = \\ell$, the derivative acts directly on the exponential. If $i \\neq j, \\ell$, the derivative couples through the N-body softmax structure. However, by exponential concentration:\n1532: \n1533: $$\n1534: \\|\\nabla_{x_i} Z_j\\| \\leq \\frac{k_{\\text{eff}}^{(\\varepsilon_c)}}{\\varepsilon_c^2} \\cdot Z_j \\leq \\frac{C_{\\text{eff}}}{\\varepsilon_c^2} \\cdot Z_j\n1535: \n1536: $$\n1537: \n1538: where $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\rho_{\\max} \\varepsilon_c^{2d} (\\log k)^d)$ grows logarithmically with $k$.\n1539: \n1540: **Step 4: Assemble first derivative bound.**\n1541: \n1542: $$\n1543: |\\nabla_{x_i} P(c(j) = \\ell)| \\leq \\frac{|\\nabla K_j^\\ell| \\cdot Z_j + K_j^\\ell \\cdot |\\nabla Z_j|}{Z_j^2} \\leq \\frac{C_1}{\\varepsilon_c^2} \\cdot P(c(j) = \\ell)\n1544: \n1545: $$\n1546: \n1547: where $C_1 = O(1 + k_{\\text{eff}}^{(\\varepsilon_c)})$ contains the $(\\log k)^d$ factor, which is **absorbed into higher-order Gevrey-1 constants** (see ¬ß7.1 for how derivative locality prevents this from affecting k-uniformity).\n1548: \n1549: **Step 5: Higher derivatives by induction.**\n1550: \n1551: For $|\\alpha| \\geq 2$, apply Fa√† di Bruno formula to $\\nabla^\\alpha \\log P = \\nabla^\\alpha (\\log K_j^\\ell - \\log Z_j)$. Each term has structure:\n1552: \n1553: $$\n1554: \\nabla^\\alpha K_j^\\ell = K_j^\\ell \\cdot \\text{(polynomial of degree } |\\alpha| \\text{ in } d_{\\text{alg}}, \\nabla d_{\\text{alg}}, \\ldots)\n1555: \n1556: $$\n1557: \n1558: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla^m d_{\\text{alg}}\\| \\leq C_m \\varepsilon_d^{1-m}$. For $\\varepsilon_d \\ll \\varepsilon_c$ (typical), the dominant factor is $\\varepsilon_c^{-2|\\alpha|}$ from repeated differentiation of the exponential.\n1559: \n1560: Exponential decay: The softmax structure ensures that walkers with $d_{\\text{alg}}(j,\\ell) > R_{\\text{eff}}$ contribute $\\exp(-R_{\\text{eff}}^2/(2\\varepsilon_c^2))$ to probabilities and $\\exp(-R_{\\text{eff}}^2/(4\\varepsilon_c^2))$ to derivatives (from quotient rule cancellations). This provides the claimed **double exponential suppression** for distant walkers.",
      "metadata": {},
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1489: :::\n1490: \n1491: :::{prf:proof}\n1492: **Step 1: Structure of softmax probability.**\n1493: \n1494: $$\n1495: P(c(j) = \\ell) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))}{\\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_c^2))} =: \\frac{K_j^\\ell}{Z_j}\n1496: \n1497: $$\n1498: \n1499: where $K_j^\\ell = \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))$ and $Z_j = \\sum_{\\ell'} K_j^{\\ell'}$.\n1500: \n1501: **Step 2: First derivative via quotient rule.**\n1502: \n1503: $$\n1504: \\nabla_{x_i} P(c(j) = \\ell) = \\frac{(\\nabla_{x_i} K_j^\\ell) \\cdot Z_j - K_j^\\ell \\cdot (\\nabla_{x_i} Z_j)}{Z_j^2}\n1505: \n1506: $$\n1507: \n1508: For the Gaussian kernel:\n1509: \n1510: $$\n1511: \\nabla_{x_i} K_j^\\ell = K_j^\\ell \\cdot \\nabla_{x_i} \\left(-\\frac{d_{\\text{alg}}^2(j,\\ell)}{2\\varepsilon_c^2}\\right) = -\\frac{K_j^\\ell}{\\varepsilon_c^2} \\cdot d_{\\text{alg}}(j,\\ell) \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\n1512: \n1513: $$\n1514: \n1515: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\\| \\leq 1$. Therefore:\n1516: \n1517: $$\n1518: \\|\\nabla_{x_i} K_j^\\ell\\| \\leq \\frac{d_{\\text{alg}}(j,\\ell)}{\\varepsilon_c^2} \\cdot K_j^\\ell \\leq \\frac{1}{\\varepsilon_c} \\cdot K_j^\\ell\n1519: \n1520: $$\n1521: \n1522: (using $d_{\\text{alg}}/\\varepsilon_c \\ll 1$ for effective contributors).\n1523: \n1524: **Step 3: Partition function derivative.**\n1525: \n1526: $$\n1527: \\nabla_{x_i} Z_j = \\sum_{\\ell' \\neq j} \\nabla_{x_i} K_j^{\\ell'} = -\\frac{1}{\\varepsilon_c^2} \\sum_{\\ell'} K_j^{\\ell'} \\cdot d_{\\text{alg}}(j,\\ell') \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell')\n1528: \n1529: $$\n1530: \n1531: **Key observation**: If $i = j$ or $i = \\ell$, the derivative acts directly on the exponential. If $i \\neq j, \\ell$, the derivative couples through the N-body softmax structure. However, by exponential concentration:\n1532: \n1533: $$\n1534: \\|\\nabla_{x_i} Z_j\\| \\leq \\frac{k_{\\text{eff}}^{(\\varepsilon_c)}}{\\varepsilon_c^2} \\cdot Z_j \\leq \\frac{C_{\\text{eff}}}{\\varepsilon_c^2} \\cdot Z_j\n1535: \n1536: $$\n1537: \n1538: where $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\rho_{\\max} \\varepsilon_c^{2d} (\\log k)^d)$ grows logarithmically with $k$.\n1539: \n1540: **Step 4: Assemble first derivative bound.**\n1541: \n1542: $$\n1543: |\\nabla_{x_i} P(c(j) = \\ell)| \\leq \\frac{|\\nabla K_j^\\ell| \\cdot Z_j + K_j^\\ell \\cdot |\\nabla Z_j|}{Z_j^2} \\leq \\frac{C_1}{\\varepsilon_c^2} \\cdot P(c(j) = \\ell)\n1544: \n1545: $$\n1546: \n1547: where $C_1 = O(1 + k_{\\text{eff}}^{(\\varepsilon_c)})$ contains the $(\\log k)^d$ factor, which is **absorbed into higher-order Gevrey-1 constants** (see ¬ß7.1 for how derivative locality prevents this from affecting k-uniformity).\n1548: \n1549: **Step 5: Higher derivatives by induction.**\n1550: \n1551: For $|\\alpha| \\geq 2$, apply Fa√† di Bruno formula to $\\nabla^\\alpha \\log P = \\nabla^\\alpha (\\log K_j^\\ell - \\log Z_j)$. Each term has structure:\n1552: \n1553: $$\n1554: \\nabla^\\alpha K_j^\\ell = K_j^\\ell \\cdot \\text{(polynomial of degree } |\\alpha| \\text{ in } d_{\\text{alg}}, \\nabla d_{\\text{alg}}, \\ldots)\n1555: \n1556: $$\n1557: \n1558: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla^m d_{\\text{alg}}\\| \\leq C_m \\varepsilon_d^{1-m}$. For $\\varepsilon_d \\ll \\varepsilon_c$ (typical), the dominant factor is $\\varepsilon_c^{-2|\\alpha|}$ from repeated differentiation of the exponential.\n1559: \n1560: Exponential decay: The softmax structure ensures that walkers with $d_{\\text{alg}}(j,\\ell) > R_{\\text{eff}}$ contribute $\\exp(-R_{\\text{eff}}^2/(2\\varepsilon_c^2))$ to probabilities and $\\exp(-R_{\\text{eff}}^2/(4\\varepsilon_c^2))$ to derivatives (from quotient rule cancellations). This provides the claimed **double exponential suppression** for distant walkers.\n1561: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-48",
      "title": null,
      "start_line": 1620,
      "end_line": 1706,
      "header_lines": [],
      "content_start": 1621,
      "content_end": 1705,
      "content": "1621: \n1622: :::{prf:proof}\n1623: **Step 0: Regularization eliminates singularity.**\n1624: \n1625: Let $r^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2 \\geq 0$. Then:\n1626: \n1627: $$\n1628: d_{\\text{alg}}(i,j) = \\sqrt{r^2 + \\varepsilon_d^2}\n1629: \n1630: $$\n1631: \n1632: **Key observation**: Even when $r = 0$ (walkers coincide), we have $d_{\\text{alg}}(i,j) = \\varepsilon_d > 0$. This **eliminates the singularity** at the origin that would occur for the unregularized distance $\\sqrt{r^2}$.\n1633: \n1634: **Step 1: First derivative.**\n1635: \n1636: Direct calculation using the chain rule:\n1637: \n1638: $$\n1639: \\frac{\\partial}{\\partial x_i^{(\\alpha)}} d_{\\text{alg}}(i,j) = \\frac{\\partial}{\\partial x_i^{(\\alpha)}} \\sqrt{r^2 + \\varepsilon_d^2}\n1640: = \\frac{1}{2\\sqrt{r^2 + \\varepsilon_d^2}} \\cdot 2(x_i^{(\\alpha)} - x_j^{(\\alpha)})\n1641: = \\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\n1642: \n1643: $$\n1644: \n1645: Since $|x_i^{(\\alpha)} - x_j^{(\\alpha)}| \\leq r \\leq d_{\\text{alg}}(i,j)$, we have:\n1646: \n1647: $$\n1648: \\|\\nabla_{x_i} d_{\\text{alg}}(i,j)\\| = \\frac{\\|x_i - x_j\\|}{d_{\\text{alg}}(i,j)} \\leq 1\n1649: \n1650: $$\n1651: \n1652: **Step 2: Second derivative (quotient rule with uniform bound).**\n1653: \n1654: $$\n1655: \\frac{\\partial^2}{\\partial x_i^{(\\alpha)} \\partial x_i^{(\\beta)}} d_{\\text{alg}}(i,j)\n1656: = \\frac{\\partial}{\\partial x_i^{(\\beta)}} \\left[\\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\\right]\n1657: \n1658: $$\n1659: \n1660: Applying quotient rule:\n1661: \n1662: $$\n1663: = \\frac{\\delta_{\\alpha\\beta}}{d_{\\text{alg}}(i,j)} - \\frac{(x_i^{(\\alpha)} - x_j^{(\\alpha)})(x_i^{(\\beta)} - x_j^{(\\beta)})}{d_{\\text{alg}}^3(i,j)}\n1664: \n1665: $$\n1666: \n1667: **Crucial difference from unregularized case**: Since $d_{\\text{alg}}(i,j) \\geq \\varepsilon_d > 0$ always, we obtain a **uniform bound**:\n1668: \n1669: $$\n1670: \\|\\nabla^2_{x_i} d_{\\text{alg}}(i,j)\\| \\leq \\frac{1}{\\varepsilon_d}\n1671: \n1672: $$\n1673: \n1674: Without regularization (Œµ_d = 0), this bound would **blow up** as $d_{\\text{alg}} \\to 0$ (walker collisions).\n1675: \n1676: **Step 3: Higher derivatives by induction with uniform bounds.**\n1677: \n1678: By induction on $n$, each derivative introduces:\n1679: - A quotient rule factor (Leibniz/Fa√† di Bruno)\n1680: - Additional powers of $1/d_{\\text{alg}}$\n1681: \n1682: The general bound:\n1683: \n1684: $$\n1685: \\|\\nabla^n d_{\\text{alg}}\\| \\leq C_{d,n} \\cdot d_{\\text{alg}}^{1-n} \\leq C_{d,n} \\cdot \\varepsilon_d^{1-n}\n1686: \n1687: $$\n1688: \n1689: follows from the Fa√† di Bruno formula for $(f \\circ g)^{(n)}$ where $f(s) = \\sqrt{s}$ and $s = r^2 + \\varepsilon_d^2$.\n1690: \n1691: The factorial growth $C_{d,n} = \\mathcal{O}(n!)$ comes from the $n$-th derivative of $\\sqrt{s}$ at $s \\geq \\varepsilon_d^2 > 0$:\n1692: \n1693: $$\n1694: \\frac{d^n}{ds^n} \\sqrt{s} = (-1)^{n-1} \\frac{(2n-3)!!}{2^n} s^{1/2 - n}\n1695: \n1696: $$\n1697: \n1698: where $(2n-3)!! = \\mathcal{O}(n! / 2^n)$, giving the Gevrey-1 bound.\n1699: \n1700: **Crucial point**: Evaluating at $s \\geq \\varepsilon_d^2$ gives:\n1701: \n1702: $$\n1703: \\left|\\frac{d^n}{ds^n} \\sqrt{s}\\right| \\leq \\frac{C_n}{\\varepsilon_d^{n-1}} \\quad \\text{(uniform bound)}\n1704: \n1705: $$",
      "metadata": {},
      "section": "## 5. Derivatives of Algorithmic Distance (Regularized Version)",
      "raw_directive": "1620: :::\n1621: \n1622: :::{prf:proof}\n1623: **Step 0: Regularization eliminates singularity.**\n1624: \n1625: Let $r^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2 \\geq 0$. Then:\n1626: \n1627: $$\n1628: d_{\\text{alg}}(i,j) = \\sqrt{r^2 + \\varepsilon_d^2}\n1629: \n1630: $$\n1631: \n1632: **Key observation**: Even when $r = 0$ (walkers coincide), we have $d_{\\text{alg}}(i,j) = \\varepsilon_d > 0$. This **eliminates the singularity** at the origin that would occur for the unregularized distance $\\sqrt{r^2}$.\n1633: \n1634: **Step 1: First derivative.**\n1635: \n1636: Direct calculation using the chain rule:\n1637: \n1638: $$\n1639: \\frac{\\partial}{\\partial x_i^{(\\alpha)}} d_{\\text{alg}}(i,j) = \\frac{\\partial}{\\partial x_i^{(\\alpha)}} \\sqrt{r^2 + \\varepsilon_d^2}\n1640: = \\frac{1}{2\\sqrt{r^2 + \\varepsilon_d^2}} \\cdot 2(x_i^{(\\alpha)} - x_j^{(\\alpha)})\n1641: = \\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\n1642: \n1643: $$\n1644: \n1645: Since $|x_i^{(\\alpha)} - x_j^{(\\alpha)}| \\leq r \\leq d_{\\text{alg}}(i,j)$, we have:\n1646: \n1647: $$\n1648: \\|\\nabla_{x_i} d_{\\text{alg}}(i,j)\\| = \\frac{\\|x_i - x_j\\|}{d_{\\text{alg}}(i,j)} \\leq 1\n1649: \n1650: $$\n1651: \n1652: **Step 2: Second derivative (quotient rule with uniform bound).**\n1653: \n1654: $$\n1655: \\frac{\\partial^2}{\\partial x_i^{(\\alpha)} \\partial x_i^{(\\beta)}} d_{\\text{alg}}(i,j)\n1656: = \\frac{\\partial}{\\partial x_i^{(\\beta)}} \\left[\\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\\right]\n1657: \n1658: $$\n1659: \n1660: Applying quotient rule:\n1661: \n1662: $$\n1663: = \\frac{\\delta_{\\alpha\\beta}}{d_{\\text{alg}}(i,j)} - \\frac{(x_i^{(\\alpha)} - x_j^{(\\alpha)})(x_i^{(\\beta)} - x_j^{(\\beta)})}{d_{\\text{alg}}^3(i,j)}\n1664: \n1665: $$\n1666: \n1667: **Crucial difference from unregularized case**: Since $d_{\\text{alg}}(i,j) \\geq \\varepsilon_d > 0$ always, we obtain a **uniform bound**:\n1668: \n1669: $$\n1670: \\|\\nabla^2_{x_i} d_{\\text{alg}}(i,j)\\| \\leq \\frac{1}{\\varepsilon_d}\n1671: \n1672: $$\n1673: \n1674: Without regularization (Œµ_d = 0), this bound would **blow up** as $d_{\\text{alg}} \\to 0$ (walker collisions).\n1675: \n1676: **Step 3: Higher derivatives by induction with uniform bounds.**\n1677: \n1678: By induction on $n$, each derivative introduces:\n1679: - A quotient rule factor (Leibniz/Fa√† di Bruno)\n1680: - Additional powers of $1/d_{\\text{alg}}$\n1681: \n1682: The general bound:\n1683: \n1684: $$\n1685: \\|\\nabla^n d_{\\text{alg}}\\| \\leq C_{d,n} \\cdot d_{\\text{alg}}^{1-n} \\leq C_{d,n} \\cdot \\varepsilon_d^{1-n}\n1686: \n1687: $$\n1688: \n1689: follows from the Fa√† di Bruno formula for $(f \\circ g)^{(n)}$ where $f(s) = \\sqrt{s}$ and $s = r^2 + \\varepsilon_d^2$.\n1690: \n1691: The factorial growth $C_{d,n} = \\mathcal{O}(n!)$ comes from the $n$-th derivative of $\\sqrt{s}$ at $s \\geq \\varepsilon_d^2 > 0$:\n1692: \n1693: $$\n1694: \\frac{d^n}{ds^n} \\sqrt{s} = (-1)^{n-1} \\frac{(2n-3)!!}{2^n} s^{1/2 - n}\n1695: \n1696: $$\n1697: \n1698: where $(2n-3)!! = \\mathcal{O}(n! / 2^n)$, giving the Gevrey-1 bound.\n1699: \n1700: **Crucial point**: Evaluating at $s \\geq \\varepsilon_d^2$ gives:\n1701: \n1702: $$\n1703: \\left|\\frac{d^n}{ds^n} \\sqrt{s}\\right| \\leq \\frac{C_n}{\\varepsilon_d^{n-1}} \\quad \\text{(uniform bound)}\n1704: \n1705: $$\n1706: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 5. Derivatives of Algorithmic Distance (Regularized Version)"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-46",
      "title": null,
      "start_line": 1793,
      "end_line": 1813,
      "header_lines": [],
      "content_start": 1796,
      "content_end": 1812,
      "content": "1796: \n1797: :::{note}\n1798: **Derivative Structure Preview**: The companion-dependent measurement has the structure:\n1799: \n1800: $$\n1801: d_j = \\frac{N_j}{Z_j} = \\frac{\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\cdot e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}{\\sum_{\\ell} e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}\n1802: \n1803: $$\n1804: \n1805: This is a **quotient of weighted sums**, leading to high complexity. The n-th derivative involves:\n1806: \n1807: 1. **Leibniz rule** for products: $d_{\\text{alg}} \\cdot \\exp(\\cdots)$\n1808: 2. **Fa√† di Bruno** for exponential: $\\exp(-d_{\\text{alg}}^2/(2\\varepsilon_c^2))$\n1809: 3. **Quotient rule** for $N_j / Z_j$ (introduces additional partitions)\n1810: 4. **Sum over companions**: Each term has exponential decay, ensuring k-uniformity\n1811: \n1812: **Key challenge**: Tracking which scale dominates‚Äî$\\varepsilon_d^{1-n}$ (from $d_{\\text{alg}}$ derivatives) vs $\\varepsilon_c^{-n}$ (from exponential kernel derivatives).",
      "metadata": {},
      "section": "## 5.5 Companion-Dependent Measurements with Softmax Coupling",
      "raw_directive": "1793: :::\n1794: \n1795: :::{prf:proof}\n1796: \n1797: :::{note}\n1798: **Derivative Structure Preview**: The companion-dependent measurement has the structure:\n1799: \n1800: $$\n1801: d_j = \\frac{N_j}{Z_j} = \\frac{\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\cdot e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}{\\sum_{\\ell} e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}\n1802: \n1803: $$\n1804: \n1805: This is a **quotient of weighted sums**, leading to high complexity. The n-th derivative involves:\n1806: \n1807: 1. **Leibniz rule** for products: $d_{\\text{alg}} \\cdot \\exp(\\cdots)$\n1808: 2. **Fa√† di Bruno** for exponential: $\\exp(-d_{\\text{alg}}^2/(2\\varepsilon_c^2))$\n1809: 3. **Quotient rule** for $N_j / Z_j$ (introduces additional partitions)\n1810: 4. **Sum over companions**: Each term has exponential decay, ensuring k-uniformity\n1811: \n1812: **Key challenge**: Tracking which scale dominates‚Äî$\\varepsilon_d^{1-n}$ (from $d_{\\text{alg}}$ derivatives) vs $\\varepsilon_c^{-n}$ (from exponential kernel derivatives).\n1813: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 5.5 Companion-Dependent Measurements with Softmax Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-315",
      "title": null,
      "start_line": 2062,
      "end_line": 2157,
      "header_lines": [],
      "content_start": 2063,
      "content_end": 2156,
      "content": "2063: \n2064: :::{prf:proof}\n2065: The self-measurement is:\n2066: \n2067: $$\n2068: d_i = \\frac{N_i}{Z_i}, \\quad N_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right), \\quad Z_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2069: \n2070: $$\n2071: \n2072: **Step 1: Derivatives of numerator $N_i$.**\n2073: \n2074: For $\\ell \\neq i$, the $\\ell$-th term in $N_i$ is:\n2075: \n2076: $$\n2077: f_\\ell := d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2078: \n2079: $$\n2080: \n2081: By the Leibniz rule (as in ¬ß5.5.2 for j‚â†i case), the $n$-th derivative satisfies:\n2082: \n2083: $$\n2084: \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2085: \n2086: $$\n2087: \n2088: where $C_{f,n} = \\mathcal{O}(n!)$ (Gevrey-1).\n2089: \n2090: **Summing over $\\ell$**:\n2091: \n2092: $$\n2093: \\|\\nabla^n_{x_i} N_i\\| \\leq \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2094: \n2095: $$\n2096: \n2097: **Step 2: Apply sum-to-integral bound.**\n2098: \n2099: By Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f \\equiv 1$:\n2100: \n2101: $$\n2102: \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n2103: \n2104: $$\n2105: \n2106: This bound is **k-uniform**: it depends only on $(\\rho_{\\max}, \\varepsilon_c, d)$, **not on $k$**.\n2107: \n2108: Therefore:\n2109: \n2110: $$\n2111: \\|\\nabla^n_{x_i} N_i\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2112: \n2113: $$\n2114: \n2115: **Step 3: Derivatives of partition function $Z_i$.**\n2116: \n2117: Similarly, for the exponential terms in $Z_i$:\n2118: \n2119: $$\n2120: \\|\\nabla^n_{x_i} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2121: \n2122: $$\n2123: \n2124: Summing and applying the sum-to-integral bound:\n2125: \n2126: $$\n2127: \\|\\nabla^n_{x_i} Z_i\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2128: \n2129: $$\n2130: \n2131: which is **k-uniform**.\n2132: \n2133: **Step 4: Quotient rule for $d_i = N_i / Z_i$.**\n2134: \n2135: By the generalized quotient rule (Fa√† di Bruno formula), the derivatives of $d_i$ involve products of $\\nabla^k N_i$ and $\\nabla^\\ell Z_i$ with $k + \\ell \\leq n$, divided by powers of $Z_i$.\n2136: \n2137: **Lower bound for $Z_i$**: By Lemma {prf:ref}`lem-companion-availability-enforcement`:\n2138: \n2139: $$\n2140: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n2141: \n2142: $$\n2143: \n2144: Combining the bounds from Steps 2-3 and applying the quotient rule:\n2145: \n2146: $$\n2147: \\|\\nabla^n_{x_i} d_i\\| \\leq C_{d_i,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2148: \n2149: $$\n2150: \n2151: where $C_{d_i,n} = \\mathcal{O}(n!)$ arises from:\n2152: - Fa√† di Bruno combinatorics: $\\mathcal{O}(n!)$\n2153: - Factorial growth from $C_{f,n}, C_{K,n}$: each $\\mathcal{O}(n!)$\n2154: - **k-uniform factors**: $\\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda} / Z_{\\min}$ (no $k$-dependence)\n2155: \n2156: **Conclusion**: The constant $C_{d_i,n}$ is **k-uniform** because the sum over companions is controlled by the sum-to-integral bound (Lemma {prf:ref}`lem-sum-to-integral-bound-full`), which replaces the naive $\\mathcal{O}(k)$ factor with $\\mathcal{O}(\\rho_{\\max} \\varepsilon_c^{2d})$ (independent of $k$).",
      "metadata": {},
      "section": "## 5.5 Companion-Dependent Measurements with Softmax Coupling",
      "raw_directive": "2062: :::\n2063: \n2064: :::{prf:proof}\n2065: The self-measurement is:\n2066: \n2067: $$\n2068: d_i = \\frac{N_i}{Z_i}, \\quad N_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right), \\quad Z_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2069: \n2070: $$\n2071: \n2072: **Step 1: Derivatives of numerator $N_i$.**\n2073: \n2074: For $\\ell \\neq i$, the $\\ell$-th term in $N_i$ is:\n2075: \n2076: $$\n2077: f_\\ell := d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2078: \n2079: $$\n2080: \n2081: By the Leibniz rule (as in ¬ß5.5.2 for j‚â†i case), the $n$-th derivative satisfies:\n2082: \n2083: $$\n2084: \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2085: \n2086: $$\n2087: \n2088: where $C_{f,n} = \\mathcal{O}(n!)$ (Gevrey-1).\n2089: \n2090: **Summing over $\\ell$**:\n2091: \n2092: $$\n2093: \\|\\nabla^n_{x_i} N_i\\| \\leq \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2094: \n2095: $$\n2096: \n2097: **Step 2: Apply sum-to-integral bound.**\n2098: \n2099: By Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f \\equiv 1$:\n2100: \n2101: $$\n2102: \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n2103: \n2104: $$\n2105: \n2106: This bound is **k-uniform**: it depends only on $(\\rho_{\\max}, \\varepsilon_c, d)$, **not on $k$**.\n2107: \n2108: Therefore:\n2109: \n2110: $$\n2111: \\|\\nabla^n_{x_i} N_i\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2112: \n2113: $$\n2114: \n2115: **Step 3: Derivatives of partition function $Z_i$.**\n2116: \n2117: Similarly, for the exponential terms in $Z_i$:\n2118: \n2119: $$\n2120: \\|\\nabla^n_{x_i} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2121: \n2122: $$\n2123: \n2124: Summing and applying the sum-to-integral bound:\n2125: \n2126: $$\n2127: \\|\\nabla^n_{x_i} Z_i\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2128: \n2129: $$\n2130: \n2131: which is **k-uniform**.\n2132: \n2133: **Step 4: Quotient rule for $d_i = N_i / Z_i$.**\n2134: \n2135: By the generalized quotient rule (Fa√† di Bruno formula), the derivatives of $d_i$ involve products of $\\nabla^k N_i$ and $\\nabla^\\ell Z_i$ with $k + \\ell \\leq n$, divided by powers of $Z_i$.\n2136: \n2137: **Lower bound for $Z_i$**: By Lemma {prf:ref}`lem-companion-availability-enforcement`:\n2138: \n2139: $$\n2140: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n2141: \n2142: $$\n2143: \n2144: Combining the bounds from Steps 2-3 and applying the quotient rule:\n2145: \n2146: $$\n2147: \\|\\nabla^n_{x_i} d_i\\| \\leq C_{d_i,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2148: \n2149: $$\n2150: \n2151: where $C_{d_i,n} = \\mathcal{O}(n!)$ arises from:\n2152: - Fa√† di Bruno combinatorics: $\\mathcal{O}(n!)$\n2153: - Factorial growth from $C_{f,n}, C_{K,n}$: each $\\mathcal{O}(n!)$\n2154: - **k-uniform factors**: $\\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda} / Z_{\\min}$ (no $k$-dependence)\n2155: \n2156: **Conclusion**: The constant $C_{d_i,n}$ is **k-uniform** because the sum over companions is controlled by the sum-to-integral bound (Lemma {prf:ref}`lem-sum-to-integral-bound-full`), which replaces the naive $\\mathcal{O}(k)$ factor with $\\mathcal{O}(\\rho_{\\max} \\varepsilon_c^{2d})$ (independent of $k$).\n2157: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 5.5 Companion-Dependent Measurements with Softmax Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-97",
      "title": null,
      "start_line": 2259,
      "end_line": 2436,
      "header_lines": [],
      "content_start": 2260,
      "content_end": 2435,
      "content": "2260: \n2261: :::{prf:proof}\n2262: **Step 1: Expected measurement structure**\n2263: \n2264: $$\n2265: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2266: \n2267: $$\n2268: \n2269: where:\n2270: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2271: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2272: \n2273: **Step 2: Exponential concentration of matching weights**\n2274: \n2275: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2276: \n2277: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2278: \n2279: $$\n2280: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2281: \n2282: $$\n2283: \n2284: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2285: \n2286: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2287: \n2288: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2289: \n2290: $$\n2291: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2292: \n2293: $$\n2294: \n2295: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2296: \n2297: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2298: \n2299: $$\n2300: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2301: \n2302: $$\n2303: \n2304: Then the expected measurement becomes:\n2305: \n2306: $$\n2307: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2308: \n2309: $$\n2310: \n2311: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2312: \n2313: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2314: \n2315: $$\n2316: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2317: \n2318: $$\n2319: \n2320: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2321: \n2322: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^‚àû regularity with k-uniform bounds **without** assuming this approximation.\n2323: \n2324: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2325: \n2326: $$\n2327: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2328: $$\n2329: \n2330: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2331: \n2332: **Consequence**: The marginal probability has simplified derivative structure:\n2333: \n2334: $$\n2335: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2336: $$\n2337: \n2338: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2339: \n2340: **Result**: The expected measurement has analytical structure\n2341: \n2342: $$\n2343: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2344: $$\n2345: \n2346: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2347: \n2348: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2349: \n2350: **Step 4: Derivative analysis via locality**\n2351: \n2352: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2353: \n2354: $$\n2355: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2356: $$\n2357: \n2358: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2359: \n2360: $$\n2361: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2362: $$\n2363: \n2364: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2365: 1. **Bounded**: By exponential weights, all ratios ‚â§ exp(const ¬∑ (R_eff)¬≤/Œµ_d¬≤) < ‚àû\n2366: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(œÅ_max Œµ_d^{2d}), independent of k\n2367: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2368: \n2369: The derivatives follow from standard quotient rule + Fa√† di Bruno:\n2370: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2371: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2372: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2373: \n2374: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2375: \n2376: $$\n2377: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2378: \n2379: $$\n2380: \n2381: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2382: \n2383: **Step 5: Derivative bound via quotient rule**\n2384: \n2385: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2386: \n2387: $$\n2388: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2389: \n2390: $$\n2391: \n2392: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2393: \n2394: $$\n2395: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2396: \n2397: $$\n2398: \n2399: By the product rule and Fa√† di Bruno formula:\n2400: \n2401: $$\n2402: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2403: \n2404: $$\n2405: \n2406: **Bounds on each term**:\n2407: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2408: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2409: \n2410: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2411: \n2412: $$\n2413: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2414: \n2415: $$\n2416: \n2417: which is **k-uniform** (independent of total swarm size).\n2418: \n2419: **Step 6: Assemble the Gevrey-1 bound**\n2420: \n2421: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2422: \n2423: $$\n2424: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2425: \n2426: $$\n2427: \n2428: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2429: \n2430: $$\n2431: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2432: \n2433: $$\n2434: \n2435: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.",
      "metadata": {},
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "raw_directive": "2259: :::\n2260: \n2261: :::{prf:proof}\n2262: **Step 1: Expected measurement structure**\n2263: \n2264: $$\n2265: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2266: \n2267: $$\n2268: \n2269: where:\n2270: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2271: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2272: \n2273: **Step 2: Exponential concentration of matching weights**\n2274: \n2275: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2276: \n2277: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2278: \n2279: $$\n2280: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2281: \n2282: $$\n2283: \n2284: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2285: \n2286: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2287: \n2288: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2289: \n2290: $$\n2291: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2292: \n2293: $$\n2294: \n2295: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2296: \n2297: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2298: \n2299: $$\n2300: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2301: \n2302: $$\n2303: \n2304: Then the expected measurement becomes:\n2305: \n2306: $$\n2307: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2308: \n2309: $$\n2310: \n2311: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2312: \n2313: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2314: \n2315: $$\n2316: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2317: \n2318: $$\n2319: \n2320: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2321: \n2322: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^‚àû regularity with k-uniform bounds **without** assuming this approximation.\n2323: \n2324: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2325: \n2326: $$\n2327: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2328: $$\n2329: \n2330: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2331: \n2332: **Consequence**: The marginal probability has simplified derivative structure:\n2333: \n2334: $$\n2335: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2336: $$\n2337: \n2338: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2339: \n2340: **Result**: The expected measurement has analytical structure\n2341: \n2342: $$\n2343: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2344: $$\n2345: \n2346: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2347: \n2348: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2349: \n2350: **Step 4: Derivative analysis via locality**\n2351: \n2352: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2353: \n2354: $$\n2355: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2356: $$\n2357: \n2358: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2359: \n2360: $$\n2361: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2362: $$\n2363: \n2364: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2365: 1. **Bounded**: By exponential weights, all ratios ‚â§ exp(const ¬∑ (R_eff)¬≤/Œµ_d¬≤) < ‚àû\n2366: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(œÅ_max Œµ_d^{2d}), independent of k\n2367: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2368: \n2369: The derivatives follow from standard quotient rule + Fa√† di Bruno:\n2370: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2371: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2372: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2373: \n2374: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2375: \n2376: $$\n2377: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2378: \n2379: $$\n2380: \n2381: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2382: \n2383: **Step 5: Derivative bound via quotient rule**\n2384: \n2385: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2386: \n2387: $$\n2388: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2389: \n2390: $$\n2391: \n2392: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2393: \n2394: $$\n2395: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2396: \n2397: $$\n2398: \n2399: By the product rule and Fa√† di Bruno formula:\n2400: \n2401: $$\n2402: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2403: \n2404: $$\n2405: \n2406: **Bounds on each term**:\n2407: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2408: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2409: \n2410: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2411: \n2412: $$\n2413: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2414: \n2415: $$\n2416: \n2417: which is **k-uniform** (independent of total swarm size).\n2418: \n2419: **Step 6: Assemble the Gevrey-1 bound**\n2420: \n2421: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2422: \n2423: $$\n2424: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2425: \n2426: $$\n2427: \n2428: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2429: \n2430: $$\n2431: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2432: \n2433: $$\n2434: \n2435: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.\n2436: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 5.6 Diversity Pairing Mechanism Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-322",
      "title": null,
      "start_line": 2484,
      "end_line": 2499,
      "header_lines": [],
      "content_start": 2485,
      "content_end": 2498,
      "content": "2485: \n2486: :::{prf:proof}\n2487: **Proof Sketch**:\n2488: \n2489: **Step 1**: Lemma 5.1.2 from `03_cloning.md` proves the greedy algorithm detects the same geometric structure as the idealized model (\"signal preservation\").\n2490: \n2491: **Step 2**: Both mechanisms are based on:\n2492: - Same exponential weights: $\\exp(-d^2/(2\\varepsilon_d^2))$\n2493: - Same normalization (softmax structure)\n2494: - Difference is only in order of summation (sequential vs. global)\n2495: \n2496: **Step 3**: Derivatives of both expressions involve the same Fa√† di Bruno polynomials and quotient rules. The sequential vs. global structure doesn't affect the analytical form of derivatives, only the constants.\n2497: \n2498: **Step 4**: The $O(k^{-\\beta})$ difference is negligible for N-uniform bounds.",
      "metadata": {},
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "raw_directive": "2484: :::\n2485: \n2486: :::{prf:proof}\n2487: **Proof Sketch**:\n2488: \n2489: **Step 1**: Lemma 5.1.2 from `03_cloning.md` proves the greedy algorithm detects the same geometric structure as the idealized model (\"signal preservation\").\n2490: \n2491: **Step 2**: Both mechanisms are based on:\n2492: - Same exponential weights: $\\exp(-d^2/(2\\varepsilon_d^2))$\n2493: - Same normalization (softmax structure)\n2494: - Difference is only in order of summation (sequential vs. global)\n2495: \n2496: **Step 3**: Derivatives of both expressions involve the same Fa√† di Bruno polynomials and quotient rules. The sequential vs. global structure doesn't affect the analytical form of derivatives, only the constants.\n2497: \n2498: **Step 4**: The $O(k^{-\\beta})$ difference is negligible for N-uniform bounds.\n2499: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 5.6 Diversity Pairing Mechanism Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-76",
      "title": null,
      "start_line": 2601,
      "end_line": 2727,
      "header_lines": [],
      "content_start": 2602,
      "content_end": 2726,
      "content": "2602: \n2603: :::{prf:proof}\n2604: **Step 1: Mechanism comparison via moment matching.**\n2605: \n2606: Both mechanisms select companions based on phase-space proximity via exponential kernels. The key difference is:\n2607: - **Softmax**: Each walker's companion selected **independently**\n2608: - **Pairing**: Companions selected **jointly** to form a matching\n2609: \n2610: For walker $j$, define the **marginal distribution** of the diversity pairing:\n2611: \n2612: $$\n2613: P_{\\text{pair}}(c(j) = \\ell | S) := \\sum_{M \\in \\mathcal{M}_k : M(j) = \\ell} P_{\\text{ideal}}(M | S)\n2614: \n2615: $$\n2616: \n2617: This is the probability that walker $j$ is matched with $\\ell$ in the ideal pairing model.\n2618: \n2619: **Claim**: $P_{\\text{pair}}(c(j) = \\ell | S) \\approx P_{\\text{softmax}}(c(j) = \\ell | S)$ up to $O(k^{-1})$ corrections.\n2620: \n2621: **Intuition**: The pairing constraint (matching must be perfect) introduces correlations, but these are weak for large $k$ due to exponential localization. Walker $j$'s companion depends primarily on $j$'s own neighborhood, with negligible coupling to distant walkers' pairing choices.\n2622: \n2623: **Step 2: Exponential concentration analysis.**\n2624: \n2625: By Corollary {prf:ref}`cor-effective-interaction-radius-full`, with high probability ($\\geq 1 - 1/k$), companion $c(j)$ satisfies:\n2626: \n2627: $$\n2628: d_{\\text{alg}}(j, c(j)) \\leq R_{\\text{eff}} = O(\\varepsilon_{\\text{comp}} \\sqrt{\\log k})\n2629: \n2630: $$\n2631: \n2632: The number of potential companions within $R_{\\text{eff}}$ is:\n2633: \n2634: $$\n2635: k_{\\text{eff}}(j) = |\\{\\ell \\in \\mathcal{A} : d_{\\text{alg}}(j,\\ell) \\leq R_{\\text{eff}}\\}| = O(\\rho_{\\max} R_{\\text{eff}}^{2d}) = O(\\log^d k)\n2636: \n2637: $$\n2638: \n2639: (by uniform density bound {prf:ref}`assump-uniform-density-full`).\n2640: \n2641: **Key Observation**: For $k \\gg k_{\\text{eff}}(j)$, the pairing constraint affects only a negligible fraction of walkers. The probability that walker $j$'s preferred companions are \"blocked\" (already matched) is $O(k_{\\text{eff}} / k) = O(\\log^d k / k) = o(1)$.\n2642: \n2643: **Step 3: Marginal distribution comparison (qualitative).**\n2644: \n2645: The softmax distribution is:\n2646: \n2647: $$\n2648: P_{\\text{softmax}}(c(j) = \\ell | S) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_{\\text{comp}}^2))}{Z_j^{\\text{soft}}}\n2649: \n2650: $$\n2651: \n2652: where $Z_j^{\\text{soft}} = \\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_{\\text{comp}}^2))$.\n2653: \n2654: The pairing marginal has the form:\n2655: \n2656: $$\n2657: P_{\\text{pair}}(c(j) = \\ell | S) = \\frac{\\sum_{M: M(j)=\\ell} W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2658: \n2659: $$\n2660: \n2661: where the weights $W(M) = \\prod_{(i,j') \\in M} \\exp(-d_{\\text{alg}}^2(i,j')/(2\\varepsilon_{\\text{pair}}^2))$ have the same exponential structure as softmax.\n2662: \n2663: **Key observation**: Both distributions:\n2664: 1. Are quotients of exponentially weighted sums (identical analytical structure)\n2665: 2. Concentrate on nearby walkers (exponential locality with the same scale)\n2666: 3. Involve $k_{\\text{eff}}^{(\\varepsilon_c)} = \\mathcal{O}((\\log k)^d)$ effective interacting companions\n2667: \n2668: Therefore, both $P_{\\text{softmax}}$ and $P_{\\text{pair}}$ have **identical regularity properties**: C^‚àû with Gevrey-1 derivative bounds.\n2669: \n2670: **Quantitative difference**: Establishing $|P_{\\text{pair}} - P_{\\text{softmax}}| = O(k^{-\\alpha})$ requires coupling analysis between independent sampling (softmax) and constrained matching (pairing). This is an **open problem** for future work.\n2671: \n2672: **Step 4: Expected measurement difference (qualitative).**\n2673: \n2674: The expected measurements are:\n2675: \n2676: $$\n2677: \\begin{aligned}\n2678: d_j^{\\text{soft}} &= \\sum_{\\ell} P_{\\text{softmax}}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell) \\\\\n2679: d_j^{\\text{pair}} &= \\sum_{\\ell} P_{\\text{pair}}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)\n2680: \\end{aligned}\n2681: \n2682: $$\n2683: \n2684: Both are weighted sums over the same quantity $d_{\\text{alg}}(j, \\ell)$ with probability distributions $P_{\\text{softmax}}$ and $P_{\\text{pair}}$ that:\n2685: 1. Have the same support (nearby walkers in phase space)\n2686: 2. Have the same exponential concentration structure\n2687: 3. Both concentrate on $k_{\\text{eff}}^{(\\varepsilon_c)} = \\mathcal{O}((\\log k)^d)$ effective companions\n2688: \n2689: Therefore, the measurements $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have the **same analytical structure** (quotients of exponentially weighted sums) with **identical regularity properties** (C^‚àû with Gevrey-1 bounds).\n2690: \n2691: **Quantitative convergence rate**: The quantitative difference $|\\Delta_j| := |d_j^{\\text{pair}} - d_j^{\\text{soft}}|$ is **bounded** (both measurements are O(diam(X√óV))), but establishing an explicit convergence rate $O(k^{-\\alpha})$ requires a rigorous coupling analysis between the softmax and pairing distributions. This is an **open problem** for future work.\n2692: \n2693: **Step 5: Identical derivative structure.**\n2694: \n2695: Both $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have Gevrey-1 derivative bounds by Lemma {prf:ref}`lem-companion-measurement-derivatives-full` and Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity`:\n2696: \n2697: $$\n2698: \\|\\nabla^m d_j^{\\text{soft}}\\|, \\|\\nabla^m d_j^{\\text{pair}}\\| \\leq C_m \\cdot m! \\cdot \\max(\\varepsilon_{\\text{comp}}^{-m}, \\varepsilon_d^{1-m})\n2699: \n2700: $$\n2701: \n2702: with the **same constants** $C_m$ (k-uniform). Therefore, both mechanisms yield measurements with identical regularity class.\n2703: \n2704: **Step 6: Propagation through the fitness pipeline.**\n2705: \n2706: The fitness potential is computed via:\n2707: \n2708: $$\n2709: V_{\\text{fit}} = g_A(Z_\\rho(\\mu_\\rho, \\sigma_\\rho^2))\n2710: \n2711: $$\n2712: \n2713: where $\\mu_\\rho^{(i)} = \\sum_j w_{ij}(\\rho) d_j$ (localized mean) and subsequent nonlinear stages (variance, std dev, Z-score, rescale).\n2714: \n2715: **Key observation**: Since $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have **identical analytical structure** (same regularity, same Gevrey-1 constants), the entire pipeline applied to either set of measurements yields fitness potentials with:\n2716: \n2717: 1. **Same regularity class**: Both $V_{\\text{fit}}^{\\text{soft}}$ and $V_{\\text{fit}}^{\\text{pair}}$ are C^‚àû\n2718: 2. **Same Gevrey-1 bounds**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_{V,m} \\cdot m!$ with identical constants\n2719: 3. **Same k-uniformity**: All constants independent of $k$\n2720: \n2721: **Quantitative difference**: Establishing $\\|V_{\\text{fit}}^{\\text{pair}} - V_{\\text{fit}}^{\\text{soft}}\\|_\\infty = O(k^{-\\alpha})$ requires:\n2722: - Quantitative bound on $|\\Delta_j|$ (Step 4, open problem)\n2723: - Lipschitz stability analysis for nonlinear stages (variance, square root, quotient, composition)\n2724: - Propagation of perturbations through the six-stage pipeline\n2725: \n2726: This is **deferred to future work**. The current document establishes only the **qualitative equivalence** of analytical properties.",
      "metadata": {},
      "section": "## 5.7 Statistical Equivalence and Unified Regularity Theorem",
      "raw_directive": "2601: :::\n2602: \n2603: :::{prf:proof}\n2604: **Step 1: Mechanism comparison via moment matching.**\n2605: \n2606: Both mechanisms select companions based on phase-space proximity via exponential kernels. The key difference is:\n2607: - **Softmax**: Each walker's companion selected **independently**\n2608: - **Pairing**: Companions selected **jointly** to form a matching\n2609: \n2610: For walker $j$, define the **marginal distribution** of the diversity pairing:\n2611: \n2612: $$\n2613: P_{\\text{pair}}(c(j) = \\ell | S) := \\sum_{M \\in \\mathcal{M}_k : M(j) = \\ell} P_{\\text{ideal}}(M | S)\n2614: \n2615: $$\n2616: \n2617: This is the probability that walker $j$ is matched with $\\ell$ in the ideal pairing model.\n2618: \n2619: **Claim**: $P_{\\text{pair}}(c(j) = \\ell | S) \\approx P_{\\text{softmax}}(c(j) = \\ell | S)$ up to $O(k^{-1})$ corrections.\n2620: \n2621: **Intuition**: The pairing constraint (matching must be perfect) introduces correlations, but these are weak for large $k$ due to exponential localization. Walker $j$'s companion depends primarily on $j$'s own neighborhood, with negligible coupling to distant walkers' pairing choices.\n2622: \n2623: **Step 2: Exponential concentration analysis.**\n2624: \n2625: By Corollary {prf:ref}`cor-effective-interaction-radius-full`, with high probability ($\\geq 1 - 1/k$), companion $c(j)$ satisfies:\n2626: \n2627: $$\n2628: d_{\\text{alg}}(j, c(j)) \\leq R_{\\text{eff}} = O(\\varepsilon_{\\text{comp}} \\sqrt{\\log k})\n2629: \n2630: $$\n2631: \n2632: The number of potential companions within $R_{\\text{eff}}$ is:\n2633: \n2634: $$\n2635: k_{\\text{eff}}(j) = |\\{\\ell \\in \\mathcal{A} : d_{\\text{alg}}(j,\\ell) \\leq R_{\\text{eff}}\\}| = O(\\rho_{\\max} R_{\\text{eff}}^{2d}) = O(\\log^d k)\n2636: \n2637: $$\n2638: \n2639: (by uniform density bound {prf:ref}`assump-uniform-density-full`).\n2640: \n2641: **Key Observation**: For $k \\gg k_{\\text{eff}}(j)$, the pairing constraint affects only a negligible fraction of walkers. The probability that walker $j$'s preferred companions are \"blocked\" (already matched) is $O(k_{\\text{eff}} / k) = O(\\log^d k / k) = o(1)$.\n2642: \n2643: **Step 3: Marginal distribution comparison (qualitative).**\n2644: \n2645: The softmax distribution is:\n2646: \n2647: $$\n2648: P_{\\text{softmax}}(c(j) = \\ell | S) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_{\\text{comp}}^2))}{Z_j^{\\text{soft}}}\n2649: \n2650: $$\n2651: \n2652: where $Z_j^{\\text{soft}} = \\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_{\\text{comp}}^2))$.\n2653: \n2654: The pairing marginal has the form:\n2655: \n2656: $$\n2657: P_{\\text{pair}}(c(j) = \\ell | S) = \\frac{\\sum_{M: M(j)=\\ell} W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2658: \n2659: $$\n2660: \n2661: where the weights $W(M) = \\prod_{(i,j') \\in M} \\exp(-d_{\\text{alg}}^2(i,j')/(2\\varepsilon_{\\text{pair}}^2))$ have the same exponential structure as softmax.\n2662: \n2663: **Key observation**: Both distributions:\n2664: 1. Are quotients of exponentially weighted sums (identical analytical structure)\n2665: 2. Concentrate on nearby walkers (exponential locality with the same scale)\n2666: 3. Involve $k_{\\text{eff}}^{(\\varepsilon_c)} = \\mathcal{O}((\\log k)^d)$ effective interacting companions\n2667: \n2668: Therefore, both $P_{\\text{softmax}}$ and $P_{\\text{pair}}$ have **identical regularity properties**: C^‚àû with Gevrey-1 derivative bounds.\n2669: \n2670: **Quantitative difference**: Establishing $|P_{\\text{pair}} - P_{\\text{softmax}}| = O(k^{-\\alpha})$ requires coupling analysis between independent sampling (softmax) and constrained matching (pairing). This is an **open problem** for future work.\n2671: \n2672: **Step 4: Expected measurement difference (qualitative).**\n2673: \n2674: The expected measurements are:\n2675: \n2676: $$\n2677: \\begin{aligned}\n2678: d_j^{\\text{soft}} &= \\sum_{\\ell} P_{\\text{softmax}}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell) \\\\\n2679: d_j^{\\text{pair}} &= \\sum_{\\ell} P_{\\text{pair}}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)\n2680: \\end{aligned}\n2681: \n2682: $$\n2683: \n2684: Both are weighted sums over the same quantity $d_{\\text{alg}}(j, \\ell)$ with probability distributions $P_{\\text{softmax}}$ and $P_{\\text{pair}}$ that:\n2685: 1. Have the same support (nearby walkers in phase space)\n2686: 2. Have the same exponential concentration structure\n2687: 3. Both concentrate on $k_{\\text{eff}}^{(\\varepsilon_c)} = \\mathcal{O}((\\log k)^d)$ effective companions\n2688: \n2689: Therefore, the measurements $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have the **same analytical structure** (quotients of exponentially weighted sums) with **identical regularity properties** (C^‚àû with Gevrey-1 bounds).\n2690: \n2691: **Quantitative convergence rate**: The quantitative difference $|\\Delta_j| := |d_j^{\\text{pair}} - d_j^{\\text{soft}}|$ is **bounded** (both measurements are O(diam(X√óV))), but establishing an explicit convergence rate $O(k^{-\\alpha})$ requires a rigorous coupling analysis between the softmax and pairing distributions. This is an **open problem** for future work.\n2692: \n2693: **Step 5: Identical derivative structure.**\n2694: \n2695: Both $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have Gevrey-1 derivative bounds by Lemma {prf:ref}`lem-companion-measurement-derivatives-full` and Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity`:\n2696: \n2697: $$\n2698: \\|\\nabla^m d_j^{\\text{soft}}\\|, \\|\\nabla^m d_j^{\\text{pair}}\\| \\leq C_m \\cdot m! \\cdot \\max(\\varepsilon_{\\text{comp}}^{-m}, \\varepsilon_d^{1-m})\n2699: \n2700: $$\n2701: \n2702: with the **same constants** $C_m$ (k-uniform). Therefore, both mechanisms yield measurements with identical regularity class.\n2703: \n2704: **Step 6: Propagation through the fitness pipeline.**\n2705: \n2706: The fitness potential is computed via:\n2707: \n2708: $$\n2709: V_{\\text{fit}} = g_A(Z_\\rho(\\mu_\\rho, \\sigma_\\rho^2))\n2710: \n2711: $$\n2712: \n2713: where $\\mu_\\rho^{(i)} = \\sum_j w_{ij}(\\rho) d_j$ (localized mean) and subsequent nonlinear stages (variance, std dev, Z-score, rescale).\n2714: \n2715: **Key observation**: Since $d_j^{\\text{soft}}$ and $d_j^{\\text{pair}}$ have **identical analytical structure** (same regularity, same Gevrey-1 constants), the entire pipeline applied to either set of measurements yields fitness potentials with:\n2716: \n2717: 1. **Same regularity class**: Both $V_{\\text{fit}}^{\\text{soft}}$ and $V_{\\text{fit}}^{\\text{pair}}$ are C^‚àû\n2718: 2. **Same Gevrey-1 bounds**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_{V,m} \\cdot m!$ with identical constants\n2719: 3. **Same k-uniformity**: All constants independent of $k$\n2720: \n2721: **Quantitative difference**: Establishing $\\|V_{\\text{fit}}^{\\text{pair}} - V_{\\text{fit}}^{\\text{soft}}\\|_\\infty = O(k^{-\\alpha})$ requires:\n2722: - Quantitative bound on $|\\Delta_j|$ (Step 4, open problem)\n2723: - Lipschitz stability analysis for nonlinear stages (variance, square root, quotient, composition)\n2724: - Propagation of perturbations through the six-stage pipeline\n2725: \n2726: This is **deferred to future work**. The current document establishes only the **qualitative equivalence** of analytical properties.\n2727: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 5.7 Statistical Equivalence and Unified Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-257",
      "title": null,
      "start_line": 2782,
      "end_line": 2936,
      "header_lines": [],
      "content_start": 2783,
      "content_end": 2935,
      "content": "2783: \n2784: :::{prf:proof}\n2785: We analyze perturbation propagation through each stage of the pipeline.\n2786: \n2787: **Stage 1: Localized Mean** (Linear propagation)\n2788: \n2789: $$\n2790: \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j\n2791: \n2792: $$\n2793: \n2794: For the perturbed measurements:\n2795: \n2796: $$\n2797: \\tilde{\\mu}_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot \\tilde{d}_j\n2798: \n2799: $$\n2800: \n2801: The difference is:\n2802: \n2803: $$\n2804: |\\delta \\mu_\\rho| := |\\tilde{\\mu}_\\rho - \\mu_\\rho| = \\left|\\sum_{j} w_{ij} (d_j - \\tilde{d}_j)\\right| \\leq \\sum_{j} w_{ij} |\\Delta_j| \\leq \\|\\Delta\\|_\\infty \\cdot \\underbrace{\\sum_j w_{ij}}_{=1} = \\|\\Delta\\|_\\infty\n2805: \n2806: $$\n2807: \n2808: using normalization $\\sum_j w_{ij} = 1$.\n2809: \n2810: **Stage 2: Localized Variance** (Quadratic propagation)\n2811: \n2812: $$\n2813: \\sigma_\\rho^{2(i)} = \\sum_{j} w_{ij} (d_j - \\mu_\\rho)^2\n2814: \n2815: $$\n2816: \n2817: For perturbed measurements:\n2818: \n2819: $$\n2820: \\tilde{\\sigma}_\\rho^{2} = \\sum_{j} w_{ij} (\\tilde{d}_j - \\tilde{\\mu}_\\rho)^2\n2821: \n2822: $$\n2823: \n2824: Expanding:\n2825: \n2826: $$\n2827: \\begin{aligned}\n2828: \\delta(\\sigma_\\rho^2) &= \\sum_j w_{ij} [(\\tilde{d}_j - \\tilde{\\mu}_\\rho)^2 - (d_j - \\mu_\\rho)^2] \\\\\n2829: &= \\sum_j w_{ij} [(d_j + \\Delta_j - \\mu_\\rho - \\delta\\mu_\\rho)^2 - (d_j - \\mu_\\rho)^2] \\\\\n2830: &= \\sum_j w_{ij} [2(d_j - \\mu_\\rho)\\Delta_j + \\Delta_j^2 - 2(d_j - \\mu_\\rho)\\delta\\mu_\\rho + (\\delta\\mu_\\rho)^2 + 2\\Delta_j \\delta\\mu_\\rho]\n2831: \\end{aligned}\n2832: \n2833: $$\n2834: \n2835: Using $\\sum_j w_{ij}(d_j - \\mu_\\rho) = 0$ (definition of $\\mu_\\rho$), the linear term in $(d_j - \\mu_\\rho)$ vanishes. The remaining terms:\n2836: \n2837: $$\n2838: |\\delta(\\sigma_\\rho^2)| \\leq \\sum_j w_{ij} (|\\Delta_j|^2 + 2|\\Delta_j||\\delta\\mu_\\rho|) + |\\delta\\mu_\\rho|^2 \\leq 2\\|\\Delta\\|_\\infty^2 + 2\\|\\Delta\\|_\\infty^2 + \\|\\Delta\\|_\\infty^2 = 5\\|\\Delta\\|_\\infty^2\n2839: \n2840: $$\n2841: \n2842: **Stage 3: Regularized Standard Deviation** (Square root with regularization)\n2843: \n2844: $$\n2845: \\sigma'_\\rho = \\sqrt{\\sigma_\\rho^2 + \\eta_{\\min}^2}\n2846: \n2847: $$\n2848: \n2849: For the perturbed quantity:\n2850: \n2851: $$\n2852: \\tilde{\\sigma}'_\\rho = \\sqrt{\\tilde{\\sigma}_\\rho^2 + \\eta_{\\min}^2} = \\sqrt{\\sigma_\\rho^2 + \\delta(\\sigma_\\rho^2) + \\eta_{\\min}^2}\n2853: \n2854: $$\n2855: \n2856: Using the mean value theorem for $f(x) = \\sqrt{x}$:\n2857: \n2858: $$\n2859: |\\delta(\\sigma'_\\rho)| = \\left|\\sqrt{\\sigma_\\rho^2 + \\delta(\\sigma_\\rho^2) + \\eta_{\\min}^2} - \\sqrt{\\sigma_\\rho^2 + \\eta_{\\min}^2}\\right| \\leq \\frac{|\\delta(\\sigma_\\rho^2)|}{2\\sqrt{\\eta_{\\min}^2}} = \\frac{|\\delta(\\sigma_\\rho^2)|}{2\\eta_{\\min}}\n2860: \n2861: $$\n2862: \n2863: where the inequality uses $\\sigma_\\rho^2 + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$. Therefore:\n2864: \n2865: $$\n2866: |\\delta(\\sigma'_\\rho)| \\leq \\frac{5\\|\\Delta\\|_\\infty^2}{2\\eta_{\\min}}\n2867: \n2868: $$\n2869: \n2870: **Key**: The regularization $\\eta_{\\min} > 0$ prevents division by zero, providing a **uniform Lipschitz constant**.\n2871: \n2872: **Stage 4: Own Measurement** (bounded)\n2873: \n2874: For walker $i$, its own measurement also changes:\n2875: \n2876: $$\n2877: |\\delta(d_i)| \\leq \\|\\Delta\\|_\\infty\n2878: \n2879: $$\n2880: \n2881: **Stage 5: Z-Score** (Quotient with bounded denominator)\n2882: \n2883: $$\n2884: Z_\\rho = \\frac{d_i - \\mu_\\rho}{\\sigma'_\\rho}\n2885: \n2886: $$\n2887: \n2888: For the perturbed Z-score:\n2889: \n2890: $$\n2891: \\tilde{Z}_\\rho = \\frac{\\tilde{d}_i - \\tilde{\\mu}_\\rho}{\\tilde{\\sigma}'_\\rho} = \\frac{(d_i + \\delta d_i) - (\\mu_\\rho + \\delta \\mu_\\rho)}{(\\sigma'_\\rho + \\delta \\sigma'_\\rho)}\n2892: \n2893: $$\n2894: \n2895: Using quotient rule:\n2896: \n2897: $$\n2898: \\begin{aligned}\n2899: |\\delta(Z_\\rho)| &= \\left|\\frac{(d_i + \\delta d_i) - (\\mu_\\rho + \\delta \\mu_\\rho)}{\\sigma'_\\rho + \\delta \\sigma'_\\rho} - \\frac{d_i - \\mu_\\rho}{\\sigma'_\\rho}\\right| \\\\\n2900: &\\leq \\frac{|\\delta d_i - \\delta \\mu_\\rho| \\cdot \\sigma'_\\rho + |d_i - \\mu_\\rho| \\cdot |\\delta \\sigma'_\\rho|}{(\\sigma'_\\rho)(\\sigma'_\\rho + \\delta \\sigma'_\\rho)}\n2901: \\end{aligned}\n2902: \n2903: $$\n2904: \n2905: Since $\\sigma'_\\rho \\geq \\eta_{\\min}$ and $|d_i - \\mu_\\rho| \\leq \\text{diam}(\\mathcal{X} \\times V) =: D_{\\max}$:\n2906: \n2907: $$\n2908: |\\delta(Z_\\rho)| \\leq \\frac{2\\|\\Delta\\|_\\infty}{\\eta_{\\min}} + \\frac{D_{\\max}}{\\eta_{\\min}^2} \\cdot \\frac{5\\|\\Delta\\|_\\infty^2}{2} \\leq C_Z (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2909: \n2910: $$\n2911: \n2912: where $C_Z = \\max(2/\\eta_{\\min}, 5D_{\\max}/(2\\eta_{\\min}^2))$ is **k-uniform**.\n2913: \n2914: **Stage 6: Fitness Rescaling** (Lipschitz composition)\n2915: \n2916: $$\n2917: V_{\\text{fit}} = g_A(Z_\\rho)\n2918: \n2919: $$\n2920: \n2921: Since $g_A \\in C^\\infty$ is Lipschitz on bounded domains (Z-score is bounded by $D_{\\max}/\\eta_{\\min}$):\n2922: \n2923: $$\n2924: |\\delta(V_{\\text{fit}})| = |g_A(\\tilde{Z}_\\rho) - g_A(Z_\\rho)| \\leq \\|g_A'\\|_\\infty \\cdot |\\delta(Z_\\rho)| \\leq L_g \\cdot C_Z (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2925: \n2926: $$\n2927: \n2928: where $L_g = \\|g_A'\\|_\\infty$ is the Lipschitz constant of the rescale function.\n2929: \n2930: **Conclusion**: Setting $L_V = L_g \\cdot C_Z$, we have:\n2931: \n2932: $$\n2933: |V_{\\text{fit}}[d] - V_{\\text{fit}}[\\tilde{d}]| \\leq L_V \\cdot (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2934: \n2935: $$",
      "metadata": {},
      "section": "## 5.7 Statistical Equivalence and Unified Regularity Theorem",
      "raw_directive": "2782: :::\n2783: \n2784: :::{prf:proof}\n2785: We analyze perturbation propagation through each stage of the pipeline.\n2786: \n2787: **Stage 1: Localized Mean** (Linear propagation)\n2788: \n2789: $$\n2790: \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j\n2791: \n2792: $$\n2793: \n2794: For the perturbed measurements:\n2795: \n2796: $$\n2797: \\tilde{\\mu}_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot \\tilde{d}_j\n2798: \n2799: $$\n2800: \n2801: The difference is:\n2802: \n2803: $$\n2804: |\\delta \\mu_\\rho| := |\\tilde{\\mu}_\\rho - \\mu_\\rho| = \\left|\\sum_{j} w_{ij} (d_j - \\tilde{d}_j)\\right| \\leq \\sum_{j} w_{ij} |\\Delta_j| \\leq \\|\\Delta\\|_\\infty \\cdot \\underbrace{\\sum_j w_{ij}}_{=1} = \\|\\Delta\\|_\\infty\n2805: \n2806: $$\n2807: \n2808: using normalization $\\sum_j w_{ij} = 1$.\n2809: \n2810: **Stage 2: Localized Variance** (Quadratic propagation)\n2811: \n2812: $$\n2813: \\sigma_\\rho^{2(i)} = \\sum_{j} w_{ij} (d_j - \\mu_\\rho)^2\n2814: \n2815: $$\n2816: \n2817: For perturbed measurements:\n2818: \n2819: $$\n2820: \\tilde{\\sigma}_\\rho^{2} = \\sum_{j} w_{ij} (\\tilde{d}_j - \\tilde{\\mu}_\\rho)^2\n2821: \n2822: $$\n2823: \n2824: Expanding:\n2825: \n2826: $$\n2827: \\begin{aligned}\n2828: \\delta(\\sigma_\\rho^2) &= \\sum_j w_{ij} [(\\tilde{d}_j - \\tilde{\\mu}_\\rho)^2 - (d_j - \\mu_\\rho)^2] \\\\\n2829: &= \\sum_j w_{ij} [(d_j + \\Delta_j - \\mu_\\rho - \\delta\\mu_\\rho)^2 - (d_j - \\mu_\\rho)^2] \\\\\n2830: &= \\sum_j w_{ij} [2(d_j - \\mu_\\rho)\\Delta_j + \\Delta_j^2 - 2(d_j - \\mu_\\rho)\\delta\\mu_\\rho + (\\delta\\mu_\\rho)^2 + 2\\Delta_j \\delta\\mu_\\rho]\n2831: \\end{aligned}\n2832: \n2833: $$\n2834: \n2835: Using $\\sum_j w_{ij}(d_j - \\mu_\\rho) = 0$ (definition of $\\mu_\\rho$), the linear term in $(d_j - \\mu_\\rho)$ vanishes. The remaining terms:\n2836: \n2837: $$\n2838: |\\delta(\\sigma_\\rho^2)| \\leq \\sum_j w_{ij} (|\\Delta_j|^2 + 2|\\Delta_j||\\delta\\mu_\\rho|) + |\\delta\\mu_\\rho|^2 \\leq 2\\|\\Delta\\|_\\infty^2 + 2\\|\\Delta\\|_\\infty^2 + \\|\\Delta\\|_\\infty^2 = 5\\|\\Delta\\|_\\infty^2\n2839: \n2840: $$\n2841: \n2842: **Stage 3: Regularized Standard Deviation** (Square root with regularization)\n2843: \n2844: $$\n2845: \\sigma'_\\rho = \\sqrt{\\sigma_\\rho^2 + \\eta_{\\min}^2}\n2846: \n2847: $$\n2848: \n2849: For the perturbed quantity:\n2850: \n2851: $$\n2852: \\tilde{\\sigma}'_\\rho = \\sqrt{\\tilde{\\sigma}_\\rho^2 + \\eta_{\\min}^2} = \\sqrt{\\sigma_\\rho^2 + \\delta(\\sigma_\\rho^2) + \\eta_{\\min}^2}\n2853: \n2854: $$\n2855: \n2856: Using the mean value theorem for $f(x) = \\sqrt{x}$:\n2857: \n2858: $$\n2859: |\\delta(\\sigma'_\\rho)| = \\left|\\sqrt{\\sigma_\\rho^2 + \\delta(\\sigma_\\rho^2) + \\eta_{\\min}^2} - \\sqrt{\\sigma_\\rho^2 + \\eta_{\\min}^2}\\right| \\leq \\frac{|\\delta(\\sigma_\\rho^2)|}{2\\sqrt{\\eta_{\\min}^2}} = \\frac{|\\delta(\\sigma_\\rho^2)|}{2\\eta_{\\min}}\n2860: \n2861: $$\n2862: \n2863: where the inequality uses $\\sigma_\\rho^2 + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$. Therefore:\n2864: \n2865: $$\n2866: |\\delta(\\sigma'_\\rho)| \\leq \\frac{5\\|\\Delta\\|_\\infty^2}{2\\eta_{\\min}}\n2867: \n2868: $$\n2869: \n2870: **Key**: The regularization $\\eta_{\\min} > 0$ prevents division by zero, providing a **uniform Lipschitz constant**.\n2871: \n2872: **Stage 4: Own Measurement** (bounded)\n2873: \n2874: For walker $i$, its own measurement also changes:\n2875: \n2876: $$\n2877: |\\delta(d_i)| \\leq \\|\\Delta\\|_\\infty\n2878: \n2879: $$\n2880: \n2881: **Stage 5: Z-Score** (Quotient with bounded denominator)\n2882: \n2883: $$\n2884: Z_\\rho = \\frac{d_i - \\mu_\\rho}{\\sigma'_\\rho}\n2885: \n2886: $$\n2887: \n2888: For the perturbed Z-score:\n2889: \n2890: $$\n2891: \\tilde{Z}_\\rho = \\frac{\\tilde{d}_i - \\tilde{\\mu}_\\rho}{\\tilde{\\sigma}'_\\rho} = \\frac{(d_i + \\delta d_i) - (\\mu_\\rho + \\delta \\mu_\\rho)}{(\\sigma'_\\rho + \\delta \\sigma'_\\rho)}\n2892: \n2893: $$\n2894: \n2895: Using quotient rule:\n2896: \n2897: $$\n2898: \\begin{aligned}\n2899: |\\delta(Z_\\rho)| &= \\left|\\frac{(d_i + \\delta d_i) - (\\mu_\\rho + \\delta \\mu_\\rho)}{\\sigma'_\\rho + \\delta \\sigma'_\\rho} - \\frac{d_i - \\mu_\\rho}{\\sigma'_\\rho}\\right| \\\\\n2900: &\\leq \\frac{|\\delta d_i - \\delta \\mu_\\rho| \\cdot \\sigma'_\\rho + |d_i - \\mu_\\rho| \\cdot |\\delta \\sigma'_\\rho|}{(\\sigma'_\\rho)(\\sigma'_\\rho + \\delta \\sigma'_\\rho)}\n2901: \\end{aligned}\n2902: \n2903: $$\n2904: \n2905: Since $\\sigma'_\\rho \\geq \\eta_{\\min}$ and $|d_i - \\mu_\\rho| \\leq \\text{diam}(\\mathcal{X} \\times V) =: D_{\\max}$:\n2906: \n2907: $$\n2908: |\\delta(Z_\\rho)| \\leq \\frac{2\\|\\Delta\\|_\\infty}{\\eta_{\\min}} + \\frac{D_{\\max}}{\\eta_{\\min}^2} \\cdot \\frac{5\\|\\Delta\\|_\\infty^2}{2} \\leq C_Z (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2909: \n2910: $$\n2911: \n2912: where $C_Z = \\max(2/\\eta_{\\min}, 5D_{\\max}/(2\\eta_{\\min}^2))$ is **k-uniform**.\n2913: \n2914: **Stage 6: Fitness Rescaling** (Lipschitz composition)\n2915: \n2916: $$\n2917: V_{\\text{fit}} = g_A(Z_\\rho)\n2918: \n2919: $$\n2920: \n2921: Since $g_A \\in C^\\infty$ is Lipschitz on bounded domains (Z-score is bounded by $D_{\\max}/\\eta_{\\min}$):\n2922: \n2923: $$\n2924: |\\delta(V_{\\text{fit}})| = |g_A(\\tilde{Z}_\\rho) - g_A(Z_\\rho)| \\leq \\|g_A'\\|_\\infty \\cdot |\\delta(Z_\\rho)| \\leq L_g \\cdot C_Z (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2925: \n2926: $$\n2927: \n2928: where $L_g = \\|g_A'\\|_\\infty$ is the Lipschitz constant of the rescale function.\n2929: \n2930: **Conclusion**: Setting $L_V = L_g \\cdot C_Z$, we have:\n2931: \n2932: $$\n2933: |V_{\\text{fit}}[d] - V_{\\text{fit}}[\\tilde{d}]| \\leq L_V \\cdot (\\|\\Delta\\|_\\infty + \\|\\Delta\\|_\\infty^2)\n2934: \n2935: $$\n2936: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 5.7 Statistical Equivalence and Unified Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-459",
      "title": null,
      "start_line": 2984,
      "end_line": 2991,
      "header_lines": [],
      "content_start": 2985,
      "content_end": 2990,
      "content": "2985: \n2986: :::{prf:proof}\n2987: **Proof Structure**:\n2988: \n2989: 1. **Softmax mechanism** (¬ß5.5): Proven in Lemma {prf:ref}`lem-companion-measurement-derivatives-full` + propagation through stages 2-6\n2990: 2. **Diversity pairing** (¬ß5.6): Proven in Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity` + same propagation",
      "metadata": {},
      "section": "## 5.7 Statistical Equivalence and Unified Regularity Theorem",
      "raw_directive": "2984: :::\n2985: \n2986: :::{prf:proof}\n2987: **Proof Structure**:\n2988: \n2989: 1. **Softmax mechanism** (¬ß5.5): Proven in Lemma {prf:ref}`lem-companion-measurement-derivatives-full` + propagation through stages 2-6\n2990: 2. **Diversity pairing** (¬ß5.6): Proven in Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity` + same propagation\n2991: 3. **Statistical equivalence** (¬ß5.7.2): Theorem {prf:ref}`thm-statistical-equivalence-companion-mechanisms` establishes both mechanisms have identical analytical structure (same regularity class, same Gevrey-1 bounds, same k-uniformity)",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 5.7 Statistical Equivalence and Unified Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-30",
      "title": null,
      "start_line": 3042,
      "end_line": 3058,
      "header_lines": [],
      "content_start": 3043,
      "content_end": 3057,
      "content": "3043: \n3044: :::{prf:proof}\n3045: By Fa√† di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n3046: \n3047: $$\n3048: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3049: \n3050: $$\n3051: \n3052: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3053: \n3054: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3055: \n3056: $$\n3057: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho",
      "metadata": {},
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3042: :::\n3043: \n3044: :::{prf:proof}\n3045: By Fa√† di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n3046: \n3047: $$\n3048: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3049: \n3050: $$\n3051: \n3052: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3053: \n3054: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3055: \n3056: $$\n3057: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho\n3058: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-63",
      "title": null,
      "start_line": 3075,
      "end_line": 3160,
      "header_lines": [],
      "content_start": 3076,
      "content_end": 3159,
      "content": "3076: \n3077: :::{prf:proof}\n3078: **Step 1: Partition function bounds.**\n3079: \n3080: By {prf:ref}`lem-companion-availability-enforcement`:\n3081: \n3082: $$\n3083: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3084: \n3085: $$\n3086: \n3087: and\n3088: \n3089: $$\n3090: Z_i(\\rho) \\leq k \\cdot 1 = k\n3091: \n3092: $$\n3093: \n3094: **Step 2: Quotient rule for $n$-th derivative.**\n3095: \n3096: By the generalized quotient rule (Fa√† di Bruno for $f/g$):\n3097: \n3098: $$\n3099: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3100: \n3101: $$\n3102: \n3103: **Step 3: Bounding each term with k-uniform estimates.**\n3104: \n3105: To establish k-uniformity, we apply the sum-to-integral lemma.\n3106: \n3107: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3108: \n3109: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3110: \n3111: $$\n3112: \\begin{aligned}\n3113: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3114: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3115: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3116: \\end{aligned}\n3117: \n3118: $$\n3119: \n3120: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3121: \n3122: $$\n3123: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3124: \n3125: $$\n3126: \n3127: Define:\n3128: \n3129: $$\n3130: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3131: \n3132: $$\n3133: \n3134: This is **k-independent** - it depends only on œÅ_max (from density assumption), œÅ (localization scale), and d (dimension).\n3135: \n3136: **Updated quotient bound:**\n3137: \n3138: Using:\n3139: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3140: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3141: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3142: \n3143: The generalized quotient rule gives:\n3144: \n3145: $$\n3146: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3147: \n3148: $$\n3149: \n3150: where $C_{w,n}(\\rho)$ depends on œÅ, œÅ_max, d but is **k-uniform** (independent of k and N).\n3151: \n3152: **Step 4: Explicit constant dependence.**\n3153: \n3154: The constant $C_{w,n}(\\rho)$ arises from the Fa√† di Bruno formula for the quotient and scales as:\n3155: \n3156: $$\n3157: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3158: \n3159: $$",
      "metadata": {},
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3075: :::\n3076: \n3077: :::{prf:proof}\n3078: **Step 1: Partition function bounds.**\n3079: \n3080: By {prf:ref}`lem-companion-availability-enforcement`:\n3081: \n3082: $$\n3083: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3084: \n3085: $$\n3086: \n3087: and\n3088: \n3089: $$\n3090: Z_i(\\rho) \\leq k \\cdot 1 = k\n3091: \n3092: $$\n3093: \n3094: **Step 2: Quotient rule for $n$-th derivative.**\n3095: \n3096: By the generalized quotient rule (Fa√† di Bruno for $f/g$):\n3097: \n3098: $$\n3099: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3100: \n3101: $$\n3102: \n3103: **Step 3: Bounding each term with k-uniform estimates.**\n3104: \n3105: To establish k-uniformity, we apply the sum-to-integral lemma.\n3106: \n3107: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3108: \n3109: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3110: \n3111: $$\n3112: \\begin{aligned}\n3113: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3114: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3115: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3116: \\end{aligned}\n3117: \n3118: $$\n3119: \n3120: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3121: \n3122: $$\n3123: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3124: \n3125: $$\n3126: \n3127: Define:\n3128: \n3129: $$\n3130: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3131: \n3132: $$\n3133: \n3134: This is **k-independent** - it depends only on œÅ_max (from density assumption), œÅ (localization scale), and d (dimension).\n3135: \n3136: **Updated quotient bound:**\n3137: \n3138: Using:\n3139: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3140: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3141: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3142: \n3143: The generalized quotient rule gives:\n3144: \n3145: $$\n3146: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3147: \n3148: $$\n3149: \n3150: where $C_{w,n}(\\rho)$ depends on œÅ, œÅ_max, d but is **k-uniform** (independent of k and N).\n3151: \n3152: **Step 4: Explicit constant dependence.**\n3153: \n3154: The constant $C_{w,n}(\\rho)$ arises from the Fa√† di Bruno formula for the quotient and scales as:\n3155: \n3156: $$\n3157: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3158: \n3159: $$\n3160: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-163",
      "title": null,
      "start_line": 3175,
      "end_line": 3189,
      "header_lines": [],
      "content_start": 3176,
      "content_end": 3188,
      "content": "3176: \n3177: :::{prf:proof}\n3178: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3179: \n3180: Differentiating $n$ times:\n3181: \n3182: $$\n3183: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3184: \n3185: $$\n3186: \n3187: The interchange of sum and differentiation is justified because:\n3188: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)",
      "metadata": {},
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3175: :::\n3176: \n3177: :::{prf:proof}\n3178: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3179: \n3180: Differentiating $n$ times:\n3181: \n3182: $$\n3183: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3184: \n3185: $$\n3186: \n3187: The interchange of sum and differentiation is justified because:\n3188: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)\n3189: - Each $w_{ij}$ is C^‚àû",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-202",
      "title": null,
      "start_line": 3214,
      "end_line": 3295,
      "header_lines": [],
      "content_start": 3215,
      "content_end": 3294,
      "content": "3215: \n3216: :::{prf:proof}\n3217: **Step 1: Naive expansion suggests k-dependence.**\n3218: \n3219: The first derivative is:\n3220: \n3221: $$\n3222: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3223: \n3224: $$\n3225: \n3226: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3227: \n3228: **Step 2: Telescoping eliminates the k-dependence.**\n3229: \n3230: Separate the sum into two parts:\n3231: \n3232: $$\n3233: \\begin{aligned}\n3234: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3235: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3236: }\n3237: \\end{aligned}\n3238: \n3239: $$\n3240: \n3241: For the first term, use the **mean subtraction trick**:\n3242: \n3243: $$\n3244: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3245: \n3246: $$\n3247: \n3248: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3249: \n3250: $$\n3251: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3252: \n3253: $$\n3254: \n3255: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3256: \n3257: **Step 3: Bound using centered deviations.**\n3258: \n3259: Now each term is centered:\n3260: \n3261: $$\n3262: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3263: \n3264: $$\n3265: \n3266: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3267: \n3268: Therefore:\n3269: \n3270: $$\n3271: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3272: \n3273: $$\n3274: \n3275: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3276: \n3277: **Step 4: Higher derivatives by induction.**\n3278: \n3279: For $m \\geq 2$, apply Leibniz rule:\n3280: \n3281: $$\n3282: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3283: \n3284: $$\n3285: \n3286: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3287: \n3288: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3289: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3290: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3291: \n3292: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3293: \n3294: By induction and combinatorial counting (Fa√† di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.",
      "metadata": {},
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3214: :::\n3215: \n3216: :::{prf:proof}\n3217: **Step 1: Naive expansion suggests k-dependence.**\n3218: \n3219: The first derivative is:\n3220: \n3221: $$\n3222: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3223: \n3224: $$\n3225: \n3226: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3227: \n3228: **Step 2: Telescoping eliminates the k-dependence.**\n3229: \n3230: Separate the sum into two parts:\n3231: \n3232: $$\n3233: \\begin{aligned}\n3234: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3235: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3236: }\n3237: \\end{aligned}\n3238: \n3239: $$\n3240: \n3241: For the first term, use the **mean subtraction trick**:\n3242: \n3243: $$\n3244: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3245: \n3246: $$\n3247: \n3248: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3249: \n3250: $$\n3251: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3252: \n3253: $$\n3254: \n3255: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3256: \n3257: **Step 3: Bound using centered deviations.**\n3258: \n3259: Now each term is centered:\n3260: \n3261: $$\n3262: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3263: \n3264: $$\n3265: \n3266: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3267: \n3268: Therefore:\n3269: \n3270: $$\n3271: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3272: \n3273: $$\n3274: \n3275: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3276: \n3277: **Step 4: Higher derivatives by induction.**\n3278: \n3279: For $m \\geq 2$, apply Leibniz rule:\n3280: \n3281: $$\n3282: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3283: \n3284: $$\n3285: \n3286: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3287: \n3288: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3289: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3290: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3291: \n3292: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3293: \n3294: By induction and combinatorial counting (Fa√† di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.\n3295: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-19",
      "title": null,
      "start_line": 3325,
      "end_line": 3334,
      "header_lines": [],
      "content_start": 3326,
      "content_end": 3333,
      "content": "3326: \n3327: :::{prf:proof}\n3328: Since $d_j = \\sum_\\ell \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ (expectation over softmax):\n3329: \n3330: $$\n3331: \\frac{\\partial d_j}{\\partial x_i} = \\sum_\\ell \\frac{\\partial}{\\partial x_i} [\\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)]\n3332: \n3333: $$",
      "metadata": {},
      "section": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling",
      "raw_directive": "3325: :::\n3326: \n3327: :::{prf:proof}\n3328: Since $d_j = \\sum_\\ell \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ (expectation over softmax):\n3329: \n3330: $$\n3331: \\frac{\\partial d_j}{\\partial x_i} = \\sum_\\ell \\frac{\\partial}{\\partial x_i} [\\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)]\n3332: \n3333: $$\n3334: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 13,
        "chapter_file": "chapter_13.json",
        "section_id": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-49",
      "title": null,
      "start_line": 3355,
      "end_line": 3444,
      "header_lines": [],
      "content_start": 3356,
      "content_end": 3443,
      "content": "3356: \n3357: :::{prf:proof}\n3358: **Step 1: Partition of unity decomposition.**\n3359: \n3360: Using the smooth partition $\\{\\psi_m\\}_{m=1}^M$ from {prf:ref}`def-smooth-phase-space-partition-full`, we have:\n3361: \n3362: $$\n3363: 1 = \\sum_{m=1}^M \\psi_m(x_i, v_i) \\quad \\text{and} \\quad 1 = \\sum_{m'=1}^M \\psi_{m'}(x_j, v_j)\n3364: \n3365: $$\n3366: \n3367: Therefore, for any function $F(x_i, v_i, x_j, v_j)$:\n3368: \n3369: $$\n3370: F = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\cdot \\psi_{m'}(x_j, v_j) \\cdot F\n3371: \n3372: $$\n3373: \n3374: Applying this to $\\partial d_j / \\partial x_i$:\n3375: \n3376: $$\n3377: \\frac{\\partial d_j}{\\partial x_i} = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\psi_{m'}(x_j, v_j) \\frac{\\partial d_j}{\\partial x_i}\n3378: \n3379: $$\n3380: \n3381: **Step 2: Intra-cluster bound** ($m = m'$).\n3382: \n3383: When walkers $i$ and $j$ both have non-zero membership in the same cluster $m$:\n3384: - Walker $i$ satisfies: $\\psi_m(x_i, v_i) > 0 \\Rightarrow d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$ (support of $\\psi_m$)\n3385: - Walker $j$ satisfies: $\\psi_m(x_j, v_j) > 0 \\Rightarrow d_{\\text{alg}}(j, \\text{center}_m) \\leq 2\\varepsilon_c$\n3386: \n3387: By the triangle inequality:\n3388: \n3389: $$\n3390: d_{\\text{alg}}(i, j) \\leq d_{\\text{alg}}(i, \\text{center}_m) + d_{\\text{alg}}(j, \\text{center}_m) \\leq 4\\varepsilon_c\n3391: \n3392: $$\n3393: \n3394: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full`:\n3395: \n3396: $$\n3397: \\left\\|\\frac{\\partial d_j}{\\partial x_i}\\right\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3398: \n3399: $$\n3400: \n3401: Therefore: $C_{i \\leftrightarrow j}^{(m,m)} = C_{d_j,1} = \\mathcal{O}(1)$.\n3402: \n3403: **Step 3: Inter-cluster bound** ($m \\neq m'$).\n3404: \n3405: When walkers belong to different clusters ($m \\neq m'$):\n3406: - Walker $i$ in cluster $m$: $d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$\n3407: - Walker $j$ in cluster $m'$: $d_{\\text{alg}}(j, \\text{center}_{m'}) \\leq 2\\varepsilon_c$\n3408: \n3409: By the triangle inequality (lower bound):\n3410: \n3411: $$\n3412: d_{\\text{alg}}(i, j) \\geq D_{\\text{sep}}(m, m') - 4\\varepsilon_c\n3413: \n3414: $$\n3415: \n3416: where $D_{\\text{sep}}(m, m') := d_{\\text{alg}}(\\text{center}_m, \\text{center}_{m'})$ is the cluster separation distance.\n3417: \n3418: The derivative involves the softmax probability (from Lemma {prf:ref}`lem-derivatives-companion-distance-full`). The key term is:\n3419: \n3420: $$\n3421: \\frac{\\partial \\mathbb{P}(c(j) = \\ell)}{\\partial x_i} \\sim \\mathbb{P}(c(j) = \\ell) \\cdot \\nabla_{x_i} \\left[-\\frac{d_{\\text{alg}}^2(j, \\ell)}{2\\varepsilon_c^2}\\right]\n3422: \n3423: $$\n3424: \n3425: For walkers $i, j$ in different clusters, the softmax probability for walker $i$ to be the companion of walker $j$ is exponentially suppressed:\n3426: \n3427: $$\n3428: \\mathbb{P}(c(j) = i) \\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\varepsilon_c^2))}{\\exp(-R_{\\max}^2/(2\\varepsilon_c^2))} \\leq \\exp\\left(-\\frac{(D_{\\text{sep}} - 4\\varepsilon_c)^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n3429: \n3430: $$\n3431: \n3432: where we used the partition function lower bound from {prf:ref}`lem-companion-availability-enforcement`.\n3433: \n3434: For well-separated clusters ($D_{\\text{sep}} \\gg \\varepsilon_c$), this gives:\n3435: \n3436: $$\n3437: C_{i \\leftrightarrow j}^{(m,m')} = \\mathcal{O}\\left(\\exp\\left(-\\frac{D_{\\text{sep}}^2(m,m')}{2\\varepsilon_c^2}\\right)\\right)\n3438: \n3439: $$\n3440: \n3441: **Conclusion**: The decomposition splits the derivative into:\n3442: - **Intra-cluster terms** ($m = m'$): $\\mathcal{O}(1)$ contributions from nearby walkers\n3443: - **Inter-cluster terms** ($m \\neq m'$): Exponentially suppressed contributions from distant walkers",
      "metadata": {},
      "section": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling",
      "raw_directive": "3355: :::\n3356: \n3357: :::{prf:proof}\n3358: **Step 1: Partition of unity decomposition.**\n3359: \n3360: Using the smooth partition $\\{\\psi_m\\}_{m=1}^M$ from {prf:ref}`def-smooth-phase-space-partition-full`, we have:\n3361: \n3362: $$\n3363: 1 = \\sum_{m=1}^M \\psi_m(x_i, v_i) \\quad \\text{and} \\quad 1 = \\sum_{m'=1}^M \\psi_{m'}(x_j, v_j)\n3364: \n3365: $$\n3366: \n3367: Therefore, for any function $F(x_i, v_i, x_j, v_j)$:\n3368: \n3369: $$\n3370: F = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\cdot \\psi_{m'}(x_j, v_j) \\cdot F\n3371: \n3372: $$\n3373: \n3374: Applying this to $\\partial d_j / \\partial x_i$:\n3375: \n3376: $$\n3377: \\frac{\\partial d_j}{\\partial x_i} = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\psi_{m'}(x_j, v_j) \\frac{\\partial d_j}{\\partial x_i}\n3378: \n3379: $$\n3380: \n3381: **Step 2: Intra-cluster bound** ($m = m'$).\n3382: \n3383: When walkers $i$ and $j$ both have non-zero membership in the same cluster $m$:\n3384: - Walker $i$ satisfies: $\\psi_m(x_i, v_i) > 0 \\Rightarrow d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$ (support of $\\psi_m$)\n3385: - Walker $j$ satisfies: $\\psi_m(x_j, v_j) > 0 \\Rightarrow d_{\\text{alg}}(j, \\text{center}_m) \\leq 2\\varepsilon_c$\n3386: \n3387: By the triangle inequality:\n3388: \n3389: $$\n3390: d_{\\text{alg}}(i, j) \\leq d_{\\text{alg}}(i, \\text{center}_m) + d_{\\text{alg}}(j, \\text{center}_m) \\leq 4\\varepsilon_c\n3391: \n3392: $$\n3393: \n3394: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full`:\n3395: \n3396: $$\n3397: \\left\\|\\frac{\\partial d_j}{\\partial x_i}\\right\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3398: \n3399: $$\n3400: \n3401: Therefore: $C_{i \\leftrightarrow j}^{(m,m)} = C_{d_j,1} = \\mathcal{O}(1)$.\n3402: \n3403: **Step 3: Inter-cluster bound** ($m \\neq m'$).\n3404: \n3405: When walkers belong to different clusters ($m \\neq m'$):\n3406: - Walker $i$ in cluster $m$: $d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$\n3407: - Walker $j$ in cluster $m'$: $d_{\\text{alg}}(j, \\text{center}_{m'}) \\leq 2\\varepsilon_c$\n3408: \n3409: By the triangle inequality (lower bound):\n3410: \n3411: $$\n3412: d_{\\text{alg}}(i, j) \\geq D_{\\text{sep}}(m, m') - 4\\varepsilon_c\n3413: \n3414: $$\n3415: \n3416: where $D_{\\text{sep}}(m, m') := d_{\\text{alg}}(\\text{center}_m, \\text{center}_{m'})$ is the cluster separation distance.\n3417: \n3418: The derivative involves the softmax probability (from Lemma {prf:ref}`lem-derivatives-companion-distance-full`). The key term is:\n3419: \n3420: $$\n3421: \\frac{\\partial \\mathbb{P}(c(j) = \\ell)}{\\partial x_i} \\sim \\mathbb{P}(c(j) = \\ell) \\cdot \\nabla_{x_i} \\left[-\\frac{d_{\\text{alg}}^2(j, \\ell)}{2\\varepsilon_c^2}\\right]\n3422: \n3423: $$\n3424: \n3425: For walkers $i, j$ in different clusters, the softmax probability for walker $i$ to be the companion of walker $j$ is exponentially suppressed:\n3426: \n3427: $$\n3428: \\mathbb{P}(c(j) = i) \\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\varepsilon_c^2))}{\\exp(-R_{\\max}^2/(2\\varepsilon_c^2))} \\leq \\exp\\left(-\\frac{(D_{\\text{sep}} - 4\\varepsilon_c)^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n3429: \n3430: $$\n3431: \n3432: where we used the partition function lower bound from {prf:ref}`lem-companion-availability-enforcement`.\n3433: \n3434: For well-separated clusters ($D_{\\text{sep}} \\gg \\varepsilon_c$), this gives:\n3435: \n3436: $$\n3437: C_{i \\leftrightarrow j}^{(m,m')} = \\mathcal{O}\\left(\\exp\\left(-\\frac{D_{\\text{sep}}^2(m,m')}{2\\varepsilon_c^2}\\right)\\right)\n3438: \n3439: $$\n3440: \n3441: **Conclusion**: The decomposition splits the derivative into:\n3442: - **Intra-cluster terms** ($m = m'$): $\\mathcal{O}(1)$ contributions from nearby walkers\n3443: - **Inter-cluster terms** ($m \\neq m'$): Exponentially suppressed contributions from distant walkers\n3444: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 13,
        "chapter_file": "chapter_13.json",
        "section_id": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-28",
      "title": null,
      "start_line": 3481,
      "end_line": 3620,
      "header_lines": [],
      "content_start": 3482,
      "content_end": 3619,
      "content": "3482: \n3483: :::{prf:proof}\n3484: **Step 1: Expand the derivative.**\n3485: \n3486: $$\n3487: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\nabla_{x_i} w_{ij} \\cdot d_j + \\sum_{j \\in \\mathcal{A}} w_{ij} \\cdot \\nabla_{x_i} d_j\n3488: \n3489: $$\n3490: \n3491: **Step 2: Telescoping the first term.**\n3492: \n3493: Using $\\sum_j \\nabla w_{ij} = 0$ and $\\mu_\\rho^{(i)} = \\sum_j w_{ij} d_j$:\n3494: \n3495: $$\n3496: \\sum_j \\nabla w_{ij} \\cdot d_j = \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho^{(i)})\n3497: \n3498: $$\n3499: \n3500: **Step 2: Use exponential localization and weighted telescoping.**\n3501: \n3502: The key observation is that $\\nabla w_{ij}$ is **exponentially localized**: $\\|\\nabla w_{ij}\\| \\sim e^{-d^2(i,j)/(2\\rho^2)} / \\rho$.\n3503: \n3504: So the sum is dominated by **nearby walkers** $j$ with $d_{\\text{alg}}(i,j) \\leq \\mathcal{O}(\\rho)$.\n3505: \n3506: By {prf:ref}`assump-uniform-density-full`, the number of such walkers is:\n3507: \n3508: $$\n3509: \\#\\{j : d_{\\text{alg}}(i,j) \\leq C\\rho\\} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\rho^{2d} = \\mathcal{O}(\\rho^{2d})\n3510: \n3511: $$\n3512: \n3513: Therefore:\n3514: \n3515: $$\n3516: \\left\\|\\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{2d}) \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3517: \n3518: $$\n3519: \n3520: This is **independent of $k$** but depends on $\\rho$.\n3521: \n3522: **Step 3: Bounding the second term with explicit k-uniformity.**\n3523: \n3524: $$\n3525: \\sum_j w_{ij} \\cdot \\nabla_{x_i} d_j\n3526: \n3527: $$\n3528: \n3529: From {prf:ref}`lem-derivatives-companion-distance-full`, $\\|\\nabla_{x_i} d_j\\| = \\mathcal{O}(1)$ when $i$ affects $j$'s companion selection.\n3530: \n3531: **Justification for k-uniformity**: Although the sum runs over all $k$ alive walkers, the result is **k-uniform** because of exponential localization:\n3532: \n3533: 1. **Localization weight decay**: $w_{ij}(\\rho) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2)) / Z_i(\\rho)$ decays exponentially with distance.\n3534: \n3535: 2. **Measurement derivative bounds**: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (Section 4.5.2), the companion-dependent measurement derivative satisfies **polynomial bounds**:\n3536: \n3537: $$\n3538: \\|\\nabla_{x_i} d_j\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3539: \n3540: $$\n3541: \n3542: **Key clarification**: The exponential factors from the softmax **cancel** in the quotient (see proof of Lemma {prf:ref}`lem-companion-measurement-derivatives-full`, Step 3, line 1012), leaving polynomial bounds rather than exponential decay. This is a crucial technical detail.\n3543: \n3544: 3. **Combined decay via weight dominance**: The summand combines the exponential decay of $w_{ij}$ with the polynomial bound on $\\nabla_{x_i} d_j$:\n3545: \n3546: $$\n3547: |w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3548: \n3549: $$\n3550: \n3551: The exponential decay of $w_{ij}(\\rho)$ **dominates** the polynomial bound on $\\nabla_{x_i} d_j$, ensuring k-uniformity of the sum.\n3552: \n3553: 4. **Sum-to-integral bound**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full` with the exponentially weighted sum:\n3554: \n3555: $$\n3556: \\sum_{j \\in \\mathcal{A}} |w_{ij} \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq C_{d_j,1} \\cdot \\rho_{\\max} (2\\pi\\rho^2)^d C_\\lambda = \\mathcal{O}(\\rho^{2d})\n3557: \n3558: $$\n3559: \n3560: This bound depends only on $\\rho$, $\\rho_{\\max}$, and dimension $d$ ‚Äî **not on $k$**.\n3561: \n3562: :::{note} **Explicit k-Uniformity Verification (Detailed)**\n3563: \n3564: To make the k-independence completely transparent, let us trace the bound step-by-step for the representative term $\\sum_j w_{ij} \\nabla_{x_i} d_j$:\n3565: \n3566: **Setup**: The summand is:\n3567: \n3568: $$\n3569: F_{ij} := w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\n3570: \n3571: $$\n3572: \n3573: **Step 1**: Bound the summand using our established bounds:\n3574: \n3575: $$\n3576: \\begin{aligned}\n3577: \\|F_{ij}\\| &= \\left\\|w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\\right\\| \\\\\n3578: &\\leq \\|w_{ij}(\\rho)\\| \\cdot \\|\\nabla_{x_i} d_j\\| \\\\\n3579: &\\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))}{Z_i(\\rho)} \\cdot C_{d_j,1} \\\\\n3580: &\\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\quad \\text{(using } Z_i \\geq 1\\text{)}\n3581: \\end{aligned}\n3582: \n3583: $$\n3584: \n3585: **Step 2**: Sum over all $k$ walkers:\n3586: \n3587: $$\n3588: \\left\\|\\sum_{j \\in \\mathcal{A}} F_{ij}\\right\\| \\leq \\sum_{j \\in \\mathcal{A}} \\|F_{ij}\\| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3589: \n3590: $$\n3591: \n3592: **Step 3**: Apply sum-to-integral lemma ({prf:ref}`lem-sum-to-integral-bound-full`):\n3593: \n3594: The sum over walkers is bounded by an integral using the uniform density bound œÅ_max:\n3595: \n3596: $$\n3597: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,y)}{2\\rho^2}\\right) dy\\,dv\n3598: \n3599: $$\n3600: \n3601: **Step 4**: Evaluate the Gaussian integral:\n3602: \n3603: $$\n3604: \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y-x_i\\|^2 + \\lambda_{\\text{alg}}\\|v-v_i\\|^2}{2\\rho^2}\\right) dy\\,dv = (2\\pi\\rho^2)^d \\cdot (2\\pi\\rho^2/\\lambda_{\\text{alg}})^{d/2} = (2\\pi\\rho^2)^d C_\\lambda\n3605: \n3606: $$\n3607: \n3608: **Step 5**: Combine to get k-uniform bound:\n3609: \n3610: $$\n3611: \\left\\|\\sum_{j \\in \\mathcal{A}} w_{ij} \\nabla_{x_i} d_j\\right\\| \\leq C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi\\rho^2)^d C_\\lambda =: C_{\\mu,1}(\\rho) \\cdot \\rho^{2d}\n3612: \n3613: $$\n3614: \n3615: where the constant $C_{\\mu,1}(\\rho) = C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi)^d C_\\lambda$ depends on:\n3616: - Derivative bound $C_{d_j,1}$ (from Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3617: - Density bound $\\rho_{\\max}$ (from Assumption {prf:ref}`assump-uniform-density-full`)\n3618: - Geometric constants $(2\\pi)^d$, $C_\\lambda$\n3619: - **NOT** on the number of alive walkers $k$",
      "metadata": {},
      "section": "## 8. Localized Mean: Derivative Expansion",
      "raw_directive": "3481: :::\n3482: \n3483: :::{prf:proof}\n3484: **Step 1: Expand the derivative.**\n3485: \n3486: $$\n3487: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\nabla_{x_i} w_{ij} \\cdot d_j + \\sum_{j \\in \\mathcal{A}} w_{ij} \\cdot \\nabla_{x_i} d_j\n3488: \n3489: $$\n3490: \n3491: **Step 2: Telescoping the first term.**\n3492: \n3493: Using $\\sum_j \\nabla w_{ij} = 0$ and $\\mu_\\rho^{(i)} = \\sum_j w_{ij} d_j$:\n3494: \n3495: $$\n3496: \\sum_j \\nabla w_{ij} \\cdot d_j = \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho^{(i)})\n3497: \n3498: $$\n3499: \n3500: **Step 2: Use exponential localization and weighted telescoping.**\n3501: \n3502: The key observation is that $\\nabla w_{ij}$ is **exponentially localized**: $\\|\\nabla w_{ij}\\| \\sim e^{-d^2(i,j)/(2\\rho^2)} / \\rho$.\n3503: \n3504: So the sum is dominated by **nearby walkers** $j$ with $d_{\\text{alg}}(i,j) \\leq \\mathcal{O}(\\rho)$.\n3505: \n3506: By {prf:ref}`assump-uniform-density-full`, the number of such walkers is:\n3507: \n3508: $$\n3509: \\#\\{j : d_{\\text{alg}}(i,j) \\leq C\\rho\\} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\rho^{2d} = \\mathcal{O}(\\rho^{2d})\n3510: \n3511: $$\n3512: \n3513: Therefore:\n3514: \n3515: $$\n3516: \\left\\|\\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{2d}) \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3517: \n3518: $$\n3519: \n3520: This is **independent of $k$** but depends on $\\rho$.\n3521: \n3522: **Step 3: Bounding the second term with explicit k-uniformity.**\n3523: \n3524: $$\n3525: \\sum_j w_{ij} \\cdot \\nabla_{x_i} d_j\n3526: \n3527: $$\n3528: \n3529: From {prf:ref}`lem-derivatives-companion-distance-full`, $\\|\\nabla_{x_i} d_j\\| = \\mathcal{O}(1)$ when $i$ affects $j$'s companion selection.\n3530: \n3531: **Justification for k-uniformity**: Although the sum runs over all $k$ alive walkers, the result is **k-uniform** because of exponential localization:\n3532: \n3533: 1. **Localization weight decay**: $w_{ij}(\\rho) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2)) / Z_i(\\rho)$ decays exponentially with distance.\n3534: \n3535: 2. **Measurement derivative bounds**: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (Section 4.5.2), the companion-dependent measurement derivative satisfies **polynomial bounds**:\n3536: \n3537: $$\n3538: \\|\\nabla_{x_i} d_j\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3539: \n3540: $$\n3541: \n3542: **Key clarification**: The exponential factors from the softmax **cancel** in the quotient (see proof of Lemma {prf:ref}`lem-companion-measurement-derivatives-full`, Step 3, line 1012), leaving polynomial bounds rather than exponential decay. This is a crucial technical detail.\n3543: \n3544: 3. **Combined decay via weight dominance**: The summand combines the exponential decay of $w_{ij}$ with the polynomial bound on $\\nabla_{x_i} d_j$:\n3545: \n3546: $$\n3547: |w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3548: \n3549: $$\n3550: \n3551: The exponential decay of $w_{ij}(\\rho)$ **dominates** the polynomial bound on $\\nabla_{x_i} d_j$, ensuring k-uniformity of the sum.\n3552: \n3553: 4. **Sum-to-integral bound**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full` with the exponentially weighted sum:\n3554: \n3555: $$\n3556: \\sum_{j \\in \\mathcal{A}} |w_{ij} \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq C_{d_j,1} \\cdot \\rho_{\\max} (2\\pi\\rho^2)^d C_\\lambda = \\mathcal{O}(\\rho^{2d})\n3557: \n3558: $$\n3559: \n3560: This bound depends only on $\\rho$, $\\rho_{\\max}$, and dimension $d$ ‚Äî **not on $k$**.\n3561: \n3562: :::{note} **Explicit k-Uniformity Verification (Detailed)**\n3563: \n3564: To make the k-independence completely transparent, let us trace the bound step-by-step for the representative term $\\sum_j w_{ij} \\nabla_{x_i} d_j$:\n3565: \n3566: **Setup**: The summand is:\n3567: \n3568: $$\n3569: F_{ij} := w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\n3570: \n3571: $$\n3572: \n3573: **Step 1**: Bound the summand using our established bounds:\n3574: \n3575: $$\n3576: \\begin{aligned}\n3577: \\|F_{ij}\\| &= \\left\\|w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\\right\\| \\\\\n3578: &\\leq \\|w_{ij}(\\rho)\\| \\cdot \\|\\nabla_{x_i} d_j\\| \\\\\n3579: &\\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))}{Z_i(\\rho)} \\cdot C_{d_j,1} \\\\\n3580: &\\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\quad \\text{(using } Z_i \\geq 1\\text{)}\n3581: \\end{aligned}\n3582: \n3583: $$\n3584: \n3585: **Step 2**: Sum over all $k$ walkers:\n3586: \n3587: $$\n3588: \\left\\|\\sum_{j \\in \\mathcal{A}} F_{ij}\\right\\| \\leq \\sum_{j \\in \\mathcal{A}} \\|F_{ij}\\| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3589: \n3590: $$\n3591: \n3592: **Step 3**: Apply sum-to-integral lemma ({prf:ref}`lem-sum-to-integral-bound-full`):\n3593: \n3594: The sum over walkers is bounded by an integral using the uniform density bound œÅ_max:\n3595: \n3596: $$\n3597: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,y)}{2\\rho^2}\\right) dy\\,dv\n3598: \n3599: $$\n3600: \n3601: **Step 4**: Evaluate the Gaussian integral:\n3602: \n3603: $$\n3604: \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y-x_i\\|^2 + \\lambda_{\\text{alg}}\\|v-v_i\\|^2}{2\\rho^2}\\right) dy\\,dv = (2\\pi\\rho^2)^d \\cdot (2\\pi\\rho^2/\\lambda_{\\text{alg}})^{d/2} = (2\\pi\\rho^2)^d C_\\lambda\n3605: \n3606: $$\n3607: \n3608: **Step 5**: Combine to get k-uniform bound:\n3609: \n3610: $$\n3611: \\left\\|\\sum_{j \\in \\mathcal{A}} w_{ij} \\nabla_{x_i} d_j\\right\\| \\leq C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi\\rho^2)^d C_\\lambda =: C_{\\mu,1}(\\rho) \\cdot \\rho^{2d}\n3612: \n3613: $$\n3614: \n3615: where the constant $C_{\\mu,1}(\\rho) = C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi)^d C_\\lambda$ depends on:\n3616: - Derivative bound $C_{d_j,1}$ (from Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3617: - Density bound $\\rho_{\\max}$ (from Assumption {prf:ref}`assump-uniform-density-full`)\n3618: - Geometric constants $(2\\pi)^d$, $C_\\lambda$\n3619: - **NOT** on the number of alive walkers $k$\n3620: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 15,
        "chapter_file": "chapter_15.json",
        "section_id": "## 8. Localized Mean: Derivative Expansion"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-207",
      "title": null,
      "start_line": 3660,
      "end_line": 3695,
      "header_lines": [],
      "content_start": 3661,
      "content_end": 3694,
      "content": "3661: \n3662: :::{prf:proof}\n3663: **Proof Strategy Overview**:\n3664: 1. **Leibniz rule expansion**: Apply the product rule to $\\nabla^{m+1}(\\sum_j w_{ij} \\cdot d_j)$ to generate $\\binom{m+1}{k}$ binomial terms\n3665: 2. **Telescoping identity**: Use $\\sum_j \\nabla^k w_{ij} = 0$ to achieve cancellation in the weight derivatives\n3666: 3. **Exponential localization**: Exploit exponential decay of $w_{ij}$ to dominate polynomial growth of measurement derivatives\n3667: 4. **Sum-to-integral technique**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to achieve k-uniformity\n3668: 5. **Fa√† di Bruno tracking**: Track combinatorial factors through nested compositions to verify Gevrey-1 growth (factorial, not exponential)\n3669: 6. **Inductive closure**: Combine bounds to show $C_{\\mu,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3670: \n3671: ---\n3672: \n3673: **Induction on $m$.**\n3674: \n3675: **Base case** ($m=1$): Established in {prf:ref}`lem-first-derivative-localized-mean-full`.\n3676: \n3677: **Inductive step** ($m \\to m+1$):\n3678: \n3679: Assume $\\|\\nabla^m \\mu_\\rho^{(i)}\\| \\leq C_{\\mu,m} \\rho^{-m}$.\n3680: \n3681: :::{note}\n3682: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\mu_\\rho$ has the schematic form:\n3683: \n3684: $$\n3685: \\nabla^{m+1} \\mu_\\rho \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} d_j]\n3686: \n3687: $$\n3688: \n3689: where the sum runs over all partitions of $m+1$ into two parts: $\\alpha + \\beta = m+1$.\n3690: \n3691: **Key bounding strategy**:\n3692: 1. **Term I** ($\\beta = 0$): Use telescoping identity $\\sum_j \\nabla^{m+1} w_{ij} = 0$ to eliminate dependence on absolute values $d_j$\n3693: 2. **Term II** ($\\beta \\geq 1$): Use **combined exponential localization**: both $w_{ij}$ (from Gaussian kernel) and $\\nabla^{\\beta} d_j$ (from companion coupling) decay exponentially\n3694: 3. **Sum-to-integral**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to show the sum over $k$ walkers is k-uniform",
      "metadata": {},
      "section": "## 8. Localized Mean: Derivative Expansion",
      "raw_directive": "3660: :::\n3661: \n3662: :::{prf:proof}\n3663: **Proof Strategy Overview**:\n3664: 1. **Leibniz rule expansion**: Apply the product rule to $\\nabla^{m+1}(\\sum_j w_{ij} \\cdot d_j)$ to generate $\\binom{m+1}{k}$ binomial terms\n3665: 2. **Telescoping identity**: Use $\\sum_j \\nabla^k w_{ij} = 0$ to achieve cancellation in the weight derivatives\n3666: 3. **Exponential localization**: Exploit exponential decay of $w_{ij}$ to dominate polynomial growth of measurement derivatives\n3667: 4. **Sum-to-integral technique**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to achieve k-uniformity\n3668: 5. **Fa√† di Bruno tracking**: Track combinatorial factors through nested compositions to verify Gevrey-1 growth (factorial, not exponential)\n3669: 6. **Inductive closure**: Combine bounds to show $C_{\\mu,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3670: \n3671: ---\n3672: \n3673: **Induction on $m$.**\n3674: \n3675: **Base case** ($m=1$): Established in {prf:ref}`lem-first-derivative-localized-mean-full`.\n3676: \n3677: **Inductive step** ($m \\to m+1$):\n3678: \n3679: Assume $\\|\\nabla^m \\mu_\\rho^{(i)}\\| \\leq C_{\\mu,m} \\rho^{-m}$.\n3680: \n3681: :::{note}\n3682: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\mu_\\rho$ has the schematic form:\n3683: \n3684: $$\n3685: \\nabla^{m+1} \\mu_\\rho \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} d_j]\n3686: \n3687: $$\n3688: \n3689: where the sum runs over all partitions of $m+1$ into two parts: $\\alpha + \\beta = m+1$.\n3690: \n3691: **Key bounding strategy**:\n3692: 1. **Term I** ($\\beta = 0$): Use telescoping identity $\\sum_j \\nabla^{m+1} w_{ij} = 0$ to eliminate dependence on absolute values $d_j$\n3693: 2. **Term II** ($\\beta \\geq 1$): Use **combined exponential localization**: both $w_{ij}$ (from Gaussian kernel) and $\\nabla^{\\beta} d_j$ (from companion coupling) decay exponentially\n3694: 3. **Sum-to-integral**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to show the sum over $k$ walkers is k-uniform\n3695: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 15,
        "chapter_file": "chapter_15.json",
        "section_id": "## 8. Localized Mean: Derivative Expansion"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-23",
      "title": null,
      "start_line": 3845,
      "end_line": 3952,
      "header_lines": [],
      "content_start": 3846,
      "content_end": 3951,
      "content": "3846: \n3847: :::{prf:proof}\n3848: **Step 1: Product rule expansion.**\n3849: \n3850: $$\n3851: \\frac{\\partial}{\\partial x_i} \\sigma_\\rho^{2(i)} = \\sum_j \\frac{\\partial}{\\partial x_i} \\left[w_{ij}(\\rho) \\cdot (d_j - \\mu_\\rho^{(i)})^2\\right]\n3852: \n3853: $$\n3854: \n3855: Applying product rule:\n3856: \n3857: $$\n3858: = \\sum_j \\left[\\frac{\\partial w_{ij}}{\\partial x_i} \\cdot (d_j - \\mu_\\rho)^2 + w_{ij} \\cdot \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2\\right]\n3859: \n3860: $$\n3861: \n3862: **Step 2: Derivative of squared term.**\n3863: \n3864: By chain rule:\n3865: \n3866: $$\n3867: \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2 = 2(d_j - \\mu_\\rho) \\cdot \\left(\\frac{\\partial d_j}{\\partial x_i} - \\frac{\\partial \\mu_\\rho}{\\partial x_i}\\right)\n3868: \n3869: $$\n3870: \n3871: **Step 3: Telescoping the first term.**\n3872: \n3873: Using $\\sum_j \\nabla w_{ij} = 0$:\n3874: \n3875: Define the **localized second moment**:\n3876: \n3877: $$\n3878: M_2^{(i)} := \\sum_j w_{ij} (d_j - \\mu_\\rho)^2 = \\sigma_\\rho^{2(i)}\n3879: \n3880: $$\n3881: \n3882: Then:\n3883: \n3884: $$\n3885: \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)^2 = \\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\n3886: \n3887: $$\n3888: \n3889: Bounding:\n3890: \n3891: $$\n3892: \\left\\|\\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\\right\\| \\leq \\rho^{2d} \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3893: \n3894: $$\n3895: \n3896: **Step 4: Bounding the second term with explicit k-uniformity.**\n3897: \n3898: $$\n3899: \\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\n3900: \n3901: $$\n3902: \n3903: **Justification for k-uniformity**: The sum runs over $k$ walkers, but remains k-uniform due to exponential localization:\n3904: \n3905: 1. **Measurement bounds**: $|d_j - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$ (measurements are bounded)\n3906: \n3907: 2. **Derivative bounds**:\n3908:    - $\\|\\nabla d_j\\| = \\mathcal{O}(1)$ with polynomial bounds (Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3909:    - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$ (from Section 7.1)\n3910: \n3911: 3. **Combined term**: Each summand satisfies:\n3912: \n3913: $$\n3914: |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla_{x_i} d_j - \\nabla_{x_i} \\mu_\\rho)|\n3915: \\leq w_{ij} \\cdot \\mathcal{O}(1) \\cdot \\mathcal{O}(\\rho^{-1})\n3916: \n3917: $$\n3918: \n3919: 4. **Exponential localization of the product**: The key is that both $w_{ij}$ and $\\nabla_{x_i} d_j$ decay exponentially (as shown in ¬ß8.1), so their product is exponentially suppressed for distant walkers:\n3920: \n3921: $$\n3922: w_{ij} \\cdot \\nabla_{x_i} d_j = \\mathcal{O}\\left(\\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho_{\\text{eff}}^2}\\right)\\right)\n3923: \n3924: $$\n3925: \n3926: where $\\rho_{\\text{eff}}^{-2} = \\rho^{-2} + \\varepsilon_c^{-2}$.\n3927: \n3928: 5. **Sum-to-integral**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full`:\n3929: \n3930: $$\n3931: \\sum_j |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)|\n3932: \\leq \\rho_{\\max} \\int_{\\mathbb{R}^{2d}} \\mathcal{O}(\\rho^{-1}) \\exp\\left(-\\frac{\\|y\\|^2}{2\\rho_{\\text{eff}}^2}\\right) dy\n3933: = \\mathcal{O}(\\rho^{2d-1})\n3934: \n3935: $$\n3936: \n3937: Therefore:\n3938: \n3939: $$\n3940: \\left\\|\\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{-1})\n3941: \n3942: $$\n3943: \n3944: which is **k-uniform** (depends only on $\\rho$, $\\varepsilon_c$, $\\rho_{\\max}$, $d$ ‚Äî not on $k$ or $N$).\n3945: \n3946: **Step 5: Combine.**\n3947: \n3948: $$\n3949: \\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq \\mathcal{O}(\\rho^{2d-1}) + \\mathcal{O}(\\rho^{-1}) = \\mathcal{O}(\\rho^{-1})\n3950: \n3951: $$",
      "metadata": {},
      "section": "## 9. Localized Variance: Full Derivative Analysis",
      "raw_directive": "3845: :::\n3846: \n3847: :::{prf:proof}\n3848: **Step 1: Product rule expansion.**\n3849: \n3850: $$\n3851: \\frac{\\partial}{\\partial x_i} \\sigma_\\rho^{2(i)} = \\sum_j \\frac{\\partial}{\\partial x_i} \\left[w_{ij}(\\rho) \\cdot (d_j - \\mu_\\rho^{(i)})^2\\right]\n3852: \n3853: $$\n3854: \n3855: Applying product rule:\n3856: \n3857: $$\n3858: = \\sum_j \\left[\\frac{\\partial w_{ij}}{\\partial x_i} \\cdot (d_j - \\mu_\\rho)^2 + w_{ij} \\cdot \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2\\right]\n3859: \n3860: $$\n3861: \n3862: **Step 2: Derivative of squared term.**\n3863: \n3864: By chain rule:\n3865: \n3866: $$\n3867: \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2 = 2(d_j - \\mu_\\rho) \\cdot \\left(\\frac{\\partial d_j}{\\partial x_i} - \\frac{\\partial \\mu_\\rho}{\\partial x_i}\\right)\n3868: \n3869: $$\n3870: \n3871: **Step 3: Telescoping the first term.**\n3872: \n3873: Using $\\sum_j \\nabla w_{ij} = 0$:\n3874: \n3875: Define the **localized second moment**:\n3876: \n3877: $$\n3878: M_2^{(i)} := \\sum_j w_{ij} (d_j - \\mu_\\rho)^2 = \\sigma_\\rho^{2(i)}\n3879: \n3880: $$\n3881: \n3882: Then:\n3883: \n3884: $$\n3885: \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)^2 = \\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\n3886: \n3887: $$\n3888: \n3889: Bounding:\n3890: \n3891: $$\n3892: \\left\\|\\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\\right\\| \\leq \\rho^{2d} \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3893: \n3894: $$\n3895: \n3896: **Step 4: Bounding the second term with explicit k-uniformity.**\n3897: \n3898: $$\n3899: \\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\n3900: \n3901: $$\n3902: \n3903: **Justification for k-uniformity**: The sum runs over $k$ walkers, but remains k-uniform due to exponential localization:\n3904: \n3905: 1. **Measurement bounds**: $|d_j - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$ (measurements are bounded)\n3906: \n3907: 2. **Derivative bounds**:\n3908:    - $\\|\\nabla d_j\\| = \\mathcal{O}(1)$ with polynomial bounds (Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3909:    - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$ (from Section 7.1)\n3910: \n3911: 3. **Combined term**: Each summand satisfies:\n3912: \n3913: $$\n3914: |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla_{x_i} d_j - \\nabla_{x_i} \\mu_\\rho)|\n3915: \\leq w_{ij} \\cdot \\mathcal{O}(1) \\cdot \\mathcal{O}(\\rho^{-1})\n3916: \n3917: $$\n3918: \n3919: 4. **Exponential localization of the product**: The key is that both $w_{ij}$ and $\\nabla_{x_i} d_j$ decay exponentially (as shown in ¬ß8.1), so their product is exponentially suppressed for distant walkers:\n3920: \n3921: $$\n3922: w_{ij} \\cdot \\nabla_{x_i} d_j = \\mathcal{O}\\left(\\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho_{\\text{eff}}^2}\\right)\\right)\n3923: \n3924: $$\n3925: \n3926: where $\\rho_{\\text{eff}}^{-2} = \\rho^{-2} + \\varepsilon_c^{-2}$.\n3927: \n3928: 5. **Sum-to-integral**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full`:\n3929: \n3930: $$\n3931: \\sum_j |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)|\n3932: \\leq \\rho_{\\max} \\int_{\\mathbb{R}^{2d}} \\mathcal{O}(\\rho^{-1}) \\exp\\left(-\\frac{\\|y\\|^2}{2\\rho_{\\text{eff}}^2}\\right) dy\n3933: = \\mathcal{O}(\\rho^{2d-1})\n3934: \n3935: $$\n3936: \n3937: Therefore:\n3938: \n3939: $$\n3940: \\left\\|\\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{-1})\n3941: \n3942: $$\n3943: \n3944: which is **k-uniform** (depends only on $\\rho$, $\\varepsilon_c$, $\\rho_{\\max}$, $d$ ‚Äî not on $k$ or $N$).\n3945: \n3946: **Step 5: Combine.**\n3947: \n3948: $$\n3949: \\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq \\mathcal{O}(\\rho^{2d-1}) + \\mathcal{O}(\\rho^{-1}) = \\mathcal{O}(\\rho^{-1})\n3950: \n3951: $$\n3952: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 16,
        "chapter_file": "chapter_16.json",
        "section_id": "## 9. Localized Variance: Full Derivative Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-147",
      "title": null,
      "start_line": 3969,
      "end_line": 4012,
      "header_lines": [],
      "content_start": 3970,
      "content_end": 4011,
      "content": "3970: \n3971: :::{prf:proof}\n3972: **Proof Strategy Overview**:\n3973: 1. **Product rule for squared terms**: Expand $\\nabla^{m+1}[\\sum_j w_{ij}(d_j - \\mu_\\rho)^2]$ using the product rule for $(d_j - \\mu_\\rho)^2$\n3974: 2. **Leibniz rule cascade**: Apply Leibniz rule multiple times for products of weights, measurements, and mean\n3975: 3. **Telescoping with squared terms**: Use $\\sum_j \\nabla^k w_{ij} = 0$ but account for the $(d_j - \\mu_\\rho)^2$ factor\n3976: 4. **Cross-terms from mean derivatives**: Track cross-terms arising from $\\nabla^k \\mu_\\rho$ (using inductive hypothesis on mean from Lemma {prf:ref}`lem-mth-derivative-localized-mean-full`)\n3977: 5. **Exponential localization dominance**: Show that exponential decay of $w_{ij}$ overcomes polynomial growth from all terms\n3978: 6. **Sum-to-integral for k-uniformity**: Apply sum-to-integral lemma to each term class separately\n3979: 7. **Fa√† di Bruno combinatorics**: Verify that despite increased complexity, Gevrey-1 growth is preserved\n3980: 8. **Inductive closure**: Establish $C_{\\sigma^2,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3981: \n3982: ---\n3983: \n3984: **Induction on $m$**, following the structure of {prf:ref}`lem-mth-derivative-localized-mean-full` but accounting for the additional complexity from the squared term.\n3985: \n3986: **Base case** ($m=1$): Established in Section 8.1.\n3987: \n3988: **Inductive step** ($m \\to m+1$):\n3989: \n3990: Assume $\\|\\nabla^m \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,m}(\\rho) \\rho^{-m}$ where $C_{\\sigma^2,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm})$.\n3991: \n3992: :::{note}\n3993: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\sigma_\\rho^2$ has the schematic form:\n3994: \n3995: $$\n3996: \\nabla^{m+1} \\sigma_\\rho^2 \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} (d_j - \\mu_\\rho)^2]\n3997: \n3998: $$\n3999: \n4000: where $\\alpha + \\beta = m+1$. The squared term adds complexity through Fa√† di Bruno's formula:\n4001: \n4002: $$\n4003: \\nabla^{\\beta} (d_j - \\mu_\\rho)^2 \\sim \\sum_{\\text{compositions}} [\\nabla^{k_1} \\Delta_j] \\cdot [\\nabla^{k_2} \\Delta_j] \\cdots\n4004: \n4005: $$\n4006: \n4007: **Key bounding strategy**:\n4008: 1. **Telescoping** ($\\alpha = m+1, \\beta = 0$): Use $\\sum_j \\nabla^{m+1} w_{ij} = 0$ as in ¬ß8.2\n4009: 2. **Product structure** ($\\beta \\geq 1$): Each $\\nabla^{\\beta} (d_j - \\mu_\\rho)^2$ involves products of derivatives $\\nabla^k \\Delta_j$ with $k \\leq \\beta$\n4010: 3. **Exponential localization**: Combined decay from $w_{ij}$ and companion coupling in $d_j$ ensures k-uniformity\n4011: 4. **Factorial counting**: Compositions and partitions contribute at most $\\mathcal{O}(\\beta!) \\cdot \\mathcal{O}((m+1-\\beta)!) = \\mathcal{O}((m+1)!)$",
      "metadata": {},
      "section": "## 9. Localized Variance: Full Derivative Analysis",
      "raw_directive": "3969: :::\n3970: \n3971: :::{prf:proof}\n3972: **Proof Strategy Overview**:\n3973: 1. **Product rule for squared terms**: Expand $\\nabla^{m+1}[\\sum_j w_{ij}(d_j - \\mu_\\rho)^2]$ using the product rule for $(d_j - \\mu_\\rho)^2$\n3974: 2. **Leibniz rule cascade**: Apply Leibniz rule multiple times for products of weights, measurements, and mean\n3975: 3. **Telescoping with squared terms**: Use $\\sum_j \\nabla^k w_{ij} = 0$ but account for the $(d_j - \\mu_\\rho)^2$ factor\n3976: 4. **Cross-terms from mean derivatives**: Track cross-terms arising from $\\nabla^k \\mu_\\rho$ (using inductive hypothesis on mean from Lemma {prf:ref}`lem-mth-derivative-localized-mean-full`)\n3977: 5. **Exponential localization dominance**: Show that exponential decay of $w_{ij}$ overcomes polynomial growth from all terms\n3978: 6. **Sum-to-integral for k-uniformity**: Apply sum-to-integral lemma to each term class separately\n3979: 7. **Fa√† di Bruno combinatorics**: Verify that despite increased complexity, Gevrey-1 growth is preserved\n3980: 8. **Inductive closure**: Establish $C_{\\sigma^2,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3981: \n3982: ---\n3983: \n3984: **Induction on $m$**, following the structure of {prf:ref}`lem-mth-derivative-localized-mean-full` but accounting for the additional complexity from the squared term.\n3985: \n3986: **Base case** ($m=1$): Established in Section 8.1.\n3987: \n3988: **Inductive step** ($m \\to m+1$):\n3989: \n3990: Assume $\\|\\nabla^m \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,m}(\\rho) \\rho^{-m}$ where $C_{\\sigma^2,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm})$.\n3991: \n3992: :::{note}\n3993: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\sigma_\\rho^2$ has the schematic form:\n3994: \n3995: $$\n3996: \\nabla^{m+1} \\sigma_\\rho^2 \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} (d_j - \\mu_\\rho)^2]\n3997: \n3998: $$\n3999: \n4000: where $\\alpha + \\beta = m+1$. The squared term adds complexity through Fa√† di Bruno's formula:\n4001: \n4002: $$\n4003: \\nabla^{\\beta} (d_j - \\mu_\\rho)^2 \\sim \\sum_{\\text{compositions}} [\\nabla^{k_1} \\Delta_j] \\cdot [\\nabla^{k_2} \\Delta_j] \\cdots\n4004: \n4005: $$\n4006: \n4007: **Key bounding strategy**:\n4008: 1. **Telescoping** ($\\alpha = m+1, \\beta = 0$): Use $\\sum_j \\nabla^{m+1} w_{ij} = 0$ as in ¬ß8.2\n4009: 2. **Product structure** ($\\beta \\geq 1$): Each $\\nabla^{\\beta} (d_j - \\mu_\\rho)^2$ involves products of derivatives $\\nabla^k \\Delta_j$ with $k \\leq \\beta$\n4010: 3. **Exponential localization**: Combined decay from $w_{ij}$ and companion coupling in $d_j$ ensures k-uniformity\n4011: 4. **Factorial counting**: Compositions and partitions contribute at most $\\mathcal{O}(\\beta!) \\cdot \\mathcal{O}((m+1-\\beta)!) = \\mathcal{O}((m+1)!)$\n4012: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 16,
        "chapter_file": "chapter_16.json",
        "section_id": "## 9. Localized Variance: Full Derivative Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-31",
      "title": null,
      "start_line": 4315,
      "end_line": 4395,
      "header_lines": [],
      "content_start": 4316,
      "content_end": 4394,
      "content": "4316: \n4317: :::{prf:proof}\n4318: **Step 1: Lower bound.**\n4319: \n4320: Since $\\sigma_\\rho^{2(i)} \\geq 0$:\n4321: \n4322: $$\n4323: \\sigma'_\\rho(i) = \\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2} \\geq \\sqrt{\\eta_{\\min}^2} = \\eta_{\\min} > 0\n4324: \n4325: $$\n4326: \n4327: **Step 2: Smoothness.**\n4328: \n4329: The square root function $f(x) = \\sqrt{x}$ is C^‚àû on $(0, \\infty)$.\n4330: \n4331: Since $\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2 > 0$ always, the composition:\n4332: \n4333: $$\n4334: \\sigma'_\\rho(i) = f(\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2)\n4335: \n4336: $$\n4337: \n4338: is C^‚àû (composition of C^‚àû functions with domain avoiding the singularity at 0).\n4339: \n4340: **Step 3: First derivative via chain rule.**\n4341: \n4342: $$\n4343: \\nabla \\sigma'_\\rho(i) = \\frac{1}{2\\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2}} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4344: = \\frac{1}{2\\sigma'_\\rho(i)} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4345: \n4346: $$\n4347: \n4348: Using $\\sigma'_\\rho(i) \\geq \\eta_{\\min}$ and $\\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,1} \\rho^{-1}$:\n4349: \n4350: $$\n4351: \\|\\nabla \\sigma'_\\rho(i)\\| \\leq \\frac{1}{2\\eta_{\\min}} \\cdot C_{\\sigma^2,1} \\rho^{-1} = \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})\n4352: \n4353: $$\n4354: \n4355: **Step 4: Higher derivatives via Fa√† di Bruno.**\n4356: \n4357: For $m \\geq 2$, apply the Fa√† di Bruno formula for the composition $\\sqrt{g(x)}$ where $g = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2$:\n4358: \n4359: $$\n4360: \\nabla^m \\sigma'_\\rho = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot \\frac{d^k}{dx^k}\\sqrt{x}\\Big|_{x=g} \\cdot \\prod_j (\\nabla^{j} g)^{n_j}\n4361: \n4362: $$\n4363: \n4364: The derivatives of $\\sqrt{x}$ are:\n4365: \n4366: $$\n4367: \\frac{d^m}{dx^m} \\sqrt{x} = (-1)^{m-1} \\frac{(2m-3)!!}{2^m} x^{1/2 - m}\n4368: \n4369: $$\n4370: \n4371: At $x = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$:\n4372: \n4373: $$\n4374: \\left|\\frac{d^m}{dx^m} \\sqrt{x}\\right| \\leq C_m \\cdot \\eta_{\\min}^{1-2m}\n4375: \n4376: $$\n4377: \n4378: where $C_m = \\mathcal{O}(m!)$ from the double factorial $(2m-3)!! = \\mathcal{O}(m!/2^m)$.\n4379: \n4380: Combining with $\\|\\nabla^j \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,j} \\rho^{-j}$:\n4381: \n4382: $$\n4383: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_m \\eta_{\\min}^{1-2m} \\sum_{\\text{partitions}} \\prod_j (C_{\\sigma^2,j} \\rho^{-j})^{n_j}\n4384: \n4385: $$\n4386: \n4387: The sum over partitions gives factorial growth, yielding:\n4388: \n4389: $$\n4390: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_{\\sigma',m}(\\rho) \\cdot \\rho^{-m}\n4391: \n4392: $$\n4393: \n4394: where $C_{\\sigma',m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m-1)})$.",
      "metadata": {},
      "section": "## 10. Regularized Standard Deviation",
      "raw_directive": "4315: :::\n4316: \n4317: :::{prf:proof}\n4318: **Step 1: Lower bound.**\n4319: \n4320: Since $\\sigma_\\rho^{2(i)} \\geq 0$:\n4321: \n4322: $$\n4323: \\sigma'_\\rho(i) = \\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2} \\geq \\sqrt{\\eta_{\\min}^2} = \\eta_{\\min} > 0\n4324: \n4325: $$\n4326: \n4327: **Step 2: Smoothness.**\n4328: \n4329: The square root function $f(x) = \\sqrt{x}$ is C^‚àû on $(0, \\infty)$.\n4330: \n4331: Since $\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2 > 0$ always, the composition:\n4332: \n4333: $$\n4334: \\sigma'_\\rho(i) = f(\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2)\n4335: \n4336: $$\n4337: \n4338: is C^‚àû (composition of C^‚àû functions with domain avoiding the singularity at 0).\n4339: \n4340: **Step 3: First derivative via chain rule.**\n4341: \n4342: $$\n4343: \\nabla \\sigma'_\\rho(i) = \\frac{1}{2\\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2}} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4344: = \\frac{1}{2\\sigma'_\\rho(i)} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4345: \n4346: $$\n4347: \n4348: Using $\\sigma'_\\rho(i) \\geq \\eta_{\\min}$ and $\\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,1} \\rho^{-1}$:\n4349: \n4350: $$\n4351: \\|\\nabla \\sigma'_\\rho(i)\\| \\leq \\frac{1}{2\\eta_{\\min}} \\cdot C_{\\sigma^2,1} \\rho^{-1} = \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})\n4352: \n4353: $$\n4354: \n4355: **Step 4: Higher derivatives via Fa√† di Bruno.**\n4356: \n4357: For $m \\geq 2$, apply the Fa√† di Bruno formula for the composition $\\sqrt{g(x)}$ where $g = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2$:\n4358: \n4359: $$\n4360: \\nabla^m \\sigma'_\\rho = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot \\frac{d^k}{dx^k}\\sqrt{x}\\Big|_{x=g} \\cdot \\prod_j (\\nabla^{j} g)^{n_j}\n4361: \n4362: $$\n4363: \n4364: The derivatives of $\\sqrt{x}$ are:\n4365: \n4366: $$\n4367: \\frac{d^m}{dx^m} \\sqrt{x} = (-1)^{m-1} \\frac{(2m-3)!!}{2^m} x^{1/2 - m}\n4368: \n4369: $$\n4370: \n4371: At $x = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$:\n4372: \n4373: $$\n4374: \\left|\\frac{d^m}{dx^m} \\sqrt{x}\\right| \\leq C_m \\cdot \\eta_{\\min}^{1-2m}\n4375: \n4376: $$\n4377: \n4378: where $C_m = \\mathcal{O}(m!)$ from the double factorial $(2m-3)!! = \\mathcal{O}(m!/2^m)$.\n4379: \n4380: Combining with $\\|\\nabla^j \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,j} \\rho^{-j}$:\n4381: \n4382: $$\n4383: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_m \\eta_{\\min}^{1-2m} \\sum_{\\text{partitions}} \\prod_j (C_{\\sigma^2,j} \\rho^{-j})^{n_j}\n4384: \n4385: $$\n4386: \n4387: The sum over partitions gives factorial growth, yielding:\n4388: \n4389: $$\n4390: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_{\\sigma',m}(\\rho) \\cdot \\rho^{-m}\n4391: \n4392: $$\n4393: \n4394: where $C_{\\sigma',m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m-1)})$.\n4395: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 18,
        "chapter_file": "chapter_18.json",
        "section_id": "## 10. Regularized Standard Deviation"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-27",
      "title": null,
      "start_line": 4427,
      "end_line": 4502,
      "header_lines": [],
      "content_start": 4428,
      "content_end": 4501,
      "content": "4428: \n4429: :::{prf:proof}\n4430: **Step 1: Well-definedness.**\n4431: \n4432: Since $\\sigma'_\\rho(i) \\geq \\eta_{\\min} > 0$ (by {prf:ref}`lem-properties-regularized-std-dev-full`), the quotient is well-defined everywhere.\n4433: \n4434: **Step 2: Smoothness.**\n4435: \n4436: Both numerator and denominator are C^‚àû:\n4437: - $d_i - \\mu_\\rho^{(i)} \\in C^\\infty$ (measurements and localized mean)\n4438: - $\\sigma'_\\rho(i) \\in C^\\infty$ (regularized std dev)\n4439: \n4440: Therefore $Z_\\rho^{(i)} \\in C^\\infty$ by smoothness of quotients with non-vanishing denominator.\n4441: \n4442: **Step 3: First derivative via quotient rule.**\n4443: \n4444: $$\n4445: \\nabla Z_\\rho^{(i)} = \\frac{\\nabla(d_i - \\mu_\\rho) \\cdot \\sigma'_\\rho - (d_i - \\mu_\\rho) \\cdot \\nabla \\sigma'_\\rho}{(\\sigma'_\\rho)^2}\n4446: \n4447: $$\n4448: \n4449: Bounding each term:\n4450: - $\\|\\nabla d_i\\| = \\mathcal{O}(1)$ (companion coupling)\n4451: - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$\n4452: - $|d_i - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$\n4453: - $\\|\\nabla \\sigma'_\\rho\\| \\leq C_{\\sigma'} \\eta_{\\min}^{-1} \\rho^{-1}$\n4454: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4455: \n4456: Therefore:\n4457: \n4458: $$\n4459: \\|\\nabla Z_\\rho^{(i)}\\| \\leq \\frac{\\mathcal{O}(\\rho^{-1}) + \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})}{\\eta_{\\min}^2} = \\mathcal{O}(\\eta_{\\min}^{-3} \\rho^{-1})\n4460: \n4461: $$\n4462: \n4463: **Step 4: Higher derivatives via generalized quotient rule.**\n4464: \n4465: For $m \\geq 2$, the $m$-th derivative of a quotient $f/g$ is given by:\n4466: \n4467: $$\n4468: \\nabla^m \\left(\\frac{f}{g}\\right) = \\frac{1}{g} \\sum_{k=0}^m \\binom{m}{k} \\nabla^k f \\cdot \\nabla^{m-k}\\left(\\frac{1}{g}\\right)\n4469: \n4470: $$\n4471: \n4472: where derivatives of $1/g$ satisfy:\n4473: \n4474: $$\n4475: \\nabla^{m}\\left(\\frac{1}{g}\\right) = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot g^{-(n_1+\\cdots+n_m+1)} \\cdot \\prod_{j=1}^m (\\nabla^j g)^{n_j}\n4476: \n4477: $$\n4478: \n4479: Using:\n4480: - $\\|\\nabla^k (d_i - \\mu_\\rho)\\| \\leq C_\\mu^{(k)} \\rho^{-k}$ (from {prf:ref}`lem-mth-derivative-localized-mean-full`)\n4481: - $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma',j} \\eta_{\\min}^{-(2j-1)} \\rho^{-j}$\n4482: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4483: \n4484: We get:\n4485: \n4486: $$\n4487: \\|\\nabla^m Z_\\rho^{(i)}\\| \\leq C_{Z,m}(\\rho) \\cdot \\rho^{-m}\n4488: \n4489: $$\n4490: \n4491: where the constant:\n4492: \n4493: $$\n4494: C_{Z,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)})\n4495: \n4496: $$\n4497: \n4498: accounts for:\n4499: - Factorial growth from combinatorial quotient rule terms: $m!$\n4500: - Localization radius factors: $\\rho^{2dm}$\n4501: - Inverse powers of regularization: $\\eta_{\\min}^{-(2m+1)}$",
      "metadata": {},
      "section": "## 11. Z-Score: Quotient Rule Analysis",
      "raw_directive": "4427: :::\n4428: \n4429: :::{prf:proof}\n4430: **Step 1: Well-definedness.**\n4431: \n4432: Since $\\sigma'_\\rho(i) \\geq \\eta_{\\min} > 0$ (by {prf:ref}`lem-properties-regularized-std-dev-full`), the quotient is well-defined everywhere.\n4433: \n4434: **Step 2: Smoothness.**\n4435: \n4436: Both numerator and denominator are C^‚àû:\n4437: - $d_i - \\mu_\\rho^{(i)} \\in C^\\infty$ (measurements and localized mean)\n4438: - $\\sigma'_\\rho(i) \\in C^\\infty$ (regularized std dev)\n4439: \n4440: Therefore $Z_\\rho^{(i)} \\in C^\\infty$ by smoothness of quotients with non-vanishing denominator.\n4441: \n4442: **Step 3: First derivative via quotient rule.**\n4443: \n4444: $$\n4445: \\nabla Z_\\rho^{(i)} = \\frac{\\nabla(d_i - \\mu_\\rho) \\cdot \\sigma'_\\rho - (d_i - \\mu_\\rho) \\cdot \\nabla \\sigma'_\\rho}{(\\sigma'_\\rho)^2}\n4446: \n4447: $$\n4448: \n4449: Bounding each term:\n4450: - $\\|\\nabla d_i\\| = \\mathcal{O}(1)$ (companion coupling)\n4451: - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$\n4452: - $|d_i - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$\n4453: - $\\|\\nabla \\sigma'_\\rho\\| \\leq C_{\\sigma'} \\eta_{\\min}^{-1} \\rho^{-1}$\n4454: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4455: \n4456: Therefore:\n4457: \n4458: $$\n4459: \\|\\nabla Z_\\rho^{(i)}\\| \\leq \\frac{\\mathcal{O}(\\rho^{-1}) + \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})}{\\eta_{\\min}^2} = \\mathcal{O}(\\eta_{\\min}^{-3} \\rho^{-1})\n4460: \n4461: $$\n4462: \n4463: **Step 4: Higher derivatives via generalized quotient rule.**\n4464: \n4465: For $m \\geq 2$, the $m$-th derivative of a quotient $f/g$ is given by:\n4466: \n4467: $$\n4468: \\nabla^m \\left(\\frac{f}{g}\\right) = \\frac{1}{g} \\sum_{k=0}^m \\binom{m}{k} \\nabla^k f \\cdot \\nabla^{m-k}\\left(\\frac{1}{g}\\right)\n4469: \n4470: $$\n4471: \n4472: where derivatives of $1/g$ satisfy:\n4473: \n4474: $$\n4475: \\nabla^{m}\\left(\\frac{1}{g}\\right) = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot g^{-(n_1+\\cdots+n_m+1)} \\cdot \\prod_{j=1}^m (\\nabla^j g)^{n_j}\n4476: \n4477: $$\n4478: \n4479: Using:\n4480: - $\\|\\nabla^k (d_i - \\mu_\\rho)\\| \\leq C_\\mu^{(k)} \\rho^{-k}$ (from {prf:ref}`lem-mth-derivative-localized-mean-full`)\n4481: - $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma',j} \\eta_{\\min}^{-(2j-1)} \\rho^{-j}$\n4482: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4483: \n4484: We get:\n4485: \n4486: $$\n4487: \\|\\nabla^m Z_\\rho^{(i)}\\| \\leq C_{Z,m}(\\rho) \\cdot \\rho^{-m}\n4488: \n4489: $$\n4490: \n4491: where the constant:\n4492: \n4493: $$\n4494: C_{Z,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)})\n4495: \n4496: $$\n4497: \n4498: accounts for:\n4499: - Factorial growth from combinatorial quotient rule terms: $m!$\n4500: - Localization radius factors: $\\rho^{2dm}$\n4501: - Inverse powers of regularization: $\\eta_{\\min}^{-(2m+1)}$\n4502: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 19,
        "chapter_file": "chapter_19.json",
        "section_id": "## 11. Z-Score: Quotient Rule Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-79",
      "title": null,
      "start_line": 4600,
      "end_line": 4677,
      "header_lines": [],
      "content_start": 4601,
      "content_end": 4676,
      "content": "4601: \n4602: :::{prf:proof}\n4603: **Step 1: Composition structure.**\n4604: \n4605: The fitness potential is the composition:\n4606: \n4607: $$\n4608: V_{\\text{fit}} = g_A \\circ Z_\\rho \\circ (\\mu_\\rho, \\sigma'_\\rho, d_i)\n4609: \n4610: $$\n4611: \n4612: where each component is C^‚àû by previous lemmas.\n4613: \n4614: **Step 2: Fa√† di Bruno formula for composition.**\n4615: \n4616: For $m \\geq 1$, the $m$-th derivative of $g_A(Z_\\rho^{(i)})$ is:\n4617: \n4618: $$\n4619: \\nabla^m V_{\\text{fit}} = \\sum_{k=1}^m g_A^{(k)}(Z_\\rho^{(i)}) \\cdot B_{m,k}(\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\ldots, \\nabla^m Z_\\rho)\n4620: \n4621: $$\n4622: \n4623: where $B_{m,k}$ are the **Bell polynomials** encoding the combinatorics of the chain rule.\n4624: \n4625: **Step 3: Bounding each term with Œµ_d propagation.**\n4626: \n4627: For the $k$-th term:\n4628: - $|g_A^{(k)}(Z_\\rho)| \\leq L_{g,k} = \\mathcal{O}(k!)$ (bounded derivatives of $g_A$)\n4629: - $B_{m,k}$ involves products of $\\nabla^j Z_\\rho$ with $j \\leq m$\n4630: - $\\|\\nabla^j Z_\\rho\\| \\leq C_{Z,j}(\\rho, \\varepsilon_d) \\cdot \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ where $C_{Z,j} = \\mathcal{O}(j! \\cdot \\rho^{2dj} \\cdot \\eta_{\\min}^{-(2j+1)})$\n4631: \n4632: **Œµ_d dependency chain**:\n4633: 1. **Companion measurements**: $\\|\\nabla^j d_i\\| \\leq C_d \\varepsilon_d^{1-j}$\n4634: 2. **Localized mean**: $\\|\\nabla^j \\mu_\\rho\\| \\leq C_\\mu(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $d_i$ via Leibniz rule)\n4635: 3. **Localized variance**: $\\|\\nabla^j \\sigma_\\rho^2\\| \\leq C_{\\sigma^2}(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\mu_\\rho$ and $d_i$)\n4636: 4. **Regularized std dev**: $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma'}(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\sigma_\\rho^2$)\n4637: 5. **Z-score**: $\\|\\nabla^j Z_\\rho\\| \\leq C_Z(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (quotient of functions with Œµ_d dependence)\n4638: 6. **Fitness potential**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_V \\max(\\rho^{-m}, \\varepsilon_d^{1-m})$ (composition with $g_A$)\n4639: \n4640: For typical parameters $\\varepsilon_d \\ll \\rho \\sim \\varepsilon_c$, the $\\varepsilon_d^{1-m}$ term dominates for $m \\geq 2$.\n4641: \n4642: The Bell polynomial $B_{m,k}$ satisfies:\n4643: \n4644: $$\n4645: \\|B_{m,k}\\| \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m \\|\\nabla^j Z_\\rho\\|^{n_j} \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m (C_{Z,j} \\rho^{-j})^{n_j}\n4646: \n4647: $$\n4648: \n4649: The sum over partitions of $m$ into $k$ parts gives combinatorial factors of at most $m!$.\n4650: \n4651: **Step 4: Factorial accounting.**\n4652: \n4653: Combining all factors:\n4654: \n4655: $$\n4656: \\begin{aligned}\n4657: \\|\\nabla^m V_{\\text{fit}}\\|\n4658: &\\leq \\sum_{k=1}^m L_{g,k} \\cdot \\|B_{m,k}\\| \\\\\n4659: &\\leq \\sum_{k=1}^m \\mathcal{O}(k!) \\cdot \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\text{(other factors)}) \\\\\n4660: &= \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)} \\cdot L_{g,m})\n4661: \\end{aligned}\n4662: \n4663: $$\n4664: \n4665: The key observation is that summing $k!$ over $k=1$ to $m$ gives $\\mathcal{O}(m!)$ (dominated by the largest term), preserving **single-factorial growth**.\n4666: \n4667: **Step 5: k-uniformity and N-uniformity.**\n4668: \n4669: All constants in the bound trace back to:\n4670: - Localization weights: k-uniform via telescoping\n4671: - Localized moments: k-uniform via exponential localization\n4672: - Regularized std dev: deterministic function of variance\n4673: - Z-score: quotient of k-uniform functions\n4674: - Rescale function: independent of swarm configuration\n4675: \n4676: Therefore $C_{V,m}(\\rho)$ is **independent of $k$ and $N$**.",
      "metadata": {},
      "section": "## 12. Fitness Potential: Composition with Rescale Function",
      "raw_directive": "4600: :::\n4601: \n4602: :::{prf:proof}\n4603: **Step 1: Composition structure.**\n4604: \n4605: The fitness potential is the composition:\n4606: \n4607: $$\n4608: V_{\\text{fit}} = g_A \\circ Z_\\rho \\circ (\\mu_\\rho, \\sigma'_\\rho, d_i)\n4609: \n4610: $$\n4611: \n4612: where each component is C^‚àû by previous lemmas.\n4613: \n4614: **Step 2: Fa√† di Bruno formula for composition.**\n4615: \n4616: For $m \\geq 1$, the $m$-th derivative of $g_A(Z_\\rho^{(i)})$ is:\n4617: \n4618: $$\n4619: \\nabla^m V_{\\text{fit}} = \\sum_{k=1}^m g_A^{(k)}(Z_\\rho^{(i)}) \\cdot B_{m,k}(\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\ldots, \\nabla^m Z_\\rho)\n4620: \n4621: $$\n4622: \n4623: where $B_{m,k}$ are the **Bell polynomials** encoding the combinatorics of the chain rule.\n4624: \n4625: **Step 3: Bounding each term with Œµ_d propagation.**\n4626: \n4627: For the $k$-th term:\n4628: - $|g_A^{(k)}(Z_\\rho)| \\leq L_{g,k} = \\mathcal{O}(k!)$ (bounded derivatives of $g_A$)\n4629: - $B_{m,k}$ involves products of $\\nabla^j Z_\\rho$ with $j \\leq m$\n4630: - $\\|\\nabla^j Z_\\rho\\| \\leq C_{Z,j}(\\rho, \\varepsilon_d) \\cdot \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ where $C_{Z,j} = \\mathcal{O}(j! \\cdot \\rho^{2dj} \\cdot \\eta_{\\min}^{-(2j+1)})$\n4631: \n4632: **Œµ_d dependency chain**:\n4633: 1. **Companion measurements**: $\\|\\nabla^j d_i\\| \\leq C_d \\varepsilon_d^{1-j}$\n4634: 2. **Localized mean**: $\\|\\nabla^j \\mu_\\rho\\| \\leq C_\\mu(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $d_i$ via Leibniz rule)\n4635: 3. **Localized variance**: $\\|\\nabla^j \\sigma_\\rho^2\\| \\leq C_{\\sigma^2}(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\mu_\\rho$ and $d_i$)\n4636: 4. **Regularized std dev**: $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma'}(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\sigma_\\rho^2$)\n4637: 5. **Z-score**: $\\|\\nabla^j Z_\\rho\\| \\leq C_Z(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (quotient of functions with Œµ_d dependence)\n4638: 6. **Fitness potential**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_V \\max(\\rho^{-m}, \\varepsilon_d^{1-m})$ (composition with $g_A$)\n4639: \n4640: For typical parameters $\\varepsilon_d \\ll \\rho \\sim \\varepsilon_c$, the $\\varepsilon_d^{1-m}$ term dominates for $m \\geq 2$.\n4641: \n4642: The Bell polynomial $B_{m,k}$ satisfies:\n4643: \n4644: $$\n4645: \\|B_{m,k}\\| \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m \\|\\nabla^j Z_\\rho\\|^{n_j} \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m (C_{Z,j} \\rho^{-j})^{n_j}\n4646: \n4647: $$\n4648: \n4649: The sum over partitions of $m$ into $k$ parts gives combinatorial factors of at most $m!$.\n4650: \n4651: **Step 4: Factorial accounting.**\n4652: \n4653: Combining all factors:\n4654: \n4655: $$\n4656: \\begin{aligned}\n4657: \\|\\nabla^m V_{\\text{fit}}\\|\n4658: &\\leq \\sum_{k=1}^m L_{g,k} \\cdot \\|B_{m,k}\\| \\\\\n4659: &\\leq \\sum_{k=1}^m \\mathcal{O}(k!) \\cdot \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\text{(other factors)}) \\\\\n4660: &= \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)} \\cdot L_{g,m})\n4661: \\end{aligned}\n4662: \n4663: $$\n4664: \n4665: The key observation is that summing $k!$ over $k=1$ to $m$ gives $\\mathcal{O}(m!)$ (dominated by the largest term), preserving **single-factorial growth**.\n4666: \n4667: **Step 5: k-uniformity and N-uniformity.**\n4668: \n4669: All constants in the bound trace back to:\n4670: - Localization weights: k-uniform via telescoping\n4671: - Localized moments: k-uniform via exponential localization\n4672: - Regularized std dev: deterministic function of variance\n4673: - Z-score: quotient of k-uniform functions\n4674: - Rescale function: independent of swarm configuration\n4675: \n4676: Therefore $C_{V,m}(\\rho)$ is **independent of $k$ and $N$**.\n4677: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 21,
        "chapter_file": "chapter_21.json",
        "section_id": "## 12. Fitness Potential: Composition with Rescale Function"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-173",
      "title": null,
      "start_line": 4694,
      "end_line": 4696,
      "header_lines": [],
      "content_start": 4695,
      "content_end": 4695,
      "content": "4695: ",
      "metadata": {},
      "section": "## 12. Fitness Potential: Composition with Rescale Function",
      "raw_directive": "4694: :::\n4695: \n4696: :::{prf:proof}",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 21,
        "chapter_file": "chapter_21.json",
        "section_id": "## 12. Fitness Potential: Composition with Rescale Function"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-72",
      "title": null,
      "start_line": 4851,
      "end_line": 4882,
      "header_lines": [],
      "content_start": 4852,
      "content_end": 4881,
      "content": "4852: \n4853: :::{prf:proof}\n4854: **Summary of proof architecture**:\n4855: \n4856: 1. **Part I (¬ß2-4)**: Smooth clustering framework\n4857:    - Partition of unity construction ({prf:ref}`const-mollified-partition-full`)\n4858:    - Exponential locality ({prf:ref}`lem-softmax-tail-corrected-full`)\n4859:    - Effective interactions ({prf:ref}`lem-effective-companion-count-corrected-full`)\n4860:    - Derivative bounds for $d_{\\text{alg}}$ ({prf:ref}`lem-dalg-derivative-bounds-full`)\n4861: \n4862: 2. **Part II (¬ß5-6)**: Localization weights\n4863:    - Gaussian kernel derivatives ({prf:ref}`lem-gaussian-kernel-derivatives-full`)\n4864:    - Quotient rule for weights ({prf:ref}`lem-localization-weight-derivatives-full`)\n4865:    - Telescoping identity ({prf:ref}`lem-telescoping-localization-weights-full`)\n4866:    - Companion coupling analysis ({prf:ref}`lem-derivatives-companion-distance-full`)\n4867: \n4868: 3. **Part III (¬ß7-8)**: Localized moments\n4869:    - Localized mean inductive bounds ({prf:ref}`lem-mth-derivative-localized-mean-full`)\n4870:    - Localized variance inductive bounds ({prf:ref}`thm-mth-derivative-localized-variance-full`)\n4871:    - k-uniformity via telescoping and exponential localization\n4872: \n4873: 4. **Part IV (¬ß9-10)**: Regularization and Z-score\n4874:    - Regularized std dev with positive lower bound ({prf:ref}`lem-properties-regularized-std-dev-full`)\n4875:    - Z-score quotient rule ({prf:ref}`thm-cinf-regularity-zscore-full`)\n4876:    - Uniform bounds from non-vanishing denominator\n4877: \n4878: 5. **Part V (¬ß11-12)**: Final composition\n4879:    - Chain rule with Fa√† di Bruno formula ({prf:ref}`thm-main-cinf-regularity-fitness-potential-full`)\n4880:    - Gevrey-1 classification ({prf:ref}`cor-gevrey-1-fitness-potential-full`)\n4881:    - N-uniform and k-uniform bounds established",
      "metadata": {},
      "section": "## 13. Main Theorem: Complete Statement",
      "raw_directive": "4851: :::\n4852: \n4853: :::{prf:proof}\n4854: **Summary of proof architecture**:\n4855: \n4856: 1. **Part I (¬ß2-4)**: Smooth clustering framework\n4857:    - Partition of unity construction ({prf:ref}`const-mollified-partition-full`)\n4858:    - Exponential locality ({prf:ref}`lem-softmax-tail-corrected-full`)\n4859:    - Effective interactions ({prf:ref}`lem-effective-companion-count-corrected-full`)\n4860:    - Derivative bounds for $d_{\\text{alg}}$ ({prf:ref}`lem-dalg-derivative-bounds-full`)\n4861: \n4862: 2. **Part II (¬ß5-6)**: Localization weights\n4863:    - Gaussian kernel derivatives ({prf:ref}`lem-gaussian-kernel-derivatives-full`)\n4864:    - Quotient rule for weights ({prf:ref}`lem-localization-weight-derivatives-full`)\n4865:    - Telescoping identity ({prf:ref}`lem-telescoping-localization-weights-full`)\n4866:    - Companion coupling analysis ({prf:ref}`lem-derivatives-companion-distance-full`)\n4867: \n4868: 3. **Part III (¬ß7-8)**: Localized moments\n4869:    - Localized mean inductive bounds ({prf:ref}`lem-mth-derivative-localized-mean-full`)\n4870:    - Localized variance inductive bounds ({prf:ref}`thm-mth-derivative-localized-variance-full`)\n4871:    - k-uniformity via telescoping and exponential localization\n4872: \n4873: 4. **Part IV (¬ß9-10)**: Regularization and Z-score\n4874:    - Regularized std dev with positive lower bound ({prf:ref}`lem-properties-regularized-std-dev-full`)\n4875:    - Z-score quotient rule ({prf:ref}`thm-cinf-regularity-zscore-full`)\n4876:    - Uniform bounds from non-vanishing denominator\n4877: \n4878: 5. **Part V (¬ß11-12)**: Final composition\n4879:    - Chain rule with Fa√† di Bruno formula ({prf:ref}`thm-main-cinf-regularity-fitness-potential-full`)\n4880:    - Gevrey-1 classification ({prf:ref}`cor-gevrey-1-fitness-potential-full`)\n4881:    - N-uniform and k-uniform bounds established\n4882: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 22,
        "chapter_file": "chapter_22.json",
        "section_id": "## 13. Main Theorem: Complete Statement"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-18",
      "title": null,
      "start_line": 4907,
      "end_line": 4946,
      "header_lines": [],
      "content_start": 4908,
      "content_end": 4945,
      "content": "4908: \n4909: :::{prf:proof}\n4910: **Step 1: Kinetic operator hypoellipticity.**\n4911: \n4912: The underdamped Langevin operator:\n4913: \n4914: $$\n4915: \\mathcal{L}_{\\text{kin}} = \\sum_{i=1}^k \\left[v_i \\cdot \\nabla_{x_i} - \\nabla_{x_i} U(x_i) \\cdot \\nabla_{v_i} - \\gamma v_i \\cdot \\nabla_{v_i} + \\frac{\\sigma^2}{2} \\Delta_{v_i}\\right]\n4916: \n4917: $$\n4918: \n4919: satisfies **H√∂rmander's condition**: the Lie algebra generated by the drift and diffusion vector fields spans the tangent space $T(\\mathcal{X}^k \\times (\\mathbb{R}^d)^k)$ at each point.\n4920: \n4921: This is a standard result for underdamped Langevin dynamics (see H√©rau & Nier, 2004).\n4922: \n4923: **Step 2: Adaptive force as C^‚àû perturbation.**\n4924: \n4925: The adaptive force term:\n4926: \n4927: $$\n4928: \\mathcal{L}_{\\text{adapt}} = -\\varepsilon_F \\sum_{i=1}^k \\nabla_{x_i} V_{\\text{fit}}(x_i, v_i) \\cdot \\nabla_{v_i}\n4929: \n4930: $$\n4931: \n4932: is a **C^‚àû vector field** by {prf:ref}`thm-main-complete-cinf-geometric-gas-full`.\n4933: \n4934: **Step 3: Perturbation theory for hypoelliptic operators.**\n4935: \n4936: By the theory of H√∂rmander (1967): a **C^‚àû perturbation** of a hypoelliptic operator **preserves hypoellipticity**.\n4937: \n4938: Since $\\mathcal{L}_{\\text{kin}}$ is hypoelliptic and $\\mathcal{L}_{\\text{adapt}}$ is a C^‚àû perturbation:\n4939: \n4940: $$\n4941: \\mathcal{L}_{\\text{geo}} = \\mathcal{L}_{\\text{kin}} + \\mathcal{L}_{\\text{adapt}}\n4942: \n4943: $$\n4944: \n4945: is hypoelliptic.",
      "metadata": {},
      "section": "## 14. Hypoellipticity of the Geometric Gas Generator",
      "raw_directive": "4907: :::\n4908: \n4909: :::{prf:proof}\n4910: **Step 1: Kinetic operator hypoellipticity.**\n4911: \n4912: The underdamped Langevin operator:\n4913: \n4914: $$\n4915: \\mathcal{L}_{\\text{kin}} = \\sum_{i=1}^k \\left[v_i \\cdot \\nabla_{x_i} - \\nabla_{x_i} U(x_i) \\cdot \\nabla_{v_i} - \\gamma v_i \\cdot \\nabla_{v_i} + \\frac{\\sigma^2}{2} \\Delta_{v_i}\\right]\n4916: \n4917: $$\n4918: \n4919: satisfies **H√∂rmander's condition**: the Lie algebra generated by the drift and diffusion vector fields spans the tangent space $T(\\mathcal{X}^k \\times (\\mathbb{R}^d)^k)$ at each point.\n4920: \n4921: This is a standard result for underdamped Langevin dynamics (see H√©rau & Nier, 2004).\n4922: \n4923: **Step 2: Adaptive force as C^‚àû perturbation.**\n4924: \n4925: The adaptive force term:\n4926: \n4927: $$\n4928: \\mathcal{L}_{\\text{adapt}} = -\\varepsilon_F \\sum_{i=1}^k \\nabla_{x_i} V_{\\text{fit}}(x_i, v_i) \\cdot \\nabla_{v_i}\n4929: \n4930: $$\n4931: \n4932: is a **C^‚àû vector field** by {prf:ref}`thm-main-complete-cinf-geometric-gas-full`.\n4933: \n4934: **Step 3: Perturbation theory for hypoelliptic operators.**\n4935: \n4936: By the theory of H√∂rmander (1967): a **C^‚àû perturbation** of a hypoelliptic operator **preserves hypoellipticity**.\n4937: \n4938: Since $\\mathcal{L}_{\\text{kin}}$ is hypoelliptic and $\\mathcal{L}_{\\text{adapt}}$ is a C^‚àû perturbation:\n4939: \n4940: $$\n4941: \\mathcal{L}_{\\text{geo}} = \\mathcal{L}_{\\text{kin}} + \\mathcal{L}_{\\text{adapt}}\n4942: \n4943: $$\n4944: \n4945: is hypoelliptic.\n4946: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 24,
        "chapter_file": "chapter_24.json",
        "section_id": "## 14. Hypoellipticity of the Geometric Gas Generator"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-86",
      "title": null,
      "start_line": 5037,
      "end_line": 5039,
      "header_lines": [],
      "content_start": 5038,
      "content_end": 5038,
      "content": "5038: ",
      "metadata": {},
      "section": "## 15. Logarithmic Sobolev Inequality",
      "raw_directive": "5037: :::\n5038: \n5039: :::{prf:proof}",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 25,
        "chapter_file": "chapter_25.json",
        "section_id": "## 15. Logarithmic Sobolev Inequality"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-102",
      "title": null,
      "start_line": 5320,
      "end_line": 5322,
      "header_lines": [],
      "content_start": 5321,
      "content_end": 5321,
      "content": "5321: ",
      "metadata": {},
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5320: :::\n5321: \n5322: :::{prf:proof}",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-123",
      "title": null,
      "start_line": 5341,
      "end_line": 5450,
      "header_lines": [],
      "content_start": 5342,
      "content_end": 5449,
      "content": "5342: \n5343: :::{prf:proof}\n5344: **Step 1: Derivatives of the outer function $f(s) = \\sqrt{s}$.**\n5345: \n5346: For $s \\geq c^2 > 0$, the $n$-th derivative of $f(s) = s^{1/2}$ is:\n5347: \n5348: $$\n5349: f^{(n)}(s) = \\frac{d^n}{ds^n} s^{1/2} = \\frac{(-1)^{n-1} \\cdot (2n-3)!!}{2^n} \\cdot s^{1/2 - n}\n5350: \n5351: $$\n5352: \n5353: where $(2n-3)!! = 1 \\cdot 3 \\cdot 5 \\cdots (2n-3)$ is the double factorial.\n5354: \n5355: **Key fact**: The double factorial satisfies:\n5356: \n5357: $$\n5358: (2n-3)!! = \\frac{(2n-2)!}{2^{n-1} (n-1)!} = \\mathcal{O}\\left(\\frac{n!}{2^{n-1}}\\right)\n5359: \n5360: $$\n5361: \n5362: Therefore:\n5363: \n5364: $$\n5365: |f^{(n)}(s)| \\leq \\frac{(2n-3)!!}{2^n \\cdot c^{n-1}} \\leq \\frac{C \\cdot n!}{2^{2n-1} \\cdot c^{n-1}} = \\mathcal{O}(n!) \\cdot c^{-(n-1)}\n5366: \n5367: $$\n5368: \n5369: **Step 2: Applying Fa√† di Bruno formula.**\n5370: \n5371: For $\\sigma'(V(x)) = f(V(x) + c^2)$, let $g(x) = V(x) + c^2$. Then:\n5372: \n5373: $$\n5374: \\nabla^m \\sigma'(V) = \\sum_{\\pi \\in \\mathcal{P}_m} f^{(|\\pi|)}(g) \\cdot B_\\pi(\\nabla g, \\nabla^2 g, \\ldots, \\nabla^m g)\n5375: \n5376: $$\n5377: \n5378: **Step 3: Bounding each partition contribution.**\n5379: \n5380: For partition $\\pi$ with $|\\pi| = \\ell$ blocks, the Bell polynomial $B_\\pi$ is a product:\n5381: \n5382: $$\n5383: B_\\pi = \\prod_{B \\in \\pi} \\nabla^{|B|} g\n5384: \n5385: $$\n5386: \n5387: where $B$ ranges over blocks of $\\pi$ and $\\sum_{B \\in \\pi} |B| = m$.\n5388: \n5389: Using $\\|\\nabla^k g\\| = \\|\\nabla^k V\\| \\leq M_k$:\n5390: \n5391: $$\n5392: \\|B_\\pi\\| \\leq \\prod_{B \\in \\pi} M_{|B|}\n5393: \n5394: $$\n5395: \n5396: **Step 4: Counting partitions and summing.**\n5397: \n5398: For fixed $\\ell$, the number of partitions of $m$ elements into $\\ell$ non-empty blocks is the **Stirling number of the second kind** $S(m, \\ell)$, which satisfies:\n5399: \n5400: $$\n5401: S(m, \\ell) \\leq \\frac{\\ell^m}{\\ell!}\n5402: \n5403: $$\n5404: \n5405: Combining:\n5406: \n5407: $$\n5408: \\begin{aligned}\n5409: \\|\\nabla^m \\sigma'\\| &\\leq \\sum_{\\ell=1}^m |f^{(\\ell)}(g)| \\cdot \\sum_{\\pi: |\\pi|=\\ell} \\|B_\\pi\\| \\\\\n5410: &\\leq \\sum_{\\ell=1}^m \\frac{C \\ell!}{c^{\\ell-1}} \\cdot S(m,\\ell) \\cdot (\\text{bound on } B_\\pi)\n5411: \\end{aligned}\n5412: \n5413: $$\n5414: \n5415: **Step 5: Worst-case scenario - all derivatives contribute.**\n5416: \n5417: The dominant contribution comes from $\\ell = 1$ (single block, using $\\nabla^m V$ directly):\n5418: \n5419: $$\n5420: \\|\\nabla^m \\sigma'\\| \\geq |f^{(1)}(g)| \\cdot \\|\\nabla^m V\\| \\sim \\frac{1}{c} M_m\n5421: \n5422: $$\n5423: \n5424: But the total sum over all partitions gives:\n5425: \n5426: $$\n5427: \\|\\nabla^m \\sigma'\\| \\leq C \\sum_{\\ell=1}^m \\ell! \\cdot c^{-(\\ell-1)} \\cdot \\frac{\\ell^m}{\\ell!} \\cdot \\prod_k M_k^{(\\text{multiplicity})}\n5428: \n5429: $$\n5430: \n5431: **Step 6: Factorial bound emerges.**\n5432: \n5433: The key observation is that the Stirling numbers and factorial from $f^{(\\ell)}$ **combine multiplicatively**, not additively. The dominant term in the sum is $\\ell = m$ (each derivative appears once):\n5434: \n5435: $$\n5436: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot c^{-(m-1)} \\cdot \\prod_{k=1}^m M_k^{(a_k)}\n5437: \n5438: $$\n5439: \n5440: where $\\sum k \\cdot a_k = m$ (partition constraint) and $\\sum a_k = m$ (Bell polynomial structure).\n5441: \n5442: For $M_k = \\mathcal{O}(k!)$ (Gevrey-1 input), this gives:\n5443: \n5444: $$\n5445: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot (\\text{poly}(m)) = \\mathcal{O}(m!)\n5446: \n5447: $$\n5448: \n5449: where the polynomial factor comes from combining products of factorial-growth inputs.",
      "metadata": {},
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5341: :::\n5342: \n5343: :::{prf:proof}\n5344: **Step 1: Derivatives of the outer function $f(s) = \\sqrt{s}$.**\n5345: \n5346: For $s \\geq c^2 > 0$, the $n$-th derivative of $f(s) = s^{1/2}$ is:\n5347: \n5348: $$\n5349: f^{(n)}(s) = \\frac{d^n}{ds^n} s^{1/2} = \\frac{(-1)^{n-1} \\cdot (2n-3)!!}{2^n} \\cdot s^{1/2 - n}\n5350: \n5351: $$\n5352: \n5353: where $(2n-3)!! = 1 \\cdot 3 \\cdot 5 \\cdots (2n-3)$ is the double factorial.\n5354: \n5355: **Key fact**: The double factorial satisfies:\n5356: \n5357: $$\n5358: (2n-3)!! = \\frac{(2n-2)!}{2^{n-1} (n-1)!} = \\mathcal{O}\\left(\\frac{n!}{2^{n-1}}\\right)\n5359: \n5360: $$\n5361: \n5362: Therefore:\n5363: \n5364: $$\n5365: |f^{(n)}(s)| \\leq \\frac{(2n-3)!!}{2^n \\cdot c^{n-1}} \\leq \\frac{C \\cdot n!}{2^{2n-1} \\cdot c^{n-1}} = \\mathcal{O}(n!) \\cdot c^{-(n-1)}\n5366: \n5367: $$\n5368: \n5369: **Step 2: Applying Fa√† di Bruno formula.**\n5370: \n5371: For $\\sigma'(V(x)) = f(V(x) + c^2)$, let $g(x) = V(x) + c^2$. Then:\n5372: \n5373: $$\n5374: \\nabla^m \\sigma'(V) = \\sum_{\\pi \\in \\mathcal{P}_m} f^{(|\\pi|)}(g) \\cdot B_\\pi(\\nabla g, \\nabla^2 g, \\ldots, \\nabla^m g)\n5375: \n5376: $$\n5377: \n5378: **Step 3: Bounding each partition contribution.**\n5379: \n5380: For partition $\\pi$ with $|\\pi| = \\ell$ blocks, the Bell polynomial $B_\\pi$ is a product:\n5381: \n5382: $$\n5383: B_\\pi = \\prod_{B \\in \\pi} \\nabla^{|B|} g\n5384: \n5385: $$\n5386: \n5387: where $B$ ranges over blocks of $\\pi$ and $\\sum_{B \\in \\pi} |B| = m$.\n5388: \n5389: Using $\\|\\nabla^k g\\| = \\|\\nabla^k V\\| \\leq M_k$:\n5390: \n5391: $$\n5392: \\|B_\\pi\\| \\leq \\prod_{B \\in \\pi} M_{|B|}\n5393: \n5394: $$\n5395: \n5396: **Step 4: Counting partitions and summing.**\n5397: \n5398: For fixed $\\ell$, the number of partitions of $m$ elements into $\\ell$ non-empty blocks is the **Stirling number of the second kind** $S(m, \\ell)$, which satisfies:\n5399: \n5400: $$\n5401: S(m, \\ell) \\leq \\frac{\\ell^m}{\\ell!}\n5402: \n5403: $$\n5404: \n5405: Combining:\n5406: \n5407: $$\n5408: \\begin{aligned}\n5409: \\|\\nabla^m \\sigma'\\| &\\leq \\sum_{\\ell=1}^m |f^{(\\ell)}(g)| \\cdot \\sum_{\\pi: |\\pi|=\\ell} \\|B_\\pi\\| \\\\\n5410: &\\leq \\sum_{\\ell=1}^m \\frac{C \\ell!}{c^{\\ell-1}} \\cdot S(m,\\ell) \\cdot (\\text{bound on } B_\\pi)\n5411: \\end{aligned}\n5412: \n5413: $$\n5414: \n5415: **Step 5: Worst-case scenario - all derivatives contribute.**\n5416: \n5417: The dominant contribution comes from $\\ell = 1$ (single block, using $\\nabla^m V$ directly):\n5418: \n5419: $$\n5420: \\|\\nabla^m \\sigma'\\| \\geq |f^{(1)}(g)| \\cdot \\|\\nabla^m V\\| \\sim \\frac{1}{c} M_m\n5421: \n5422: $$\n5423: \n5424: But the total sum over all partitions gives:\n5425: \n5426: $$\n5427: \\|\\nabla^m \\sigma'\\| \\leq C \\sum_{\\ell=1}^m \\ell! \\cdot c^{-(\\ell-1)} \\cdot \\frac{\\ell^m}{\\ell!} \\cdot \\prod_k M_k^{(\\text{multiplicity})}\n5428: \n5429: $$\n5430: \n5431: **Step 6: Factorial bound emerges.**\n5432: \n5433: The key observation is that the Stirling numbers and factorial from $f^{(\\ell)}$ **combine multiplicatively**, not additively. The dominant term in the sum is $\\ell = m$ (each derivative appears once):\n5434: \n5435: $$\n5436: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot c^{-(m-1)} \\cdot \\prod_{k=1}^m M_k^{(a_k)}\n5437: \n5438: $$\n5439: \n5440: where $\\sum k \\cdot a_k = m$ (partition constraint) and $\\sum a_k = m$ (Bell polynomial structure).\n5441: \n5442: For $M_k = \\mathcal{O}(k!)$ (Gevrey-1 input), this gives:\n5443: \n5444: $$\n5445: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot (\\text{poly}(m)) = \\mathcal{O}(m!)\n5446: \n5447: $$\n5448: \n5449: where the polynomial factor comes from combining products of factorial-growth inputs.\n5450: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-256",
      "title": null,
      "start_line": 5474,
      "end_line": 5476,
      "header_lines": [],
      "content_start": 5475,
      "content_end": 5475,
      "content": "5475: ",
      "metadata": {},
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5474: :::\n5475: \n5476: :::{prf:proof}",
      "_registry_context": {
        "stage": "directives",
        "document_id": "20_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    }
  ]
}