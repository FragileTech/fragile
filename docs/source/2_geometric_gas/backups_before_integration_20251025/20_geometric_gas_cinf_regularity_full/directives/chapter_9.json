{
  "chapter_index": 9,
  "section_id": "## 5.6 Diversity Pairing Mechanism Analysis",
  "directive_count": 6,
  "hints": [
    {
      "directive_type": "definition",
      "label": "def-diversity-pairing-cinf",
      "title": "Sequential Stochastic Greedy Pairing (From 03_cloning.md)",
      "start_line": 2183,
      "end_line": 2200,
      "header_lines": [
        2184
      ],
      "content_start": 2186,
      "content_end": 2199,
      "content": "2186: :label: def-diversity-pairing-cinf\n2187: \n2188: From Definition 5.1.2 in `docs/source/1_euclidean_gas/03_cloning.md`:\n2189: \n2190: **Inputs**: Alive walkers $\\mathcal{A}_t = \\{w_1, \\ldots, w_k\\}$, interaction range $\\varepsilon_d > 0$\n2191: \n2192: **Operation** (Algorithm 5.1):\n2193: 1. Initialize unpaired set $U \\leftarrow \\mathcal{A}_t$, empty companion map $c$\n2194: 2. While $|U| > 1$:\n2195:    - Select walker $i$ from $U$, remove from $U$\n2196:    - For each $j \\in U$, compute weight: $w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\varepsilon_d^2}\\right)$\n2197:    - Sample companion $c_i$ from softmax distribution: $P(j) = w_{ij} / \\sum_{\\ell \\in U} w_{i\\ell}$\n2198:    - Remove $c_i$ from $U$\n2199:    - Set bidirectional pairing: $c(i) \\leftarrow c_i$ and $c(c_i) \\leftarrow i$",
      "metadata": {
        "label": "def-diversity-pairing-cinf"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [],
      "raw_directive": "2183: ### 5.6.1 Diversity Pairing Definition\n2184: \n2185: :::{prf:definition} Sequential Stochastic Greedy Pairing (From 03_cloning.md)\n2186: :label: def-diversity-pairing-cinf\n2187: \n2188: From Definition 5.1.2 in `docs/source/1_euclidean_gas/03_cloning.md`:\n2189: \n2190: **Inputs**: Alive walkers $\\mathcal{A}_t = \\{w_1, \\ldots, w_k\\}$, interaction range $\\varepsilon_d > 0$\n2191: \n2192: **Operation** (Algorithm 5.1):\n2193: 1. Initialize unpaired set $U \\leftarrow \\mathcal{A}_t$, empty companion map $c$\n2194: 2. While $|U| > 1$:\n2195:    - Select walker $i$ from $U$, remove from $U$\n2196:    - For each $j \\in U$, compute weight: $w_{ij} := \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\varepsilon_d^2}\\right)$\n2197:    - Sample companion $c_i$ from softmax distribution: $P(j) = w_{ij} / \\sum_{\\ell \\in U} w_{i\\ell}$\n2198:    - Remove $c_i$ from $U$\n2199:    - Set bidirectional pairing: $c(i) \\leftarrow c_i$ and $c(c_i) \\leftarrow i$\n2200: "
    },
    {
      "directive_type": "definition",
      "label": "def-idealized-pairing-cinf",
      "title": "Idealized Spatially-Aware Pairing (From 03_cloning.md)",
      "start_line": 2202,
      "end_line": 2222,
      "header_lines": [
        2203
      ],
      "content_start": 2205,
      "content_end": 2221,
      "content": "2205: :label: def-idealized-pairing-cinf\n2206: \n2207: From Definition 5.1.1 in `03_cloning.md`:\n2208: \n2209: The idealized model assigns probability to each perfect matching $M \\in \\mathcal{M}_k$ via:\n2210: \n2211: $$\n2212: P_{\\text{ideal}}(M | S) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2213: \n2214: $$\n2215: \n2216: where the matching quality is:\n2217: \n2218: $$\n2219: W(M) := \\prod_{(i,j) \\in M} \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\varepsilon_d^2}\\right)\n2220: \n2221: $$",
      "metadata": {
        "label": "def-idealized-pairing-cinf"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [],
      "raw_directive": "2202: :::\n2203: \n2204: :::{prf:definition} Idealized Spatially-Aware Pairing (From 03_cloning.md)\n2205: :label: def-idealized-pairing-cinf\n2206: \n2207: From Definition 5.1.1 in `03_cloning.md`:\n2208: \n2209: The idealized model assigns probability to each perfect matching $M \\in \\mathcal{M}_k$ via:\n2210: \n2211: $$\n2212: P_{\\text{ideal}}(M | S) = \\frac{W(M)}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2213: \n2214: $$\n2215: \n2216: where the matching quality is:\n2217: \n2218: $$\n2219: W(M) := \\prod_{(i,j) \\in M} \\exp\\left(-\\frac{d_{\\text{alg}}(i, j)^2}{2\\varepsilon_d^2}\\right)\n2220: \n2221: $$\n2222: "
    },
    {
      "directive_type": "theorem",
      "label": "thm-diversity-pairing-measurement-regularity",
      "title": "C^\u221e Regularity with K-Uniform Bounds (Diversity Pairing)",
      "start_line": 2246,
      "end_line": 2257,
      "header_lines": [
        2247
      ],
      "content_start": 2249,
      "content_end": 2256,
      "content": "2249: :label: thm-diversity-pairing-measurement-regularity\n2250: \n2251: Using the diversity pairing mechanism (either idealized or sequential greedy), the expected measurement satisfies:\n2252: \n2253: $$\n2254: \\|\\nabla^m \\bar{d}_i\\|_{\\infty} \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2255: \n2256: $$",
      "metadata": {
        "label": "thm-diversity-pairing-measurement-regularity"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [],
      "raw_directive": "2246: ### 5.6.3 C^\u221e Regularity of Diversity Pairing Measurements\n2247: \n2248: :::{prf:theorem} C^\u221e Regularity with K-Uniform Bounds (Diversity Pairing)\n2249: :label: thm-diversity-pairing-measurement-regularity\n2250: \n2251: Using the diversity pairing mechanism (either idealized or sequential greedy), the expected measurement satisfies:\n2252: \n2253: $$\n2254: \\|\\nabla^m \\bar{d}_i\\|_{\\infty} \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2255: \n2256: $$\n2257: "
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-97",
      "title": null,
      "start_line": 2259,
      "end_line": 2436,
      "header_lines": [],
      "content_start": 2260,
      "content_end": 2435,
      "content": "2260: \n2261: :::{prf:proof}\n2262: **Step 1: Expected measurement structure**\n2263: \n2264: $$\n2265: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2266: \n2267: $$\n2268: \n2269: where:\n2270: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2271: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2272: \n2273: **Step 2: Exponential concentration of matching weights**\n2274: \n2275: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2276: \n2277: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2278: \n2279: $$\n2280: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2281: \n2282: $$\n2283: \n2284: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2285: \n2286: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2287: \n2288: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2289: \n2290: $$\n2291: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2292: \n2293: $$\n2294: \n2295: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2296: \n2297: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2298: \n2299: $$\n2300: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2301: \n2302: $$\n2303: \n2304: Then the expected measurement becomes:\n2305: \n2306: $$\n2307: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2308: \n2309: $$\n2310: \n2311: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2312: \n2313: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2314: \n2315: $$\n2316: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2317: \n2318: $$\n2319: \n2320: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2321: \n2322: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^\u221e regularity with k-uniform bounds **without** assuming this approximation.\n2323: \n2324: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2325: \n2326: $$\n2327: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2328: $$\n2329: \n2330: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2331: \n2332: **Consequence**: The marginal probability has simplified derivative structure:\n2333: \n2334: $$\n2335: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2336: $$\n2337: \n2338: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2339: \n2340: **Result**: The expected measurement has analytical structure\n2341: \n2342: $$\n2343: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2344: $$\n2345: \n2346: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2347: \n2348: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2349: \n2350: **Step 4: Derivative analysis via locality**\n2351: \n2352: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2353: \n2354: $$\n2355: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2356: $$\n2357: \n2358: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2359: \n2360: $$\n2361: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2362: $$\n2363: \n2364: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2365: 1. **Bounded**: By exponential weights, all ratios \u2264 exp(const \u00b7 (R_eff)\u00b2/\u03b5_d\u00b2) < \u221e\n2366: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(\u03c1_max \u03b5_d^{2d}), independent of k\n2367: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2368: \n2369: The derivatives follow from standard quotient rule + Fa\u00e0 di Bruno:\n2370: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2371: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2372: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2373: \n2374: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2375: \n2376: $$\n2377: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2378: \n2379: $$\n2380: \n2381: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2382: \n2383: **Step 5: Derivative bound via quotient rule**\n2384: \n2385: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2386: \n2387: $$\n2388: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2389: \n2390: $$\n2391: \n2392: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2393: \n2394: $$\n2395: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2396: \n2397: $$\n2398: \n2399: By the product rule and Fa\u00e0 di Bruno formula:\n2400: \n2401: $$\n2402: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2403: \n2404: $$\n2405: \n2406: **Bounds on each term**:\n2407: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2408: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2409: \n2410: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2411: \n2412: $$\n2413: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2414: \n2415: $$\n2416: \n2417: which is **k-uniform** (independent of total swarm size).\n2418: \n2419: **Step 6: Assemble the Gevrey-1 bound**\n2420: \n2421: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2422: \n2423: $$\n2424: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2425: \n2426: $$\n2427: \n2428: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2429: \n2430: $$\n2431: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2432: \n2433: $$\n2434: \n2435: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.",
      "metadata": {},
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [
        "assump-uniform-density-full"
      ],
      "raw_directive": "2259: :::\n2260: \n2261: :::{prf:proof}\n2262: **Step 1: Expected measurement structure**\n2263: \n2264: $$\n2265: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2266: \n2267: $$\n2268: \n2269: where:\n2270: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2271: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2272: \n2273: **Step 2: Exponential concentration of matching weights**\n2274: \n2275: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2276: \n2277: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2278: \n2279: $$\n2280: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2281: \n2282: $$\n2283: \n2284: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2285: \n2286: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2287: \n2288: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2289: \n2290: $$\n2291: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2292: \n2293: $$\n2294: \n2295: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2296: \n2297: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2298: \n2299: $$\n2300: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2301: \n2302: $$\n2303: \n2304: Then the expected measurement becomes:\n2305: \n2306: $$\n2307: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2308: \n2309: $$\n2310: \n2311: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2312: \n2313: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2314: \n2315: $$\n2316: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2317: \n2318: $$\n2319: \n2320: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2321: \n2322: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^\u221e regularity with k-uniform bounds **without** assuming this approximation.\n2323: \n2324: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2325: \n2326: $$\n2327: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2328: $$\n2329: \n2330: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2331: \n2332: **Consequence**: The marginal probability has simplified derivative structure:\n2333: \n2334: $$\n2335: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2336: $$\n2337: \n2338: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2339: \n2340: **Result**: The expected measurement has analytical structure\n2341: \n2342: $$\n2343: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2344: $$\n2345: \n2346: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2347: \n2348: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2349: \n2350: **Step 4: Derivative analysis via locality**\n2351: \n2352: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2353: \n2354: $$\n2355: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2356: $$\n2357: \n2358: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2359: \n2360: $$\n2361: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2362: $$\n2363: \n2364: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2365: 1. **Bounded**: By exponential weights, all ratios \u2264 exp(const \u00b7 (R_eff)\u00b2/\u03b5_d\u00b2) < \u221e\n2366: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(\u03c1_max \u03b5_d^{2d}), independent of k\n2367: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2368: \n2369: The derivatives follow from standard quotient rule + Fa\u00e0 di Bruno:\n2370: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2371: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2372: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2373: \n2374: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2375: \n2376: $$\n2377: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2378: \n2379: $$\n2380: \n2381: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2382: \n2383: **Step 5: Derivative bound via quotient rule**\n2384: \n2385: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2386: \n2387: $$\n2388: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2389: \n2390: $$\n2391: \n2392: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2393: \n2394: $$\n2395: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2396: \n2397: $$\n2398: \n2399: By the product rule and Fa\u00e0 di Bruno formula:\n2400: \n2401: $$\n2402: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2403: \n2404: $$\n2405: \n2406: **Bounds on each term**:\n2407: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2408: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2409: \n2410: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2411: \n2412: $$\n2413: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2414: \n2415: $$\n2416: \n2417: which is **k-uniform** (independent of total swarm size).\n2418: \n2419: **Step 6: Assemble the Gevrey-1 bound**\n2420: \n2421: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2422: \n2423: $$\n2424: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2425: \n2426: $$\n2427: \n2428: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2429: \n2430: $$\n2431: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2432: \n2433: $$\n2434: \n2435: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.\n2436: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-greedy-ideal-equivalence",
      "title": "Statistical Equivalence Preserves C^\u221e Regularity",
      "start_line": 2471,
      "end_line": 2482,
      "header_lines": [
        2472
      ],
      "content_start": 2474,
      "content_end": 2481,
      "content": "2474: :label: lem-greedy-ideal-equivalence\n2475: \n2476: The Sequential Stochastic Greedy Pairing and the Idealized Spatially-Aware Pairing produce statistically equivalent measurements:\n2477: \n2478: $$\n2479: \\mathbb{E}_{\\text{greedy}}[d_i | S] = \\mathbb{E}_{\\text{ideal}}[d_i | S] + O(k^{-\\beta})\n2480: \n2481: $$",
      "metadata": {
        "label": "lem-greedy-ideal-equivalence"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [
        "thm-diversity-pairing-measurement-regularity"
      ],
      "raw_directive": "2471: ### 5.6.4 Transfer from Idealized to Greedy Pairing\n2472: \n2473: :::{prf:lemma} Statistical Equivalence Preserves C^\u221e Regularity\n2474: :label: lem-greedy-ideal-equivalence\n2475: \n2476: The Sequential Stochastic Greedy Pairing and the Idealized Spatially-Aware Pairing produce statistically equivalent measurements:\n2477: \n2478: $$\n2479: \\mathbb{E}_{\\text{greedy}}[d_i | S] = \\mathbb{E}_{\\text{ideal}}[d_i | S] + O(k^{-\\beta})\n2480: \n2481: $$\n2482: "
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-322",
      "title": null,
      "start_line": 2484,
      "end_line": 2499,
      "header_lines": [],
      "content_start": 2485,
      "content_end": 2498,
      "content": "2485: \n2486: :::{prf:proof}\n2487: **Proof Sketch**:\n2488: \n2489: **Step 1**: Lemma 5.1.2 from `03_cloning.md` proves the greedy algorithm detects the same geometric structure as the idealized model (\"signal preservation\").\n2490: \n2491: **Step 2**: Both mechanisms are based on:\n2492: - Same exponential weights: $\\exp(-d^2/(2\\varepsilon_d^2))$\n2493: - Same normalization (softmax structure)\n2494: - Difference is only in order of summation (sequential vs. global)\n2495: \n2496: **Step 3**: Derivatives of both expressions involve the same Fa\u00e0 di Bruno polynomials and quotient rules. The sequential vs. global structure doesn't affect the analytical form of derivatives, only the constants.\n2497: \n2498: **Step 4**: The $O(k^{-\\beta})$ difference is negligible for N-uniform bounds.",
      "metadata": {},
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "references": [],
      "raw_directive": "2484: :::\n2485: \n2486: :::{prf:proof}\n2487: **Proof Sketch**:\n2488: \n2489: **Step 1**: Lemma 5.1.2 from `03_cloning.md` proves the greedy algorithm detects the same geometric structure as the idealized model (\"signal preservation\").\n2490: \n2491: **Step 2**: Both mechanisms are based on:\n2492: - Same exponential weights: $\\exp(-d^2/(2\\varepsilon_d^2))$\n2493: - Same normalization (softmax structure)\n2494: - Difference is only in order of summation (sequential vs. global)\n2495: \n2496: **Step 3**: Derivatives of both expressions involve the same Fa\u00e0 di Bruno polynomials and quotient rules. The sequential vs. global structure doesn't affect the analytical form of derivatives, only the constants.\n2497: \n2498: **Step 4**: The $O(k^{-\\beta})$ difference is negligible for N-uniform bounds.\n2499: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}