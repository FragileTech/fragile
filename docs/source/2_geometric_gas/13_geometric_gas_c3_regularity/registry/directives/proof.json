{
  "document_id": "13_geometric_gas_c3_regularity",
  "stage": "directives",
  "directive_type": "proof",
  "generated_at": "2025-11-10T13:57:32.809138+00:00",
  "count": 16,
  "items": [
    {
      "directive_type": "proof",
      "label": "proof-lem-derivative-locality-c3",
      "title": null,
      "start_line": 501,
      "end_line": 608,
      "header_lines": [
        502
      ],
      "content_start": 504,
      "content_end": 607,
      "content": "504: :label: proof-lem-derivative-locality-c3\n505: \n506: **Step 1: Softmax probability derivative.**\n507: \n508: Let $P_{j\\ell} = \\mathbb{P}(c(j)=\\ell) = \\exp(-\\Phi_{j\\ell}) / Z_j$ where $\\Phi_{j\\ell} = d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)$ and $Z_j = \\sum_r \\exp(-\\Phi_{jr})$.\n509: \n510: Differentiating with respect to $x_i$:\n511: $$\n512: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}\\left[-\\partial_{x_i}\\Phi_{j\\ell} + \\sum_r P_{jr} \\partial_{x_i}\\Phi_{jr}\\right]\n513: $$\n514: \n515: **Locality of $\\Phi_{j\\ell}$**: Since $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, we have:\n516: $$\n517: \\partial_{x_i}\\Phi_{j\\ell} = \\delta_{\\ell i} \\partial_{x_i}\\Phi_{ji}\n518: $$\n519: \n520: Therefore:\n521: $$\n522: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}[P_{ji} - \\delta_{\\ell i}] \\partial_{x_i}\\Phi_{ji}\n523: $$\n524: \n525: **Step 2: Derivative of expected measurement.**\n526: $$\n527: \\nabla_{x_i} d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\left[(\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) + P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell))\\right]\n528: $$\n529: \n530: **Derivative locality for $d_{\\text{alg}}$**: Since $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = \\delta_{\\ell i} \\nabla_{x_i} d_{\\text{alg}}(j,i)$, the second term gives:\n531: $$\n532: \\sum_{\\ell} P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)) = P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n533: $$\n534: \n535: For the first term:\n536: $$\n537: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = \\left(\\sum_{\\ell} P_{j\\ell}[\\delta_{\\ell i} - P_{ji}] d_{\\text{alg}}(j,\\ell)\\right) \\nabla_{x_i}\\Phi_{ji}\n538: $$\n539: \n540: Simplifying: $\\sum_{\\ell} P_{j\\ell} \\delta_{\\ell i} d_{\\text{alg}}(j,\\ell) = P_{ji} d_{\\text{alg}}(j,i)$ and $\\sum_{\\ell} P_{j\\ell} d_{\\text{alg}}(j,\\ell) = d_j$, so:\n541: $$\n542: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = P_{ji}[d_j - d_{\\text{alg}}(j,i)] \\nabla_{x_i}\\Phi_{ji}\n543: $$\n544: \n545: **Step 3: Combine terms.**\n546: $$\n547: \\nabla_{x_i} d_j = P_{ji}\\left[d_{\\text{alg}}(j,i) - d_j\\right] \\nabla_{x_i}\\Phi_{ji} + P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n548: $$\n549: \n550: Using $\\Phi_{ji} = d_{\\text{alg}}^2(j,i)/(2\\varepsilon_c^2)$, so $\\nabla_{x_i}\\Phi_{ji} = \\frac{d_{\\text{alg}}(j,i)}{\\varepsilon_c^2} \\nabla_{x_i} d_{\\text{alg}}(j,i)$:\n551: $$\n552: \\nabla_{x_i} d_j = P_{ji}\\left[1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}\\right] \\nabla_{x_i} d_{\\text{alg}}(j,i)\n553: $$\n554: \n555: Defining $A_{ji} := 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$, we get:\n556: $$\n557: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n558: $$\n559: \n560: **Step 4: Derivatives of $d_{\\text{alg}}(j,i)$ with regularization.**\n561: \n562: Let $w = (x_j - x_i, \\sqrt{\\lambda_{\\text{alg}}}(v_j - v_i)) \\in \\mathbb{R}^{2d}$ and $d_{\\text{alg}}(j,i) = \\sqrt{\\|w\\|^2 + \\varepsilon_d^2}$.\n563: \n564: Direct calculation gives:\n565: $$\n566: \\nabla_w d_{\\text{alg}} = \\frac{w}{d_{\\text{alg}}}, \\quad \\nabla^2_w d_{\\text{alg}} = \\frac{1}{d_{\\text{alg}}}\\text{Id}_{2d} - \\frac{w \\otimes w}{d_{\\text{alg}}^3}\n567: $$\n568: $$\n569: \\nabla^3_w d_{\\text{alg}} = -\\frac{1}{d_{\\text{alg}}^3}\\text{sym}(\\text{Id} \\otimes w) + \\frac{3}{d_{\\text{alg}}^5} w^{\\otimes 3}\n570: $$\n571: \n572: Since $d_{\\text{alg}} \\geq \\varepsilon_d$ and $\\|w\\| \\leq d_{\\text{alg}}$:\n573: $$\n574: \\|\\nabla d_{\\text{alg}}\\| \\leq 1, \\quad \\|\\nabla^2 d_{\\text{alg}}\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3 d_{\\text{alg}}\\| \\leq \\frac{6}{\\varepsilon_d^2}\n575: $$\n576: \n577: **Step 5: Higher-order derivatives of $d_j$.**\n578: \n579: Applying Leibniz rule iteratively to $\\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)$ gives:\n580: $$\n581: \\nabla^2_{x_i} d_j = P_{ji} A_{ji} \\nabla^2 d_{\\text{alg}} + \\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\n582: $$\n583: $$\n584: \\nabla^3_{x_i} d_j = P_{ji} A_{ji} \\nabla^3 d_{\\text{alg}} + 3\\,\\text{sym}\\left(\\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla^2 d_{\\text{alg}}\\right) + \\text{sym}\\left(\\nabla^2_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\\right)\n585: $$\n586: \n587: **Step 6: Bound the coefficients.**\n588: \n589: Using $P_{ji} \\leq 1$, $|d_{\\text{alg}}(j,i)| \\leq D_{\\max}$, $|d_j| \\leq D_{\\max}$:\n590: $$\n591: |A_{ji}| \\leq 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n592: $$\n593: \n594: The derivatives $\\nabla_{x_i}(P_{ji} A_{ji})$ and $\\nabla^2_{x_i}(P_{ji} A_{ji})$ involve products of softmax derivatives and $A_{ji}$ derivatives, bounded by $O(\\varepsilon_c^{-2})$ and $O(\\varepsilon_c^{-4})$ respectively.\n595: \n596: **Step 7: Final bounds.**\n597: \n598: Combining (using Codex's explicit formulas):\n599: $$\n600: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n601: $$\n602: $$\n603: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{with} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n604: $$\n605: $$\n606: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n607: $$",
      "metadata": {
        "label": "proof-lem-derivative-locality-c3"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "501: :::\n502: \n503: :::{prf:proof}\n504: :label: proof-lem-derivative-locality-c3\n505: \n506: **Step 1: Softmax probability derivative.**\n507: \n508: Let $P_{j\\ell} = \\mathbb{P}(c(j)=\\ell) = \\exp(-\\Phi_{j\\ell}) / Z_j$ where $\\Phi_{j\\ell} = d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)$ and $Z_j = \\sum_r \\exp(-\\Phi_{jr})$.\n509: \n510: Differentiating with respect to $x_i$:\n511: $$\n512: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}\\left[-\\partial_{x_i}\\Phi_{j\\ell} + \\sum_r P_{jr} \\partial_{x_i}\\Phi_{jr}\\right]\n513: $$\n514: \n515: **Locality of $\\Phi_{j\\ell}$**: Since $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, we have:\n516: $$\n517: \\partial_{x_i}\\Phi_{j\\ell} = \\delta_{\\ell i} \\partial_{x_i}\\Phi_{ji}\n518: $$\n519: \n520: Therefore:\n521: $$\n522: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}[P_{ji} - \\delta_{\\ell i}] \\partial_{x_i}\\Phi_{ji}\n523: $$\n524: \n525: **Step 2: Derivative of expected measurement.**\n526: $$\n527: \\nabla_{x_i} d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\left[(\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) + P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell))\\right]\n528: $$\n529: \n530: **Derivative locality for $d_{\\text{alg}}$**: Since $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = \\delta_{\\ell i} \\nabla_{x_i} d_{\\text{alg}}(j,i)$, the second term gives:\n531: $$\n532: \\sum_{\\ell} P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)) = P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n533: $$\n534: \n535: For the first term:\n536: $$\n537: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = \\left(\\sum_{\\ell} P_{j\\ell}[\\delta_{\\ell i} - P_{ji}] d_{\\text{alg}}(j,\\ell)\\right) \\nabla_{x_i}\\Phi_{ji}\n538: $$\n539: \n540: Simplifying: $\\sum_{\\ell} P_{j\\ell} \\delta_{\\ell i} d_{\\text{alg}}(j,\\ell) = P_{ji} d_{\\text{alg}}(j,i)$ and $\\sum_{\\ell} P_{j\\ell} d_{\\text{alg}}(j,\\ell) = d_j$, so:\n541: $$\n542: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = P_{ji}[d_j - d_{\\text{alg}}(j,i)] \\nabla_{x_i}\\Phi_{ji}\n543: $$\n544: \n545: **Step 3: Combine terms.**\n546: $$\n547: \\nabla_{x_i} d_j = P_{ji}\\left[d_{\\text{alg}}(j,i) - d_j\\right] \\nabla_{x_i}\\Phi_{ji} + P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n548: $$\n549: \n550: Using $\\Phi_{ji} = d_{\\text{alg}}^2(j,i)/(2\\varepsilon_c^2)$, so $\\nabla_{x_i}\\Phi_{ji} = \\frac{d_{\\text{alg}}(j,i)}{\\varepsilon_c^2} \\nabla_{x_i} d_{\\text{alg}}(j,i)$:\n551: $$\n552: \\nabla_{x_i} d_j = P_{ji}\\left[1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}\\right] \\nabla_{x_i} d_{\\text{alg}}(j,i)\n553: $$\n554: \n555: Defining $A_{ji} := 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$, we get:\n556: $$\n557: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n558: $$\n559: \n560: **Step 4: Derivatives of $d_{\\text{alg}}(j,i)$ with regularization.**\n561: \n562: Let $w = (x_j - x_i, \\sqrt{\\lambda_{\\text{alg}}}(v_j - v_i)) \\in \\mathbb{R}^{2d}$ and $d_{\\text{alg}}(j,i) = \\sqrt{\\|w\\|^2 + \\varepsilon_d^2}$.\n563: \n564: Direct calculation gives:\n565: $$\n566: \\nabla_w d_{\\text{alg}} = \\frac{w}{d_{\\text{alg}}}, \\quad \\nabla^2_w d_{\\text{alg}} = \\frac{1}{d_{\\text{alg}}}\\text{Id}_{2d} - \\frac{w \\otimes w}{d_{\\text{alg}}^3}\n567: $$\n568: $$\n569: \\nabla^3_w d_{\\text{alg}} = -\\frac{1}{d_{\\text{alg}}^3}\\text{sym}(\\text{Id} \\otimes w) + \\frac{3}{d_{\\text{alg}}^5} w^{\\otimes 3}\n570: $$\n571: \n572: Since $d_{\\text{alg}} \\geq \\varepsilon_d$ and $\\|w\\| \\leq d_{\\text{alg}}$:\n573: $$\n574: \\|\\nabla d_{\\text{alg}}\\| \\leq 1, \\quad \\|\\nabla^2 d_{\\text{alg}}\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3 d_{\\text{alg}}\\| \\leq \\frac{6}{\\varepsilon_d^2}\n575: $$\n576: \n577: **Step 5: Higher-order derivatives of $d_j$.**\n578: \n579: Applying Leibniz rule iteratively to $\\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)$ gives:\n580: $$\n581: \\nabla^2_{x_i} d_j = P_{ji} A_{ji} \\nabla^2 d_{\\text{alg}} + \\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\n582: $$\n583: $$\n584: \\nabla^3_{x_i} d_j = P_{ji} A_{ji} \\nabla^3 d_{\\text{alg}} + 3\\,\\text{sym}\\left(\\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla^2 d_{\\text{alg}}\\right) + \\text{sym}\\left(\\nabla^2_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\\right)\n585: $$\n586: \n587: **Step 6: Bound the coefficients.**\n588: \n589: Using $P_{ji} \\leq 1$, $|d_{\\text{alg}}(j,i)| \\leq D_{\\max}$, $|d_j| \\leq D_{\\max}$:\n590: $$\n591: |A_{ji}| \\leq 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n592: $$\n593: \n594: The derivatives $\\nabla_{x_i}(P_{ji} A_{ji})$ and $\\nabla^2_{x_i}(P_{ji} A_{ji})$ involve products of softmax derivatives and $A_{ji}$ derivatives, bounded by $O(\\varepsilon_c^{-2})$ and $O(\\varepsilon_c^{-4})$ respectively.\n595: \n596: **Step 7: Final bounds.**\n597: \n598: Combining (using Codex's explicit formulas):\n599: $$\n600: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n601: $$\n602: $$\n603: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{with} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n604: $$\n605: $$\n606: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n607: $$\n608: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Mathematical Framework and Notation"
      }
    },
    {
      "directive_type": "proof",
      "label": "lem-telescoping-derivatives",
      "title": null,
      "start_line": 661,
      "end_line": 843,
      "header_lines": [
        662,
        837
      ],
      "content_start": 664,
      "content_end": 842,
      "content": "664: :label: proof-lem-self-measurement-derivatives\n665: \n666: **Normalization and notation.** Fix walker $i$ and differentiate with respect to its configuration $x_i$. Set:\n667: \n668: $$\n669: r_{i\\ell}(x_i) = \\frac{d_{i\\ell}(x_i)^2}{2\\varepsilon_c^2}, \\quad E_{i\\ell}(x_i) = e^{-r_{i\\ell}(x_i)}, \\quad A_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell} d_{i\\ell}, \\quad Z_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell}\n670: $$\n671: \n672: Then $d_i = A_i / Z_i$. Let:\n673: \n674: $$\n675: P_{i\\ell} = \\frac{E_{i\\ell}}{Z_i}, \\quad \\mathbb{E}_i[\\varphi] = \\sum_{\\ell \\neq i} P_{i\\ell} \\varphi_{i\\ell}, \\quad D := \\nabla_{x_i}, \\quad D^m \\text{ the $m$-th derivative tensor}\n676: $$\n677: \n678: Throughout we exploit $\\sum_{\\ell} P_{i\\ell} = 1$ to eliminate every appearance of $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n679: \n680: **Step 1 (First derivative).** Applying the quotient rule:\n681: \n682: $$\n683: D d_i = \\frac{D A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D Z_i}{Z_i}\n684: $$\n685: \n686: Direct differentiation yields $D A_i = \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell})$ and $D Z_i = -\\sum_{\\ell} E_{i\\ell} D r_{i\\ell}$. Therefore:\n687: \n688: $$\n689: D d_i = \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell}) + d_i \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell} D r_{i\\ell}\n690: $$\n691: \n692: Replacing $\\frac{E_{i\\ell}}{Z_i}$ by $P_{i\\ell}$ and inserting $\\sum_{\\ell} P_{i\\ell} = 1$ gives:\n693: \n694: $$\n695: D d_i = \\sum_{\\ell} P_{i\\ell} D d_{i\\ell} - \\sum_{\\ell} P_{i\\ell}(d_{i\\ell} - d_i) D r_{i\\ell} = \\mathbb{E}_i[D d_{i\\ell}] - \\mathbb{E}_i[(d_{i\\ell} - d_i) D r_{i\\ell}]\n696: $$\n697: \n698: so every term is an expectation, i.e., $k$-uniform.\n699: \n700: **Step 2 (Second derivative).** Differentiating a second time gives:\n701: \n702: $$\n703: D^2 d_i = \\frac{D^2 A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D^2 Z_i}{Z_i} - \\frac{2}{Z_i^2} \\text{sym}(D A_i \\otimes D Z_i) + \\frac{2A_i}{Z_i} \\frac{1}{Z_i^2} \\text{sym}(D Z_i \\otimes D Z_i)\n704: $$\n705: \n706: Using:\n707: \n708: $$\n709: \\begin{aligned}\n710: D^2 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^2 d_{i\\ell} - D d_{i\\ell} \\otimes D r_{i\\ell} - D r_{i\\ell} \\otimes D d_{i\\ell} - d_{i\\ell} D^2 r_{i\\ell} + d_{i\\ell} D r_{i\\ell} \\otimes D r_{i\\ell}\\Big) \\\\\n711: D^2 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D r_{i\\ell} \\otimes D r_{i\\ell} - D^2 r_{i\\ell}\\Big)\n712: \\end{aligned}\n713: $$\n714: \n715: and renormalizing by $Z_i$, we obtain:\n716: \n717: $$\n718: \\boxed{\n719: \\begin{aligned}\n720: D^2 d_i &= \\mathbb{E}_i[D^2 d_{i\\ell} - (d_{i\\ell} - d_i) D^2 r_{i\\ell}] \\\\\n721: &\\quad - 2 \\text{sym} \\, \\mathbb{E}_i[(D d_{i\\ell} - \\mathbb{E}_i[D d_{i\\bullet}]) \\otimes (D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])] \\\\\n722: &\\quad + \\mathbb{E}_i\\Big[(d_{i\\ell} - d_i) \\big((D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])^{\\otimes 2} - \\text{Cov}_i(D r_{i\\bullet})\\big)\\Big]\n723: \\end{aligned}\n724: }\n725: $$\n726: \n727: with $\\text{Cov}_i(D r_{i\\bullet}) = \\mathbb{E}_i[D r_{i\\ell} \\otimes D r_{i\\ell}] - \\mathbb{E}_i[D r_{i\\bullet}] \\otimes \\mathbb{E}_i[D r_{i\\bullet}]$.\n728: \n729: Every tensor on the right is an expectation, hence $k$-uniform.\n730: \n731: **Step 3 (Third derivative via Faà di Bruno).** Write $d_i = A_i Z_i^{-1}$ and apply Faà di Bruno to the product $A_i \\cdot Z_i^{-1}$:\n732: \n733: $$\n734: \\begin{aligned}\n735: D^3 d_i &= Z_i^{-1} D^3 A_i - 3 Z_i^{-2} \\text{sym}(D^2 A_i \\otimes D Z_i) + 6 Z_i^{-3} \\text{sym}(D A_i \\otimes D Z_i \\otimes D Z_i) \\\\\n736: &\\quad - 3 Z_i^{-2} \\text{sym}(D A_i \\otimes D^2 Z_i) - 6 d_i Z_i^{-3} D Z_i^{\\otimes 3} \\\\\n737: &\\quad + 6 d_i Z_i^{-2} \\text{sym}(D Z_i \\otimes D^2 Z_i) - d_i Z_i^{-1} D^3 Z_i\n738: \\end{aligned}\n739: $$\n740: \n741: The third derivatives of $A_i$ and $Z_i$ are, term by term:\n742: \n743: $$\n744: \\begin{aligned}\n745: D^3 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^3 d_{i\\ell} - 3 \\text{sym}(D^2 d_{i\\ell} \\otimes D r_{i\\ell}) - 3 \\text{sym}(D d_{i\\ell} \\otimes D^2 r_{i\\ell}) \\\\\n746: &\\quad\\quad - d_{i\\ell} D^3 r_{i\\ell} + 3 d_{i\\ell} \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - d_{i\\ell} D r_{i\\ell}^{\\otimes 3}\\Big) \\\\\n747: D^3 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(- D r_{i\\ell}^{\\otimes 3} + 3 \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - D^3 r_{i\\ell}\\Big)\n748: \\end{aligned}\n749: $$\n750: \n751: After dividing by $Z_i$, each summation turns into $\\mathbb{E}_i[\\cdot]$, so every block in $D^3 d_i$ is again an expectation with weights $P_{i\\ell}$. Thus the Faà di Bruno expansion inherits the same $k$-uniformity: all companion sums appear inside expectations, never multiplied by $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n752: \n753: **Step 4 (Explicit uniform bounds).** Introduce the supremum bounds:\n754: \n755: $$\n756: B_0 = \\sup_{\\ell} |d_{i\\ell}|, \\quad M_m = \\sup_{\\ell} \\|D^m d_{i\\ell}\\|, \\quad m = 1,2,3\n757: $$\n758: \n759: and note:\n760: \n761: $$\n762: \\|D r_{i\\ell}\\| \\leq \\frac{B_0 M_1}{\\varepsilon_c^2} = R_1, \\quad \\|D^2 r_{i\\ell}\\| \\leq \\frac{M_1^2 + B_0 M_2}{\\varepsilon_c^2} = R_2, \\quad \\|D^3 r_{i\\ell}\\| \\leq \\frac{3 M_1 M_2 + B_0 M_3}{\\varepsilon_c^2} = R_3\n763: $$\n764: \n765: Because every derivative of $d_i$ is an expectation, the operator norms are bounded by the maxima of these ingredients, giving the explicit $k$-independent constants:\n766: \n767: $$\n768: \\boxed{\\|D d_i\\| \\leq C_{d,1} = M_1\\left(1 + \\frac{2 B_0^2}{\\varepsilon_c^2}\\right)}\n769: $$\n770: \n771: $$\n772: \\boxed{\\|D^2 d_i\\| \\leq C_{d,2} = M_2 + \\frac{6 B_0 M_1^2 + 2 B_0^2 M_2}{\\varepsilon_c^2} + \\frac{6 B_0^3 M_1^2}{\\varepsilon_c^4}}\n773: $$\n774: \n775: $$\n776: \\boxed{\\|D^3 d_i\\| \\leq C_{d,3} = M_3 + \\frac{6 M_1^3 + 18 B_0 M_1 M_2 + 2 B_0^2 M_3}{\\varepsilon_c^2} + \\frac{33 B_0^2 M_1^3 + 18 B_0^3 M_1 M_2}{\\varepsilon_c^4} + \\frac{26 B_0^4 M_1^3}{\\varepsilon_c^6}}\n777: $$\n778: \n779: Each $C_{d,k}$ depends only on uniform bounds of the pairwise distances and their derivatives, never on $|\\mathcal{A}|$ or $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n780: \n781: \n782: **Step 5 (Simplification with regularized metric bounds).** Substitute the explicit bounds for the regularized algorithmic distance:\n783: \n784: $$\n785: M_1 = \\|\\nabla d_{i\\ell}\\| = 1, \\quad M_2 = \\|\\nabla^2 d_{i\\ell}\\| = \\frac{2}{\\varepsilon_d}, \\quad M_3 = \\|\\nabla^3 d_{i\\ell}\\| = \\frac{6}{\\varepsilon_d^2}, \\quad B_0 = D_{\\max}\n786: $$\n787: \n788: For $C_{d,3}$, the boxed formula becomes:\n789: \n790: $$\n791: \\begin{aligned}\n792: C_{d,3} &= \\frac{6}{\\varepsilon_d^2} + \\frac{6 \\cdot 1 + 18 D_{\\max} \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d} + 2 D_{\\max}^2 \\cdot \\frac{6}{\\varepsilon_d^2}}{\\varepsilon_c^2} \\\\\n793: &\\quad + \\frac{33 D_{\\max}^2 \\cdot 1 + 18 D_{\\max}^3 \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d}}{\\varepsilon_c^4} + \\frac{26 D_{\\max}^4 \\cdot 1}{\\varepsilon_c^6}\n794: \\end{aligned}\n795: $$\n796: \n797: Collecting $\\varepsilon_d^{-2}$ terms:\n798: \n799: $$\n800: C_{d,3} = \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{2 D_{\\max}^2}{\\varepsilon_c^2}\\right) + O(\\varepsilon_d^{-1}) + O(1)\n801: $$\n802: \n803: For the typical regime $\\varepsilon_d \\ll \\varepsilon_c$, the dominant term is:\n804: \n805: $$\n806: C_{d,3} \\approx \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n807: $$\n808: \n809: matching the simplified formula stated in the lemma (where subdominant $\\varepsilon_d^{-1}$ and constant terms are absorbed). ∎\n810: \n811: The full model involves **two distinct spatial scales** that work together to maintain k-uniform bounds:\n812: \n813: **Scale 1: Companion Selection** (controlled by $\\varepsilon_c$):\n814: - **Purpose**: Select companions for measurements\n815: - **Effective interactions**: $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\varepsilon_c^{2d} (\\log k)^d)$ (NOT k-uniform)\n816: - **Key mechanism**: **Derivative locality** (§2.5.4) eliminates ℓ-sums before $(\\log k)^d$ can appear\n817: - **Result for j≠i**: Only companion $\\ell = i$ contributes to $\\nabla_i d_j$ → single term, no log factor\n818: \n819: **Scale 2: Localization Weights** (controlled by $\\rho$):\n820: - **Purpose**: Compute local statistics (mean, variance)\n821: - **Effective interactions**: $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ (IS k-uniform)\n822: - **Key mechanism**: **Telescoping identity** (§2.7) from $\\sum_j w_{ij} = 1$\n823: - **Result**: Naive $O(k)$ sum over $j$ cancels to $O(\\rho^{2d})$ (k-uniform)\n824: \n825: **Combined Effect**: Despite N-body coupling from companion selection:\n826: 1. Derivative locality prevents $(\\log k)^d$ at the ε_c-scale\n827: 2. Telescoping controls $j$-sums at the ρ-scale\n828: 3. Result: **k-uniform third-derivative bounds** for the full companion-dependent model\n829: \n830: **Typical parameter hierarchy**: $\\varepsilon_d \\ll \\varepsilon_c \\lesssim \\rho \\ll 1$\n831: \n832: This two-scale framework is essential for all k-uniformity proofs in Chapters 5-8.\n833: \n834: ### 2.7. k-Uniformity and Telescoping Properties\n835: \n836: A bound is **k-uniform** if it is independent of the alive walker count $k = |A_k|$. The key technical tool for proving k-uniformity is the **telescoping property** of normalized weights:\n837: \n838: :::{prf:lemma} Telescoping Identity for Derivatives\n839: :label: lem-telescoping-derivatives\n840: \n841: For any derivative order $m \\in \\{1, 2, 3\\}$, the localization weights satisfy:\n842: $$",
      "metadata": {
        "label": "lem-telescoping-derivatives"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "661: :::\n662: \n663: :::{prf:proof}\n664: :label: proof-lem-self-measurement-derivatives\n665: \n666: **Normalization and notation.** Fix walker $i$ and differentiate with respect to its configuration $x_i$. Set:\n667: \n668: $$\n669: r_{i\\ell}(x_i) = \\frac{d_{i\\ell}(x_i)^2}{2\\varepsilon_c^2}, \\quad E_{i\\ell}(x_i) = e^{-r_{i\\ell}(x_i)}, \\quad A_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell} d_{i\\ell}, \\quad Z_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell}\n670: $$\n671: \n672: Then $d_i = A_i / Z_i$. Let:\n673: \n674: $$\n675: P_{i\\ell} = \\frac{E_{i\\ell}}{Z_i}, \\quad \\mathbb{E}_i[\\varphi] = \\sum_{\\ell \\neq i} P_{i\\ell} \\varphi_{i\\ell}, \\quad D := \\nabla_{x_i}, \\quad D^m \\text{ the $m$-th derivative tensor}\n676: $$\n677: \n678: Throughout we exploit $\\sum_{\\ell} P_{i\\ell} = 1$ to eliminate every appearance of $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n679: \n680: **Step 1 (First derivative).** Applying the quotient rule:\n681: \n682: $$\n683: D d_i = \\frac{D A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D Z_i}{Z_i}\n684: $$\n685: \n686: Direct differentiation yields $D A_i = \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell})$ and $D Z_i = -\\sum_{\\ell} E_{i\\ell} D r_{i\\ell}$. Therefore:\n687: \n688: $$\n689: D d_i = \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell}) + d_i \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell} D r_{i\\ell}\n690: $$\n691: \n692: Replacing $\\frac{E_{i\\ell}}{Z_i}$ by $P_{i\\ell}$ and inserting $\\sum_{\\ell} P_{i\\ell} = 1$ gives:\n693: \n694: $$\n695: D d_i = \\sum_{\\ell} P_{i\\ell} D d_{i\\ell} - \\sum_{\\ell} P_{i\\ell}(d_{i\\ell} - d_i) D r_{i\\ell} = \\mathbb{E}_i[D d_{i\\ell}] - \\mathbb{E}_i[(d_{i\\ell} - d_i) D r_{i\\ell}]\n696: $$\n697: \n698: so every term is an expectation, i.e., $k$-uniform.\n699: \n700: **Step 2 (Second derivative).** Differentiating a second time gives:\n701: \n702: $$\n703: D^2 d_i = \\frac{D^2 A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D^2 Z_i}{Z_i} - \\frac{2}{Z_i^2} \\text{sym}(D A_i \\otimes D Z_i) + \\frac{2A_i}{Z_i} \\frac{1}{Z_i^2} \\text{sym}(D Z_i \\otimes D Z_i)\n704: $$\n705: \n706: Using:\n707: \n708: $$\n709: \\begin{aligned}\n710: D^2 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^2 d_{i\\ell} - D d_{i\\ell} \\otimes D r_{i\\ell} - D r_{i\\ell} \\otimes D d_{i\\ell} - d_{i\\ell} D^2 r_{i\\ell} + d_{i\\ell} D r_{i\\ell} \\otimes D r_{i\\ell}\\Big) \\\\\n711: D^2 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D r_{i\\ell} \\otimes D r_{i\\ell} - D^2 r_{i\\ell}\\Big)\n712: \\end{aligned}\n713: $$\n714: \n715: and renormalizing by $Z_i$, we obtain:\n716: \n717: $$\n718: \\boxed{\n719: \\begin{aligned}\n720: D^2 d_i &= \\mathbb{E}_i[D^2 d_{i\\ell} - (d_{i\\ell} - d_i) D^2 r_{i\\ell}] \\\\\n721: &\\quad - 2 \\text{sym} \\, \\mathbb{E}_i[(D d_{i\\ell} - \\mathbb{E}_i[D d_{i\\bullet}]) \\otimes (D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])] \\\\\n722: &\\quad + \\mathbb{E}_i\\Big[(d_{i\\ell} - d_i) \\big((D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])^{\\otimes 2} - \\text{Cov}_i(D r_{i\\bullet})\\big)\\Big]\n723: \\end{aligned}\n724: }\n725: $$\n726: \n727: with $\\text{Cov}_i(D r_{i\\bullet}) = \\mathbb{E}_i[D r_{i\\ell} \\otimes D r_{i\\ell}] - \\mathbb{E}_i[D r_{i\\bullet}] \\otimes \\mathbb{E}_i[D r_{i\\bullet}]$.\n728: \n729: Every tensor on the right is an expectation, hence $k$-uniform.\n730: \n731: **Step 3 (Third derivative via Faà di Bruno).** Write $d_i = A_i Z_i^{-1}$ and apply Faà di Bruno to the product $A_i \\cdot Z_i^{-1}$:\n732: \n733: $$\n734: \\begin{aligned}\n735: D^3 d_i &= Z_i^{-1} D^3 A_i - 3 Z_i^{-2} \\text{sym}(D^2 A_i \\otimes D Z_i) + 6 Z_i^{-3} \\text{sym}(D A_i \\otimes D Z_i \\otimes D Z_i) \\\\\n736: &\\quad - 3 Z_i^{-2} \\text{sym}(D A_i \\otimes D^2 Z_i) - 6 d_i Z_i^{-3} D Z_i^{\\otimes 3} \\\\\n737: &\\quad + 6 d_i Z_i^{-2} \\text{sym}(D Z_i \\otimes D^2 Z_i) - d_i Z_i^{-1} D^3 Z_i\n738: \\end{aligned}\n739: $$\n740: \n741: The third derivatives of $A_i$ and $Z_i$ are, term by term:\n742: \n743: $$\n744: \\begin{aligned}\n745: D^3 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^3 d_{i\\ell} - 3 \\text{sym}(D^2 d_{i\\ell} \\otimes D r_{i\\ell}) - 3 \\text{sym}(D d_{i\\ell} \\otimes D^2 r_{i\\ell}) \\\\\n746: &\\quad\\quad - d_{i\\ell} D^3 r_{i\\ell} + 3 d_{i\\ell} \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - d_{i\\ell} D r_{i\\ell}^{\\otimes 3}\\Big) \\\\\n747: D^3 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(- D r_{i\\ell}^{\\otimes 3} + 3 \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - D^3 r_{i\\ell}\\Big)\n748: \\end{aligned}\n749: $$\n750: \n751: After dividing by $Z_i$, each summation turns into $\\mathbb{E}_i[\\cdot]$, so every block in $D^3 d_i$ is again an expectation with weights $P_{i\\ell}$. Thus the Faà di Bruno expansion inherits the same $k$-uniformity: all companion sums appear inside expectations, never multiplied by $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n752: \n753: **Step 4 (Explicit uniform bounds).** Introduce the supremum bounds:\n754: \n755: $$\n756: B_0 = \\sup_{\\ell} |d_{i\\ell}|, \\quad M_m = \\sup_{\\ell} \\|D^m d_{i\\ell}\\|, \\quad m = 1,2,3\n757: $$\n758: \n759: and note:\n760: \n761: $$\n762: \\|D r_{i\\ell}\\| \\leq \\frac{B_0 M_1}{\\varepsilon_c^2} = R_1, \\quad \\|D^2 r_{i\\ell}\\| \\leq \\frac{M_1^2 + B_0 M_2}{\\varepsilon_c^2} = R_2, \\quad \\|D^3 r_{i\\ell}\\| \\leq \\frac{3 M_1 M_2 + B_0 M_3}{\\varepsilon_c^2} = R_3\n763: $$\n764: \n765: Because every derivative of $d_i$ is an expectation, the operator norms are bounded by the maxima of these ingredients, giving the explicit $k$-independent constants:\n766: \n767: $$\n768: \\boxed{\\|D d_i\\| \\leq C_{d,1} = M_1\\left(1 + \\frac{2 B_0^2}{\\varepsilon_c^2}\\right)}\n769: $$\n770: \n771: $$\n772: \\boxed{\\|D^2 d_i\\| \\leq C_{d,2} = M_2 + \\frac{6 B_0 M_1^2 + 2 B_0^2 M_2}{\\varepsilon_c^2} + \\frac{6 B_0^3 M_1^2}{\\varepsilon_c^4}}\n773: $$\n774: \n775: $$\n776: \\boxed{\\|D^3 d_i\\| \\leq C_{d,3} = M_3 + \\frac{6 M_1^3 + 18 B_0 M_1 M_2 + 2 B_0^2 M_3}{\\varepsilon_c^2} + \\frac{33 B_0^2 M_1^3 + 18 B_0^3 M_1 M_2}{\\varepsilon_c^4} + \\frac{26 B_0^4 M_1^3}{\\varepsilon_c^6}}\n777: $$\n778: \n779: Each $C_{d,k}$ depends only on uniform bounds of the pairwise distances and their derivatives, never on $|\\mathcal{A}|$ or $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n780: \n781: \n782: **Step 5 (Simplification with regularized metric bounds).** Substitute the explicit bounds for the regularized algorithmic distance:\n783: \n784: $$\n785: M_1 = \\|\\nabla d_{i\\ell}\\| = 1, \\quad M_2 = \\|\\nabla^2 d_{i\\ell}\\| = \\frac{2}{\\varepsilon_d}, \\quad M_3 = \\|\\nabla^3 d_{i\\ell}\\| = \\frac{6}{\\varepsilon_d^2}, \\quad B_0 = D_{\\max}\n786: $$\n787: \n788: For $C_{d,3}$, the boxed formula becomes:\n789: \n790: $$\n791: \\begin{aligned}\n792: C_{d,3} &= \\frac{6}{\\varepsilon_d^2} + \\frac{6 \\cdot 1 + 18 D_{\\max} \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d} + 2 D_{\\max}^2 \\cdot \\frac{6}{\\varepsilon_d^2}}{\\varepsilon_c^2} \\\\\n793: &\\quad + \\frac{33 D_{\\max}^2 \\cdot 1 + 18 D_{\\max}^3 \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d}}{\\varepsilon_c^4} + \\frac{26 D_{\\max}^4 \\cdot 1}{\\varepsilon_c^6}\n794: \\end{aligned}\n795: $$\n796: \n797: Collecting $\\varepsilon_d^{-2}$ terms:\n798: \n799: $$\n800: C_{d,3} = \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{2 D_{\\max}^2}{\\varepsilon_c^2}\\right) + O(\\varepsilon_d^{-1}) + O(1)\n801: $$\n802: \n803: For the typical regime $\\varepsilon_d \\ll \\varepsilon_c$, the dominant term is:\n804: \n805: $$\n806: C_{d,3} \\approx \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n807: $$\n808: \n809: matching the simplified formula stated in the lemma (where subdominant $\\varepsilon_d^{-1}$ and constant terms are absorbed). ∎\n810: \n811: The full model involves **two distinct spatial scales** that work together to maintain k-uniform bounds:\n812: \n813: **Scale 1: Companion Selection** (controlled by $\\varepsilon_c$):\n814: - **Purpose**: Select companions for measurements\n815: - **Effective interactions**: $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\varepsilon_c^{2d} (\\log k)^d)$ (NOT k-uniform)\n816: - **Key mechanism**: **Derivative locality** (§2.5.4) eliminates ℓ-sums before $(\\log k)^d$ can appear\n817: - **Result for j≠i**: Only companion $\\ell = i$ contributes to $\\nabla_i d_j$ → single term, no log factor\n818: \n819: **Scale 2: Localization Weights** (controlled by $\\rho$):\n820: - **Purpose**: Compute local statistics (mean, variance)\n821: - **Effective interactions**: $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ (IS k-uniform)\n822: - **Key mechanism**: **Telescoping identity** (§2.7) from $\\sum_j w_{ij} = 1$\n823: - **Result**: Naive $O(k)$ sum over $j$ cancels to $O(\\rho^{2d})$ (k-uniform)\n824: \n825: **Combined Effect**: Despite N-body coupling from companion selection:\n826: 1. Derivative locality prevents $(\\log k)^d$ at the ε_c-scale\n827: 2. Telescoping controls $j$-sums at the ρ-scale\n828: 3. Result: **k-uniform third-derivative bounds** for the full companion-dependent model\n829: \n830: **Typical parameter hierarchy**: $\\varepsilon_d \\ll \\varepsilon_c \\lesssim \\rho \\ll 1$\n831: \n832: This two-scale framework is essential for all k-uniformity proofs in Chapters 5-8.\n833: \n834: ### 2.7. k-Uniformity and Telescoping Properties\n835: \n836: A bound is **k-uniform** if it is independent of the alive walker count $k = |A_k|$. The key technical tool for proving k-uniformity is the **telescoping property** of normalized weights:\n837: \n838: :::{prf:lemma} Telescoping Identity for Derivatives\n839: :label: lem-telescoping-derivatives\n840: \n841: For any derivative order $m \\in \\{1, 2, 3\\}$, the localization weights satisfy:\n842: $$\n843: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = 0",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Mathematical Framework and Notation"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-telescoping-derivatives",
      "title": null,
      "start_line": 845,
      "end_line": 881,
      "header_lines": [
        846
      ],
      "content_start": 848,
      "content_end": 880,
      "content": "848: :label: proof-lem-telescoping-derivatives\n849: \n850: **Overview**: We prove that the normalization constraint $\\sum_j w_{ij}(\\rho) = 1$ holds identically in $x_i$, each weight is $C^3$, and differentiating both sides yields the telescoping identity.\n851: \n852: **Step 1: Normalization identity.**\n853: \n854: By definition, the localization weights are $w_{ij}(\\rho) := K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) := \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$. Since the kernel $K_\\rho$ is strictly positive (Gaussian kernel), we have $Z_i(\\rho) > 0$. Therefore:\n855: $$\n856: \\sum_{j \\in A_k} w_{ij}(\\rho) = \\sum_{j \\in A_k} \\frac{K_\\rho(x_i, x_j)}{Z_i(\\rho)} = \\frac{1}{Z_i(\\rho)} \\sum_{j \\in A_k} K_\\rho(x_i, x_j) = \\frac{Z_i(\\rho)}{Z_i(\\rho)} = 1\n857: $$\n858: \n859: This holds identically for all $x_i \\in \\mathcal{X}$.\n860: \n861: **Step 2: Regularity of weights.**\n862: \n863: Each weight $w_{ij}(\\rho)$ is $C^3$ in $x_i$ by the quotient rule: the numerator $K_\\rho(x_i, x_j)$ is $C^3$ (Gaussian kernel), the denominator $Z_i(\\rho)$ is $C^3$ (finite sum of $C^3$ functions), and $Z_i(\\rho) > 0$ ensures the quotient is well-defined and $C^3$.\n864: \n865: **Step 3: Differentiation.**\n866: \n867: Apply $\\nabla^m_{x_i}$ for $m \\in \\{1,2,3\\}$ to both sides of the identity $\\sum_j w_{ij}(\\rho) = 1$. By linearity of differentiation and finiteness of the sum:\n868: $$\n869: \\nabla^m_{x_i} \\left(\\sum_{j \\in A_k} w_{ij}(\\rho)\\right) = \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho)\n870: $$\n871: \n872: The right-hand side of the original identity is the constant function 1, so $\\nabla^m_{x_i}(1) = 0$ for all $m \\geq 1$.\n873: \n874: **Step 4: Conclusion.**\n875: \n876: Combining the above:\n877: $$\n878: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = \\nabla^m_{x_i}(1) = 0\n879: $$\n880: ",
      "metadata": {
        "label": "proof-lem-telescoping-derivatives"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "845: :::\n846: \n847: :::{prf:proof}\n848: :label: proof-lem-telescoping-derivatives\n849: \n850: **Overview**: We prove that the normalization constraint $\\sum_j w_{ij}(\\rho) = 1$ holds identically in $x_i$, each weight is $C^3$, and differentiating both sides yields the telescoping identity.\n851: \n852: **Step 1: Normalization identity.**\n853: \n854: By definition, the localization weights are $w_{ij}(\\rho) := K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) := \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$. Since the kernel $K_\\rho$ is strictly positive (Gaussian kernel), we have $Z_i(\\rho) > 0$. Therefore:\n855: $$\n856: \\sum_{j \\in A_k} w_{ij}(\\rho) = \\sum_{j \\in A_k} \\frac{K_\\rho(x_i, x_j)}{Z_i(\\rho)} = \\frac{1}{Z_i(\\rho)} \\sum_{j \\in A_k} K_\\rho(x_i, x_j) = \\frac{Z_i(\\rho)}{Z_i(\\rho)} = 1\n857: $$\n858: \n859: This holds identically for all $x_i \\in \\mathcal{X}$.\n860: \n861: **Step 2: Regularity of weights.**\n862: \n863: Each weight $w_{ij}(\\rho)$ is $C^3$ in $x_i$ by the quotient rule: the numerator $K_\\rho(x_i, x_j)$ is $C^3$ (Gaussian kernel), the denominator $Z_i(\\rho)$ is $C^3$ (finite sum of $C^3$ functions), and $Z_i(\\rho) > 0$ ensures the quotient is well-defined and $C^3$.\n864: \n865: **Step 3: Differentiation.**\n866: \n867: Apply $\\nabla^m_{x_i}$ for $m \\in \\{1,2,3\\}$ to both sides of the identity $\\sum_j w_{ij}(\\rho) = 1$. By linearity of differentiation and finiteness of the sum:\n868: $$\n869: \\nabla^m_{x_i} \\left(\\sum_{j \\in A_k} w_{ij}(\\rho)\\right) = \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho)\n870: $$\n871: \n872: The right-hand side of the original identity is the constant function 1, so $\\nabla^m_{x_i}(1) = 0$ for all $m \\geq 1$.\n873: \n874: **Step 4: Conclusion.**\n875: \n876: Combining the above:\n877: $$\n878: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = \\nabla^m_{x_i}(1) = 0\n879: $$\n880: \n881: This completes the proof for all $m \\in \\{1, 2, 3\\}$.",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Mathematical Framework and Notation"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-weight-third-derivative",
      "title": null,
      "start_line": 1063,
      "end_line": 1133,
      "header_lines": [
        1064
      ],
      "content_start": 1066,
      "content_end": 1132,
      "content": "1066: :label: proof-lem-weight-third-derivative\n1067: \n1068: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n1069: \n1070: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n1071: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n1072: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n1073: \n1074: **Step 2: Derivatives of numerator.**\n1075: By Assumption {prf:ref}`assump-c3-kernel`:\n1076: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n1077: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1078: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1079: \n1080: **Step 3: Derivatives of denominator.**\n1081: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n1082: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n1083: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1084: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1085: \n1086: **Step 4: Apply quotient rule for third derivative.**\n1087: \n1088: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n1089: $$\n1090: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n1091: $$\n1092: \n1093: plus additional terms. We bound each term:\n1094: \n1095: **Term 1:** $|\\nabla^3 u / v|$\n1096: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n1097: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n1098: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n1099: \n1100: **Remarks on k-uniformity:** The quotient rule formula from §2.4 shows that $\\nabla^3(u/v)$ involves terms with denominators up to $v^4$, multiplied by various combinations of derivatives of $u$ and $v$. Since $v = Z_i = \\sum_{\\ell} K_\\rho(x_i, x_\\ell)$ involves a sum over $k$ walkers, naive application of the quotient rule appears to produce $k$-dependent bounds.\n1101: \n1102: **Key insight:** k-uniformity is achieved through the **normalization constraint** $\\sum_j w_{ij} = 1$. When differentiated three times (see Step 5 below), this constraint provides a telescoping identity that ensures cancellation of $k$-dependent factors. The quotient rule terms involving high powers of $1/Z_i$ combine with sums over $j$ to produce k-uniform expressions.\n1103: \n1104: **Step 5: Achieve k-uniformity via telescoping.**\n1105: \n1106: Differentiating the normalization constraint $\\sum_{j \\in A_k} w_{ij} = 1$ three times yields the **telescoping identity**:\n1107: \n1108: $$\n1109: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n1110: $$\n1111: \n1112: This identity ensures that when $\\nabla^3 w_{ij}$ appears in weighted sums (as in the localized moments in §5), the $Z_i$-dependent correction terms from the quotient rule sum to zero, leaving only k-uniform contributions.\n1113: \n1114: More precisely, the quotient rule structure implies:\n1115: \n1116: $$\n1117: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{(correction terms from } \\nabla^m Z_i\\text{, } m=1,2,3\\text{)}\n1118: $$\n1119: \n1120: The leading term $\\nabla^3 K_\\rho(x_i, x_j) / Z_i$ is already k-uniform since both the numerator $\\nabla^3 K_\\rho$ (bounded by $C_{\\nabla^3 K}(\\rho)/\\rho^3$, independent of $k$) and denominator $Z_i = O(k)$ scale appropriately. The correction terms involve products of kernel derivatives with derivatives of $Z_i^{-1}$, which contain factors of $k$ from sums in $\\nabla^m Z_i$. The telescoping identity guarantees that when these are summed over $j$, the net $k$-dependence cancels.\n1121: \n1122: **Step 6: Explicit bound.**\n1123: \n1124: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n1125: $$\n1126: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n1127: $$\n1128: \n1129: Absorbing constants and using conservative bounds:\n1130: $$\n1131: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1132: $$",
      "metadata": {
        "label": "proof-lem-weight-third-derivative"
      },
      "section": "## 4. Third Derivatives of Localization Weights",
      "references": [
        "assump-c3-kernel"
      ],
      "raw_directive": "1063: :::\n1064: \n1065: :::{prf:proof}\n1066: :label: proof-lem-weight-third-derivative\n1067: \n1068: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n1069: \n1070: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n1071: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n1072: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n1073: \n1074: **Step 2: Derivatives of numerator.**\n1075: By Assumption {prf:ref}`assump-c3-kernel`:\n1076: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n1077: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1078: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1079: \n1080: **Step 3: Derivatives of denominator.**\n1081: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n1082: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n1083: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1084: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1085: \n1086: **Step 4: Apply quotient rule for third derivative.**\n1087: \n1088: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n1089: $$\n1090: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n1091: $$\n1092: \n1093: plus additional terms. We bound each term:\n1094: \n1095: **Term 1:** $|\\nabla^3 u / v|$\n1096: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n1097: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n1098: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n1099: \n1100: **Remarks on k-uniformity:** The quotient rule formula from §2.4 shows that $\\nabla^3(u/v)$ involves terms with denominators up to $v^4$, multiplied by various combinations of derivatives of $u$ and $v$. Since $v = Z_i = \\sum_{\\ell} K_\\rho(x_i, x_\\ell)$ involves a sum over $k$ walkers, naive application of the quotient rule appears to produce $k$-dependent bounds.\n1101: \n1102: **Key insight:** k-uniformity is achieved through the **normalization constraint** $\\sum_j w_{ij} = 1$. When differentiated three times (see Step 5 below), this constraint provides a telescoping identity that ensures cancellation of $k$-dependent factors. The quotient rule terms involving high powers of $1/Z_i$ combine with sums over $j$ to produce k-uniform expressions.\n1103: \n1104: **Step 5: Achieve k-uniformity via telescoping.**\n1105: \n1106: Differentiating the normalization constraint $\\sum_{j \\in A_k} w_{ij} = 1$ three times yields the **telescoping identity**:\n1107: \n1108: $$\n1109: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n1110: $$\n1111: \n1112: This identity ensures that when $\\nabla^3 w_{ij}$ appears in weighted sums (as in the localized moments in §5), the $Z_i$-dependent correction terms from the quotient rule sum to zero, leaving only k-uniform contributions.\n1113: \n1114: More precisely, the quotient rule structure implies:\n1115: \n1116: $$\n1117: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{(correction terms from } \\nabla^m Z_i\\text{, } m=1,2,3\\text{)}\n1118: $$\n1119: \n1120: The leading term $\\nabla^3 K_\\rho(x_i, x_j) / Z_i$ is already k-uniform since both the numerator $\\nabla^3 K_\\rho$ (bounded by $C_{\\nabla^3 K}(\\rho)/\\rho^3$, independent of $k$) and denominator $Z_i = O(k)$ scale appropriately. The correction terms involve products of kernel derivatives with derivatives of $Z_i^{-1}$, which contain factors of $k$ from sums in $\\nabla^m Z_i$. The telescoping identity guarantees that when these are summed over $j$, the net $k$-dependence cancels.\n1121: \n1122: **Step 6: Explicit bound.**\n1123: \n1124: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n1125: $$\n1126: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n1127: $$\n1128: \n1129: Absorbing constants and using conservative bounds:\n1130: $$\n1131: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1132: $$\n1133: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 4. Third Derivatives of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-mean-third-derivative",
      "title": null,
      "start_line": 1168,
      "end_line": 1268,
      "header_lines": [
        1169
      ],
      "content_start": 1171,
      "content_end": 1267,
      "content": "1171: :label: proof-lem-mean-third-derivative\n1172: \n1173: **Overview**: Unlike the simplified model, companion-dependent measurements $d_j$ depend on $x_i$ for ALL walkers $j$ (via softmax coupling). We apply Leibniz rule to all products $w_{ij} \\cdot d_j$, using **derivative locality** (§2.5.4) to maintain k-uniformity.\n1174: \n1175: **Step 1: Product rule for all terms.**\n1176: \n1177: The mean is $\\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j$ where $d_j = \\mathbb{E}[d_{\\text{alg}}(j, c(j))]$. Apply Leibniz rule for third derivatives:\n1178: $$\n1179: \\nabla^3_{x_i} [w_{ij} \\cdot d_j] = \\sum_{k=0}^{3} \\binom{3}{k} (\\nabla^k_{x_i} w_{ij}) \\cdot (\\nabla^{3-k}_{x_i} d_j)\n1180: $$\n1181: \n1182: Expanding all four terms:\n1183: $$\n1184: \\nabla^3_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\left[w_{ij} \\nabla^3 d_j + 3(\\nabla w_{ij})(\\nabla^2 d_j) + 3(\\nabla^2 w_{ij})(\\nabla d_j) + (\\nabla^3 w_{ij}) d_j\\right]\n1185: $$\n1186: \n1187: **Step 2: Apply derivative bounds for ALL j.**\n1188: \n1189: **For j ≠ i**: From Lemma {prf:ref}`lem-derivative-locality-c3` (derivative locality):\n1190: - $\\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform due to derivative locality)\n1191: \n1192: **For j = i**: From Lemma {prf:ref}`lem-self-measurement-derivatives` (self-measurement):\n1193: - $\\|\\nabla^3_{x_i} d_i\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform due to normalization $\\sum_{\\ell} P_{i\\ell} = 1$)\n1194: \n1195: **Key Result**: Despite different mechanisms (derivative locality for j≠i, expectation normalization for j=i), BOTH cases give the **same k-uniform bound** with the **same constant** $C_{d,3}$.\n1196: \n1197: Therefore, for all $j \\in \\mathcal{A}$:\n1198: - $\\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform)\n1199: - $\\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1}$ (k-uniform)\n1200: - $\\|\\nabla_{x_i} d_j\\| \\leq C_{d,1}$ (k-uniform)\n1201: - $|d_j| \\leq D_{\\max}$ (bounded by diameter)\n1202: \n1203: **Term 1**: $\\sum_j w_{ij} \\nabla^3 d_j$\n1204: $$\n1205: \\left\\|\\sum_j w_{ij} \\nabla^3 d_j\\right\\| \\leq \\left(\\sum_j w_{ij}\\right) \\cdot C_{d,3} \\varepsilon_d^{-2} = C_{d,3} \\varepsilon_d^{-2}\n1206: $$\n1207: \n1208: (using normalization $\\sum_j w_{ij} = 1$)\n1209: \n1210: **Term 2**: $3 \\sum_j (\\nabla w_{ij})(\\nabla^2 d_j)$\n1211: $$\n1212: \\left\\|\\sum_j (\\nabla w_{ij})(\\nabla^2 d_j)\\right\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\sum_j \\|\\nabla w_{ij}\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\cdot \\frac{C_{\\nabla K}(\\rho)}{\\rho} \\cdot k_{\\text{eff}}^{(\\rho)}\n1213: $$\n1214: \n1215: where $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ is k-uniform (exponential localization of Gaussian weights).\n1216: \n1217: **Term 3**: $3 \\sum_j (\\nabla^2 w_{ij})(\\nabla d_j)$\n1218: $$\n1219: \\left\\|\\sum_j (\\nabla^2 w_{ij})(\\nabla d_j)\\right\\| \\leq C_{d,1} \\sum_j \\|\\nabla^2 w_{ij}\\| \\leq C_{d,1} \\cdot \\frac{C_{\\nabla^2 K}(\\rho)}{\\rho^2} \\cdot k_{\\text{eff}}^{(\\rho)}\n1220: $$\n1221: \n1222: **Term 4**: $\\sum_j (\\nabla^3 w_{ij}) d_j$\n1223: \n1224: Apply telescoping identity $\\sum_j \\nabla^3 w_{ij} = 0$:\n1225: $$\n1226: \\sum_j (\\nabla^3 w_{ij}) d_j = \\sum_j (\\nabla^3 w_{ij})(d_j - d_i)\n1227: $$\n1228: \n1229: By exponential localization, $\\|\\nabla^3 w_{ij}\\|$ is significant only for $j$ with $d_{\\text{alg}}(i,j) = O(\\rho)$. For such $j$:\n1230: $$\n1231: |d_j - d_i| \\leq 2D_{\\max} \\quad \\text{(worst case)}\n1232: $$\n1233: \n1234: Therefore:\n1235: $$\n1236: \\left\\|\\sum_j (\\nabla^3 w_{ij}) d_j\\right\\| \\leq D_{\\max} \\sum_j \\|\\nabla^3 w_{ij}\\| \\leq D_{\\max} \\cdot C_{w,3}(\\rho) \\cdot k_{\\text{eff}}^{(\\rho)}\n1237: $$\n1238: \n1239: **Step 4: Combine and absorb $k_{\\text{eff}}^{(\\rho)}$ into constants.**\n1240: \n1241: \n1242: Since $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ is k-uniform, we can absorb it into the constants:\n1243: $$\n1244: \\begin{aligned}\n1245: \\|\\nabla^3 \\mu_\\rho^{(i)}\\| &\\leq C_{d,3} \\varepsilon_d^{-2} + 3 C_{d,2} \\varepsilon_d^{-1} \\frac{C_{\\nabla K}(\\rho)}{\\rho} k_{\\text{eff}}^{(\\rho)} \\\\\n1246: &\\quad + 3 C_{d,1} \\frac{C_{\\nabla^2 K}(\\rho)}{\\rho^2} k_{\\text{eff}}^{(\\rho)} + D_{\\max} C_{w,3}(\\rho) k_{\\text{eff}}^{(\\rho)}\n1247: \\end{aligned}\n1248: \n1249: \n1250: where the bound has been split into:\n1251: 1. **First term** ($C_{d,3} \\varepsilon_d^{-2}$): From $\\sum_j w_{ij} \\nabla^3 d_j$ with normalization $\\sum_j w_{ij} = 1$ (no $k_{\\text{eff}}$ factor)\n1252: 2. **Remaining terms**: From weight-derivative products, each scaled by $k_{\\text{eff}}^{(\\rho)} \\leq C_{\\text{vol}} \\rho_{\\max} \\rho^{2d}$\n1253: \n1254: Substituting $k_{\\text{eff}}^{(\\rho)} \\leq C_{\\text{vol}} \\rho_{\\max} \\rho^{2d}$ into the bound matches the definition of $K_{\\mu,3}$ from the lemma statement (equation in §5.1 header), which keeps the $\\rho^{-1}, \\rho^{-2}, \\rho^{-3}$ factors explicit:\n1255: $$\n1256: K_{\\mu,3}(\\rho, \\varepsilon_d, \\varepsilon_c) = C_{d,3} \\varepsilon_d^{-2} + 6 C_{d,2} \\varepsilon_d^{-1} \\frac{C_{\\nabla K}(\\rho)}{\\rho} C_{\\text{vol}} \\rho_{\\max} \\rho^{2d} + \\cdots\n1257: $$\n1258: \n1259: This gives $K_{\\mu,3} = O(\\varepsilon_d^{-2}) + O(\\rho^{2d-1}) + O(\\rho^{2d-2}) + O(\\rho^{2d-3})$, which matches Document 20's $m=3$ scaling.\n1260: $$\n1261: \n1262: **Step 5: Verify k-uniformity.**\n1263: \n1264: Each component:\n1265: - $C_{d,3}$, $C_{d,2}$, $C_{d,1}$: k-uniform by derivative locality (Lemma {prf:ref}`lem-derivative-locality-c3`)\n1266: - Weight bounds $C_{\\nabla K}$, $C_{\\nabla^2 K}$, $C_{w,3}$: k-uniform (kernel derivatives independent of $k$)\n1267: - $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$: k-uniform (depends only on $\\rho$ and dimension $d$)",
      "metadata": {
        "label": "proof-lem-mean-third-derivative"
      },
      "section": "## 5. Third Derivatives of Localized Moments",
      "references": [
        "lem-derivative-locality-c3",
        "lem-self-measurement-derivatives"
      ],
      "raw_directive": "1168: :::\n1169: \n1170: :::{prf:proof}\n1171: :label: proof-lem-mean-third-derivative\n1172: \n1173: **Overview**: Unlike the simplified model, companion-dependent measurements $d_j$ depend on $x_i$ for ALL walkers $j$ (via softmax coupling). We apply Leibniz rule to all products $w_{ij} \\cdot d_j$, using **derivative locality** (§2.5.4) to maintain k-uniformity.\n1174: \n1175: **Step 1: Product rule for all terms.**\n1176: \n1177: The mean is $\\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j$ where $d_j = \\mathbb{E}[d_{\\text{alg}}(j, c(j))]$. Apply Leibniz rule for third derivatives:\n1178: $$\n1179: \\nabla^3_{x_i} [w_{ij} \\cdot d_j] = \\sum_{k=0}^{3} \\binom{3}{k} (\\nabla^k_{x_i} w_{ij}) \\cdot (\\nabla^{3-k}_{x_i} d_j)\n1180: $$\n1181: \n1182: Expanding all four terms:\n1183: $$\n1184: \\nabla^3_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\left[w_{ij} \\nabla^3 d_j + 3(\\nabla w_{ij})(\\nabla^2 d_j) + 3(\\nabla^2 w_{ij})(\\nabla d_j) + (\\nabla^3 w_{ij}) d_j\\right]\n1185: $$\n1186: \n1187: **Step 2: Apply derivative bounds for ALL j.**\n1188: \n1189: **For j ≠ i**: From Lemma {prf:ref}`lem-derivative-locality-c3` (derivative locality):\n1190: - $\\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform due to derivative locality)\n1191: \n1192: **For j = i**: From Lemma {prf:ref}`lem-self-measurement-derivatives` (self-measurement):\n1193: - $\\|\\nabla^3_{x_i} d_i\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform due to normalization $\\sum_{\\ell} P_{i\\ell} = 1$)\n1194: \n1195: **Key Result**: Despite different mechanisms (derivative locality for j≠i, expectation normalization for j=i), BOTH cases give the **same k-uniform bound** with the **same constant** $C_{d,3}$.\n1196: \n1197: Therefore, for all $j \\in \\mathcal{A}$:\n1198: - $\\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2}$ (k-uniform)\n1199: - $\\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1}$ (k-uniform)\n1200: - $\\|\\nabla_{x_i} d_j\\| \\leq C_{d,1}$ (k-uniform)\n1201: - $|d_j| \\leq D_{\\max}$ (bounded by diameter)\n1202: \n1203: **Term 1**: $\\sum_j w_{ij} \\nabla^3 d_j$\n1204: $$\n1205: \\left\\|\\sum_j w_{ij} \\nabla^3 d_j\\right\\| \\leq \\left(\\sum_j w_{ij}\\right) \\cdot C_{d,3} \\varepsilon_d^{-2} = C_{d,3} \\varepsilon_d^{-2}\n1206: $$\n1207: \n1208: (using normalization $\\sum_j w_{ij} = 1$)\n1209: \n1210: **Term 2**: $3 \\sum_j (\\nabla w_{ij})(\\nabla^2 d_j)$\n1211: $$\n1212: \\left\\|\\sum_j (\\nabla w_{ij})(\\nabla^2 d_j)\\right\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\sum_j \\|\\nabla w_{ij}\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\cdot \\frac{C_{\\nabla K}(\\rho)}{\\rho} \\cdot k_{\\text{eff}}^{(\\rho)}\n1213: $$\n1214: \n1215: where $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ is k-uniform (exponential localization of Gaussian weights).\n1216: \n1217: **Term 3**: $3 \\sum_j (\\nabla^2 w_{ij})(\\nabla d_j)$\n1218: $$\n1219: \\left\\|\\sum_j (\\nabla^2 w_{ij})(\\nabla d_j)\\right\\| \\leq C_{d,1} \\sum_j \\|\\nabla^2 w_{ij}\\| \\leq C_{d,1} \\cdot \\frac{C_{\\nabla^2 K}(\\rho)}{\\rho^2} \\cdot k_{\\text{eff}}^{(\\rho)}\n1220: $$\n1221: \n1222: **Term 4**: $\\sum_j (\\nabla^3 w_{ij}) d_j$\n1223: \n1224: Apply telescoping identity $\\sum_j \\nabla^3 w_{ij} = 0$:\n1225: $$\n1226: \\sum_j (\\nabla^3 w_{ij}) d_j = \\sum_j (\\nabla^3 w_{ij})(d_j - d_i)\n1227: $$\n1228: \n1229: By exponential localization, $\\|\\nabla^3 w_{ij}\\|$ is significant only for $j$ with $d_{\\text{alg}}(i,j) = O(\\rho)$. For such $j$:\n1230: $$\n1231: |d_j - d_i| \\leq 2D_{\\max} \\quad \\text{(worst case)}\n1232: $$\n1233: \n1234: Therefore:\n1235: $$\n1236: \\left\\|\\sum_j (\\nabla^3 w_{ij}) d_j\\right\\| \\leq D_{\\max} \\sum_j \\|\\nabla^3 w_{ij}\\| \\leq D_{\\max} \\cdot C_{w,3}(\\rho) \\cdot k_{\\text{eff}}^{(\\rho)}\n1237: $$\n1238: \n1239: **Step 4: Combine and absorb $k_{\\text{eff}}^{(\\rho)}$ into constants.**\n1240: \n1241: \n1242: Since $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ is k-uniform, we can absorb it into the constants:\n1243: $$\n1244: \\begin{aligned}\n1245: \\|\\nabla^3 \\mu_\\rho^{(i)}\\| &\\leq C_{d,3} \\varepsilon_d^{-2} + 3 C_{d,2} \\varepsilon_d^{-1} \\frac{C_{\\nabla K}(\\rho)}{\\rho} k_{\\text{eff}}^{(\\rho)} \\\\\n1246: &\\quad + 3 C_{d,1} \\frac{C_{\\nabla^2 K}(\\rho)}{\\rho^2} k_{\\text{eff}}^{(\\rho)} + D_{\\max} C_{w,3}(\\rho) k_{\\text{eff}}^{(\\rho)}\n1247: \\end{aligned}\n1248: \n1249: \n1250: where the bound has been split into:\n1251: 1. **First term** ($C_{d,3} \\varepsilon_d^{-2}$): From $\\sum_j w_{ij} \\nabla^3 d_j$ with normalization $\\sum_j w_{ij} = 1$ (no $k_{\\text{eff}}$ factor)\n1252: 2. **Remaining terms**: From weight-derivative products, each scaled by $k_{\\text{eff}}^{(\\rho)} \\leq C_{\\text{vol}} \\rho_{\\max} \\rho^{2d}$\n1253: \n1254: Substituting $k_{\\text{eff}}^{(\\rho)} \\leq C_{\\text{vol}} \\rho_{\\max} \\rho^{2d}$ into the bound matches the definition of $K_{\\mu,3}$ from the lemma statement (equation in §5.1 header), which keeps the $\\rho^{-1}, \\rho^{-2}, \\rho^{-3}$ factors explicit:\n1255: $$\n1256: K_{\\mu,3}(\\rho, \\varepsilon_d, \\varepsilon_c) = C_{d,3} \\varepsilon_d^{-2} + 6 C_{d,2} \\varepsilon_d^{-1} \\frac{C_{\\nabla K}(\\rho)}{\\rho} C_{\\text{vol}} \\rho_{\\max} \\rho^{2d} + \\cdots\n1257: $$\n1258: \n1259: This gives $K_{\\mu,3} = O(\\varepsilon_d^{-2}) + O(\\rho^{2d-1}) + O(\\rho^{2d-2}) + O(\\rho^{2d-3})$, which matches Document 20's $m=3$ scaling.\n1260: $$\n1261: \n1262: **Step 5: Verify k-uniformity.**\n1263: \n1264: Each component:\n1265: - $C_{d,3}$, $C_{d,2}$, $C_{d,1}$: k-uniform by derivative locality (Lemma {prf:ref}`lem-derivative-locality-c3`)\n1266: - Weight bounds $C_{\\nabla K}$, $C_{\\nabla^2 K}$, $C_{w,3}$: k-uniform (kernel derivatives independent of $k$)\n1267: - $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$: k-uniform (depends only on $\\rho$ and dimension $d$)\n1268: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Third Derivatives of Localized Moments"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-patch-chain-rule",
      "title": null,
      "start_line": 1459,
      "end_line": 1491,
      "header_lines": [
        1460
      ],
      "content_start": 1462,
      "content_end": 1490,
      "content": "1462: :label: proof-lem-patch-chain-rule\n1463: \n1464: This is a direct application of the multivariable chain rule for third derivatives. The composition $h = \\sigma\\'_{\\text{reg}} \\circ V$ requires:\n1465: \n1466: **First derivative:**\n1467: $$\n1468: \\nabla h = (\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla V\n1469: $$\n1470: \n1471: **Second derivative:**\n1472: $$\n1473: \\nabla^2 h = (\\sigma\\'_{\\text{reg}})''(V) \\cdot (\\nabla V) \\otimes (\\nabla V) + (\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^2 V\n1474: $$\n1475: \n1476: **Third derivative:**\n1477: \n1478: Differentiate the second derivative expression:\n1479: $$\n1480: \\nabla^3 h = \\nabla[(\\sigma\\'_{\\text{reg}})''(V) \\cdot (\\nabla V)^2] + \\nabla[(\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^2 V]\n1481: $$\n1482: \n1483: The first term gives $(\\sigma\\'_{\\text{reg}})''(V) \\cdot [(\\nabla V)^3 + \\text{mixed terms}]$ after applying the product rule.\n1484: \n1485: The second term gives $(\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^3 V$ plus lower-order cross-terms.\n1486: \n1487: Taking the norm and using the bounds:\n1488: $$\n1489: \\|\\nabla^3 h\\| \\le L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot \\|\\nabla V\\|^3 + 3 L_{\\sigma\\'_{\\text{reg}}} \\cdot \\|\\nabla V\\| \\cdot \\|\\nabla^2 V\\| + L_{\\sigma\\'_{\\text{reg}}} \\cdot \\|\\nabla^3 V\\|\n1490: $$",
      "metadata": {
        "label": "proof-lem-patch-chain-rule"
      },
      "section": "## 6. Third Derivatives of Regularized Standard Deviation",
      "references": [],
      "raw_directive": "1459: :::\n1460: \n1461: :::{prf:proof}\n1462: :label: proof-lem-patch-chain-rule\n1463: \n1464: This is a direct application of the multivariable chain rule for third derivatives. The composition $h = \\sigma\\'_{\\text{reg}} \\circ V$ requires:\n1465: \n1466: **First derivative:**\n1467: $$\n1468: \\nabla h = (\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla V\n1469: $$\n1470: \n1471: **Second derivative:**\n1472: $$\n1473: \\nabla^2 h = (\\sigma\\'_{\\text{reg}})''(V) \\cdot (\\nabla V) \\otimes (\\nabla V) + (\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^2 V\n1474: $$\n1475: \n1476: **Third derivative:**\n1477: \n1478: Differentiate the second derivative expression:\n1479: $$\n1480: \\nabla^3 h = \\nabla[(\\sigma\\'_{\\text{reg}})''(V) \\cdot (\\nabla V)^2] + \\nabla[(\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^2 V]\n1481: $$\n1482: \n1483: The first term gives $(\\sigma\\'_{\\text{reg}})''(V) \\cdot [(\\nabla V)^3 + \\text{mixed terms}]$ after applying the product rule.\n1484: \n1485: The second term gives $(\\sigma\\'_{\\text{reg}})'(V) \\cdot \\nabla^3 V$ plus lower-order cross-terms.\n1486: \n1487: Taking the norm and using the bounds:\n1488: $$\n1489: \\|\\nabla^3 h\\| \\le L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot \\|\\nabla V\\|^3 + 3 L_{\\sigma\\'_{\\text{reg}}} \\cdot \\|\\nabla V\\| \\cdot \\|\\nabla^2 V\\| + L_{\\sigma\\'_{\\text{reg}}} \\cdot \\|\\nabla^3 V\\|\n1490: $$\n1491: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 6. Third Derivatives of Regularized Standard Deviation"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-patch-third-derivative",
      "title": null,
      "start_line": 1506,
      "end_line": 1510,
      "header_lines": [
        1507
      ],
      "content_start": 1509,
      "content_end": 1509,
      "content": "1509: :label: proof-lem-patch-third-derivative",
      "metadata": {
        "label": "proof-lem-patch-third-derivative"
      },
      "section": "## 6. Third Derivatives of Regularized Standard Deviation",
      "references": [
        "lem-patch-chain-rule"
      ],
      "raw_directive": "1506: :::\n1507: \n1508: :::{prf:proof}\n1509: :label: proof-lem-patch-third-derivative\n1510: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 6. Third Derivatives of Regularized Standard Deviation"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-zscore-third-derivative",
      "title": null,
      "start_line": 1551,
      "end_line": 1664,
      "header_lines": [
        1552
      ],
      "content_start": 1554,
      "content_end": 1663,
      "content": "1554: :label: proof-lem-zscore-third-derivative\n1555: \n1556: **Step 1: Quotient rule for third derivative.**\n1557: \n1558: For the quotient $Z = u/v$ where $u = d_i - \\mu_\\rho^{(i)}$ and $v = \\sigma'_{\\rho}^{(i)}$, the third derivative is:\n1559: $$\n1560: \\nabla^3 Z = \\frac{1}{v} \\left[\\nabla^3 u - 3 \\frac{\\nabla u \\otimes \\nabla^2 v}{v} - 3 \\frac{\\nabla^2 u \\otimes \\nabla v}{v} + 6 \\frac{\\nabla u \\otimes (\\nabla v)^2}{v^2} - \\frac{u \\nabla^3 v}{v}\\right] + O(v^{-4})\n1561: $$\n1562: \n1563: The $O(v^{-4})$ terms involve higher powers of $1/v$ with lower-order derivatives.\n1564: \n1565: **Step 2: Bounds on numerator derivatives.**\n1566: \n1567: The numerator is $u(x_i) = d(x_i) - \\mu_\\rho^{(i)}$.\n1568: \n1569: **First derivative:**\n1570: $$\n1571: \\nabla u = \\nabla d(x_i) - \\nabla \\mu_\\rho^{(i)}\n1572: $$\n1573: \n1574: Bound:\n1575: $$\n1576: \\|\\nabla u\\| \\le d'_{\\max} + C_{\\mu,\\nabla}(\\rho) =: C_{u,\\nabla}(\\rho)\n1577: $$\n1578: \n1579: **Second derivative:**\n1580: $$\n1581: \\nabla^2 u = \\nabla^2 d(x_i) - \\nabla^2 \\mu_\\rho^{(i)}\n1582: $$\n1583: \n1584: Bound:\n1585: $$\n1586: \\|\\nabla^2 u\\| \\le d''_{\\max} + C_{\\mu,\\nabla^2}(\\rho) =: C_{u,\\nabla^2}(\\rho)\n1587: $$\n1588: \n1589: **Third derivative:**\n1590: $$\n1591: \\nabla^3 u = \\nabla^3 d(x_i) - \\nabla^3 \\mu_\\rho^{(i)}\n1592: $$\n1593: \n1594: Bound (using Lemma {prf:ref}`lem-mean-third-derivative`):\n1595: $$\n1596: \\|\\nabla^3 u\\| \\le d'''_{\\max} + C_{\\mu,\\nabla^3}(\\rho) =: C_{u,\\nabla^3}(\\rho)\n1597: $$\n1598: \n1599: **Step 3: Bounds on denominator derivatives.**\n1600: \n1601: The denominator is $v(x_i) = \\sigma'_{\\rho}^{(i)} = \\sigma\\'_{\\text{reg}}(V_\\rho^{(i)})$.\n1602: \n1603: **Lower bound (crucial):**\n1604: $$\n1605: v(x_i) \\ge \\sigma\\'_{\\min} > 0\n1606: $$\n1607: \n1608: This comes from Assumption {prf:ref}`assump-c3-patch` and ensures all powers of $1/v$ are bounded.\n1609: \n1610: **First derivative:**\n1611: $$\n1612: \\|\\nabla v\\| \\le C_{v,\\nabla}(\\rho) := L_{\\sigma\\'_{\\text{reg}}} \\cdot C_{V,\\nabla}(\\rho)\n1613: $$\n1614: \n1615: **Second derivative:**\n1616: $$\n1617: \\|\\nabla^2 v\\| \\le C_{v,\\nabla^2}(\\rho) := L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot (C_{V,\\nabla}(\\rho))^2 + L_{\\sigma\\'_{\\text{reg}}} \\cdot C_{V,\\nabla^2}(\\rho)\n1618: $$\n1619: \n1620: **Third derivative (from Lemma {prf:ref}`lem-patch-third-derivative`):**\n1621: $$\n1622: \\|\\nabla^3 v\\| \\le C_{v,\\nabla^3}(\\rho)\n1623: $$\n1624: \n1625: **Step 4: Bound each term in the quotient rule.**\n1626: \n1627: **Term 1:** $|\\nabla^3 u / v|$\n1628: $$\n1629: \\left\\|\\frac{\\nabla^3 u}{v}\\right\\| \\le \\frac{C_{u,\\nabla^3}(\\rho)}{\\sigma\\'_{\\min}}\n1630: $$\n1631: \n1632: **Term 2:** $|3\\nabla u \\otimes \\nabla^2 v / v^2|$\n1633: $$\n1634: \\left\\|\\frac{3\\nabla u \\otimes \\nabla^2 v}{v^2}\\right\\| \\le \\frac{3 C_{u,\\nabla}(\\rho) \\cdot C_{v,\\nabla^2}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1635: $$\n1636: \n1637: **Term 3:** $|3\\nabla^2 u \\otimes \\nabla v / v^2|$\n1638: $$\n1639: \\left\\|\\frac{3\\nabla^2 u \\otimes \\nabla v}{v^2}\\right\\| \\le \\frac{3 C_{u,\\nabla^2}(\\rho) \\cdot C_{v,\\nabla}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1640: $$\n1641: \n1642: **Term 4:** $|6\\nabla u \\otimes (\\nabla v)^2 / v^3|$\n1643: $$\n1644: \\left\\|\\frac{6\\nabla u \\otimes (\\nabla v)^2}{v^3}\\right\\| \\le \\frac{6 C_{u,\\nabla}(\\rho) \\cdot (C_{v,\\nabla}(\\rho))^2}{(\\sigma\\'_{\\min})^3}\n1645: $$\n1646: \n1647: **Term 5:** $|u \\nabla^3 v / v^2|$\n1648: \n1649: Using $|u| = |d(x_i) - \\mu_\\rho^{(i)}| \\le d_{\\max} + C_{\\mu,\\nabla}(\\rho)$:\n1650: $$\n1651: \\left\\|\\frac{u \\nabla^3 v}{v^2}\\right\\| \\le \\frac{(d_{\\max} + C_{\\mu,\\nabla}(\\rho)) \\cdot C_{v,\\nabla^3}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1652: $$\n1653: \n1654: **Step 5: Combine terms.**\n1655: \n1656: Summing all contributions and extracting the dominant factor $1/\\sigma\\'_{\\min}$:\n1657: $$\n1658: K_{Z,3}(\\rho) = \\frac{1}{\\sigma\\'_{\\min}} \\left[C_{u,\\nabla^3}(\\rho) + 3 C_{u,\\nabla}(\\rho) C_{v,\\nabla^2}(\\rho) + 3 C_{u,\\nabla^2}(\\rho) C_{v,\\nabla}(\\rho) + 6 C_{u,\\nabla}(\\rho) (C_{v,\\nabla}(\\rho))^2 + (d_{\\max} + C_{\\mu,\\nabla}(\\rho)) C_{v,\\nabla^3}(\\rho)\\right]\n1659: $$\n1660: \n1661: (Here we've absorbed factors of $1/\\sigma\\'_{\\min}$ from higher powers of $v$ into the leading factor.)\n1662: \n1663: **Step 6: k-uniformity.**",
      "metadata": {
        "label": "proof-lem-zscore-third-derivative"
      },
      "section": "## 7. Third Derivative of the Z-Score",
      "references": [
        "lem-mean-third-derivative",
        "assump-c3-patch",
        "lem-patch-third-derivative"
      ],
      "raw_directive": "1551: :::\n1552: \n1553: :::{prf:proof}\n1554: :label: proof-lem-zscore-third-derivative\n1555: \n1556: **Step 1: Quotient rule for third derivative.**\n1557: \n1558: For the quotient $Z = u/v$ where $u = d_i - \\mu_\\rho^{(i)}$ and $v = \\sigma'_{\\rho}^{(i)}$, the third derivative is:\n1559: $$\n1560: \\nabla^3 Z = \\frac{1}{v} \\left[\\nabla^3 u - 3 \\frac{\\nabla u \\otimes \\nabla^2 v}{v} - 3 \\frac{\\nabla^2 u \\otimes \\nabla v}{v} + 6 \\frac{\\nabla u \\otimes (\\nabla v)^2}{v^2} - \\frac{u \\nabla^3 v}{v}\\right] + O(v^{-4})\n1561: $$\n1562: \n1563: The $O(v^{-4})$ terms involve higher powers of $1/v$ with lower-order derivatives.\n1564: \n1565: **Step 2: Bounds on numerator derivatives.**\n1566: \n1567: The numerator is $u(x_i) = d(x_i) - \\mu_\\rho^{(i)}$.\n1568: \n1569: **First derivative:**\n1570: $$\n1571: \\nabla u = \\nabla d(x_i) - \\nabla \\mu_\\rho^{(i)}\n1572: $$\n1573: \n1574: Bound:\n1575: $$\n1576: \\|\\nabla u\\| \\le d'_{\\max} + C_{\\mu,\\nabla}(\\rho) =: C_{u,\\nabla}(\\rho)\n1577: $$\n1578: \n1579: **Second derivative:**\n1580: $$\n1581: \\nabla^2 u = \\nabla^2 d(x_i) - \\nabla^2 \\mu_\\rho^{(i)}\n1582: $$\n1583: \n1584: Bound:\n1585: $$\n1586: \\|\\nabla^2 u\\| \\le d''_{\\max} + C_{\\mu,\\nabla^2}(\\rho) =: C_{u,\\nabla^2}(\\rho)\n1587: $$\n1588: \n1589: **Third derivative:**\n1590: $$\n1591: \\nabla^3 u = \\nabla^3 d(x_i) - \\nabla^3 \\mu_\\rho^{(i)}\n1592: $$\n1593: \n1594: Bound (using Lemma {prf:ref}`lem-mean-third-derivative`):\n1595: $$\n1596: \\|\\nabla^3 u\\| \\le d'''_{\\max} + C_{\\mu,\\nabla^3}(\\rho) =: C_{u,\\nabla^3}(\\rho)\n1597: $$\n1598: \n1599: **Step 3: Bounds on denominator derivatives.**\n1600: \n1601: The denominator is $v(x_i) = \\sigma'_{\\rho}^{(i)} = \\sigma\\'_{\\text{reg}}(V_\\rho^{(i)})$.\n1602: \n1603: **Lower bound (crucial):**\n1604: $$\n1605: v(x_i) \\ge \\sigma\\'_{\\min} > 0\n1606: $$\n1607: \n1608: This comes from Assumption {prf:ref}`assump-c3-patch` and ensures all powers of $1/v$ are bounded.\n1609: \n1610: **First derivative:**\n1611: $$\n1612: \\|\\nabla v\\| \\le C_{v,\\nabla}(\\rho) := L_{\\sigma\\'_{\\text{reg}}} \\cdot C_{V,\\nabla}(\\rho)\n1613: $$\n1614: \n1615: **Second derivative:**\n1616: $$\n1617: \\|\\nabla^2 v\\| \\le C_{v,\\nabla^2}(\\rho) := L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot (C_{V,\\nabla}(\\rho))^2 + L_{\\sigma\\'_{\\text{reg}}} \\cdot C_{V,\\nabla^2}(\\rho)\n1618: $$\n1619: \n1620: **Third derivative (from Lemma {prf:ref}`lem-patch-third-derivative`):**\n1621: $$\n1622: \\|\\nabla^3 v\\| \\le C_{v,\\nabla^3}(\\rho)\n1623: $$\n1624: \n1625: **Step 4: Bound each term in the quotient rule.**\n1626: \n1627: **Term 1:** $|\\nabla^3 u / v|$\n1628: $$\n1629: \\left\\|\\frac{\\nabla^3 u}{v}\\right\\| \\le \\frac{C_{u,\\nabla^3}(\\rho)}{\\sigma\\'_{\\min}}\n1630: $$\n1631: \n1632: **Term 2:** $|3\\nabla u \\otimes \\nabla^2 v / v^2|$\n1633: $$\n1634: \\left\\|\\frac{3\\nabla u \\otimes \\nabla^2 v}{v^2}\\right\\| \\le \\frac{3 C_{u,\\nabla}(\\rho) \\cdot C_{v,\\nabla^2}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1635: $$\n1636: \n1637: **Term 3:** $|3\\nabla^2 u \\otimes \\nabla v / v^2|$\n1638: $$\n1639: \\left\\|\\frac{3\\nabla^2 u \\otimes \\nabla v}{v^2}\\right\\| \\le \\frac{3 C_{u,\\nabla^2}(\\rho) \\cdot C_{v,\\nabla}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1640: $$\n1641: \n1642: **Term 4:** $|6\\nabla u \\otimes (\\nabla v)^2 / v^3|$\n1643: $$\n1644: \\left\\|\\frac{6\\nabla u \\otimes (\\nabla v)^2}{v^3}\\right\\| \\le \\frac{6 C_{u,\\nabla}(\\rho) \\cdot (C_{v,\\nabla}(\\rho))^2}{(\\sigma\\'_{\\min})^3}\n1645: $$\n1646: \n1647: **Term 5:** $|u \\nabla^3 v / v^2|$\n1648: \n1649: Using $|u| = |d(x_i) - \\mu_\\rho^{(i)}| \\le d_{\\max} + C_{\\mu,\\nabla}(\\rho)$:\n1650: $$\n1651: \\left\\|\\frac{u \\nabla^3 v}{v^2}\\right\\| \\le \\frac{(d_{\\max} + C_{\\mu,\\nabla}(\\rho)) \\cdot C_{v,\\nabla^3}(\\rho)}{(\\sigma\\'_{\\min})^2}\n1652: $$\n1653: \n1654: **Step 5: Combine terms.**\n1655: \n1656: Summing all contributions and extracting the dominant factor $1/\\sigma\\'_{\\min}$:\n1657: $$\n1658: K_{Z,3}(\\rho) = \\frac{1}{\\sigma\\'_{\\min}} \\left[C_{u,\\nabla^3}(\\rho) + 3 C_{u,\\nabla}(\\rho) C_{v,\\nabla^2}(\\rho) + 3 C_{u,\\nabla^2}(\\rho) C_{v,\\nabla}(\\rho) + 6 C_{u,\\nabla}(\\rho) (C_{v,\\nabla}(\\rho))^2 + (d_{\\max} + C_{\\mu,\\nabla}(\\rho)) C_{v,\\nabla^3}(\\rho)\\right]\n1659: $$\n1660: \n1661: (Here we've absorbed factors of $1/\\sigma\\'_{\\min}$ from higher powers of $v$ into the leading factor.)\n1662: \n1663: **Step 6: k-uniformity.**\n1664: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 7. Third Derivative of the Z-Score"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-c3-regularity",
      "title": null,
      "start_line": 1705,
      "end_line": 1788,
      "header_lines": [
        1706
      ],
      "content_start": 1708,
      "content_end": 1787,
      "content": "1708: :label: proof-thm-c3-regularity\n1709: \n1710: **Step 1: Chain rule for composition.**\n1711: \n1712: The fitness potential is $V_{\\text{fit}} = g_A \\circ Z_\\rho$, a composition of smooth functions. By the multivariable chain rule for third derivatives (see ρ2.4):\n1713: $$\n1714: \\nabla^3 V_{\\text{fit}} = g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3 + 3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho + g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\n1715: $$\n1716: \n1717: **Step 2: Bound each term.**\n1718: \n1719: **Term 1:** $|g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3|$\n1720: \n1721: By Assumption {prf:ref}`assump-c3-rescale`, $|g'''_A(z)| \\le L_{g'''_A}$ for all $z \\in \\mathbb{R}$.\n1722: \n1723: The first derivative of $Z_\\rho$ satisfies (from Appendix A of [11_geometric_gas.md](11_geometric_gas.md)):\n1724: $$\n1725: \\|\\nabla Z_\\rho\\| \\le K_{Z,1}(\\rho)\n1726: $$\n1727: \n1728: where $K_{Z,1}(\\rho)$ is the k-uniform bound from Theorem {prf:ref}`thm-c1-regularity`.\n1729: \n1730: Therefore:\n1731: $$\n1732: \\|g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3\\| \\le L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3\n1733: $$\n1734: \n1735: **Term 2:** $|3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho|$\n1736: \n1737: By Assumption {prf:ref}`assump-c3-rescale`, $|g''_A(z)| \\le L_{g''_A}$.\n1738: \n1739: The second derivative of $Z_\\rho$ satisfies (from Appendix A):\n1740: $$\n1741: \\|\\nabla^2 Z_\\rho\\| \\le K_{Z,2}(\\rho)\n1742: $$\n1743: \n1744: Therefore:\n1745: $$\n1746: \\|3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho\\| \\le 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho)\n1747: $$\n1748: \n1749: **Term 3:** $|g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho|$\n1750: \n1751: By Assumption {prf:ref}`assump-c3-rescale`, $|g'_A(z)| \\le L_{g'_A}$.\n1752: \n1753: The third derivative of $Z_\\rho$ satisfies (from Lemma {prf:ref}`lem-zscore-third-derivative`):\n1754: $$\n1755: \\|\\nabla^3 Z_\\rho\\| \\le K_{Z,3}(\\rho)\n1756: $$\n1757: \n1758: Therefore:\n1759: $$\n1760: \\|g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\\| \\le L_{g'_A} \\cdot K_{Z,3}(\\rho)\n1761: $$\n1762: \n1763: **Step 3: Combine bounds.**\n1764: \n1765: Summing the three terms:\n1766: $$\n1767: \\|\\nabla^3 V_{\\text{fit}}\\| \\le L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 + 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) + L_{g'_A} \\cdot K_{Z,3}(\\rho) =: K_{V,3}(\\rho)\n1768: $$\n1769: \n1770: **Step 4: k-uniformity.**\n1771: \n1772: Each constituent bound is k-uniform by the preceding lemmas:\n1773: - $K_{Z,1}(\\rho)$ is k-uniform (Theorem A.1 in [11_geometric_gas.md](11_geometric_gas.md))\n1774: - $K_{Z,2}(\\rho)$ is k-uniform (Theorem A.2 in [11_geometric_gas.md](11_geometric_gas.md))\n1775: - $K_{Z,3}(\\rho)$ is k-uniform (Lemma {prf:ref}`lem-zscore-third-derivative`)\n1776: \n1777: Therefore $K_{V,3}(\\rho)$ is k-uniform and N-uniform.\n1778: \n1779: **Step 5: Continuity of third derivatives.**\n1780: \n1781: The third derivative $\\nabla^3 V_{\\text{fit}}$ is a composition of continuous functions:\n1782: 1. The localization kernel $K_\\rho(x_i, x_j)$ is $C^3$ in $x_i$ (Assumption {prf:ref}`assump-c3-kernel`)\n1783: 2. The weights $w_{ij}(\\rho)$ are continuous in $(x_i, \\{x_j\\}_{j \\in A_k}, \\rho)$\n1784: 3. The moments $\\mu_\\rho, V_\\rho$ are continuous (weighted sums of continuous functions)\n1785: 4. The patched function $\\sigma\\'_{\\text{reg}}$ is $C^3$ (Assumption {prf:ref}`assump-c3-patch`)\n1786: 5. The Z-score is a quotient of continuous functions with positive denominator\n1787: 6. The rescale function $g_A$ is $C^3$ (Assumption {prf:ref}`assump-c3-rescale`)",
      "metadata": {
        "label": "proof-thm-c3-regularity"
      },
      "section": "## 8. Main $C^3$ Regularity Theorem",
      "references": [
        "assump-c3-rescale",
        "thm-c1-regularity",
        "lem-zscore-third-derivative",
        "assump-c3-kernel",
        "assump-c3-patch"
      ],
      "raw_directive": "1705: :::\n1706: \n1707: :::{prf:proof}\n1708: :label: proof-thm-c3-regularity\n1709: \n1710: **Step 1: Chain rule for composition.**\n1711: \n1712: The fitness potential is $V_{\\text{fit}} = g_A \\circ Z_\\rho$, a composition of smooth functions. By the multivariable chain rule for third derivatives (see ρ2.4):\n1713: $$\n1714: \\nabla^3 V_{\\text{fit}} = g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3 + 3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho + g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\n1715: $$\n1716: \n1717: **Step 2: Bound each term.**\n1718: \n1719: **Term 1:** $|g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3|$\n1720: \n1721: By Assumption {prf:ref}`assump-c3-rescale`, $|g'''_A(z)| \\le L_{g'''_A}$ for all $z \\in \\mathbb{R}$.\n1722: \n1723: The first derivative of $Z_\\rho$ satisfies (from Appendix A of [11_geometric_gas.md](11_geometric_gas.md)):\n1724: $$\n1725: \\|\\nabla Z_\\rho\\| \\le K_{Z,1}(\\rho)\n1726: $$\n1727: \n1728: where $K_{Z,1}(\\rho)$ is the k-uniform bound from Theorem {prf:ref}`thm-c1-regularity`.\n1729: \n1730: Therefore:\n1731: $$\n1732: \\|g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3\\| \\le L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3\n1733: $$\n1734: \n1735: **Term 2:** $|3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho|$\n1736: \n1737: By Assumption {prf:ref}`assump-c3-rescale`, $|g''_A(z)| \\le L_{g''_A}$.\n1738: \n1739: The second derivative of $Z_\\rho$ satisfies (from Appendix A):\n1740: $$\n1741: \\|\\nabla^2 Z_\\rho\\| \\le K_{Z,2}(\\rho)\n1742: $$\n1743: \n1744: Therefore:\n1745: $$\n1746: \\|3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho\\| \\le 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho)\n1747: $$\n1748: \n1749: **Term 3:** $|g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho|$\n1750: \n1751: By Assumption {prf:ref}`assump-c3-rescale`, $|g'_A(z)| \\le L_{g'_A}$.\n1752: \n1753: The third derivative of $Z_\\rho$ satisfies (from Lemma {prf:ref}`lem-zscore-third-derivative`):\n1754: $$\n1755: \\|\\nabla^3 Z_\\rho\\| \\le K_{Z,3}(\\rho)\n1756: $$\n1757: \n1758: Therefore:\n1759: $$\n1760: \\|g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\\| \\le L_{g'_A} \\cdot K_{Z,3}(\\rho)\n1761: $$\n1762: \n1763: **Step 3: Combine bounds.**\n1764: \n1765: Summing the three terms:\n1766: $$\n1767: \\|\\nabla^3 V_{\\text{fit}}\\| \\le L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 + 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) + L_{g'_A} \\cdot K_{Z,3}(\\rho) =: K_{V,3}(\\rho)\n1768: $$\n1769: \n1770: **Step 4: k-uniformity.**\n1771: \n1772: Each constituent bound is k-uniform by the preceding lemmas:\n1773: - $K_{Z,1}(\\rho)$ is k-uniform (Theorem A.1 in [11_geometric_gas.md](11_geometric_gas.md))\n1774: - $K_{Z,2}(\\rho)$ is k-uniform (Theorem A.2 in [11_geometric_gas.md](11_geometric_gas.md))\n1775: - $K_{Z,3}(\\rho)$ is k-uniform (Lemma {prf:ref}`lem-zscore-third-derivative`)\n1776: \n1777: Therefore $K_{V,3}(\\rho)$ is k-uniform and N-uniform.\n1778: \n1779: **Step 5: Continuity of third derivatives.**\n1780: \n1781: The third derivative $\\nabla^3 V_{\\text{fit}}$ is a composition of continuous functions:\n1782: 1. The localization kernel $K_\\rho(x_i, x_j)$ is $C^3$ in $x_i$ (Assumption {prf:ref}`assump-c3-kernel`)\n1783: 2. The weights $w_{ij}(\\rho)$ are continuous in $(x_i, \\{x_j\\}_{j \\in A_k}, \\rho)$\n1784: 3. The moments $\\mu_\\rho, V_\\rho$ are continuous (weighted sums of continuous functions)\n1785: 4. The patched function $\\sigma\\'_{\\text{reg}}$ is $C^3$ (Assumption {prf:ref}`assump-c3-patch`)\n1786: 5. The Z-score is a quotient of continuous functions with positive denominator\n1787: 6. The rescale function $g_A$ is $C^3$ (Assumption {prf:ref}`assump-c3-rescale`)\n1788: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 8. Main $C^3$ Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-prop-scaling-kv3",
      "title": null,
      "start_line": 1815,
      "end_line": 1849,
      "header_lines": [
        1816
      ],
      "content_start": 1818,
      "content_end": 1848,
      "content": "1818: :label: proof-prop-scaling-kv3\n1819: \n1820: **Step 1: Recall constituent bounds.** From the preceding lemmas and the corrected centered moment scaling:\n1821: - $K_{Z,1}(\\rho) = O(\\rho^{2d})$ (first derivative includes one factor of $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$)\n1822: - $K_{Z,2}(\\rho) = O(\\rho^{4d-2})$ (second derivative includes two factors, giving $\\rho^{2d \\cdot 2 - 2}$)\n1823: - $K_{Z,3}(\\rho) = O(\\rho^{6d-3})$ (third derivative from Lemma {prf:ref}`lem-zscore-third-derivative`, with three factors giving $\\rho^{2d \\cdot 3 - 3}$)\n1824: \n1825: These scalings follow from:\n1826: 1. Weight derivatives: $C_{w,m}(\\rho) = O(\\rho^{-m})$ for Gaussian kernel (Lemma {prf:ref}`lem-weight-third-derivative`)\n1827: 2. **Localized moment derivatives**: From Lemmas {prf:ref}`lem-mean-third-derivative` and {prf:ref}`lem-variance-third-derivative`, the dominant $\\rho$-scaling comes from the weight derivatives $C_{w,m}(\\rho) = O(\\rho^{-m})$. Using the explicit formulas:\n1828:    - $K_{\\mu,1}(\\rho)$ from Section 2.8: Terms with $C_{\\nabla K}(\\rho)/\\rho$ give $O(\\rho^{2d-1})$\n1829:    - $K_{\\mu,2}(\\rho)$ from Appendix A: Terms with $C_{\\nabla^2 K}(\\rho)/\\rho^2$ give $O(\\rho^{2d-2})$\n1830:    - $K_{\\mu,3}(\\rho)$: Terms with $C_{w,3}(\\rho) = O(\\rho^{-3})$ and $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ give $O(\\rho^{2d-3})$\n1831:    \n1832:    Therefore: $C_{\\mu,\\nabla^m}(\\rho) = O(\\rho^{2d-m})$ for the weight-derivative dominated terms, consistent with the centered telescoping mechanism.\n1833: 3. Quotient rule composition: $Z = (d - \\mu)/\\sigma'_{\\text{reg}}$ gives $K_{Z,m}$ from $C_{\\mu,\\nabla^m}$ and $C_{V,\\nabla^m}$\n1834: \n1835: **Step 2: Analyze the three terms in $K_{V,3}(\\rho)$ via Faà di Bruno.**\n1836: \n1837: Composing $V = g_A(Z_\\rho)$ gives three contributions:\n1838: \n1839: 1. **Cubic term:** $L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 = O(1) \\cdot O(\\rho^{2d})^3 = O(\\rho^{6d})$ (subdominant for $d > 1$, dominant for $d = 1/2$)\n1840: \n1841: 2. **Mixed term:** $3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) = O(1) \\cdot O(\\rho^{2d}) \\cdot O(\\rho^{4d-2}) = O(\\rho^{6d-2})$ (subdominant)\n1842: \n1843: 3. **Linear term:** $L_{g'_A} \\cdot K_{Z,3}(\\rho) = O(1) \\cdot O(\\rho^{6d-3}) = O(\\rho^{6d-3})$ **← DOMINANT** (smallest exponent on $\\rho$)\n1844: \n1845: **Step 3: Dominant scaling.** The linear term dominates for small $\\rho$ since it has the smallest exponent. Therefore:\n1846: $$\n1847: K_{V,3}(\\rho) = O(\\rho^{6d-3})\n1848: $$",
      "metadata": {
        "label": "proof-prop-scaling-kv3"
      },
      "section": "## 8. Main $C^3$ Regularity Theorem",
      "references": [
        "lem-zscore-third-derivative",
        "lem-weight-third-derivative",
        "lem-mean-third-derivative",
        "lem-variance-third-derivative"
      ],
      "raw_directive": "1815: :::\n1816: \n1817: :::{prf:proof}\n1818: :label: proof-prop-scaling-kv3\n1819: \n1820: **Step 1: Recall constituent bounds.** From the preceding lemmas and the corrected centered moment scaling:\n1821: - $K_{Z,1}(\\rho) = O(\\rho^{2d})$ (first derivative includes one factor of $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$)\n1822: - $K_{Z,2}(\\rho) = O(\\rho^{4d-2})$ (second derivative includes two factors, giving $\\rho^{2d \\cdot 2 - 2}$)\n1823: - $K_{Z,3}(\\rho) = O(\\rho^{6d-3})$ (third derivative from Lemma {prf:ref}`lem-zscore-third-derivative`, with three factors giving $\\rho^{2d \\cdot 3 - 3}$)\n1824: \n1825: These scalings follow from:\n1826: 1. Weight derivatives: $C_{w,m}(\\rho) = O(\\rho^{-m})$ for Gaussian kernel (Lemma {prf:ref}`lem-weight-third-derivative`)\n1827: 2. **Localized moment derivatives**: From Lemmas {prf:ref}`lem-mean-third-derivative` and {prf:ref}`lem-variance-third-derivative`, the dominant $\\rho$-scaling comes from the weight derivatives $C_{w,m}(\\rho) = O(\\rho^{-m})$. Using the explicit formulas:\n1828:    - $K_{\\mu,1}(\\rho)$ from Section 2.8: Terms with $C_{\\nabla K}(\\rho)/\\rho$ give $O(\\rho^{2d-1})$\n1829:    - $K_{\\mu,2}(\\rho)$ from Appendix A: Terms with $C_{\\nabla^2 K}(\\rho)/\\rho^2$ give $O(\\rho^{2d-2})$\n1830:    - $K_{\\mu,3}(\\rho)$: Terms with $C_{w,3}(\\rho) = O(\\rho^{-3})$ and $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ give $O(\\rho^{2d-3})$\n1831:    \n1832:    Therefore: $C_{\\mu,\\nabla^m}(\\rho) = O(\\rho^{2d-m})$ for the weight-derivative dominated terms, consistent with the centered telescoping mechanism.\n1833: 3. Quotient rule composition: $Z = (d - \\mu)/\\sigma'_{\\text{reg}}$ gives $K_{Z,m}$ from $C_{\\mu,\\nabla^m}$ and $C_{V,\\nabla^m}$\n1834: \n1835: **Step 2: Analyze the three terms in $K_{V,3}(\\rho)$ via Faà di Bruno.**\n1836: \n1837: Composing $V = g_A(Z_\\rho)$ gives three contributions:\n1838: \n1839: 1. **Cubic term:** $L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 = O(1) \\cdot O(\\rho^{2d})^3 = O(\\rho^{6d})$ (subdominant for $d > 1$, dominant for $d = 1/2$)\n1840: \n1841: 2. **Mixed term:** $3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) = O(1) \\cdot O(\\rho^{2d}) \\cdot O(\\rho^{4d-2}) = O(\\rho^{6d-2})$ (subdominant)\n1842: \n1843: 3. **Linear term:** $L_{g'_A} \\cdot K_{Z,3}(\\rho) = O(1) \\cdot O(\\rho^{6d-3}) = O(\\rho^{6d-3})$ **← DOMINANT** (smallest exponent on $\\rho$)\n1844: \n1845: **Step 3: Dominant scaling.** The linear term dominates for small $\\rho$ since it has the smallest exponent. Therefore:\n1846: $$\n1847: K_{V,3}(\\rho) = O(\\rho^{6d-3})\n1848: $$\n1849: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 8. Main $C^3$ Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-baoab-validity",
      "title": null,
      "start_line": 1878,
      "end_line": 1882,
      "header_lines": [
        1879
      ],
      "content_start": 1881,
      "content_end": 1881,
      "content": "1881: :label: proof-cor-baoab-validity",
      "metadata": {
        "label": "proof-cor-baoab-validity"
      },
      "section": "## 9. Stability Implications and Corollaries",
      "references": [
        "thm-c3-regularity"
      ],
      "raw_directive": "1878: :::\n1879: \n1880: :::{prf:proof}\n1881: :label: proof-cor-baoab-validity\n1882: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 9. Stability Implications and Corollaries"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-lyapunov-c3",
      "title": null,
      "start_line": 1909,
      "end_line": 1944,
      "header_lines": [
        1910
      ],
      "content_start": 1912,
      "content_end": 1943,
      "content": "1912: :label: proof-cor-lyapunov-c3\n1913: \n1914: **Step 1: Structure of $V_{\\text{total}}$.**\n1915: \n1916: From [11_geometric_gas.md](11_geometric_gas.md) Chapter 5, the total Lyapunov function is:\n1917: $$\n1918: V_{\\text{total}}(S) = V_{\\text{pos}}(S) + \\lambda_v V_{\\text{vel}}(S)\n1919: $$\n1920: \n1921: where:\n1922: - $V_{\\text{pos}}(S) = \\sum_{i=1}^N U(x_i) + \\frac{1}{N}\\sum_{i,j} \\|x_i - x_j\\|^2$ (position variances and confinement)\n1923: - $V_{\\text{vel}}(S) = \\sum_{i=1}^N \\|v_i\\|^2$ (kinetic energy)\n1924: \n1925: **Step 2: Third derivatives of each component.**\n1926: \n1927: **Position term:**\n1928: - The confining potential $U(x)$ is assumed smooth (typically quadratic or polynomial), so $U \\in C^3$ with bounded third derivatives.\n1929: - The pairwise distance term $\\|x_i - x_j\\|^2$ is a polynomial, hence $C^\\infty$.\n1930: \n1931: **Velocity term:**\n1932: - $V_{\\text{vel}}$ is quadratic in velocities, so $\\nabla^3_{v_i} V_{\\text{vel}} = 0$ (all third derivatives vanish).\n1933: \n1934: **Fitness contribution:**\n1935: - The adaptive force is $\\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla V_{\\text{fit}}[f_k, \\rho]$, which appears in the drift term of the SDE.\n1936: - The Foster-Lyapunov analysis involves $\\nabla V_{\\text{total}} \\cdot \\mathbf{F}_{\\text{adapt}}$, requiring up to second derivatives of $\\mathbf{F}_{\\text{adapt}}$, which are bounded by $\\epsilon_F K_{V,3}(\\rho)$.\n1937: \n1938: **Step 3: Combine bounds.**\n1939: \n1940: Since each component has bounded third derivatives, $V_{\\text{total}} \\in C^3$ with:\n1941: $$\n1942: K_{\\text{total},3} = \\max(\\|\\nabla^3 U\\|, \\|\\nabla^3 V_{\\text{fit}}\\|, 0) = \\max(\\|\\nabla^3 U\\|, K_{V,3}(\\rho))\n1943: $$",
      "metadata": {
        "label": "proof-cor-lyapunov-c3"
      },
      "section": "## 9. Stability Implications and Corollaries",
      "references": [],
      "raw_directive": "1909: :::\n1910: \n1911: :::{prf:proof}\n1912: :label: proof-cor-lyapunov-c3\n1913: \n1914: **Step 1: Structure of $V_{\\text{total}}$.**\n1915: \n1916: From [11_geometric_gas.md](11_geometric_gas.md) Chapter 5, the total Lyapunov function is:\n1917: $$\n1918: V_{\\text{total}}(S) = V_{\\text{pos}}(S) + \\lambda_v V_{\\text{vel}}(S)\n1919: $$\n1920: \n1921: where:\n1922: - $V_{\\text{pos}}(S) = \\sum_{i=1}^N U(x_i) + \\frac{1}{N}\\sum_{i,j} \\|x_i - x_j\\|^2$ (position variances and confinement)\n1923: - $V_{\\text{vel}}(S) = \\sum_{i=1}^N \\|v_i\\|^2$ (kinetic energy)\n1924: \n1925: **Step 2: Third derivatives of each component.**\n1926: \n1927: **Position term:**\n1928: - The confining potential $U(x)$ is assumed smooth (typically quadratic or polynomial), so $U \\in C^3$ with bounded third derivatives.\n1929: - The pairwise distance term $\\|x_i - x_j\\|^2$ is a polynomial, hence $C^\\infty$.\n1930: \n1931: **Velocity term:**\n1932: - $V_{\\text{vel}}$ is quadratic in velocities, so $\\nabla^3_{v_i} V_{\\text{vel}} = 0$ (all third derivatives vanish).\n1933: \n1934: **Fitness contribution:**\n1935: - The adaptive force is $\\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla V_{\\text{fit}}[f_k, \\rho]$, which appears in the drift term of the SDE.\n1936: - The Foster-Lyapunov analysis involves $\\nabla V_{\\text{total}} \\cdot \\mathbf{F}_{\\text{adapt}}$, requiring up to second derivatives of $\\mathbf{F}_{\\text{adapt}}$, which are bounded by $\\epsilon_F K_{V,3}(\\rho)$.\n1937: \n1938: **Step 3: Combine bounds.**\n1939: \n1940: Since each component has bounded third derivatives, $V_{\\text{total}} \\in C^3$ with:\n1941: $$\n1942: K_{\\text{total},3} = \\max(\\|\\nabla^3 U\\|, \\|\\nabla^3 V_{\\text{fit}}\\|, 0) = \\max(\\|\\nabla^3 U\\|, K_{V,3}(\\rho))\n1943: $$\n1944: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 9. Stability Implications and Corollaries"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-smooth-perturbation",
      "title": null,
      "start_line": 1962,
      "end_line": 1970,
      "header_lines": [
        1963
      ],
      "content_start": 1965,
      "content_end": 1969,
      "content": "1965: :label: proof-cor-smooth-perturbation\n1966: \n1967: The adaptive force is $\\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla V_{\\text{fit}}$. Differentiating:\n1968: - $\\nabla \\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla^2 V_{\\text{fit}}$: Bounded by $\\epsilon_F H_{\\max}(\\rho)$ (Theorem {prf:ref}`thm-c2-regularity`)\n1969: - $\\nabla^2 \\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla^3 V_{\\text{fit}}$: Bounded by $\\epsilon_F K_{V,3}(\\rho)$ (Theorem {prf:ref}`thm-c3-regularity`)",
      "metadata": {
        "label": "proof-cor-smooth-perturbation"
      },
      "section": "## 9. Stability Implications and Corollaries",
      "references": [
        "thm-c2-regularity",
        "thm-c3-regularity"
      ],
      "raw_directive": "1962: :::\n1963: \n1964: :::{prf:proof}\n1965: :label: proof-cor-smooth-perturbation\n1966: \n1967: The adaptive force is $\\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla V_{\\text{fit}}$. Differentiating:\n1968: - $\\nabla \\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla^2 V_{\\text{fit}}$: Bounded by $\\epsilon_F H_{\\max}(\\rho)$ (Theorem {prf:ref}`thm-c2-regularity`)\n1969: - $\\nabla^2 \\mathbf{F}_{\\text{adapt}} = \\epsilon_F \\nabla^3 V_{\\text{fit}}$: Bounded by $\\epsilon_F K_{V,3}(\\rho)$ (Theorem {prf:ref}`thm-c3-regularity`)\n1970: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 9. Stability Implications and Corollaries"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-prop-scaling-k-v-3",
      "title": null,
      "start_line": 2034,
      "end_line": 2111,
      "header_lines": [
        2035
      ],
      "content_start": 2037,
      "content_end": 2110,
      "content": "2037: :label: proof-prop-scaling-k-v-3\n2038: \n2039: **Step 1: Trace the ρ-dependence through the pipeline.**\n2040: \n2041: From Lemma {prf:ref}`lem-weight-third-derivative`:\n2042: $$\n2043: C_{w,3}(\\rho) = O(\\rho^{-3})\n2044: $$\n2045: \n2046: From Lemma {prf:ref}`lem-mean-third-derivative`, accounting for the $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ factor from summing over the effective neighborhood:\n2047: $$\n2048: C_{\\mu,\\nabla^3}(\\rho) = d'''_{\\max} + O(\\rho^{2d-2}) + O(\\rho^{2d-1}) + O(d_{\\max} \\rho^{2d-3})\n2049: $$\n2050: \n2051: For small $\\rho$, the dominant term is $O(\\rho^{2d-3})$.\n2052: \n2053: From Lemma {prf:ref}`lem-variance-third-derivative`:\n2054: $$\n2055: C_{V,\\nabla^3}(\\rho) = O(d_{\\max} d'''_{\\max}) + O(\\rho^{2d-2}) + O(\\rho^{2d-3})\n2056: $$\n2057: \n2058: For small $\\rho$, the dominant term is $O(\\rho^{2d-3})$.\n2059: \n2060: From Lemma {prf:ref}`lem-patch-third-derivative`:\n2061: $$\n2062: C_{v,\\nabla^3}(\\rho) = L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot O(\\rho^{2d-3}) + L_{\\sigma\\'_{\\text{reg}}} \\cdot O(\\rho^{2d-3}) = O(\\rho^{2d-3})\n2063: $$\n2064: \n2065: From Lemma {prf:ref}`lem-zscore-third-derivative`, combining through the quotient rule:\n2066: $$\n2067: K_{Z,3}(\\rho) = \\frac{1}{\\sigma\\'_{\\min}} \\left[O(\\rho^{6d-3}) + O(\\rho^{6d-5}) + O(\\rho^{6d-7})\\right] = O(\\rho^{6d-3})\n2068: $$\n2069: \n2070: (The structure $\\rho^{6d-3}$ arises from three applications of derivatives, each contributing a $\\rho^{2d-m}$ factor.)\n2071: \n2072: **Step 2: Combine via the chain rule.**\n2073: \n2074: From Theorem {prf:ref}`thm-c3-regularity`:\n2075: $$\n2076: K_{V,3}(\\rho) = L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 + 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) + L_{g'_A} \\cdot K_{Z,3}(\\rho)\n2077: $$\n2078: \n2079: Using the **corrected scalings** accounting for the $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ factor at each derivative order:\n2080: - $K_{Z,1}(\\rho) = O(\\rho^{2d})$ (first derivative includes one $k_{\\text{eff}}$ factor)\n2081: - $K_{Z,2}(\\rho) = O(\\rho^{4d-2})$ (second derivative includes two factors)\n2082: - $K_{Z,3}(\\rho) = O(\\rho^{6d-3})$ (third derivative includes three factors - Step 1)\n2083: \n2084: We have:\n2085: - Cubic term: $L_{g'''_A} \\cdot (K_{Z,1})^3 = O(1) \\cdot O(\\rho^{2d})^3 = O(\\rho^{6d})$ (dominant for $d > 1$, subdominant for small $\\rho$ when $d < 1/2$)\n2086: - Mixed term: $3 L_{g''_A} \\cdot K_{Z,1} \\cdot K_{Z,2} = O(1) \\cdot O(\\rho^{2d}) \\cdot O(\\rho^{4d-2}) = O(\\rho^{6d-2})$ (subdominant for small $\\rho$)\n2087: - Linear term: $L_{g'_A} \\cdot K_{Z,3} = O(1) \\cdot O(\\rho^{6d-3}) = O(\\rho^{6d-3})$ **← DOMINANT for small** $\\rho$ **(smallest exponent)**\n2088: \n2089: The **linear term dominates** for small $\\rho$ (smallest exponent on $\\rho$), giving:\n2090: $$\n2091: K_{V,3}(\\rho) = O(\\rho^{6d-3}) \\quad \\text{for } \\rho \\to 0\n2092: $$\n2093: \n2094: **Step 3: Global limit ($\\rho \\to \\infty$).**\n2095: \n2096: As $\\rho \\to \\infty$, the localization kernel becomes approximately uniform over the swarm:\n2097: $$\n2098: K_\\rho(x, x') \\to 1/|\\mathcal{X}|\n2099: $$\n2100: \n2101: In this limit:\n2102: - The weights $w_{ij}(\\rho) \\to 1/k$ (uniform over alive walkers)\n2103: - The derivatives $\\nabla w_{ij}(\\rho) \\to 0$ (no dependence on $x_i$)\n2104: - Higher-order derivatives $\\nabla^m w_{ij}(\\rho) \\to 0$ for $m \\ge 1$\n2105: \n2106: Thus:\n2107: - $C_{w,3}(\\rho) \\to 0$ as $\\rho \\to \\infty$\n2108: - $C_{\\mu,\\nabla^3}(\\rho) \\to d'''_{\\max}$ (only the direct derivative of $d(x_i)$ survives)\n2109: - $K_{Z,3}(\\rho) \\to O(1)$ (bounded by measurement function derivatives)\n2110: - $K_{V,3}(\\rho) \\to O(1)$",
      "metadata": {
        "label": "proof-prop-scaling-k-v-3"
      },
      "section": "## 10. ρ-Scaling Analysis and Numerical Considerations",
      "references": [
        "lem-weight-third-derivative",
        "lem-mean-third-derivative",
        "lem-variance-third-derivative",
        "lem-patch-third-derivative",
        "lem-zscore-third-derivative",
        "thm-c3-regularity"
      ],
      "raw_directive": "2034: :::\n2035: \n2036: :::{prf:proof}\n2037: :label: proof-prop-scaling-k-v-3\n2038: \n2039: **Step 1: Trace the ρ-dependence through the pipeline.**\n2040: \n2041: From Lemma {prf:ref}`lem-weight-third-derivative`:\n2042: $$\n2043: C_{w,3}(\\rho) = O(\\rho^{-3})\n2044: $$\n2045: \n2046: From Lemma {prf:ref}`lem-mean-third-derivative`, accounting for the $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ factor from summing over the effective neighborhood:\n2047: $$\n2048: C_{\\mu,\\nabla^3}(\\rho) = d'''_{\\max} + O(\\rho^{2d-2}) + O(\\rho^{2d-1}) + O(d_{\\max} \\rho^{2d-3})\n2049: $$\n2050: \n2051: For small $\\rho$, the dominant term is $O(\\rho^{2d-3})$.\n2052: \n2053: From Lemma {prf:ref}`lem-variance-third-derivative`:\n2054: $$\n2055: C_{V,\\nabla^3}(\\rho) = O(d_{\\max} d'''_{\\max}) + O(\\rho^{2d-2}) + O(\\rho^{2d-3})\n2056: $$\n2057: \n2058: For small $\\rho$, the dominant term is $O(\\rho^{2d-3})$.\n2059: \n2060: From Lemma {prf:ref}`lem-patch-third-derivative`:\n2061: $$\n2062: C_{v,\\nabla^3}(\\rho) = L_{\\sigma\\'\\'_{\\text{reg}}} \\cdot O(\\rho^{2d-3}) + L_{\\sigma\\'_{\\text{reg}}} \\cdot O(\\rho^{2d-3}) = O(\\rho^{2d-3})\n2063: $$\n2064: \n2065: From Lemma {prf:ref}`lem-zscore-third-derivative`, combining through the quotient rule:\n2066: $$\n2067: K_{Z,3}(\\rho) = \\frac{1}{\\sigma\\'_{\\min}} \\left[O(\\rho^{6d-3}) + O(\\rho^{6d-5}) + O(\\rho^{6d-7})\\right] = O(\\rho^{6d-3})\n2068: $$\n2069: \n2070: (The structure $\\rho^{6d-3}$ arises from three applications of derivatives, each contributing a $\\rho^{2d-m}$ factor.)\n2071: \n2072: **Step 2: Combine via the chain rule.**\n2073: \n2074: From Theorem {prf:ref}`thm-c3-regularity`:\n2075: $$\n2076: K_{V,3}(\\rho) = L_{g'''_A} \\cdot (K_{Z,1}(\\rho))^3 + 3 L_{g''_A} \\cdot K_{Z,1}(\\rho) \\cdot K_{Z,2}(\\rho) + L_{g'_A} \\cdot K_{Z,3}(\\rho)\n2077: $$\n2078: \n2079: Using the **corrected scalings** accounting for the $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ factor at each derivative order:\n2080: - $K_{Z,1}(\\rho) = O(\\rho^{2d})$ (first derivative includes one $k_{\\text{eff}}$ factor)\n2081: - $K_{Z,2}(\\rho) = O(\\rho^{4d-2})$ (second derivative includes two factors)\n2082: - $K_{Z,3}(\\rho) = O(\\rho^{6d-3})$ (third derivative includes three factors - Step 1)\n2083: \n2084: We have:\n2085: - Cubic term: $L_{g'''_A} \\cdot (K_{Z,1})^3 = O(1) \\cdot O(\\rho^{2d})^3 = O(\\rho^{6d})$ (dominant for $d > 1$, subdominant for small $\\rho$ when $d < 1/2$)\n2086: - Mixed term: $3 L_{g''_A} \\cdot K_{Z,1} \\cdot K_{Z,2} = O(1) \\cdot O(\\rho^{2d}) \\cdot O(\\rho^{4d-2}) = O(\\rho^{6d-2})$ (subdominant for small $\\rho$)\n2087: - Linear term: $L_{g'_A} \\cdot K_{Z,3} = O(1) \\cdot O(\\rho^{6d-3}) = O(\\rho^{6d-3})$ **← DOMINANT for small** $\\rho$ **(smallest exponent)**\n2088: \n2089: The **linear term dominates** for small $\\rho$ (smallest exponent on $\\rho$), giving:\n2090: $$\n2091: K_{V,3}(\\rho) = O(\\rho^{6d-3}) \\quad \\text{for } \\rho \\to 0\n2092: $$\n2093: \n2094: **Step 3: Global limit ($\\rho \\to \\infty$).**\n2095: \n2096: As $\\rho \\to \\infty$, the localization kernel becomes approximately uniform over the swarm:\n2097: $$\n2098: K_\\rho(x, x') \\to 1/|\\mathcal{X}|\n2099: $$\n2100: \n2101: In this limit:\n2102: - The weights $w_{ij}(\\rho) \\to 1/k$ (uniform over alive walkers)\n2103: - The derivatives $\\nabla w_{ij}(\\rho) \\to 0$ (no dependence on $x_i$)\n2104: - Higher-order derivatives $\\nabla^m w_{ij}(\\rho) \\to 0$ for $m \\ge 1$\n2105: \n2106: Thus:\n2107: - $C_{w,3}(\\rho) \\to 0$ as $\\rho \\to \\infty$\n2108: - $C_{\\mu,\\nabla^3}(\\rho) \\to d'''_{\\max}$ (only the direct derivative of $d(x_i)$ survives)\n2109: - $K_{Z,3}(\\rho) \\to O(1)$ (bounded by measurement function derivatives)\n2110: - $K_{V,3}(\\rho) \\to O(1)$\n2111: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 10. ρ-Scaling Analysis and Numerical Considerations"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-prop-timestep-constraint",
      "title": null,
      "start_line": 2131,
      "end_line": 2155,
      "header_lines": [
        2132
      ],
      "content_start": 2134,
      "content_end": 2154,
      "content": "2134: :label: proof-prop-timestep-constraint\n2135: \n2136: The BAOAB weak error analysis (Theorem 1.7.2 in [04_convergence.md](../1_euclidean_gas/06_convergence.md)) involves truncating the Itρ-Taylor expansion at second order. The truncation error depends on:\n2137: $$\n2138: \\Delta t^2 \\cdot \\|\\nabla^3 V\\|\n2139: $$\n2140: \n2141: For the error to remain $O(\\Delta t^2)$, we need:\n2142: $$\n2143: \\Delta t^2 \\cdot K_{V,3}(\\rho) = O(\\Delta t^2)\n2144: $$\n2145: \n2146: This is automatically satisfied, but for the **discrete-time Markov chain** to be well-behaved (e.g., to avoid large jumps), we require the higher-order correction terms to be small:\n2147: $$\n2148: \\Delta t \\cdot \\sqrt{K_{V,3}(\\rho)} \\lesssim 1\n2149: $$\n2150: \n2151: Using $K_{V,3}(\\rho) = O(\\rho^{6d-3})$:\n2152: $$\n2153: \\Delta t \\lesssim \\frac{1}{(K_{V,3}(\\rho))^{1/2}} = O(\\rho^{-(6d-3)/2})\n2154: $$",
      "metadata": {
        "label": "proof-prop-timestep-constraint"
      },
      "section": "## 10. ρ-Scaling Analysis and Numerical Considerations",
      "references": [],
      "raw_directive": "2131: :::\n2132: \n2133: :::{prf:proof}\n2134: :label: proof-prop-timestep-constraint\n2135: \n2136: The BAOAB weak error analysis (Theorem 1.7.2 in [04_convergence.md](../1_euclidean_gas/06_convergence.md)) involves truncating the Itρ-Taylor expansion at second order. The truncation error depends on:\n2137: $$\n2138: \\Delta t^2 \\cdot \\|\\nabla^3 V\\|\n2139: $$\n2140: \n2141: For the error to remain $O(\\Delta t^2)$, we need:\n2142: $$\n2143: \\Delta t^2 \\cdot K_{V,3}(\\rho) = O(\\Delta t^2)\n2144: $$\n2145: \n2146: This is automatically satisfied, but for the **discrete-time Markov chain** to be well-behaved (e.g., to avoid large jumps), we require the higher-order correction terms to be small:\n2147: $$\n2148: \\Delta t \\cdot \\sqrt{K_{V,3}(\\rho)} \\lesssim 1\n2149: $$\n2150: \n2151: Using $K_{V,3}(\\rho) = O(\\rho^{6d-3})$:\n2152: $$\n2153: \\Delta t \\lesssim \\frac{1}{(K_{V,3}(\\rho))^{1/2}} = O(\\rho^{-(6d-3)/2})\n2154: $$\n2155: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 11,
        "chapter_file": "chapter_11.json",
        "section_id": "## 10. ρ-Scaling Analysis and Numerical Considerations"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-continuity-third-derivatives",
      "title": null,
      "start_line": 2227,
      "end_line": 2279,
      "header_lines": [
        2228
      ],
      "content_start": 2230,
      "content_end": 2278,
      "content": "2230: :label: proof-thm-continuity-third-derivatives\n2231: \n2232: **Step 1: Composition theorem for continuity.**\n2233: \n2234: The fitness potential is $V_{\\text{fit}} = g_A \\circ Z_\\rho$. By the chain rule, $\\nabla^3 V_{\\text{fit}}$ is a composition of:\n2235: 1. Third derivative operator $\\nabla^3$\n2236: 2. Rescale function $g_A$ and its derivatives $g'_A, g''_A, g'''_A$\n2237: 3. Z-score $Z_\\rho$ and its derivatives $\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\nabla^3 Z_\\rho$\n2238: \n2239: Each component is continuous:\n2240: \n2241: **Component 1: Kernel continuity.**\n2242: The Gaussian kernel $K_\\rho(x, x')$ is $C^\\infty$ in $(x, x', \\rho)$ for $\\rho > 0$. Thus all derivatives $\\nabla^m_x K_\\rho$ are continuous.\n2243: \n2244: **Component 2: Weight continuity.**\n2245: The weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / \\sum_\\ell K_\\rho(x_i, x_\\ell)$ are quotients of continuous positive functions, hence continuous in $(x_i, \\{x_j\\}_{j \\in A_k}, \\rho)$.\n2246: \n2247: **Component 3: Moment continuity.**\n2248: The localized mean $\\mu_\\rho^{(i)}$ and variance $V_\\rho^{(i)}$ are weighted sums (continuous functions) of continuous weights and continuous measurement values. Thus continuous.\n2249: \n2250: **Component 4: Patched function continuity.**\n2251: The regularized standard deviation $\\sigma\\'_{\\text{reg}}(V)$ is $C^3$ by Assumption {prf:ref}`assump-c3-patch`, hence its first and second derivatives are continuous.\n2252: \n2253: **Component 5: Z-score continuity.**\n2254: The Z-score $Z_\\rho = (d(x_i) - \\mu_\\rho^{(i)}) / \\sigma\\'_{\\text{reg}}(V_\\rho^{(i)})$ is a quotient of continuous functions with positive denominator ($\\sigma\\'_{\\text{reg}} \\ge \\sigma\\'_{\\min} > 0$), hence continuous.\n2255: \n2256: **Component 6: Rescale function continuity.**\n2257: The rescale function $g_A$ is $C^3$ by Assumption {prf:ref}`assump-c3-rescale`, so $g_A, g'_A, g''_A, g'''_A$ are all continuous.\n2258: \n2259: **Step 2: Apply composition theorem.**\n2260: \n2261: The third derivative $\\nabla^3 V_{\\text{fit}}$ is given by the chain rule formula (Theorem {prf:ref}`thm-c3-regularity`):\n2262: $$\n2263: \\nabla^3 V_{\\text{fit}} = g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3 + 3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho + g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\n2264: $$\n2265: \n2266: Each term is a product/composition of continuous functions:\n2267: - $g'''_A(Z_\\rho(\\cdot))$: Continuous (composition of continuous functions)\n2268: - $\\nabla Z_\\rho(\\cdot)$: Continuous (by Step 1)\n2269: - $\\nabla^2 Z_\\rho(\\cdot)$: Continuous (differentiation of continuous function)\n2270: - $\\nabla^3 Z_\\rho(\\cdot)$: Continuous (differentiation of continuous function)\n2271: \n2272: Therefore $\\nabla^3 V_{\\text{fit}}$ is continuous as a function of $(x_i, S, \\rho)$.\n2273: \n2274: **Step 3: Uniform continuity on compact sets.**\n2275: \n2276: Since $\\mathcal{X}$ is compact and $(\\mathcal{X} \\times \\mathbb{R}^d)^N$ is locally compact (with appropriate topology), any compact subset $K$ is:\n2277: 1. Bounded in all coordinates\n2278: 2. Closed",
      "metadata": {
        "label": "proof-thm-continuity-third-derivatives"
      },
      "section": "## 11. Continuity of Third Derivatives",
      "references": [
        "assump-c3-patch",
        "assump-c3-rescale",
        "thm-c3-regularity"
      ],
      "raw_directive": "2227: :::\n2228: \n2229: :::{prf:proof}\n2230: :label: proof-thm-continuity-third-derivatives\n2231: \n2232: **Step 1: Composition theorem for continuity.**\n2233: \n2234: The fitness potential is $V_{\\text{fit}} = g_A \\circ Z_\\rho$. By the chain rule, $\\nabla^3 V_{\\text{fit}}$ is a composition of:\n2235: 1. Third derivative operator $\\nabla^3$\n2236: 2. Rescale function $g_A$ and its derivatives $g'_A, g''_A, g'''_A$\n2237: 3. Z-score $Z_\\rho$ and its derivatives $\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\nabla^3 Z_\\rho$\n2238: \n2239: Each component is continuous:\n2240: \n2241: **Component 1: Kernel continuity.**\n2242: The Gaussian kernel $K_\\rho(x, x')$ is $C^\\infty$ in $(x, x', \\rho)$ for $\\rho > 0$. Thus all derivatives $\\nabla^m_x K_\\rho$ are continuous.\n2243: \n2244: **Component 2: Weight continuity.**\n2245: The weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / \\sum_\\ell K_\\rho(x_i, x_\\ell)$ are quotients of continuous positive functions, hence continuous in $(x_i, \\{x_j\\}_{j \\in A_k}, \\rho)$.\n2246: \n2247: **Component 3: Moment continuity.**\n2248: The localized mean $\\mu_\\rho^{(i)}$ and variance $V_\\rho^{(i)}$ are weighted sums (continuous functions) of continuous weights and continuous measurement values. Thus continuous.\n2249: \n2250: **Component 4: Patched function continuity.**\n2251: The regularized standard deviation $\\sigma\\'_{\\text{reg}}(V)$ is $C^3$ by Assumption {prf:ref}`assump-c3-patch`, hence its first and second derivatives are continuous.\n2252: \n2253: **Component 5: Z-score continuity.**\n2254: The Z-score $Z_\\rho = (d(x_i) - \\mu_\\rho^{(i)}) / \\sigma\\'_{\\text{reg}}(V_\\rho^{(i)})$ is a quotient of continuous functions with positive denominator ($\\sigma\\'_{\\text{reg}} \\ge \\sigma\\'_{\\min} > 0$), hence continuous.\n2255: \n2256: **Component 6: Rescale function continuity.**\n2257: The rescale function $g_A$ is $C^3$ by Assumption {prf:ref}`assump-c3-rescale`, so $g_A, g'_A, g''_A, g'''_A$ are all continuous.\n2258: \n2259: **Step 2: Apply composition theorem.**\n2260: \n2261: The third derivative $\\nabla^3 V_{\\text{fit}}$ is given by the chain rule formula (Theorem {prf:ref}`thm-c3-regularity`):\n2262: $$\n2263: \\nabla^3 V_{\\text{fit}} = g'''_A(Z_\\rho) \\cdot (\\nabla Z_\\rho)^3 + 3 g''_A(Z_\\rho) \\cdot \\nabla Z_\\rho \\cdot \\nabla^2 Z_\\rho + g'_A(Z_\\rho) \\cdot \\nabla^3 Z_\\rho\n2264: $$\n2265: \n2266: Each term is a product/composition of continuous functions:\n2267: - $g'''_A(Z_\\rho(\\cdot))$: Continuous (composition of continuous functions)\n2268: - $\\nabla Z_\\rho(\\cdot)$: Continuous (by Step 1)\n2269: - $\\nabla^2 Z_\\rho(\\cdot)$: Continuous (differentiation of continuous function)\n2270: - $\\nabla^3 Z_\\rho(\\cdot)$: Continuous (differentiation of continuous function)\n2271: \n2272: Therefore $\\nabla^3 V_{\\text{fit}}$ is continuous as a function of $(x_i, S, \\rho)$.\n2273: \n2274: **Step 3: Uniform continuity on compact sets.**\n2275: \n2276: Since $\\mathcal{X}$ is compact and $(\\mathcal{X} \\times \\mathbb{R}^d)^N$ is locally compact (with appropriate topology), any compact subset $K$ is:\n2277: 1. Bounded in all coordinates\n2278: 2. Closed\n2279: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "13_geometric_gas_c3_regularity",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 11. Continuity of Third Derivatives"
      }
    }
  ]
}