{
  "chapter_index": 5,
  "section_id": "## 4. Third Derivatives of Localization Weights",
  "directive_count": 2,
  "hints": [
    {
      "directive_type": "lemma",
      "label": "lem-weight-third-derivative",
      "title": "Third Derivative of Localization Weights",
      "start_line": 1047,
      "end_line": 1061,
      "header_lines": [
        1048
      ],
      "content_start": 1050,
      "content_end": 1060,
      "content": "1050: :label: lem-weight-third-derivative\n1051: \n1052: The localization weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$ satisfy:\n1053: $$\n1054: \\|\\nabla^3_{x_i} w_{ij}(\\rho)\\| \\le C_{w,3}(\\rho)\n1055: $$\n1056: \n1057: where\n1058: $$\n1059: C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1060: $$",
      "metadata": {
        "label": "lem-weight-third-derivative"
      },
      "section": "## 4. Third Derivatives of Localization Weights",
      "raw_directive": "1047: where $d_{\\text{alg}}(i,j) = \\sqrt{\\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}}\\|v_i - v_j\\|^2 + \\varepsilon_d^2}$ (from \u00a72.5.1). The weights $w_{ij} = K_\\rho(i,j) / Z_i$ do NOT involve companion selection (they use direct pairwise distances), so the quotient analysis below applies with minor adaptations. The key difference: derivatives of $K_\\rho$ now involve derivatives of $d_{\\text{alg}}$, which are regularized by $\\varepsilon_d > 0$.\n1048: \n1049: :::{prf:lemma} Third Derivative of Localization Weights\n1050: :label: lem-weight-third-derivative\n1051: \n1052: The localization weights $w_{ij}(\\rho) = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$ satisfy:\n1053: $$\n1054: \\|\\nabla^3_{x_i} w_{ij}(\\rho)\\| \\le C_{w,3}(\\rho)\n1055: $$\n1056: \n1057: where\n1058: $$\n1059: C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1060: $$\n1061: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-weight-third-derivative",
      "title": null,
      "start_line": 1063,
      "end_line": 1133,
      "header_lines": [
        1064
      ],
      "content_start": 1066,
      "content_end": 1132,
      "content": "1066: :label: proof-lem-weight-third-derivative\n1067: \n1068: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n1069: \n1070: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n1071: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n1072: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n1073: \n1074: **Step 2: Derivatives of numerator.**\n1075: By Assumption {prf:ref}`assump-c3-kernel`:\n1076: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n1077: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1078: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1079: \n1080: **Step 3: Derivatives of denominator.**\n1081: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n1082: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n1083: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1084: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1085: \n1086: **Step 4: Apply quotient rule for third derivative.**\n1087: \n1088: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n1089: $$\n1090: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n1091: $$\n1092: \n1093: plus additional terms. We bound each term:\n1094: \n1095: **Term 1:** $|\\nabla^3 u / v|$\n1096: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n1097: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n1098: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n1099: \n1100: **Remarks on k-uniformity:** The quotient rule formula from \u00a72.4 shows that $\\nabla^3(u/v)$ involves terms with denominators up to $v^4$, multiplied by various combinations of derivatives of $u$ and $v$. Since $v = Z_i = \\sum_{\\ell} K_\\rho(x_i, x_\\ell)$ involves a sum over $k$ walkers, naive application of the quotient rule appears to produce $k$-dependent bounds.\n1101: \n1102: **Key insight:** k-uniformity is achieved through the **normalization constraint** $\\sum_j w_{ij} = 1$. When differentiated three times (see Step 5 below), this constraint provides a telescoping identity that ensures cancellation of $k$-dependent factors. The quotient rule terms involving high powers of $1/Z_i$ combine with sums over $j$ to produce k-uniform expressions.\n1103: \n1104: **Step 5: Achieve k-uniformity via telescoping.**\n1105: \n1106: Differentiating the normalization constraint $\\sum_{j \\in A_k} w_{ij} = 1$ three times yields the **telescoping identity**:\n1107: \n1108: $$\n1109: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n1110: $$\n1111: \n1112: This identity ensures that when $\\nabla^3 w_{ij}$ appears in weighted sums (as in the localized moments in \u00a75), the $Z_i$-dependent correction terms from the quotient rule sum to zero, leaving only k-uniform contributions.\n1113: \n1114: More precisely, the quotient rule structure implies:\n1115: \n1116: $$\n1117: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{(correction terms from } \\nabla^m Z_i\\text{, } m=1,2,3\\text{)}\n1118: $$\n1119: \n1120: The leading term $\\nabla^3 K_\\rho(x_i, x_j) / Z_i$ is already k-uniform since both the numerator $\\nabla^3 K_\\rho$ (bounded by $C_{\\nabla^3 K}(\\rho)/\\rho^3$, independent of $k$) and denominator $Z_i = O(k)$ scale appropriately. The correction terms involve products of kernel derivatives with derivatives of $Z_i^{-1}$, which contain factors of $k$ from sums in $\\nabla^m Z_i$. The telescoping identity guarantees that when these are summed over $j$, the net $k$-dependence cancels.\n1121: \n1122: **Step 6: Explicit bound.**\n1123: \n1124: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n1125: $$\n1126: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n1127: $$\n1128: \n1129: Absorbing constants and using conservative bounds:\n1130: $$\n1131: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1132: $$",
      "metadata": {
        "label": "proof-lem-weight-third-derivative"
      },
      "section": "## 4. Third Derivatives of Localization Weights",
      "raw_directive": "1063: :::\n1064: \n1065: :::{prf:proof}\n1066: :label: proof-lem-weight-third-derivative\n1067: \n1068: The weight $w_{ij}(\\rho)$ is a quotient, so we apply the quotient rule for third derivatives.\n1069: \n1070: **Step 1: Setup.** Write $w_{ij} = K_\\rho(x_i, x_j) / Z_i(\\rho)$ where:\n1071: - Numerator: $u(x_i) = K_\\rho(x_i, x_j)$ (depends on $x_i$ only, $x_j$ fixed)\n1072: - Denominator: $v(x_i) = Z_i(\\rho) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$\n1073: \n1074: **Step 2: Derivatives of numerator.**\n1075: By Assumption {prf:ref}`assump-c3-kernel`:\n1076: - $|\\nabla u| = |\\nabla K_\\rho(x_i, x_j)| \\le C_{\\nabla K}(\\rho)/\\rho$\n1077: - $|\\nabla^2 u| = |\\nabla^2 K_\\rho(x_i, x_j)| \\le C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1078: - $|\\nabla^3 u| = |\\nabla^3 K_\\rho(x_i, x_j)| \\le C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1079: \n1080: **Step 3: Derivatives of denominator.**\n1081: Since $v(x_i) = \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$, linearity gives:\n1082: - $|\\nabla v| = \\left|\\sum_{\\ell \\in A_k} \\nabla K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla K}(\\rho)/\\rho$\n1083: - $|\\nabla^2 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^2 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^2 K}(\\rho)/\\rho^2$\n1084: - $|\\nabla^3 v| = \\left|\\sum_{\\ell \\in A_k} \\nabla^3 K_\\rho(x_i, x_\\ell)\\right| \\le k \\cdot C_{\\nabla^3 K}(\\rho)/\\rho^3$\n1085: \n1086: **Step 4: Apply quotient rule for third derivative.**\n1087: \n1088: The general formula for $\\nabla^3(u/v)$ involves terms of the form:\n1089: $$\n1090: \\nabla^3\\left(\\frac{u}{v}\\right) = \\frac{1}{v}\\left[\\nabla^3 u - 3\\frac{\\nabla u \\cdot \\nabla^2 v}{v} - 3\\frac{\\nabla^2 u \\cdot \\nabla v}{v} + 6\\frac{(\\nabla u) \\cdot (\\nabla v)^2}{v^2} - \\frac{u \\cdot \\nabla^3 v}{v}\\right]\n1091: $$\n1092: \n1093: plus additional terms. We bound each term:\n1094: \n1095: **Term 1:** $|\\nabla^3 u / v|$\n1096: - Bound: $C_{\\nabla^3 K}(\\rho)/\\rho^3 \\cdot 1/v$\n1097: - Since $v = Z_i(\\rho) \\ge K_\\rho(x_i, x_i) \\ge c_0 > 0$ for some constant (kernel is positive at self)\n1098: - Contribution: $O(C_{\\nabla^3 K}(\\rho)/\\rho^3)$\n1099: \n1100: **Remarks on k-uniformity:** The quotient rule formula from \u00a72.4 shows that $\\nabla^3(u/v)$ involves terms with denominators up to $v^4$, multiplied by various combinations of derivatives of $u$ and $v$. Since $v = Z_i = \\sum_{\\ell} K_\\rho(x_i, x_\\ell)$ involves a sum over $k$ walkers, naive application of the quotient rule appears to produce $k$-dependent bounds.\n1101: \n1102: **Key insight:** k-uniformity is achieved through the **normalization constraint** $\\sum_j w_{ij} = 1$. When differentiated three times (see Step 5 below), this constraint provides a telescoping identity that ensures cancellation of $k$-dependent factors. The quotient rule terms involving high powers of $1/Z_i$ combine with sums over $j$ to produce k-uniform expressions.\n1103: \n1104: **Step 5: Achieve k-uniformity via telescoping.**\n1105: \n1106: Differentiating the normalization constraint $\\sum_{j \\in A_k} w_{ij} = 1$ three times yields the **telescoping identity**:\n1107: \n1108: $$\n1109: \\sum_{j \\in A_k} \\nabla^3_{x_i} w_{ij}(\\rho) = 0\n1110: $$\n1111: \n1112: This identity ensures that when $\\nabla^3 w_{ij}$ appears in weighted sums (as in the localized moments in \u00a75), the $Z_i$-dependent correction terms from the quotient rule sum to zero, leaving only k-uniform contributions.\n1113: \n1114: More precisely, the quotient rule structure implies:\n1115: \n1116: $$\n1117: \\nabla^3 w_{ij} = \\frac{\\nabla^3 K_\\rho(x_i, x_j)}{Z_i} + \\text{(correction terms from } \\nabla^m Z_i\\text{, } m=1,2,3\\text{)}\n1118: $$\n1119: \n1120: The leading term $\\nabla^3 K_\\rho(x_i, x_j) / Z_i$ is already k-uniform since both the numerator $\\nabla^3 K_\\rho$ (bounded by $C_{\\nabla^3 K}(\\rho)/\\rho^3$, independent of $k$) and denominator $Z_i = O(k)$ scale appropriately. The correction terms involve products of kernel derivatives with derivatives of $Z_i^{-1}$, which contain factors of $k$ from sums in $\\nabla^m Z_i$. The telescoping identity guarantees that when these are summed over $j$, the net $k$-dependence cancels.\n1121: \n1122: **Step 6: Explicit bound.**\n1123: \n1124: Collecting all terms and using $v = Z_i(\\rho) \\ge c_0 > 0$:\n1125: $$\n1126: \\|\\nabla^3 w_{ij}\\| \\le \\frac{1}{c_0}\\left[C_{\\nabla^3 K}(\\rho)/\\rho^3 + 3 \\cdot (C_{\\nabla K}(\\rho)/\\rho) \\cdot (C_{\\nabla^2 K}(\\rho)/\\rho^2) + O((C_{\\nabla K}(\\rho)/\\rho)^3)\\right]\n1127: $$\n1128: \n1129: Absorbing constants and using conservative bounds:\n1130: $$\n1131: \\|\\nabla^3 w_{ij}\\| \\le C_{w,3}(\\rho) := \\frac{C_{\\nabla^3 K}(\\rho)}{\\rho^3} + \\frac{12 C_{\\nabla K}(\\rho) C_{\\nabla^2 K}(\\rho)}{\\rho^3} + \\frac{16 C_{\\nabla K}(\\rho)^3}{\\rho^3}\n1132: $$\n1133: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}