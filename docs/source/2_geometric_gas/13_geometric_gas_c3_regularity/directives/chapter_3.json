{
  "chapter_index": 3,
  "section_id": "## 2. Mathematical Framework and Notation",
  "directive_count": 5,
  "hints": [
    {
      "directive_type": "lemma",
      "label": "lem-derivative-locality-c3",
      "title": "Derivative Locality for Third Derivatives (Complete)",
      "start_line": 468,
      "end_line": 499,
      "header_lines": [
        469
      ],
      "content_start": 471,
      "content_end": 498,
      "content": "471: :label: lem-derivative-locality-c3\n472: \n473: For walkers $i, j \\in \\mathcal{A}$ with $i \\neq j$, the companion-dependent measurement $d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ satisfies:\n474: \n475: **First derivative**:\n476: $$\n477: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n478: $$\n479: \n480: where $P_{ji} = \\mathbb{P}(c(j)=i)$ and $A_{ji} = 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$.\n481: \n482: **KEY INSIGHT**: In the sum over companions $\\ell \\in \\mathcal{A} \\setminus \\{j\\}$, only the term **$\\ell = i$** contributes to $\\nabla_{x_i} d_{\\text{alg}}(j, \\ell)$ because $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, not on $(x_i, v_i)$ for $\\ell \\neq i$.\n483: \n484: **Derivative bounds** (using $d_{\\text{alg}}(j,i) = \\sqrt{\\|x_j - x_i\\|^2 + \\lambda_{\\text{alg}}\\|v_j - v_i\\|^2 + \\varepsilon_d^2}$):\n485: $$\n486: \\|\\nabla_{x_i} d_{\\text{alg}}(j,i)\\| \\leq 1, \\quad \\|\\nabla^2_{x_i} d_{\\text{alg}}(j,i)\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3_{x_i} d_{\\text{alg}}(j,i)\\| \\leq \\frac{6}{\\varepsilon_d^2}\n487: $$\n488: \n489: **Bounds for companion-dependent measurement** (with $P_{ji} \\leq 1$ and $|A_{ji}| \\leq 1 + D_{\\max}^2/\\varepsilon_c^2$):\n490: $$\n491: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n492: $$\n493: $$\n494: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{where} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n495: $$\n496: $$\n497: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{where} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n498: $$",
      "metadata": {
        "label": "lem-derivative-locality-c3"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "468: #### 2.5.4. Derivative Locality Lemma (KEY for k-Uniformity)\n469: \n470: :::{prf:lemma} Derivative Locality for Third Derivatives (Complete)\n471: :label: lem-derivative-locality-c3\n472: \n473: For walkers $i, j \\in \\mathcal{A}$ with $i \\neq j$, the companion-dependent measurement $d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ satisfies:\n474: \n475: **First derivative**:\n476: $$\n477: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n478: $$\n479: \n480: where $P_{ji} = \\mathbb{P}(c(j)=i)$ and $A_{ji} = 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$.\n481: \n482: **KEY INSIGHT**: In the sum over companions $\\ell \\in \\mathcal{A} \\setminus \\{j\\}$, only the term **$\\ell = i$** contributes to $\\nabla_{x_i} d_{\\text{alg}}(j, \\ell)$ because $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, not on $(x_i, v_i)$ for $\\ell \\neq i$.\n483: \n484: **Derivative bounds** (using $d_{\\text{alg}}(j,i) = \\sqrt{\\|x_j - x_i\\|^2 + \\lambda_{\\text{alg}}\\|v_j - v_i\\|^2 + \\varepsilon_d^2}$):\n485: $$\n486: \\|\\nabla_{x_i} d_{\\text{alg}}(j,i)\\| \\leq 1, \\quad \\|\\nabla^2_{x_i} d_{\\text{alg}}(j,i)\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3_{x_i} d_{\\text{alg}}(j,i)\\| \\leq \\frac{6}{\\varepsilon_d^2}\n487: $$\n488: \n489: **Bounds for companion-dependent measurement** (with $P_{ji} \\leq 1$ and $|A_{ji}| \\leq 1 + D_{\\max}^2/\\varepsilon_c^2$):\n490: $$\n491: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n492: $$\n493: $$\n494: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{where} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n495: $$\n496: $$\n497: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{where} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n498: $$\n499: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-derivative-locality-c3",
      "title": null,
      "start_line": 501,
      "end_line": 608,
      "header_lines": [
        502
      ],
      "content_start": 504,
      "content_end": 607,
      "content": "504: :label: proof-lem-derivative-locality-c3\n505: \n506: **Step 1: Softmax probability derivative.**\n507: \n508: Let $P_{j\\ell} = \\mathbb{P}(c(j)=\\ell) = \\exp(-\\Phi_{j\\ell}) / Z_j$ where $\\Phi_{j\\ell} = d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)$ and $Z_j = \\sum_r \\exp(-\\Phi_{jr})$.\n509: \n510: Differentiating with respect to $x_i$:\n511: $$\n512: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}\\left[-\\partial_{x_i}\\Phi_{j\\ell} + \\sum_r P_{jr} \\partial_{x_i}\\Phi_{jr}\\right]\n513: $$\n514: \n515: **Locality of $\\Phi_{j\\ell}$**: Since $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, we have:\n516: $$\n517: \\partial_{x_i}\\Phi_{j\\ell} = \\delta_{\\ell i} \\partial_{x_i}\\Phi_{ji}\n518: $$\n519: \n520: Therefore:\n521: $$\n522: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}[P_{ji} - \\delta_{\\ell i}] \\partial_{x_i}\\Phi_{ji}\n523: $$\n524: \n525: **Step 2: Derivative of expected measurement.**\n526: $$\n527: \\nabla_{x_i} d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\left[(\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) + P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell))\\right]\n528: $$\n529: \n530: **Derivative locality for $d_{\\text{alg}}$**: Since $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = \\delta_{\\ell i} \\nabla_{x_i} d_{\\text{alg}}(j,i)$, the second term gives:\n531: $$\n532: \\sum_{\\ell} P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)) = P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n533: $$\n534: \n535: For the first term:\n536: $$\n537: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = \\left(\\sum_{\\ell} P_{j\\ell}[\\delta_{\\ell i} - P_{ji}] d_{\\text{alg}}(j,\\ell)\\right) \\nabla_{x_i}\\Phi_{ji}\n538: $$\n539: \n540: Simplifying: $\\sum_{\\ell} P_{j\\ell} \\delta_{\\ell i} d_{\\text{alg}}(j,\\ell) = P_{ji} d_{\\text{alg}}(j,i)$ and $\\sum_{\\ell} P_{j\\ell} d_{\\text{alg}}(j,\\ell) = d_j$, so:\n541: $$\n542: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = P_{ji}[d_j - d_{\\text{alg}}(j,i)] \\nabla_{x_i}\\Phi_{ji}\n543: $$\n544: \n545: **Step 3: Combine terms.**\n546: $$\n547: \\nabla_{x_i} d_j = P_{ji}\\left[d_{\\text{alg}}(j,i) - d_j\\right] \\nabla_{x_i}\\Phi_{ji} + P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n548: $$\n549: \n550: Using $\\Phi_{ji} = d_{\\text{alg}}^2(j,i)/(2\\varepsilon_c^2)$, so $\\nabla_{x_i}\\Phi_{ji} = \\frac{d_{\\text{alg}}(j,i)}{\\varepsilon_c^2} \\nabla_{x_i} d_{\\text{alg}}(j,i)$:\n551: $$\n552: \\nabla_{x_i} d_j = P_{ji}\\left[1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}\\right] \\nabla_{x_i} d_{\\text{alg}}(j,i)\n553: $$\n554: \n555: Defining $A_{ji} := 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$, we get:\n556: $$\n557: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n558: $$\n559: \n560: **Step 4: Derivatives of $d_{\\text{alg}}(j,i)$ with regularization.**\n561: \n562: Let $w = (x_j - x_i, \\sqrt{\\lambda_{\\text{alg}}}(v_j - v_i)) \\in \\mathbb{R}^{2d}$ and $d_{\\text{alg}}(j,i) = \\sqrt{\\|w\\|^2 + \\varepsilon_d^2}$.\n563: \n564: Direct calculation gives:\n565: $$\n566: \\nabla_w d_{\\text{alg}} = \\frac{w}{d_{\\text{alg}}}, \\quad \\nabla^2_w d_{\\text{alg}} = \\frac{1}{d_{\\text{alg}}}\\text{Id}_{2d} - \\frac{w \\otimes w}{d_{\\text{alg}}^3}\n567: $$\n568: $$\n569: \\nabla^3_w d_{\\text{alg}} = -\\frac{1}{d_{\\text{alg}}^3}\\text{sym}(\\text{Id} \\otimes w) + \\frac{3}{d_{\\text{alg}}^5} w^{\\otimes 3}\n570: $$\n571: \n572: Since $d_{\\text{alg}} \\geq \\varepsilon_d$ and $\\|w\\| \\leq d_{\\text{alg}}$:\n573: $$\n574: \\|\\nabla d_{\\text{alg}}\\| \\leq 1, \\quad \\|\\nabla^2 d_{\\text{alg}}\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3 d_{\\text{alg}}\\| \\leq \\frac{6}{\\varepsilon_d^2}\n575: $$\n576: \n577: **Step 5: Higher-order derivatives of $d_j$.**\n578: \n579: Applying Leibniz rule iteratively to $\\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)$ gives:\n580: $$\n581: \\nabla^2_{x_i} d_j = P_{ji} A_{ji} \\nabla^2 d_{\\text{alg}} + \\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\n582: $$\n583: $$\n584: \\nabla^3_{x_i} d_j = P_{ji} A_{ji} \\nabla^3 d_{\\text{alg}} + 3\\,\\text{sym}\\left(\\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla^2 d_{\\text{alg}}\\right) + \\text{sym}\\left(\\nabla^2_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\\right)\n585: $$\n586: \n587: **Step 6: Bound the coefficients.**\n588: \n589: Using $P_{ji} \\leq 1$, $|d_{\\text{alg}}(j,i)| \\leq D_{\\max}$, $|d_j| \\leq D_{\\max}$:\n590: $$\n591: |A_{ji}| \\leq 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n592: $$\n593: \n594: The derivatives $\\nabla_{x_i}(P_{ji} A_{ji})$ and $\\nabla^2_{x_i}(P_{ji} A_{ji})$ involve products of softmax derivatives and $A_{ji}$ derivatives, bounded by $O(\\varepsilon_c^{-2})$ and $O(\\varepsilon_c^{-4})$ respectively.\n595: \n596: **Step 7: Final bounds.**\n597: \n598: Combining (using Codex's explicit formulas):\n599: $$\n600: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n601: $$\n602: $$\n603: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{with} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n604: $$\n605: $$\n606: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n607: $$",
      "metadata": {
        "label": "proof-lem-derivative-locality-c3"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "501: :::\n502: \n503: :::{prf:proof}\n504: :label: proof-lem-derivative-locality-c3\n505: \n506: **Step 1: Softmax probability derivative.**\n507: \n508: Let $P_{j\\ell} = \\mathbb{P}(c(j)=\\ell) = \\exp(-\\Phi_{j\\ell}) / Z_j$ where $\\Phi_{j\\ell} = d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)$ and $Z_j = \\sum_r \\exp(-\\Phi_{jr})$.\n509: \n510: Differentiating with respect to $x_i$:\n511: $$\n512: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}\\left[-\\partial_{x_i}\\Phi_{j\\ell} + \\sum_r P_{jr} \\partial_{x_i}\\Phi_{jr}\\right]\n513: $$\n514: \n515: **Locality of $\\Phi_{j\\ell}$**: Since $d_{\\text{alg}}(j,\\ell)$ depends only on $(x_j, v_j, x_\\ell, v_\\ell)$, we have:\n516: $$\n517: \\partial_{x_i}\\Phi_{j\\ell} = \\delta_{\\ell i} \\partial_{x_i}\\Phi_{ji}\n518: $$\n519: \n520: Therefore:\n521: $$\n522: \\partial_{x_i} P_{j\\ell} = P_{j\\ell}[P_{ji} - \\delta_{\\ell i}] \\partial_{x_i}\\Phi_{ji}\n523: $$\n524: \n525: **Step 2: Derivative of expected measurement.**\n526: $$\n527: \\nabla_{x_i} d_j = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{j\\}} \\left[(\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) + P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell))\\right]\n528: $$\n529: \n530: **Derivative locality for $d_{\\text{alg}}$**: Since $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = \\delta_{\\ell i} \\nabla_{x_i} d_{\\text{alg}}(j,i)$, the second term gives:\n531: $$\n532: \\sum_{\\ell} P_{j\\ell} (\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)) = P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n533: $$\n534: \n535: For the first term:\n536: $$\n537: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = \\left(\\sum_{\\ell} P_{j\\ell}[\\delta_{\\ell i} - P_{ji}] d_{\\text{alg}}(j,\\ell)\\right) \\nabla_{x_i}\\Phi_{ji}\n538: $$\n539: \n540: Simplifying: $\\sum_{\\ell} P_{j\\ell} \\delta_{\\ell i} d_{\\text{alg}}(j,\\ell) = P_{ji} d_{\\text{alg}}(j,i)$ and $\\sum_{\\ell} P_{j\\ell} d_{\\text{alg}}(j,\\ell) = d_j$, so:\n541: $$\n542: \\sum_{\\ell} (\\nabla_{x_i} P_{j\\ell}) d_{\\text{alg}}(j,\\ell) = P_{ji}[d_j - d_{\\text{alg}}(j,i)] \\nabla_{x_i}\\Phi_{ji}\n543: $$\n544: \n545: **Step 3: Combine terms.**\n546: $$\n547: \\nabla_{x_i} d_j = P_{ji}\\left[d_{\\text{alg}}(j,i) - d_j\\right] \\nabla_{x_i}\\Phi_{ji} + P_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n548: $$\n549: \n550: Using $\\Phi_{ji} = d_{\\text{alg}}^2(j,i)/(2\\varepsilon_c^2)$, so $\\nabla_{x_i}\\Phi_{ji} = \\frac{d_{\\text{alg}}(j,i)}{\\varepsilon_c^2} \\nabla_{x_i} d_{\\text{alg}}(j,i)$:\n551: $$\n552: \\nabla_{x_i} d_j = P_{ji}\\left[1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}\\right] \\nabla_{x_i} d_{\\text{alg}}(j,i)\n553: $$\n554: \n555: Defining $A_{ji} := 1 - \\frac{d_{\\text{alg}}(j,i)(d_{\\text{alg}}(j,i) - d_j)}{\\varepsilon_c^2}$, we get:\n556: $$\n557: \\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)\n558: $$\n559: \n560: **Step 4: Derivatives of $d_{\\text{alg}}(j,i)$ with regularization.**\n561: \n562: Let $w = (x_j - x_i, \\sqrt{\\lambda_{\\text{alg}}}(v_j - v_i)) \\in \\mathbb{R}^{2d}$ and $d_{\\text{alg}}(j,i) = \\sqrt{\\|w\\|^2 + \\varepsilon_d^2}$.\n563: \n564: Direct calculation gives:\n565: $$\n566: \\nabla_w d_{\\text{alg}} = \\frac{w}{d_{\\text{alg}}}, \\quad \\nabla^2_w d_{\\text{alg}} = \\frac{1}{d_{\\text{alg}}}\\text{Id}_{2d} - \\frac{w \\otimes w}{d_{\\text{alg}}^3}\n567: $$\n568: $$\n569: \\nabla^3_w d_{\\text{alg}} = -\\frac{1}{d_{\\text{alg}}^3}\\text{sym}(\\text{Id} \\otimes w) + \\frac{3}{d_{\\text{alg}}^5} w^{\\otimes 3}\n570: $$\n571: \n572: Since $d_{\\text{alg}} \\geq \\varepsilon_d$ and $\\|w\\| \\leq d_{\\text{alg}}$:\n573: $$\n574: \\|\\nabla d_{\\text{alg}}\\| \\leq 1, \\quad \\|\\nabla^2 d_{\\text{alg}}\\| \\leq \\frac{2}{\\varepsilon_d}, \\quad \\|\\nabla^3 d_{\\text{alg}}\\| \\leq \\frac{6}{\\varepsilon_d^2}\n575: $$\n576: \n577: **Step 5: Higher-order derivatives of $d_j$.**\n578: \n579: Applying Leibniz rule iteratively to $\\nabla_{x_i} d_j = P_{ji} A_{ji} \\nabla_{x_i} d_{\\text{alg}}(j,i)$ gives:\n580: $$\n581: \\nabla^2_{x_i} d_j = P_{ji} A_{ji} \\nabla^2 d_{\\text{alg}} + \\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\n582: $$\n583: $$\n584: \\nabla^3_{x_i} d_j = P_{ji} A_{ji} \\nabla^3 d_{\\text{alg}} + 3\\,\\text{sym}\\left(\\nabla_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla^2 d_{\\text{alg}}\\right) + \\text{sym}\\left(\\nabla^2_{x_i}(P_{ji} A_{ji}) \\otimes \\nabla d_{\\text{alg}}\\right)\n585: $$\n586: \n587: **Step 6: Bound the coefficients.**\n588: \n589: Using $P_{ji} \\leq 1$, $|d_{\\text{alg}}(j,i)| \\leq D_{\\max}$, $|d_j| \\leq D_{\\max}$:\n590: $$\n591: |A_{ji}| \\leq 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n592: $$\n593: \n594: The derivatives $\\nabla_{x_i}(P_{ji} A_{ji})$ and $\\nabla^2_{x_i}(P_{ji} A_{ji})$ involve products of softmax derivatives and $A_{ji}$ derivatives, bounded by $O(\\varepsilon_c^{-2})$ and $O(\\varepsilon_c^{-4})$ respectively.\n595: \n596: **Step 7: Final bounds.**\n597: \n598: Combining (using Codex's explicit formulas):\n599: $$\n600: \\|\\nabla_{x_i} d_j\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n601: $$\n602: $$\n603: \\|\\nabla^2_{x_i} d_j\\| \\leq C_{d,2} \\varepsilon_d^{-1} \\quad \\text{with} \\quad C_{d,2} = 2\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{3D_{\\max}^3}{\\varepsilon_c^4}\n604: $$\n605: $$\n606: \\|\\nabla^3_{x_i} d_j\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15D_{\\max}^3}{\\varepsilon_c^4}\n607: $$\n608: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-self-measurement-derivatives",
      "title": "Self-Measurement Derivative Bounds (j=i Case)",
      "start_line": 614,
      "end_line": 659,
      "header_lines": [
        615
      ],
      "content_start": 617,
      "content_end": 658,
      "content": "617: :label: lem-self-measurement-derivatives\n618: \n619: For the self-measurement where walker $i$ selects a companion from the alive set:\n620: \n621: $$\n622: d_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} P_{i\\ell} \\, d_{\\text{alg}}(i,\\ell), \\quad P_{i\\ell} = \\frac{\\exp(-d_{i\\ell}^2/(2\\varepsilon_c^2))}{Z_i}\n623: $$\n624: \n625: the third derivative with respect to walker $i$'s position is **k-uniform** despite the sum over $k_{\\text{eff}}^{(\\varepsilon_c)} = O((\\log k)^d)$ companions.\n626: \n627: **Key Mechanism**: The normalization $\\sum_{\\ell} P_{i\\ell} = 1$ ensures all derivatives are **probability-weighted expectations**, canceling the sum over companions.\n628: \n629: **First derivative** (covariance form):\n630: \n631: $$\n632: \\nabla_{x_i} d_i = \\mathbb{E}_{P_i}[\\nabla_{x_i} d_{i\\ell}] - \\text{Cov}_{P_i}(d_{i\\ell}, S_{i\\ell})\n633: $$\n634: \n635: where $S_{i\\ell} := \\frac{d_{i\\ell}}{\\varepsilon_c^2} \\nabla_{x_i} d_{i\\ell}$.\n636: \n637: **Third derivative** (expectation form):\n638: \n639: $$\n640: \\begin{aligned}\n641: \\nabla^3_{x_i} d_i &= \\sum_{\\ell} P_{i\\ell} \\nabla^3 d_{i\\ell}\n642: + 3\\,\\text{sym}\\sum_{\\ell} P_{i\\ell} (\\Delta_{i\\ell} \\otimes \\nabla^2 d_{i\\ell}) \\\\\n643: &\\quad + 3\\,\\text{sym}\\sum_{\\ell} P_{i\\ell} [(\\Delta_{i\\ell} \\otimes \\Delta_{i\\ell}) + \\Gamma_{i\\ell}] \\otimes \\nabla d_{i\\ell} \\\\\n644: &\\quad + \\sum_{\\ell} P_{i\\ell} [\\Delta_{i\\ell}^{\\otimes 3} + \\text{sym}(\\Delta_{i\\ell} \\otimes \\Gamma_{i\\ell}) + \\Xi_{i\\ell}] d_{i\\ell}\n645: \\end{aligned}\n646: $$\n647: \n648: where $\\Delta_{i\\ell} = \\bar{S}_i - S_{i\\ell}$ with $\\bar{S}_i = \\sum_r P_{ir} S_{ir}$ (expectation), and $\\Gamma_{i\\ell}, \\Xi_{i\\ell}$ are derivatives of $\\Delta_{i\\ell}$ (also expectations).\n649: \n650: **Bounds** (using $\\|\\nabla d_{i\\ell}\\| \\leq 1$, $\\|\\nabla^2 d_{i\\ell}\\| \\leq 2/\\varepsilon_d$, $\\|\\nabla^3 d_{i\\ell}\\| \\leq 6/\\varepsilon_d^2$, $d_{i\\ell} \\leq D_{\\max}$):\n651: \n652: $$\n653: \\|\\nabla_{x_i} d_i\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n654: $$\n655: \n656: $$\n657: \\|\\nabla^3_{x_i} d_i\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n658: $$",
      "metadata": {
        "label": "lem-self-measurement-derivatives"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "614: ### 2.6. Two-Scale Framework for k-Uniformity\n615: \n616: :::{prf:lemma} Self-Measurement Derivative Bounds (j=i Case)\n617: :label: lem-self-measurement-derivatives\n618: \n619: For the self-measurement where walker $i$ selects a companion from the alive set:\n620: \n621: $$\n622: d_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} P_{i\\ell} \\, d_{\\text{alg}}(i,\\ell), \\quad P_{i\\ell} = \\frac{\\exp(-d_{i\\ell}^2/(2\\varepsilon_c^2))}{Z_i}\n623: $$\n624: \n625: the third derivative with respect to walker $i$'s position is **k-uniform** despite the sum over $k_{\\text{eff}}^{(\\varepsilon_c)} = O((\\log k)^d)$ companions.\n626: \n627: **Key Mechanism**: The normalization $\\sum_{\\ell} P_{i\\ell} = 1$ ensures all derivatives are **probability-weighted expectations**, canceling the sum over companions.\n628: \n629: **First derivative** (covariance form):\n630: \n631: $$\n632: \\nabla_{x_i} d_i = \\mathbb{E}_{P_i}[\\nabla_{x_i} d_{i\\ell}] - \\text{Cov}_{P_i}(d_{i\\ell}, S_{i\\ell})\n633: $$\n634: \n635: where $S_{i\\ell} := \\frac{d_{i\\ell}}{\\varepsilon_c^2} \\nabla_{x_i} d_{i\\ell}$.\n636: \n637: **Third derivative** (expectation form):\n638: \n639: $$\n640: \\begin{aligned}\n641: \\nabla^3_{x_i} d_i &= \\sum_{\\ell} P_{i\\ell} \\nabla^3 d_{i\\ell}\n642: + 3\\,\\text{sym}\\sum_{\\ell} P_{i\\ell} (\\Delta_{i\\ell} \\otimes \\nabla^2 d_{i\\ell}) \\\\\n643: &\\quad + 3\\,\\text{sym}\\sum_{\\ell} P_{i\\ell} [(\\Delta_{i\\ell} \\otimes \\Delta_{i\\ell}) + \\Gamma_{i\\ell}] \\otimes \\nabla d_{i\\ell} \\\\\n644: &\\quad + \\sum_{\\ell} P_{i\\ell} [\\Delta_{i\\ell}^{\\otimes 3} + \\text{sym}(\\Delta_{i\\ell} \\otimes \\Gamma_{i\\ell}) + \\Xi_{i\\ell}] d_{i\\ell}\n645: \\end{aligned}\n646: $$\n647: \n648: where $\\Delta_{i\\ell} = \\bar{S}_i - S_{i\\ell}$ with $\\bar{S}_i = \\sum_r P_{ir} S_{ir}$ (expectation), and $\\Gamma_{i\\ell}, \\Xi_{i\\ell}$ are derivatives of $\\Delta_{i\\ell}$ (also expectations).\n649: \n650: **Bounds** (using $\\|\\nabla d_{i\\ell}\\| \\leq 1$, $\\|\\nabla^2 d_{i\\ell}\\| \\leq 2/\\varepsilon_d$, $\\|\\nabla^3 d_{i\\ell}\\| \\leq 6/\\varepsilon_d^2$, $d_{i\\ell} \\leq D_{\\max}$):\n651: \n652: $$\n653: \\|\\nabla_{x_i} d_i\\| \\leq C_{d,1} := 1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\n654: $$\n655: \n656: $$\n657: \\|\\nabla^3_{x_i} d_i\\| \\leq C_{d,3} \\varepsilon_d^{-2} \\quad \\text{with} \\quad C_{d,3} = 6\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n658: $$\n659: "
    },
    {
      "directive_type": "proof",
      "label": "lem-telescoping-derivatives",
      "title": null,
      "start_line": 661,
      "end_line": 843,
      "header_lines": [
        662,
        837
      ],
      "content_start": 664,
      "content_end": 842,
      "content": "664: :label: proof-lem-self-measurement-derivatives\n665: \n666: **Normalization and notation.** Fix walker $i$ and differentiate with respect to its configuration $x_i$. Set:\n667: \n668: $$\n669: r_{i\\ell}(x_i) = \\frac{d_{i\\ell}(x_i)^2}{2\\varepsilon_c^2}, \\quad E_{i\\ell}(x_i) = e^{-r_{i\\ell}(x_i)}, \\quad A_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell} d_{i\\ell}, \\quad Z_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell}\n670: $$\n671: \n672: Then $d_i = A_i / Z_i$. Let:\n673: \n674: $$\n675: P_{i\\ell} = \\frac{E_{i\\ell}}{Z_i}, \\quad \\mathbb{E}_i[\\varphi] = \\sum_{\\ell \\neq i} P_{i\\ell} \\varphi_{i\\ell}, \\quad D := \\nabla_{x_i}, \\quad D^m \\text{ the $m$-th derivative tensor}\n676: $$\n677: \n678: Throughout we exploit $\\sum_{\\ell} P_{i\\ell} = 1$ to eliminate every appearance of $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n679: \n680: **Step 1 (First derivative).** Applying the quotient rule:\n681: \n682: $$\n683: D d_i = \\frac{D A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D Z_i}{Z_i}\n684: $$\n685: \n686: Direct differentiation yields $D A_i = \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell})$ and $D Z_i = -\\sum_{\\ell} E_{i\\ell} D r_{i\\ell}$. Therefore:\n687: \n688: $$\n689: D d_i = \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell}) + d_i \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell} D r_{i\\ell}\n690: $$\n691: \n692: Replacing $\\frac{E_{i\\ell}}{Z_i}$ by $P_{i\\ell}$ and inserting $\\sum_{\\ell} P_{i\\ell} = 1$ gives:\n693: \n694: $$\n695: D d_i = \\sum_{\\ell} P_{i\\ell} D d_{i\\ell} - \\sum_{\\ell} P_{i\\ell}(d_{i\\ell} - d_i) D r_{i\\ell} = \\mathbb{E}_i[D d_{i\\ell}] - \\mathbb{E}_i[(d_{i\\ell} - d_i) D r_{i\\ell}]\n696: $$\n697: \n698: so every term is an expectation, i.e., $k$-uniform.\n699: \n700: **Step 2 (Second derivative).** Differentiating a second time gives:\n701: \n702: $$\n703: D^2 d_i = \\frac{D^2 A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D^2 Z_i}{Z_i} - \\frac{2}{Z_i^2} \\text{sym}(D A_i \\otimes D Z_i) + \\frac{2A_i}{Z_i} \\frac{1}{Z_i^2} \\text{sym}(D Z_i \\otimes D Z_i)\n704: $$\n705: \n706: Using:\n707: \n708: $$\n709: \\begin{aligned}\n710: D^2 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^2 d_{i\\ell} - D d_{i\\ell} \\otimes D r_{i\\ell} - D r_{i\\ell} \\otimes D d_{i\\ell} - d_{i\\ell} D^2 r_{i\\ell} + d_{i\\ell} D r_{i\\ell} \\otimes D r_{i\\ell}\\Big) \\\\\n711: D^2 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D r_{i\\ell} \\otimes D r_{i\\ell} - D^2 r_{i\\ell}\\Big)\n712: \\end{aligned}\n713: $$\n714: \n715: and renormalizing by $Z_i$, we obtain:\n716: \n717: $$\n718: \\boxed{\n719: \\begin{aligned}\n720: D^2 d_i &= \\mathbb{E}_i[D^2 d_{i\\ell} - (d_{i\\ell} - d_i) D^2 r_{i\\ell}] \\\\\n721: &\\quad - 2 \\text{sym} \\, \\mathbb{E}_i[(D d_{i\\ell} - \\mathbb{E}_i[D d_{i\\bullet}]) \\otimes (D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])] \\\\\n722: &\\quad + \\mathbb{E}_i\\Big[(d_{i\\ell} - d_i) \\big((D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])^{\\otimes 2} - \\text{Cov}_i(D r_{i\\bullet})\\big)\\Big]\n723: \\end{aligned}\n724: }\n725: $$\n726: \n727: with $\\text{Cov}_i(D r_{i\\bullet}) = \\mathbb{E}_i[D r_{i\\ell} \\otimes D r_{i\\ell}] - \\mathbb{E}_i[D r_{i\\bullet}] \\otimes \\mathbb{E}_i[D r_{i\\bullet}]$.\n728: \n729: Every tensor on the right is an expectation, hence $k$-uniform.\n730: \n731: **Step 3 (Third derivative via Fa\u00e0 di Bruno).** Write $d_i = A_i Z_i^{-1}$ and apply Fa\u00e0 di Bruno to the product $A_i \\cdot Z_i^{-1}$:\n732: \n733: $$\n734: \\begin{aligned}\n735: D^3 d_i &= Z_i^{-1} D^3 A_i - 3 Z_i^{-2} \\text{sym}(D^2 A_i \\otimes D Z_i) + 6 Z_i^{-3} \\text{sym}(D A_i \\otimes D Z_i \\otimes D Z_i) \\\\\n736: &\\quad - 3 Z_i^{-2} \\text{sym}(D A_i \\otimes D^2 Z_i) - 6 d_i Z_i^{-3} D Z_i^{\\otimes 3} \\\\\n737: &\\quad + 6 d_i Z_i^{-2} \\text{sym}(D Z_i \\otimes D^2 Z_i) - d_i Z_i^{-1} D^3 Z_i\n738: \\end{aligned}\n739: $$\n740: \n741: The third derivatives of $A_i$ and $Z_i$ are, term by term:\n742: \n743: $$\n744: \\begin{aligned}\n745: D^3 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^3 d_{i\\ell} - 3 \\text{sym}(D^2 d_{i\\ell} \\otimes D r_{i\\ell}) - 3 \\text{sym}(D d_{i\\ell} \\otimes D^2 r_{i\\ell}) \\\\\n746: &\\quad\\quad - d_{i\\ell} D^3 r_{i\\ell} + 3 d_{i\\ell} \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - d_{i\\ell} D r_{i\\ell}^{\\otimes 3}\\Big) \\\\\n747: D^3 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(- D r_{i\\ell}^{\\otimes 3} + 3 \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - D^3 r_{i\\ell}\\Big)\n748: \\end{aligned}\n749: $$\n750: \n751: After dividing by $Z_i$, each summation turns into $\\mathbb{E}_i[\\cdot]$, so every block in $D^3 d_i$ is again an expectation with weights $P_{i\\ell}$. Thus the Fa\u00e0 di Bruno expansion inherits the same $k$-uniformity: all companion sums appear inside expectations, never multiplied by $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n752: \n753: **Step 4 (Explicit uniform bounds).** Introduce the supremum bounds:\n754: \n755: $$\n756: B_0 = \\sup_{\\ell} |d_{i\\ell}|, \\quad M_m = \\sup_{\\ell} \\|D^m d_{i\\ell}\\|, \\quad m = 1,2,3\n757: $$\n758: \n759: and note:\n760: \n761: $$\n762: \\|D r_{i\\ell}\\| \\leq \\frac{B_0 M_1}{\\varepsilon_c^2} = R_1, \\quad \\|D^2 r_{i\\ell}\\| \\leq \\frac{M_1^2 + B_0 M_2}{\\varepsilon_c^2} = R_2, \\quad \\|D^3 r_{i\\ell}\\| \\leq \\frac{3 M_1 M_2 + B_0 M_3}{\\varepsilon_c^2} = R_3\n763: $$\n764: \n765: Because every derivative of $d_i$ is an expectation, the operator norms are bounded by the maxima of these ingredients, giving the explicit $k$-independent constants:\n766: \n767: $$\n768: \\boxed{\\|D d_i\\| \\leq C_{d,1} = M_1\\left(1 + \\frac{2 B_0^2}{\\varepsilon_c^2}\\right)}\n769: $$\n770: \n771: $$\n772: \\boxed{\\|D^2 d_i\\| \\leq C_{d,2} = M_2 + \\frac{6 B_0 M_1^2 + 2 B_0^2 M_2}{\\varepsilon_c^2} + \\frac{6 B_0^3 M_1^2}{\\varepsilon_c^4}}\n773: $$\n774: \n775: $$\n776: \\boxed{\\|D^3 d_i\\| \\leq C_{d,3} = M_3 + \\frac{6 M_1^3 + 18 B_0 M_1 M_2 + 2 B_0^2 M_3}{\\varepsilon_c^2} + \\frac{33 B_0^2 M_1^3 + 18 B_0^3 M_1 M_2}{\\varepsilon_c^4} + \\frac{26 B_0^4 M_1^3}{\\varepsilon_c^6}}\n777: $$\n778: \n779: Each $C_{d,k}$ depends only on uniform bounds of the pairwise distances and their derivatives, never on $|\\mathcal{A}|$ or $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n780: \n781: \n782: **Step 5 (Simplification with regularized metric bounds).** Substitute the explicit bounds for the regularized algorithmic distance:\n783: \n784: $$\n785: M_1 = \\|\\nabla d_{i\\ell}\\| = 1, \\quad M_2 = \\|\\nabla^2 d_{i\\ell}\\| = \\frac{2}{\\varepsilon_d}, \\quad M_3 = \\|\\nabla^3 d_{i\\ell}\\| = \\frac{6}{\\varepsilon_d^2}, \\quad B_0 = D_{\\max}\n786: $$\n787: \n788: For $C_{d,3}$, the boxed formula becomes:\n789: \n790: $$\n791: \\begin{aligned}\n792: C_{d,3} &= \\frac{6}{\\varepsilon_d^2} + \\frac{6 \\cdot 1 + 18 D_{\\max} \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d} + 2 D_{\\max}^2 \\cdot \\frac{6}{\\varepsilon_d^2}}{\\varepsilon_c^2} \\\\\n793: &\\quad + \\frac{33 D_{\\max}^2 \\cdot 1 + 18 D_{\\max}^3 \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d}}{\\varepsilon_c^4} + \\frac{26 D_{\\max}^4 \\cdot 1}{\\varepsilon_c^6}\n794: \\end{aligned}\n795: $$\n796: \n797: Collecting $\\varepsilon_d^{-2}$ terms:\n798: \n799: $$\n800: C_{d,3} = \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{2 D_{\\max}^2}{\\varepsilon_c^2}\\right) + O(\\varepsilon_d^{-1}) + O(1)\n801: $$\n802: \n803: For the typical regime $\\varepsilon_d \\ll \\varepsilon_c$, the dominant term is:\n804: \n805: $$\n806: C_{d,3} \\approx \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n807: $$\n808: \n809: matching the simplified formula stated in the lemma (where subdominant $\\varepsilon_d^{-1}$ and constant terms are absorbed). \u220e\n810: \n811: The full model involves **two distinct spatial scales** that work together to maintain k-uniform bounds:\n812: \n813: **Scale 1: Companion Selection** (controlled by $\\varepsilon_c$):\n814: - **Purpose**: Select companions for measurements\n815: - **Effective interactions**: $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\varepsilon_c^{2d} (\\log k)^d)$ (NOT k-uniform)\n816: - **Key mechanism**: **Derivative locality** (\u00a72.5.4) eliminates \u2113-sums before $(\\log k)^d$ can appear\n817: - **Result for j\u2260i**: Only companion $\\ell = i$ contributes to $\\nabla_i d_j$ \u2192 single term, no log factor\n818: \n819: **Scale 2: Localization Weights** (controlled by $\\rho$):\n820: - **Purpose**: Compute local statistics (mean, variance)\n821: - **Effective interactions**: $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ (IS k-uniform)\n822: - **Key mechanism**: **Telescoping identity** (\u00a72.7) from $\\sum_j w_{ij} = 1$\n823: - **Result**: Naive $O(k)$ sum over $j$ cancels to $O(\\rho^{2d})$ (k-uniform)\n824: \n825: **Combined Effect**: Despite N-body coupling from companion selection:\n826: 1. Derivative locality prevents $(\\log k)^d$ at the \u03b5_c-scale\n827: 2. Telescoping controls $j$-sums at the \u03c1-scale\n828: 3. Result: **k-uniform third-derivative bounds** for the full companion-dependent model\n829: \n830: **Typical parameter hierarchy**: $\\varepsilon_d \\ll \\varepsilon_c \\lesssim \\rho \\ll 1$\n831: \n832: This two-scale framework is essential for all k-uniformity proofs in Chapters 5-8.\n833: \n834: ### 2.7. k-Uniformity and Telescoping Properties\n835: \n836: A bound is **k-uniform** if it is independent of the alive walker count $k = |A_k|$. The key technical tool for proving k-uniformity is the **telescoping property** of normalized weights:\n837: \n838: :::{prf:lemma} Telescoping Identity for Derivatives\n839: :label: lem-telescoping-derivatives\n840: \n841: For any derivative order $m \\in \\{1, 2, 3\\}$, the localization weights satisfy:\n842: $$",
      "metadata": {
        "label": "lem-telescoping-derivatives"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "661: :::\n662: \n663: :::{prf:proof}\n664: :label: proof-lem-self-measurement-derivatives\n665: \n666: **Normalization and notation.** Fix walker $i$ and differentiate with respect to its configuration $x_i$. Set:\n667: \n668: $$\n669: r_{i\\ell}(x_i) = \\frac{d_{i\\ell}(x_i)^2}{2\\varepsilon_c^2}, \\quad E_{i\\ell}(x_i) = e^{-r_{i\\ell}(x_i)}, \\quad A_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell} d_{i\\ell}, \\quad Z_i(x_i) = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} E_{i\\ell}\n670: $$\n671: \n672: Then $d_i = A_i / Z_i$. Let:\n673: \n674: $$\n675: P_{i\\ell} = \\frac{E_{i\\ell}}{Z_i}, \\quad \\mathbb{E}_i[\\varphi] = \\sum_{\\ell \\neq i} P_{i\\ell} \\varphi_{i\\ell}, \\quad D := \\nabla_{x_i}, \\quad D^m \\text{ the $m$-th derivative tensor}\n676: $$\n677: \n678: Throughout we exploit $\\sum_{\\ell} P_{i\\ell} = 1$ to eliminate every appearance of $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n679: \n680: **Step 1 (First derivative).** Applying the quotient rule:\n681: \n682: $$\n683: D d_i = \\frac{D A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D Z_i}{Z_i}\n684: $$\n685: \n686: Direct differentiation yields $D A_i = \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell})$ and $D Z_i = -\\sum_{\\ell} E_{i\\ell} D r_{i\\ell}$. Therefore:\n687: \n688: $$\n689: D d_i = \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell}(D d_{i\\ell} - d_{i\\ell} D r_{i\\ell}) + d_i \\frac{1}{Z_i} \\sum_{\\ell} E_{i\\ell} D r_{i\\ell}\n690: $$\n691: \n692: Replacing $\\frac{E_{i\\ell}}{Z_i}$ by $P_{i\\ell}$ and inserting $\\sum_{\\ell} P_{i\\ell} = 1$ gives:\n693: \n694: $$\n695: D d_i = \\sum_{\\ell} P_{i\\ell} D d_{i\\ell} - \\sum_{\\ell} P_{i\\ell}(d_{i\\ell} - d_i) D r_{i\\ell} = \\mathbb{E}_i[D d_{i\\ell}] - \\mathbb{E}_i[(d_{i\\ell} - d_i) D r_{i\\ell}]\n696: $$\n697: \n698: so every term is an expectation, i.e., $k$-uniform.\n699: \n700: **Step 2 (Second derivative).** Differentiating a second time gives:\n701: \n702: $$\n703: D^2 d_i = \\frac{D^2 A_i}{Z_i} - \\frac{A_i}{Z_i} \\frac{D^2 Z_i}{Z_i} - \\frac{2}{Z_i^2} \\text{sym}(D A_i \\otimes D Z_i) + \\frac{2A_i}{Z_i} \\frac{1}{Z_i^2} \\text{sym}(D Z_i \\otimes D Z_i)\n704: $$\n705: \n706: Using:\n707: \n708: $$\n709: \\begin{aligned}\n710: D^2 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^2 d_{i\\ell} - D d_{i\\ell} \\otimes D r_{i\\ell} - D r_{i\\ell} \\otimes D d_{i\\ell} - d_{i\\ell} D^2 r_{i\\ell} + d_{i\\ell} D r_{i\\ell} \\otimes D r_{i\\ell}\\Big) \\\\\n711: D^2 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D r_{i\\ell} \\otimes D r_{i\\ell} - D^2 r_{i\\ell}\\Big)\n712: \\end{aligned}\n713: $$\n714: \n715: and renormalizing by $Z_i$, we obtain:\n716: \n717: $$\n718: \\boxed{\n719: \\begin{aligned}\n720: D^2 d_i &= \\mathbb{E}_i[D^2 d_{i\\ell} - (d_{i\\ell} - d_i) D^2 r_{i\\ell}] \\\\\n721: &\\quad - 2 \\text{sym} \\, \\mathbb{E}_i[(D d_{i\\ell} - \\mathbb{E}_i[D d_{i\\bullet}]) \\otimes (D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])] \\\\\n722: &\\quad + \\mathbb{E}_i\\Big[(d_{i\\ell} - d_i) \\big((D r_{i\\ell} - \\mathbb{E}_i[D r_{i\\bullet}])^{\\otimes 2} - \\text{Cov}_i(D r_{i\\bullet})\\big)\\Big]\n723: \\end{aligned}\n724: }\n725: $$\n726: \n727: with $\\text{Cov}_i(D r_{i\\bullet}) = \\mathbb{E}_i[D r_{i\\ell} \\otimes D r_{i\\ell}] - \\mathbb{E}_i[D r_{i\\bullet}] \\otimes \\mathbb{E}_i[D r_{i\\bullet}]$.\n728: \n729: Every tensor on the right is an expectation, hence $k$-uniform.\n730: \n731: **Step 3 (Third derivative via Fa\u00e0 di Bruno).** Write $d_i = A_i Z_i^{-1}$ and apply Fa\u00e0 di Bruno to the product $A_i \\cdot Z_i^{-1}$:\n732: \n733: $$\n734: \\begin{aligned}\n735: D^3 d_i &= Z_i^{-1} D^3 A_i - 3 Z_i^{-2} \\text{sym}(D^2 A_i \\otimes D Z_i) + 6 Z_i^{-3} \\text{sym}(D A_i \\otimes D Z_i \\otimes D Z_i) \\\\\n736: &\\quad - 3 Z_i^{-2} \\text{sym}(D A_i \\otimes D^2 Z_i) - 6 d_i Z_i^{-3} D Z_i^{\\otimes 3} \\\\\n737: &\\quad + 6 d_i Z_i^{-2} \\text{sym}(D Z_i \\otimes D^2 Z_i) - d_i Z_i^{-1} D^3 Z_i\n738: \\end{aligned}\n739: $$\n740: \n741: The third derivatives of $A_i$ and $Z_i$ are, term by term:\n742: \n743: $$\n744: \\begin{aligned}\n745: D^3 A_i &= \\sum_{\\ell} E_{i\\ell}\\Big(D^3 d_{i\\ell} - 3 \\text{sym}(D^2 d_{i\\ell} \\otimes D r_{i\\ell}) - 3 \\text{sym}(D d_{i\\ell} \\otimes D^2 r_{i\\ell}) \\\\\n746: &\\quad\\quad - d_{i\\ell} D^3 r_{i\\ell} + 3 d_{i\\ell} \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - d_{i\\ell} D r_{i\\ell}^{\\otimes 3}\\Big) \\\\\n747: D^3 Z_i &= \\sum_{\\ell} E_{i\\ell}\\Big(- D r_{i\\ell}^{\\otimes 3} + 3 \\text{sym}(D^2 r_{i\\ell} \\otimes D r_{i\\ell}) - D^3 r_{i\\ell}\\Big)\n748: \\end{aligned}\n749: $$\n750: \n751: After dividing by $Z_i$, each summation turns into $\\mathbb{E}_i[\\cdot]$, so every block in $D^3 d_i$ is again an expectation with weights $P_{i\\ell}$. Thus the Fa\u00e0 di Bruno expansion inherits the same $k$-uniformity: all companion sums appear inside expectations, never multiplied by $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n752: \n753: **Step 4 (Explicit uniform bounds).** Introduce the supremum bounds:\n754: \n755: $$\n756: B_0 = \\sup_{\\ell} |d_{i\\ell}|, \\quad M_m = \\sup_{\\ell} \\|D^m d_{i\\ell}\\|, \\quad m = 1,2,3\n757: $$\n758: \n759: and note:\n760: \n761: $$\n762: \\|D r_{i\\ell}\\| \\leq \\frac{B_0 M_1}{\\varepsilon_c^2} = R_1, \\quad \\|D^2 r_{i\\ell}\\| \\leq \\frac{M_1^2 + B_0 M_2}{\\varepsilon_c^2} = R_2, \\quad \\|D^3 r_{i\\ell}\\| \\leq \\frac{3 M_1 M_2 + B_0 M_3}{\\varepsilon_c^2} = R_3\n763: $$\n764: \n765: Because every derivative of $d_i$ is an expectation, the operator norms are bounded by the maxima of these ingredients, giving the explicit $k$-independent constants:\n766: \n767: $$\n768: \\boxed{\\|D d_i\\| \\leq C_{d,1} = M_1\\left(1 + \\frac{2 B_0^2}{\\varepsilon_c^2}\\right)}\n769: $$\n770: \n771: $$\n772: \\boxed{\\|D^2 d_i\\| \\leq C_{d,2} = M_2 + \\frac{6 B_0 M_1^2 + 2 B_0^2 M_2}{\\varepsilon_c^2} + \\frac{6 B_0^3 M_1^2}{\\varepsilon_c^4}}\n773: $$\n774: \n775: $$\n776: \\boxed{\\|D^3 d_i\\| \\leq C_{d,3} = M_3 + \\frac{6 M_1^3 + 18 B_0 M_1 M_2 + 2 B_0^2 M_3}{\\varepsilon_c^2} + \\frac{33 B_0^2 M_1^3 + 18 B_0^3 M_1 M_2}{\\varepsilon_c^4} + \\frac{26 B_0^4 M_1^3}{\\varepsilon_c^6}}\n777: $$\n778: \n779: Each $C_{d,k}$ depends only on uniform bounds of the pairwise distances and their derivatives, never on $|\\mathcal{A}|$ or $k_{\\text{eff}}^{(\\varepsilon_c)}$.\n780: \n781: \n782: **Step 5 (Simplification with regularized metric bounds).** Substitute the explicit bounds for the regularized algorithmic distance:\n783: \n784: $$\n785: M_1 = \\|\\nabla d_{i\\ell}\\| = 1, \\quad M_2 = \\|\\nabla^2 d_{i\\ell}\\| = \\frac{2}{\\varepsilon_d}, \\quad M_3 = \\|\\nabla^3 d_{i\\ell}\\| = \\frac{6}{\\varepsilon_d^2}, \\quad B_0 = D_{\\max}\n786: $$\n787: \n788: For $C_{d,3}$, the boxed formula becomes:\n789: \n790: $$\n791: \\begin{aligned}\n792: C_{d,3} &= \\frac{6}{\\varepsilon_d^2} + \\frac{6 \\cdot 1 + 18 D_{\\max} \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d} + 2 D_{\\max}^2 \\cdot \\frac{6}{\\varepsilon_d^2}}{\\varepsilon_c^2} \\\\\n793: &\\quad + \\frac{33 D_{\\max}^2 \\cdot 1 + 18 D_{\\max}^3 \\cdot 1 \\cdot \\frac{2}{\\varepsilon_d}}{\\varepsilon_c^4} + \\frac{26 D_{\\max}^4 \\cdot 1}{\\varepsilon_c^6}\n794: \\end{aligned}\n795: $$\n796: \n797: Collecting $\\varepsilon_d^{-2}$ terms:\n798: \n799: $$\n800: C_{d,3} = \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{2 D_{\\max}^2}{\\varepsilon_c^2}\\right) + O(\\varepsilon_d^{-1}) + O(1)\n801: $$\n802: \n803: For the typical regime $\\varepsilon_d \\ll \\varepsilon_c$, the dominant term is:\n804: \n805: $$\n806: C_{d,3} \\approx \\frac{6}{\\varepsilon_d^2}\\left(1 + \\frac{D_{\\max}^2}{\\varepsilon_c^2}\\right) + \\frac{15 D_{\\max}^3}{\\varepsilon_c^4}\n807: $$\n808: \n809: matching the simplified formula stated in the lemma (where subdominant $\\varepsilon_d^{-1}$ and constant terms are absorbed). \u220e\n810: \n811: The full model involves **two distinct spatial scales** that work together to maintain k-uniform bounds:\n812: \n813: **Scale 1: Companion Selection** (controlled by $\\varepsilon_c$):\n814: - **Purpose**: Select companions for measurements\n815: - **Effective interactions**: $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\varepsilon_c^{2d} (\\log k)^d)$ (NOT k-uniform)\n816: - **Key mechanism**: **Derivative locality** (\u00a72.5.4) eliminates \u2113-sums before $(\\log k)^d$ can appear\n817: - **Result for j\u2260i**: Only companion $\\ell = i$ contributes to $\\nabla_i d_j$ \u2192 single term, no log factor\n818: \n819: **Scale 2: Localization Weights** (controlled by $\\rho$):\n820: - **Purpose**: Compute local statistics (mean, variance)\n821: - **Effective interactions**: $k_{\\text{eff}}^{(\\rho)} = O(\\rho^{2d})$ (IS k-uniform)\n822: - **Key mechanism**: **Telescoping identity** (\u00a72.7) from $\\sum_j w_{ij} = 1$\n823: - **Result**: Naive $O(k)$ sum over $j$ cancels to $O(\\rho^{2d})$ (k-uniform)\n824: \n825: **Combined Effect**: Despite N-body coupling from companion selection:\n826: 1. Derivative locality prevents $(\\log k)^d$ at the \u03b5_c-scale\n827: 2. Telescoping controls $j$-sums at the \u03c1-scale\n828: 3. Result: **k-uniform third-derivative bounds** for the full companion-dependent model\n829: \n830: **Typical parameter hierarchy**: $\\varepsilon_d \\ll \\varepsilon_c \\lesssim \\rho \\ll 1$\n831: \n832: This two-scale framework is essential for all k-uniformity proofs in Chapters 5-8.\n833: \n834: ### 2.7. k-Uniformity and Telescoping Properties\n835: \n836: A bound is **k-uniform** if it is independent of the alive walker count $k = |A_k|$. The key technical tool for proving k-uniformity is the **telescoping property** of normalized weights:\n837: \n838: :::{prf:lemma} Telescoping Identity for Derivatives\n839: :label: lem-telescoping-derivatives\n840: \n841: For any derivative order $m \\in \\{1, 2, 3\\}$, the localization weights satisfy:\n842: $$\n843: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = 0"
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-telescoping-derivatives",
      "title": null,
      "start_line": 845,
      "end_line": 881,
      "header_lines": [
        846
      ],
      "content_start": 848,
      "content_end": 880,
      "content": "848: :label: proof-lem-telescoping-derivatives\n849: \n850: **Overview**: We prove that the normalization constraint $\\sum_j w_{ij}(\\rho) = 1$ holds identically in $x_i$, each weight is $C^3$, and differentiating both sides yields the telescoping identity.\n851: \n852: **Step 1: Normalization identity.**\n853: \n854: By definition, the localization weights are $w_{ij}(\\rho) := K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) := \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$. Since the kernel $K_\\rho$ is strictly positive (Gaussian kernel), we have $Z_i(\\rho) > 0$. Therefore:\n855: $$\n856: \\sum_{j \\in A_k} w_{ij}(\\rho) = \\sum_{j \\in A_k} \\frac{K_\\rho(x_i, x_j)}{Z_i(\\rho)} = \\frac{1}{Z_i(\\rho)} \\sum_{j \\in A_k} K_\\rho(x_i, x_j) = \\frac{Z_i(\\rho)}{Z_i(\\rho)} = 1\n857: $$\n858: \n859: This holds identically for all $x_i \\in \\mathcal{X}$.\n860: \n861: **Step 2: Regularity of weights.**\n862: \n863: Each weight $w_{ij}(\\rho)$ is $C^3$ in $x_i$ by the quotient rule: the numerator $K_\\rho(x_i, x_j)$ is $C^3$ (Gaussian kernel), the denominator $Z_i(\\rho)$ is $C^3$ (finite sum of $C^3$ functions), and $Z_i(\\rho) > 0$ ensures the quotient is well-defined and $C^3$.\n864: \n865: **Step 3: Differentiation.**\n866: \n867: Apply $\\nabla^m_{x_i}$ for $m \\in \\{1,2,3\\}$ to both sides of the identity $\\sum_j w_{ij}(\\rho) = 1$. By linearity of differentiation and finiteness of the sum:\n868: $$\n869: \\nabla^m_{x_i} \\left(\\sum_{j \\in A_k} w_{ij}(\\rho)\\right) = \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho)\n870: $$\n871: \n872: The right-hand side of the original identity is the constant function 1, so $\\nabla^m_{x_i}(1) = 0$ for all $m \\geq 1$.\n873: \n874: **Step 4: Conclusion.**\n875: \n876: Combining the above:\n877: $$\n878: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = \\nabla^m_{x_i}(1) = 0\n879: $$\n880: ",
      "metadata": {
        "label": "proof-lem-telescoping-derivatives"
      },
      "section": "## 2. Mathematical Framework and Notation",
      "references": [],
      "raw_directive": "845: :::\n846: \n847: :::{prf:proof}\n848: :label: proof-lem-telescoping-derivatives\n849: \n850: **Overview**: We prove that the normalization constraint $\\sum_j w_{ij}(\\rho) = 1$ holds identically in $x_i$, each weight is $C^3$, and differentiating both sides yields the telescoping identity.\n851: \n852: **Step 1: Normalization identity.**\n853: \n854: By definition, the localization weights are $w_{ij}(\\rho) := K_\\rho(x_i, x_j) / Z_i(\\rho)$ where $Z_i(\\rho) := \\sum_{\\ell \\in A_k} K_\\rho(x_i, x_\\ell)$. Since the kernel $K_\\rho$ is strictly positive (Gaussian kernel), we have $Z_i(\\rho) > 0$. Therefore:\n855: $$\n856: \\sum_{j \\in A_k} w_{ij}(\\rho) = \\sum_{j \\in A_k} \\frac{K_\\rho(x_i, x_j)}{Z_i(\\rho)} = \\frac{1}{Z_i(\\rho)} \\sum_{j \\in A_k} K_\\rho(x_i, x_j) = \\frac{Z_i(\\rho)}{Z_i(\\rho)} = 1\n857: $$\n858: \n859: This holds identically for all $x_i \\in \\mathcal{X}$.\n860: \n861: **Step 2: Regularity of weights.**\n862: \n863: Each weight $w_{ij}(\\rho)$ is $C^3$ in $x_i$ by the quotient rule: the numerator $K_\\rho(x_i, x_j)$ is $C^3$ (Gaussian kernel), the denominator $Z_i(\\rho)$ is $C^3$ (finite sum of $C^3$ functions), and $Z_i(\\rho) > 0$ ensures the quotient is well-defined and $C^3$.\n864: \n865: **Step 3: Differentiation.**\n866: \n867: Apply $\\nabla^m_{x_i}$ for $m \\in \\{1,2,3\\}$ to both sides of the identity $\\sum_j w_{ij}(\\rho) = 1$. By linearity of differentiation and finiteness of the sum:\n868: $$\n869: \\nabla^m_{x_i} \\left(\\sum_{j \\in A_k} w_{ij}(\\rho)\\right) = \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho)\n870: $$\n871: \n872: The right-hand side of the original identity is the constant function 1, so $\\nabla^m_{x_i}(1) = 0$ for all $m \\geq 1$.\n873: \n874: **Step 4: Conclusion.**\n875: \n876: Combining the above:\n877: $$\n878: \\sum_{j \\in A_k} \\nabla^m_{x_i} w_{ij}(\\rho) = \\nabla^m_{x_i}(1) = 0\n879: $$\n880: \n881: This completes the proof for all $m \\in \\{1, 2, 3\\}$."
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}