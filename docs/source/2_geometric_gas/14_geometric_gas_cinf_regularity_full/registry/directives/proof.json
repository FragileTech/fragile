{
  "document_id": "14_geometric_gas_cinf_regularity_full",
  "stage": "directives",
  "directive_type": "proof",
  "generated_at": "2025-11-08T17:16:20.243845+00:00",
  "count": 39,
  "items": [
    {
      "directive_type": "proof",
      "label": "proof-lem-fokker-planck-density-bound-conservative-full",
      "title": null,
      "start_line": 630,
      "end_line": 649,
      "header_lines": [
        631
      ],
      "content_start": 633,
      "content_end": 648,
      "content": "633: :label: proof-lem-fokker-planck-density-bound-conservative-full\n634: \n635: **Proof sketch** (conservative case):\n636: \n637: The generator for the conservative Langevin dynamics is:\n638: \n639: $$\n640: \\mathcal{L} f = -\\psi(v) \\cdot \\nabla_x f + \\gamma v \\cdot \\nabla_v f + \\nabla_x V_{\\text{fit}} \\cdot \\nabla_v f + \\gamma T \\Delta_v f\n641: \n642: $$\n643: \n644: **Key steps**:\n645: 1. Lipschitz drift + non-degenerate diffusion ‚Üí semigroup maps L^‚àû to L^‚àû\n646: 2. Compactness of ùí≥ √ó V ‚Üí V_fit and kinetic energy uniformly bounded\n647: 3. Invariant density satisfies: œÅ_‚àû(x,v) ‚â§ C exp((V_fit(x) + ¬Ω‚Äñv‚Äñ¬≤)/(Œ≥T))\n648: 4. Since both terms in exponent are bounded ‚Üí œÅ_‚àû ‚â§ C_FK < ‚àû",
      "metadata": {
        "label": "proof-lem-fokker-planck-density-bound-conservative-full"
      },
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "630: :::\n631: \n632: :::{prf:proof}\n633: :label: proof-lem-fokker-planck-density-bound-conservative-full\n634: \n635: **Proof sketch** (conservative case):\n636: \n637: The generator for the conservative Langevin dynamics is:\n638: \n639: $$\n640: \\mathcal{L} f = -\\psi(v) \\cdot \\nabla_x f + \\gamma v \\cdot \\nabla_v f + \\nabla_x V_{\\text{fit}} \\cdot \\nabla_v f + \\gamma T \\Delta_v f\n641: \n642: $$\n643: \n644: **Key steps**:\n645: 1. Lipschitz drift + non-degenerate diffusion ‚Üí semigroup maps L^‚àû to L^‚àû\n646: 2. Compactness of ùí≥ √ó V ‚Üí V_fit and kinetic energy uniformly bounded\n647: 3. Invariant density satisfies: œÅ_‚àû(x,v) ‚â§ C exp((V_fit(x) + ¬Ω‚Äñv‚Äñ¬≤)/(Œ≥T))\n648: 4. Since both terms in exponent are bounded ‚Üí œÅ_‚àû ‚â§ C_FK < ‚àû\n649: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-verif-density-bound-consistency-full",
      "title": null,
      "start_line": 747,
      "end_line": 768,
      "header_lines": [
        748
      ],
      "content_start": 750,
      "content_end": 767,
      "content": "750: :label: proof-verif-density-bound-consistency-full\n751: \n752: Because $T$ is affine, $|T(\\rho_1) - T(\\rho_2)| = \\beta_1 |\\rho_1 - \\rho_2|$.\n753: \n754: The inequality $\\beta_1 < 1$ makes $T$ a strict contraction.\n755: \n756: Moreover, $T(0) = \\beta_0 \\geq 0$ and $T(\\rho_{\\text{upper}}) = \\beta_0 + \\beta_1 \\rho_{\\text{upper}} = \\rho_{\\text{upper}}$, so $T$ maps the closed interval to itself.\n757: \n758: Banach's Fixed-Point Theorem therefore yields a unique $\\rho_{\\max}^*$ satisfying $\\rho_{\\max}^* = T(\\rho_{\\max}^*)$ and $\\rho_{\\max}^* \\leq \\rho_{\\text{upper}}$.\n759: \n760: By construction:\n761: \n762: $$\n763: \\rho_{\\max}^* = C_{\\text{QSD}}\\left(A_0 + A_1\\left(L_0 + C_{\\nabla V}\\rho_{\\max}^*\\right)\\right)\n764: \n765: $$\n766: \n767: which is exactly the consistency equation for the uniform density bound.",
      "metadata": {
        "label": "proof-verif-density-bound-consistency-full"
      },
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "747: :::\n748: \n749: :::{prf:proof}\n750: :label: proof-verif-density-bound-consistency-full\n751: \n752: Because $T$ is affine, $|T(\\rho_1) - T(\\rho_2)| = \\beta_1 |\\rho_1 - \\rho_2|$.\n753: \n754: The inequality $\\beta_1 < 1$ makes $T$ a strict contraction.\n755: \n756: Moreover, $T(0) = \\beta_0 \\geq 0$ and $T(\\rho_{\\text{upper}}) = \\beta_0 + \\beta_1 \\rho_{\\text{upper}} = \\rho_{\\text{upper}}$, so $T$ maps the closed interval to itself.\n757: \n758: Banach's Fixed-Point Theorem therefore yields a unique $\\rho_{\\max}^*$ satisfying $\\rho_{\\max}^* = T(\\rho_{\\max}^*)$ and $\\rho_{\\max}^* \\leq \\rho_{\\text{upper}}$.\n759: \n760: By construction:\n761: \n762: $$\n763: \\rho_{\\max}^* = C_{\\text{QSD}}\\left(A_0 + A_1\\left(L_0 + C_{\\nabla V}\\rho_{\\max}^*\\right)\\right)\n764: \n765: $$\n766: \n767: which is exactly the consistency equation for the uniform density bound.\n768: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-companion-availability-enforcement",
      "title": null,
      "start_line": 794,
      "end_line": 851,
      "header_lines": [
        795
      ],
      "content_start": 797,
      "content_end": 850,
      "content": "797: :label: proof-lem-companion-availability-enforcement\n798: \n799: **Direct proof from compactness and minimum walker requirement.**\n800: \n801: The proof uses ONLY primitive assumptions:\n802: 1. **Bounded domain**: $\\mathcal{X} \\times V$ is compact, so $D_{\\max} := \\text{diam}(\\mathcal{X} \\times V) < \\infty$\n803: 2. **Minimum walkers**: Cloning enforces $k \\geq k_{\\min} \\geq 2$ (at least 2 alive walkers)\n804: 3. **Self-exclusion**: By definition, walker $i$ cannot choose itself as companion\n805: \n806: **Step 1: Partition function structure.**\n807: \n808: The softmax partition function is:\n809: \n810: $$\n811: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n812: \n813: $$\n814: \n815: Since $k \\geq 2$, the set $\\mathcal{A} \\setminus \\{i\\}$ contains **at least one walker** $\\ell \\neq i$. Therefore, the sum has at least $k-1 \\geq 1$ term.\n816: \n817: **Step 2: Lower bound for each term.**\n818: \n819: For any walker $\\ell \\in \\mathcal{A} \\setminus \\{i\\}$:\n820: \n821: $$\n822: \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right)\n823: \n824: $$\n825: \n826: since $d_{\\text{alg}}(i,\\ell) \\leq D_{\\max}$ by compactness (worst case: $\\ell$ is at maximum distance from $i$).\n827: \n828: **Step 3: Combine to obtain lower bound.**\n829: \n830: Since $Z_i$ is a sum of at least one term, each at least $\\exp(-D_{\\max}^2/(2\\varepsilon_c^2))$:\n831: \n832: $$\n833: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n834: \n835: $$\n836: \n837: **Step 4: k-uniformity verification.**\n838: \n839: The bound $Z_{\\min}$ depends only on:\n840: - **Domain diameter** $D_{\\max}$ (geometric property of $\\mathcal{X} \\times V$)\n841: - **Companion scale** $\\varepsilon_c$ (algorithmic parameter)\n842: \n843: It does **not** depend on:\n844: - ‚úó Number of alive walkers $k$\n845: - ‚úó Total walker count $N$\n846: - ‚úó Walker positions $\\{(x_j, v_j)\\}_{j \\in \\mathcal{A}}$\n847: - ‚úó Fitness potential regularity\n848: - ‚úó Density bounds\n849: \n850: **Conclusion**: The partition function lower bound $Z_i \\geq Z_{\\min} > 0$ holds **for all walkers** $i \\in \\mathcal{A}$ and **all swarm configurations** with $k \\geq 2$. This is a **primitive geometric bound** requiring no regularity or density assumptions.",
      "metadata": {
        "label": "proof-lem-companion-availability-enforcement"
      },
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "794: :::\n795: \n796: :::{prf:proof}\n797: :label: proof-lem-companion-availability-enforcement\n798: \n799: **Direct proof from compactness and minimum walker requirement.**\n800: \n801: The proof uses ONLY primitive assumptions:\n802: 1. **Bounded domain**: $\\mathcal{X} \\times V$ is compact, so $D_{\\max} := \\text{diam}(\\mathcal{X} \\times V) < \\infty$\n803: 2. **Minimum walkers**: Cloning enforces $k \\geq k_{\\min} \\geq 2$ (at least 2 alive walkers)\n804: 3. **Self-exclusion**: By definition, walker $i$ cannot choose itself as companion\n805: \n806: **Step 1: Partition function structure.**\n807: \n808: The softmax partition function is:\n809: \n810: $$\n811: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n812: \n813: $$\n814: \n815: Since $k \\geq 2$, the set $\\mathcal{A} \\setminus \\{i\\}$ contains **at least one walker** $\\ell \\neq i$. Therefore, the sum has at least $k-1 \\geq 1$ term.\n816: \n817: **Step 2: Lower bound for each term.**\n818: \n819: For any walker $\\ell \\in \\mathcal{A} \\setminus \\{i\\}$:\n820: \n821: $$\n822: \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right)\n823: \n824: $$\n825: \n826: since $d_{\\text{alg}}(i,\\ell) \\leq D_{\\max}$ by compactness (worst case: $\\ell$ is at maximum distance from $i$).\n827: \n828: **Step 3: Combine to obtain lower bound.**\n829: \n830: Since $Z_i$ is a sum of at least one term, each at least $\\exp(-D_{\\max}^2/(2\\varepsilon_c^2))$:\n831: \n832: $$\n833: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n834: \n835: $$\n836: \n837: **Step 4: k-uniformity verification.**\n838: \n839: The bound $Z_{\\min}$ depends only on:\n840: - **Domain diameter** $D_{\\max}$ (geometric property of $\\mathcal{X} \\times V$)\n841: - **Companion scale** $\\varepsilon_c$ (algorithmic parameter)\n842: \n843: It does **not** depend on:\n844: - ‚úó Number of alive walkers $k$\n845: - ‚úó Total walker count $N$\n846: - ‚úó Walker positions $\\{(x_j, v_j)\\}_{j \\in \\mathcal{A}}$\n847: - ‚úó Fitness potential regularity\n848: - ‚úó Density bounds\n849: \n850: **Conclusion**: The partition function lower bound $Z_i \\geq Z_{\\min} > 0$ holds **for all walkers** $i \\in \\mathcal{A}$ and **all swarm configurations** with $k \\geq 2$. This is a **primitive geometric bound** requiring no regularity or density assumptions.\n851: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-high-prob-min-separation-full",
      "title": null,
      "start_line": 901,
      "end_line": 957,
      "header_lines": [
        902
      ],
      "content_start": 904,
      "content_end": 956,
      "content": "904: :label: proof-lem-high-prob-min-separation-full\n905: \n906: **Step 1: Collision probability for Brownian particles.**\n907: \n908: Consider two walkers $i, j$ undergoing independent Langevin dynamics in phase space. The relative position $X_t = x_i(t) - x_j(t)$ satisfies:\n909: \n910: $$\n911: dX_t = (v_i - v_j) dt, \\quad dv_i = -\\gamma v_i dt + \\sqrt{2\\gamma T} dW_i\n912: \n913: $$\n914: \n915: with independent Brownian motions $W_i, W_j$. The probability that $\\|X_t\\| < r$ for some $t \\in [0, \\tau]$ (collision within time $\\tau$) satisfies the heat kernel bound:\n916: \n917: $$\n918: \\mathbb{P}(\\|X_t\\| < r \\text{ for some } t \\leq \\tau) \\leq C \\cdot \\frac{r^d}{\\sqrt{D\\tau}} \\cdot \\exp\\left(-\\frac{\\|X_0\\|^2}{4D\\tau}\\right)\n919: \n920: $$\n921: \n922: where $D = T/\\gamma$ is the effective diffusion constant.\n923: \n924: **Step 2: Union bound over all pairs.**\n925: \n926: There are $\\binom{k}{2} = O(k^2)$ walker pairs. By union bound:\n927: \n928: $$\n929: \\mathbb{P}(\\exists \\, i \\neq j : d_{\\text{alg}}(i,j) < r_{\\min}) \\leq k^2 \\cdot \\mathbb{P}(\\text{single pair collision})\n930: \n931: $$\n932: \n933: Setting $r_{\\min} = \\varepsilon_d$ (the distance regularization scale) and using QSD stationarity (typical separation $\\sim k^{-1/2d}$ from random packing):\n934: \n935: $$\n936: \\mathbb{P}(\\text{collision}) \\leq C k^2 \\cdot e^{-c k^{1/d}}\n937: \n938: $$\n939: \n940: For $d \\geq 2$, this is super-polynomial in $k$.\n941: \n942: **Step 3: Cloning enhances separation.**\n943: \n944: The cloning operator preferentially removes low-fitness walkers, which tend to be closer to existing walkers (lower algorithmic diversity). This **enhances** the minimum separation beyond what pure Langevin dynamics provides. By {prf:ref}`doc-03-cloning` Theorem 5.2 (Diversity Maintenance Principle), cloning ensures:\n945: \n946: $$\n947: \\mathbb{E}[\\min_{i \\neq j} d_{\\text{alg}}(i,j)] \\geq C_{\\text{clone}} \\cdot \\varepsilon_c\n948: \n949: $$\n950: \n951: Combined with diffusion, this yields exponential concentration:\n952: \n953: $$\n954: \\mathbb{P}(\\min d_{\\text{alg}} < r_{\\min}) \\leq C_{\\text{sep}} e^{-c_{\\text{sep}} k}\n955: \n956: $$",
      "metadata": {
        "label": "proof-lem-high-prob-min-separation-full"
      },
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "901: :::\n902: \n903: :::{prf:proof}\n904: :label: proof-lem-high-prob-min-separation-full\n905: \n906: **Step 1: Collision probability for Brownian particles.**\n907: \n908: Consider two walkers $i, j$ undergoing independent Langevin dynamics in phase space. The relative position $X_t = x_i(t) - x_j(t)$ satisfies:\n909: \n910: $$\n911: dX_t = (v_i - v_j) dt, \\quad dv_i = -\\gamma v_i dt + \\sqrt{2\\gamma T} dW_i\n912: \n913: $$\n914: \n915: with independent Brownian motions $W_i, W_j$. The probability that $\\|X_t\\| < r$ for some $t \\in [0, \\tau]$ (collision within time $\\tau$) satisfies the heat kernel bound:\n916: \n917: $$\n918: \\mathbb{P}(\\|X_t\\| < r \\text{ for some } t \\leq \\tau) \\leq C \\cdot \\frac{r^d}{\\sqrt{D\\tau}} \\cdot \\exp\\left(-\\frac{\\|X_0\\|^2}{4D\\tau}\\right)\n919: \n920: $$\n921: \n922: where $D = T/\\gamma$ is the effective diffusion constant.\n923: \n924: **Step 2: Union bound over all pairs.**\n925: \n926: There are $\\binom{k}{2} = O(k^2)$ walker pairs. By union bound:\n927: \n928: $$\n929: \\mathbb{P}(\\exists \\, i \\neq j : d_{\\text{alg}}(i,j) < r_{\\min}) \\leq k^2 \\cdot \\mathbb{P}(\\text{single pair collision})\n930: \n931: $$\n932: \n933: Setting $r_{\\min} = \\varepsilon_d$ (the distance regularization scale) and using QSD stationarity (typical separation $\\sim k^{-1/2d}$ from random packing):\n934: \n935: $$\n936: \\mathbb{P}(\\text{collision}) \\leq C k^2 \\cdot e^{-c k^{1/d}}\n937: \n938: $$\n939: \n940: For $d \\geq 2$, this is super-polynomial in $k$.\n941: \n942: **Step 3: Cloning enhances separation.**\n943: \n944: The cloning operator preferentially removes low-fitness walkers, which tend to be closer to existing walkers (lower algorithmic diversity). This **enhances** the minimum separation beyond what pure Langevin dynamics provides. By {prf:ref}`doc-03-cloning` Theorem 5.2 (Diversity Maintenance Principle), cloning ensures:\n945: \n946: $$\n947: \\mathbb{E}[\\min_{i \\neq j} d_{\\text{alg}}(i,j)] \\geq C_{\\text{clone}} \\cdot \\varepsilon_c\n948: \n949: $$\n950: \n951: Combined with diffusion, this yields exponential concentration:\n952: \n953: $$\n954: \\mathbb{P}(\\min d_{\\text{alg}} < r_{\\min}) \\leq C_{\\text{sep}} e^{-c_{\\text{sep}} k}\n955: \n956: $$\n957: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-sum-to-integral-bound-full",
      "title": null,
      "start_line": 995,
      "end_line": 1070,
      "header_lines": [
        996
      ],
      "content_start": 998,
      "content_end": 1069,
      "content": "998: :label: proof-lem-sum-to-integral-bound-full\n999: \n1000: **Step 1: High-probability packing bound.**\n1001: \n1002: By {prf:ref}`lem-high-prob-min-separation-full`, with probability $\\geq 1 - \\delta$ (where $\\delta = C_{\\text{sep}} e^{-c_{\\text{sep}} k}$), all walker pairs satisfy $d_{\\text{alg}}(i,j) \\geq r_{\\min}$. On this high-probability set, we have a **packing bound**: for any measurable set $S \\subset \\mathcal{X} \\times \\mathbb{R}^d$,\n1003: \n1004: $$\n1005: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\frac{\\text{Vol}(S)}{V_{\\text{excl}}(r_{\\min})}\n1006: \n1007: $$\n1008: \n1009: where $V_{\\text{excl}}(r_{\\min}) = C_{\\text{vol}} r_{\\min}^{2d}$ is the volume of an exclusion ball.\n1010: \n1011: By {prf:ref}`assump-uniform-density-full`, the QSD density satisfies $\\rho_{\\text{phase}}^{\\text{QSD}}(x,v) \\leq \\rho_{\\max}$. The packing and density bounds together give:\n1012: \n1013: $$\n1014: \\mathbb{E}[\\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\}] \\leq \\rho_{\\max} \\cdot \\text{Vol}(S) + \\delta \\cdot k\n1015: \n1016: $$\n1017: \n1018: For $k$ sufficiently large (e.g., $k \\geq 20$), the error term $\\delta \\cdot k = k \\cdot C_{\\text{sep}} e^{-c_{\\text{sep}} k} = o(1)$ is negligible. Therefore:\n1019: \n1020: $$\n1021: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(S) \\cdot (1 + o(1))\n1022: \n1023: $$\n1024: \n1025: with probability $1 - o(e^{-k})$. **For the remainder of the proof, we work on the high-probability set where minimum separation holds.**\n1026: \n1027: **Step 2: Upper bound via integral.**\n1028: \n1029: For any non-negative weight function $w(y, u)$ and $|f| \\leq M$:\n1030: \n1031: $$\n1032: \\begin{aligned}\n1033: \\sum_{j \\in \\mathcal{A}} f(x_j, v_j) \\, w(x_j, v_j)\n1034: &\\leq M \\sum_{j \\in \\mathcal{A}} w(x_j, v_j) \\\\\n1035: &\\leq M \\cdot \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} w(y, u) \\, dy \\, du\n1036: \\end{aligned}\n1037: \n1038: $$\n1039: \n1040: **Step 3: Gaussian weight evaluation.**\n1041: \n1042: For the exponential weight $w(y,u) = \\exp(-d_{\\text{alg}}^2(i,(y,u))/(2\\varepsilon_c^2))$:\n1043: \n1044: $$\n1045: \\begin{aligned}\n1046: \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{\\|y - x_i\\|^2 + \\lambda_{\\text{alg}} \\|u - v_i\\|^2 + \\varepsilon_d^2}{2\\varepsilon_c^2}\\right) dy\\,du\n1047: &\\leq \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right) \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y\\|^2 + \\lambda_{\\text{alg}} \\|u\\|^2}{2\\varepsilon_c^2}\\right) dy\\,du \\\\\n1048: &= (2\\pi\\varepsilon_c^2)^d \\cdot \\lambda_{\\text{alg}}^{-d/2} \\cdot \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right)\n1049: \\end{aligned}\n1050: \n1051: $$\n1052: \n1053: (using Gaussian integral formula in $2d$ dimensions with rescaling).\n1054: \n1055: **Step 4: k-uniformity.**\n1056: \n1057: The bound:\n1058: \n1059: $$\n1060: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_c^2}\\right)\n1061: \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n1062: \n1063: $$\n1064: \n1065: depends only on:\n1066: - $\\rho_{\\max}$ (framework assumption)\n1067: - $\\varepsilon_c$ (algorithmic parameter)\n1068: - $d$ (dimension)\n1069: - $\\lambda_{\\text{alg}}$ (distance metric parameter)",
      "metadata": {
        "label": "proof-lem-sum-to-integral-bound-full"
      },
      "section": "## 2. Companion Selection Mechanisms: Framework Context",
      "raw_directive": "995: :::\n996: \n997: :::{prf:proof}\n998: :label: proof-lem-sum-to-integral-bound-full\n999: \n1000: **Step 1: High-probability packing bound.**\n1001: \n1002: By {prf:ref}`lem-high-prob-min-separation-full`, with probability $\\geq 1 - \\delta$ (where $\\delta = C_{\\text{sep}} e^{-c_{\\text{sep}} k}$), all walker pairs satisfy $d_{\\text{alg}}(i,j) \\geq r_{\\min}$. On this high-probability set, we have a **packing bound**: for any measurable set $S \\subset \\mathcal{X} \\times \\mathbb{R}^d$,\n1003: \n1004: $$\n1005: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\frac{\\text{Vol}(S)}{V_{\\text{excl}}(r_{\\min})}\n1006: \n1007: $$\n1008: \n1009: where $V_{\\text{excl}}(r_{\\min}) = C_{\\text{vol}} r_{\\min}^{2d}$ is the volume of an exclusion ball.\n1010: \n1011: By {prf:ref}`assump-uniform-density-full`, the QSD density satisfies $\\rho_{\\text{phase}}^{\\text{QSD}}(x,v) \\leq \\rho_{\\max}$. The packing and density bounds together give:\n1012: \n1013: $$\n1014: \\mathbb{E}[\\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\}] \\leq \\rho_{\\max} \\cdot \\text{Vol}(S) + \\delta \\cdot k\n1015: \n1016: $$\n1017: \n1018: For $k$ sufficiently large (e.g., $k \\geq 20$), the error term $\\delta \\cdot k = k \\cdot C_{\\text{sep}} e^{-c_{\\text{sep}} k} = o(1)$ is negligible. Therefore:\n1019: \n1020: $$\n1021: \\#\\{j \\in \\mathcal{A} : (x_j, v_j) \\in S\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(S) \\cdot (1 + o(1))\n1022: \n1023: $$\n1024: \n1025: with probability $1 - o(e^{-k})$. **For the remainder of the proof, we work on the high-probability set where minimum separation holds.**\n1026: \n1027: **Step 2: Upper bound via integral.**\n1028: \n1029: For any non-negative weight function $w(y, u)$ and $|f| \\leq M$:\n1030: \n1031: $$\n1032: \\begin{aligned}\n1033: \\sum_{j \\in \\mathcal{A}} f(x_j, v_j) \\, w(x_j, v_j)\n1034: &\\leq M \\sum_{j \\in \\mathcal{A}} w(x_j, v_j) \\\\\n1035: &\\leq M \\cdot \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} w(y, u) \\, dy \\, du\n1036: \\end{aligned}\n1037: \n1038: $$\n1039: \n1040: **Step 3: Gaussian weight evaluation.**\n1041: \n1042: For the exponential weight $w(y,u) = \\exp(-d_{\\text{alg}}^2(i,(y,u))/(2\\varepsilon_c^2))$:\n1043: \n1044: $$\n1045: \\begin{aligned}\n1046: \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{\\|y - x_i\\|^2 + \\lambda_{\\text{alg}} \\|u - v_i\\|^2 + \\varepsilon_d^2}{2\\varepsilon_c^2}\\right) dy\\,du\n1047: &\\leq \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right) \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y\\|^2 + \\lambda_{\\text{alg}} \\|u\\|^2}{2\\varepsilon_c^2}\\right) dy\\,du \\\\\n1048: &= (2\\pi\\varepsilon_c^2)^d \\cdot \\lambda_{\\text{alg}}^{-d/2} \\cdot \\exp\\left(-\\frac{\\varepsilon_d^2}{2\\varepsilon_c^2}\\right)\n1049: \\end{aligned}\n1050: \n1051: $$\n1052: \n1053: (using Gaussian integral formula in $2d$ dimensions with rescaling).\n1054: \n1055: **Step 4: k-uniformity.**\n1056: \n1057: The bound:\n1058: \n1059: $$\n1060: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_c^2}\\right)\n1061: \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n1062: \n1063: $$\n1064: \n1065: depends only on:\n1066: - $\\rho_{\\max}$ (framework assumption)\n1067: - $\\varepsilon_c$ (algorithmic parameter)\n1068: - $d$ (dimension)\n1069: - $\\lambda_{\\text{alg}}$ (distance metric parameter)\n1070: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Companion Selection Mechanisms: Framework Context"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-partition-derivative-bounds-full",
      "title": null,
      "start_line": 1196,
      "end_line": 1240,
      "header_lines": [
        1197
      ],
      "content_start": 1199,
      "content_end": 1239,
      "content": "1199: :label: proof-lem-partition-derivative-bounds-full\n1200: \n1201: **Step 1: Derivatives of the bump function.**\n1202: \n1203: For the smooth cutoff $\\phi(r)$, standard calculus gives:\n1204: \n1205: $$\n1206: |\\phi^{(n)}(r)| \\leq C_\\phi \\cdot n! \\cdot R^{-n}\n1207: \n1208: $$\n1209: \n1210: where $C_\\phi$ is a universal constant (Gevrey-1 bounds for smooth compactly supported functions).\n1211: \n1212: **Step 2: Chain rule for $\\tilde{\\psi}_m$.**\n1213: \n1214: Since $\\tilde{\\psi}_m(x,v) = \\phi(d_{\\text{alg}}((x,v), (y_m, u_m)) / (2\\varepsilon_c))$, by Fa√† di Bruno formula:\n1215: \n1216: $$\n1217: \\|\\nabla^n \\tilde{\\psi}_m\\|_\\infty \\leq C'_\\phi \\cdot n! \\cdot (2\\varepsilon_c)^{-n}\n1218: \n1219: $$\n1220: \n1221: (using $\\|\\nabla^j d_{\\text{alg}}\\|_\\infty = \\mathcal{O}(1)$ for $j \\geq 1$ - see Lemma {prf:ref}`lem-dalg-derivative-bounds-full`).\n1222: \n1223: **Step 3: Quotient rule for $\\psi_m$.**\n1224: \n1225: The normalized partition function:\n1226: \n1227: $$\n1228: \\psi_m = \\frac{\\tilde{\\psi}_m}{\\sum_{m'} \\tilde{\\psi}_{m'}}\n1229: \n1230: $$\n1231: \n1232: By quotient rule, with denominator bounded below by $1$ (sum of at least one non-zero $\\tilde{\\psi}_{m'}$):\n1233: \n1234: $$\n1235: \\|\\nabla^n \\psi_m\\|_\\infty \\leq C_{\\psi,n} \\cdot \\varepsilon_c^{-n}\n1236: \n1237: $$\n1238: \n1239: where $C_{\\psi,n} = \\mathcal{O}(n!)$ absorbs the combinatorial factors from the quotient rule.",
      "metadata": {
        "label": "proof-lem-partition-derivative-bounds-full"
      },
      "section": "## 3. Smooth Phase-Space Clustering",
      "raw_directive": "1196: :::\n1197: \n1198: :::{prf:proof}\n1199: :label: proof-lem-partition-derivative-bounds-full\n1200: \n1201: **Step 1: Derivatives of the bump function.**\n1202: \n1203: For the smooth cutoff $\\phi(r)$, standard calculus gives:\n1204: \n1205: $$\n1206: |\\phi^{(n)}(r)| \\leq C_\\phi \\cdot n! \\cdot R^{-n}\n1207: \n1208: $$\n1209: \n1210: where $C_\\phi$ is a universal constant (Gevrey-1 bounds for smooth compactly supported functions).\n1211: \n1212: **Step 2: Chain rule for $\\tilde{\\psi}_m$.**\n1213: \n1214: Since $\\tilde{\\psi}_m(x,v) = \\phi(d_{\\text{alg}}((x,v), (y_m, u_m)) / (2\\varepsilon_c))$, by Fa√† di Bruno formula:\n1215: \n1216: $$\n1217: \\|\\nabla^n \\tilde{\\psi}_m\\|_\\infty \\leq C'_\\phi \\cdot n! \\cdot (2\\varepsilon_c)^{-n}\n1218: \n1219: $$\n1220: \n1221: (using $\\|\\nabla^j d_{\\text{alg}}\\|_\\infty = \\mathcal{O}(1)$ for $j \\geq 1$ - see Lemma {prf:ref}`lem-dalg-derivative-bounds-full`).\n1222: \n1223: **Step 3: Quotient rule for $\\psi_m$.**\n1224: \n1225: The normalized partition function:\n1226: \n1227: $$\n1228: \\psi_m = \\frac{\\tilde{\\psi}_m}{\\sum_{m'} \\tilde{\\psi}_{m'}}\n1229: \n1230: $$\n1231: \n1232: By quotient rule, with denominator bounded below by $1$ (sum of at least one non-zero $\\tilde{\\psi}_{m'}$):\n1233: \n1234: $$\n1235: \\|\\nabla^n \\psi_m\\|_\\infty \\leq C_{\\psi,n} \\cdot \\varepsilon_c^{-n}\n1236: \n1237: $$\n1238: \n1239: where $C_{\\psi,n} = \\mathcal{O}(n!)$ absorbs the combinatorial factors from the quotient rule.\n1240: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 3. Smooth Phase-Space Clustering"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-effective-cluster-size-bounds-full",
      "title": null,
      "start_line": 1297,
      "end_line": 1337,
      "header_lines": [
        1298
      ],
      "content_start": 1300,
      "content_end": 1336,
      "content": "1300: :label: proof-lem-effective-cluster-size-bounds-full\n1301: \n1302: This lemma establishes uniform bounds on the effective cluster size using density bounds and geometric measure theory.\n1303: \n1304: **Part 1: Upper bound via density and support**\n1305: \n1306: From {prf:ref}`def-effective-cluster-population-full`, $k_m^{\\text{eff}} = \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j)$. Since $\\psi_m$ has support only within distance $2\\varepsilon_c$ of cluster center $(y_m, u_m)$, only walkers in the phase-space ball $B(y_m, 2\\varepsilon_c)$ contribute.\n1307: \n1308: Under the uniform density bound {prf:ref}`assump-uniform-density-full`, the number of walkers in any ball $B$ satisfies:\n1309: \n1310: $$\n1311: \\#\\{j : (x_j, v_j) \\in B\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(B)\n1312: \n1313: $$\n1314: \n1315: The phase-space has dimension $2d$ (position + velocity), so:\n1316: \n1317: $$\n1318: \\text{Vol}(B(y_m, 2\\varepsilon_c)) = \\frac{\\pi^d}{d!} (2\\varepsilon_c)^{2d} = C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1319: \n1320: $$\n1321: \n1322: where $C_{\\text{vol}} = 2^{2d} \\pi^d / d!$. Therefore:\n1323: \n1324: $$\n1325: k_m^{\\text{eff}} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1326: \n1327: $$\n1328: \n1329: **Part 2: Total population conservation**\n1330: \n1331: The partition functions satisfy $\\sum_{m=1}^M \\psi_m(x, v) = 1$ (partition of unity). Summing over all clusters:\n1332: \n1333: $$\n1334: \\sum_{m=1}^M k_m^{\\text{eff}} = \\sum_{m=1}^M \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} \\sum_{m=1}^M \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} 1 = k\n1335: \n1336: $$",
      "metadata": {
        "label": "proof-lem-effective-cluster-size-bounds-full"
      },
      "section": "## 3. Smooth Phase-Space Clustering",
      "raw_directive": "1297: :::\n1298: \n1299: :::{prf:proof}\n1300: :label: proof-lem-effective-cluster-size-bounds-full\n1301: \n1302: This lemma establishes uniform bounds on the effective cluster size using density bounds and geometric measure theory.\n1303: \n1304: **Part 1: Upper bound via density and support**\n1305: \n1306: From {prf:ref}`def-effective-cluster-population-full`, $k_m^{\\text{eff}} = \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j)$. Since $\\psi_m$ has support only within distance $2\\varepsilon_c$ of cluster center $(y_m, u_m)$, only walkers in the phase-space ball $B(y_m, 2\\varepsilon_c)$ contribute.\n1307: \n1308: Under the uniform density bound {prf:ref}`assump-uniform-density-full`, the number of walkers in any ball $B$ satisfies:\n1309: \n1310: $$\n1311: \\#\\{j : (x_j, v_j) \\in B\\} \\leq \\rho_{\\max} \\cdot \\text{Vol}(B)\n1312: \n1313: $$\n1314: \n1315: The phase-space has dimension $2d$ (position + velocity), so:\n1316: \n1317: $$\n1318: \\text{Vol}(B(y_m, 2\\varepsilon_c)) = \\frac{\\pi^d}{d!} (2\\varepsilon_c)^{2d} = C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1319: \n1320: $$\n1321: \n1322: where $C_{\\text{vol}} = 2^{2d} \\pi^d / d!$. Therefore:\n1323: \n1324: $$\n1325: k_m^{\\text{eff}} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\varepsilon_c^{2d}\n1326: \n1327: $$\n1328: \n1329: **Part 2: Total population conservation**\n1330: \n1331: The partition functions satisfy $\\sum_{m=1}^M \\psi_m(x, v) = 1$ (partition of unity). Summing over all clusters:\n1332: \n1333: $$\n1334: \\sum_{m=1}^M k_m^{\\text{eff}} = \\sum_{m=1}^M \\sum_{j \\in \\mathcal{A}} \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} \\sum_{m=1}^M \\psi_m(x_j, v_j) = \\sum_{j \\in \\mathcal{A}} 1 = k\n1335: \n1336: $$\n1337: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 5,
        "chapter_file": "chapter_5.json",
        "section_id": "## 3. Smooth Phase-Space Clustering"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-softmax-tail-corrected-full",
      "title": null,
      "start_line": 1373,
      "end_line": 1402,
      "header_lines": [
        1374
      ],
      "content_start": 1376,
      "content_end": 1401,
      "content": "1376: :label: proof-lem-softmax-tail-corrected-full\n1377: \n1378: **Step 1: Partition function lower bound.**\n1379: \n1380: By {prf:ref}`lem-companion-availability-enforcement`, there exists $\\ell^* \\in \\mathcal{A} \\setminus \\{i\\}$ with $d_{\\text{alg}}(i, \\ell^*) \\leq R_{\\max}$.\n1381: \n1382: Therefore:\n1383: \n1384: $$\n1385: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\exp\\left(-\\frac{C_{\\text{comp}}^2}{2}\\right) =: Z_{\\min} > 0\n1386: \n1387: $$\n1388: \n1389: **Step 2: Tail probability.**\n1390: \n1391: For $R > R_{\\max}$:\n1392: \n1393: $$\n1394: \\begin{aligned}\n1395: \\mathbb{P}(d_{\\text{alg}}(i,c(i)) > R)\n1396: &= \\sum_{\\ell : d(i,\\ell) > R} \\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_c^2))}{Z_i} \\\\\n1397: &\\leq \\frac{k \\cdot \\exp(-R^2/(2\\varepsilon_c^2))}{Z_{\\min}} \\\\\n1398: &= k \\cdot \\exp\\left(-\\frac{R^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n1399: \\end{aligned}\n1400: \n1401: $$",
      "metadata": {
        "label": "proof-lem-softmax-tail-corrected-full"
      },
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1373: :::\n1374: \n1375: :::{prf:proof}\n1376: :label: proof-lem-softmax-tail-corrected-full\n1377: \n1378: **Step 1: Partition function lower bound.**\n1379: \n1380: By {prf:ref}`lem-companion-availability-enforcement`, there exists $\\ell^* \\in \\mathcal{A} \\setminus \\{i\\}$ with $d_{\\text{alg}}(i, \\ell^*) \\leq R_{\\max}$.\n1381: \n1382: Therefore:\n1383: \n1384: $$\n1385: Z_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\exp\\left(-\\frac{C_{\\text{comp}}^2}{2}\\right) =: Z_{\\min} > 0\n1386: \n1387: $$\n1388: \n1389: **Step 2: Tail probability.**\n1390: \n1391: For $R > R_{\\max}$:\n1392: \n1393: $$\n1394: \\begin{aligned}\n1395: \\mathbb{P}(d_{\\text{alg}}(i,c(i)) > R)\n1396: &= \\sum_{\\ell : d(i,\\ell) > R} \\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_c^2))}{Z_i} \\\\\n1397: &\\leq \\frac{k \\cdot \\exp(-R^2/(2\\varepsilon_c^2))}{Z_{\\min}} \\\\\n1398: &= k \\cdot \\exp\\left(-\\frac{R^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n1399: \\end{aligned}\n1400: \n1401: $$\n1402: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-effective-interaction-radius-full",
      "title": null,
      "start_line": 1424,
      "end_line": 1435,
      "header_lines": [
        1425
      ],
      "content_start": 1427,
      "content_end": 1434,
      "content": "1427: :label: proof-cor-effective-interaction-radius-full\n1428: \n1429: Set the tail bound from {prf:ref}`lem-softmax-tail-corrected-full` equal to $1/k$:\n1430: \n1431: $$\n1432: k \\cdot \\exp\\left(-\\frac{R_{\\text{eff}}^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\frac{1}{k}\n1433: \n1434: $$",
      "metadata": {
        "label": "proof-cor-effective-interaction-radius-full"
      },
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1424: :::\n1425: \n1426: :::{prf:proof}\n1427: :label: proof-cor-effective-interaction-radius-full\n1428: \n1429: Set the tail bound from {prf:ref}`lem-softmax-tail-corrected-full` equal to $1/k$:\n1430: \n1431: $$\n1432: k \\cdot \\exp\\left(-\\frac{R_{\\text{eff}}^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right) = \\frac{1}{k}\n1433: \n1434: $$\n1435: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-effective-companion-count-corrected-full",
      "title": null,
      "start_line": 1474,
      "end_line": 1478,
      "header_lines": [
        1475
      ],
      "content_start": 1477,
      "content_end": 1477,
      "content": "1477: :label: proof-lem-effective-companion-count-corrected-full",
      "metadata": {
        "label": "proof-lem-effective-companion-count-corrected-full"
      },
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1474: :::\n1475: \n1476: :::{prf:proof}\n1477: :label: proof-lem-effective-companion-count-corrected-full\n1478: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-softmax-derivative-locality-full",
      "title": null,
      "start_line": 1520,
      "end_line": 1594,
      "header_lines": [
        1521
      ],
      "content_start": 1523,
      "content_end": 1593,
      "content": "1523: :label: proof-lem-softmax-derivative-locality-full\n1524: \n1525: **Step 1: Structure of softmax probability.**\n1526: \n1527: $$\n1528: P(c(j) = \\ell) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))}{\\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_c^2))} =: \\frac{K_j^\\ell}{Z_j}\n1529: \n1530: $$\n1531: \n1532: where $K_j^\\ell = \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))$ and $Z_j = \\sum_{\\ell'} K_j^{\\ell'}$.\n1533: \n1534: **Step 2: First derivative via quotient rule.**\n1535: \n1536: $$\n1537: \\nabla_{x_i} P(c(j) = \\ell) = \\frac{(\\nabla_{x_i} K_j^\\ell) \\cdot Z_j - K_j^\\ell \\cdot (\\nabla_{x_i} Z_j)}{Z_j^2}\n1538: \n1539: $$\n1540: \n1541: For the Gaussian kernel:\n1542: \n1543: $$\n1544: \\nabla_{x_i} K_j^\\ell = K_j^\\ell \\cdot \\nabla_{x_i} \\left(-\\frac{d_{\\text{alg}}^2(j,\\ell)}{2\\varepsilon_c^2}\\right) = -\\frac{K_j^\\ell}{\\varepsilon_c^2} \\cdot d_{\\text{alg}}(j,\\ell) \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\n1545: \n1546: $$\n1547: \n1548: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\\| \\leq 1$. Therefore:\n1549: \n1550: $$\n1551: \\|\\nabla_{x_i} K_j^\\ell\\| \\leq \\frac{d_{\\text{alg}}(j,\\ell)}{\\varepsilon_c^2} \\cdot K_j^\\ell \\leq \\frac{1}{\\varepsilon_c} \\cdot K_j^\\ell\n1552: \n1553: $$\n1554: \n1555: (using $d_{\\text{alg}}/\\varepsilon_c \\ll 1$ for effective contributors).\n1556: \n1557: **Step 3: Partition function derivative.**\n1558: \n1559: $$\n1560: \\nabla_{x_i} Z_j = \\sum_{\\ell' \\neq j} \\nabla_{x_i} K_j^{\\ell'} = -\\frac{1}{\\varepsilon_c^2} \\sum_{\\ell'} K_j^{\\ell'} \\cdot d_{\\text{alg}}(j,\\ell') \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell')\n1561: \n1562: $$\n1563: \n1564: **Key observation**: If $i = j$ or $i = \\ell$, the derivative acts directly on the exponential. If $i \\neq j, \\ell$, the derivative couples through the N-body softmax structure. However, by exponential concentration:\n1565: \n1566: $$\n1567: \\|\\nabla_{x_i} Z_j\\| \\leq \\frac{k_{\\text{eff}}^{(\\varepsilon_c)}}{\\varepsilon_c^2} \\cdot Z_j \\leq \\frac{C_{\\text{eff}}}{\\varepsilon_c^2} \\cdot Z_j\n1568: \n1569: $$\n1570: \n1571: where $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\rho_{\\max} \\varepsilon_c^{2d} (\\log k)^d)$ grows logarithmically with $k$.\n1572: \n1573: **Step 4: Assemble first derivative bound.**\n1574: \n1575: $$\n1576: |\\nabla_{x_i} P(c(j) = \\ell)| \\leq \\frac{|\\nabla K_j^\\ell| \\cdot Z_j + K_j^\\ell \\cdot |\\nabla Z_j|}{Z_j^2} \\leq \\frac{C_1}{\\varepsilon_c^2} \\cdot P(c(j) = \\ell)\n1577: \n1578: $$\n1579: \n1580: where $C_1 = O(1 + k_{\\text{eff}}^{(\\varepsilon_c)})$ contains the $(\\log k)^d$ factor, which is **absorbed into higher-order Gevrey-1 constants** (see ¬ß7.1 for how derivative locality prevents this from affecting k-uniformity).\n1581: \n1582: **Step 5: Higher derivatives by induction.**\n1583: \n1584: For $|\\alpha| \\geq 2$, apply Fa√† di Bruno formula to $\\nabla^\\alpha \\log P = \\nabla^\\alpha (\\log K_j^\\ell - \\log Z_j)$. Each term has structure:\n1585: \n1586: $$\n1587: \\nabla^\\alpha K_j^\\ell = K_j^\\ell \\cdot \\text{(polynomial of degree } |\\alpha| \\text{ in } d_{\\text{alg}}, \\nabla d_{\\text{alg}}, \\ldots)\n1588: \n1589: $$\n1590: \n1591: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla^m d_{\\text{alg}}\\| \\leq C_m \\varepsilon_d^{1-m}$. For $\\varepsilon_d \\ll \\varepsilon_c$ (typical), the dominant factor is $\\varepsilon_c^{-2|\\alpha|}$ from repeated differentiation of the exponential.\n1592: \n1593: Exponential decay: The softmax structure ensures that walkers with $d_{\\text{alg}}(j,\\ell) > R_{\\text{eff}}$ contribute $\\exp(-R_{\\text{eff}}^2/(2\\varepsilon_c^2))$ to probabilities and $\\exp(-R_{\\text{eff}}^2/(4\\varepsilon_c^2))$ to derivatives (from quotient rule cancellations). This provides the claimed **double exponential suppression** for distant walkers.",
      "metadata": {
        "label": "proof-lem-softmax-derivative-locality-full"
      },
      "section": "## 4. Exponential Locality and Effective Interactions",
      "raw_directive": "1520: :::\n1521: \n1522: :::{prf:proof}\n1523: :label: proof-lem-softmax-derivative-locality-full\n1524: \n1525: **Step 1: Structure of softmax probability.**\n1526: \n1527: $$\n1528: P(c(j) = \\ell) = \\frac{\\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))}{\\sum_{\\ell' \\in \\mathcal{A} \\setminus \\{j\\}} \\exp(-d_{\\text{alg}}^2(j,\\ell')/(2\\varepsilon_c^2))} =: \\frac{K_j^\\ell}{Z_j}\n1529: \n1530: $$\n1531: \n1532: where $K_j^\\ell = \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2))$ and $Z_j = \\sum_{\\ell'} K_j^{\\ell'}$.\n1533: \n1534: **Step 2: First derivative via quotient rule.**\n1535: \n1536: $$\n1537: \\nabla_{x_i} P(c(j) = \\ell) = \\frac{(\\nabla_{x_i} K_j^\\ell) \\cdot Z_j - K_j^\\ell \\cdot (\\nabla_{x_i} Z_j)}{Z_j^2}\n1538: \n1539: $$\n1540: \n1541: For the Gaussian kernel:\n1542: \n1543: $$\n1544: \\nabla_{x_i} K_j^\\ell = K_j^\\ell \\cdot \\nabla_{x_i} \\left(-\\frac{d_{\\text{alg}}^2(j,\\ell)}{2\\varepsilon_c^2}\\right) = -\\frac{K_j^\\ell}{\\varepsilon_c^2} \\cdot d_{\\text{alg}}(j,\\ell) \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\n1545: \n1546: $$\n1547: \n1548: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla_{x_i} d_{\\text{alg}}(j,\\ell)\\| \\leq 1$. Therefore:\n1549: \n1550: $$\n1551: \\|\\nabla_{x_i} K_j^\\ell\\| \\leq \\frac{d_{\\text{alg}}(j,\\ell)}{\\varepsilon_c^2} \\cdot K_j^\\ell \\leq \\frac{1}{\\varepsilon_c} \\cdot K_j^\\ell\n1552: \n1553: $$\n1554: \n1555: (using $d_{\\text{alg}}/\\varepsilon_c \\ll 1$ for effective contributors).\n1556: \n1557: **Step 3: Partition function derivative.**\n1558: \n1559: $$\n1560: \\nabla_{x_i} Z_j = \\sum_{\\ell' \\neq j} \\nabla_{x_i} K_j^{\\ell'} = -\\frac{1}{\\varepsilon_c^2} \\sum_{\\ell'} K_j^{\\ell'} \\cdot d_{\\text{alg}}(j,\\ell') \\cdot \\nabla_{x_i} d_{\\text{alg}}(j,\\ell')\n1561: \n1562: $$\n1563: \n1564: **Key observation**: If $i = j$ or $i = \\ell$, the derivative acts directly on the exponential. If $i \\neq j, \\ell$, the derivative couples through the N-body softmax structure. However, by exponential concentration:\n1565: \n1566: $$\n1567: \\|\\nabla_{x_i} Z_j\\| \\leq \\frac{k_{\\text{eff}}^{(\\varepsilon_c)}}{\\varepsilon_c^2} \\cdot Z_j \\leq \\frac{C_{\\text{eff}}}{\\varepsilon_c^2} \\cdot Z_j\n1568: \n1569: $$\n1570: \n1571: where $k_{\\text{eff}}^{(\\varepsilon_c)} = O(\\rho_{\\max} \\varepsilon_c^{2d} (\\log k)^d)$ grows logarithmically with $k$.\n1572: \n1573: **Step 4: Assemble first derivative bound.**\n1574: \n1575: $$\n1576: |\\nabla_{x_i} P(c(j) = \\ell)| \\leq \\frac{|\\nabla K_j^\\ell| \\cdot Z_j + K_j^\\ell \\cdot |\\nabla Z_j|}{Z_j^2} \\leq \\frac{C_1}{\\varepsilon_c^2} \\cdot P(c(j) = \\ell)\n1577: \n1578: $$\n1579: \n1580: where $C_1 = O(1 + k_{\\text{eff}}^{(\\varepsilon_c)})$ contains the $(\\log k)^d$ factor, which is **absorbed into higher-order Gevrey-1 constants** (see ¬ß7.1 for how derivative locality prevents this from affecting k-uniformity).\n1581: \n1582: **Step 5: Higher derivatives by induction.**\n1583: \n1584: For $|\\alpha| \\geq 2$, apply Fa√† di Bruno formula to $\\nabla^\\alpha \\log P = \\nabla^\\alpha (\\log K_j^\\ell - \\log Z_j)$. Each term has structure:\n1585: \n1586: $$\n1587: \\nabla^\\alpha K_j^\\ell = K_j^\\ell \\cdot \\text{(polynomial of degree } |\\alpha| \\text{ in } d_{\\text{alg}}, \\nabla d_{\\text{alg}}, \\ldots)\n1588: \n1589: $$\n1590: \n1591: By {prf:ref}`lem-dalg-derivative-bounds-full`, $\\|\\nabla^m d_{\\text{alg}}\\| \\leq C_m \\varepsilon_d^{1-m}$. For $\\varepsilon_d \\ll \\varepsilon_c$ (typical), the dominant factor is $\\varepsilon_c^{-2|\\alpha|}$ from repeated differentiation of the exponential.\n1592: \n1593: Exponential decay: The softmax structure ensures that walkers with $d_{\\text{alg}}(j,\\ell) > R_{\\text{eff}}$ contribute $\\exp(-R_{\\text{eff}}^2/(2\\varepsilon_c^2))$ to probabilities and $\\exp(-R_{\\text{eff}}^2/(4\\varepsilon_c^2))$ to derivatives (from quotient rule cancellations). This provides the claimed **double exponential suppression** for distant walkers.\n1594: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 4. Exponential Locality and Effective Interactions"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-dalg-derivative-bounds-full",
      "title": null,
      "start_line": 1653,
      "end_line": 1741,
      "header_lines": [
        1654
      ],
      "content_start": 1656,
      "content_end": 1740,
      "content": "1656: :label: proof-lem-dalg-derivative-bounds-full\n1657: \n1658: **Step 0: Regularization eliminates singularity.**\n1659: \n1660: Let $r^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2 \\geq 0$. Then:\n1661: \n1662: $$\n1663: d_{\\text{alg}}(i,j) = \\sqrt{r^2 + \\varepsilon_d^2}\n1664: \n1665: $$\n1666: \n1667: **Key observation**: Even when $r = 0$ (walkers coincide), we have $d_{\\text{alg}}(i,j) = \\varepsilon_d > 0$. This **eliminates the singularity** at the origin that would occur for the unregularized distance $\\sqrt{r^2}$.\n1668: \n1669: **Step 1: First derivative.**\n1670: \n1671: Direct calculation using the chain rule:\n1672: \n1673: $$\n1674: \\frac{\\partial}{\\partial x_i^{(\\alpha)}} d_{\\text{alg}}(i,j) = \\frac{\\partial}{\\partial x_i^{(\\alpha)}} \\sqrt{r^2 + \\varepsilon_d^2}\n1675: = \\frac{1}{2\\sqrt{r^2 + \\varepsilon_d^2}} \\cdot 2(x_i^{(\\alpha)} - x_j^{(\\alpha)})\n1676: = \\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\n1677: \n1678: $$\n1679: \n1680: Since $|x_i^{(\\alpha)} - x_j^{(\\alpha)}| \\leq r \\leq d_{\\text{alg}}(i,j)$, we have:\n1681: \n1682: $$\n1683: \\|\\nabla_{x_i} d_{\\text{alg}}(i,j)\\| = \\frac{\\|x_i - x_j\\|}{d_{\\text{alg}}(i,j)} \\leq 1\n1684: \n1685: $$\n1686: \n1687: **Step 2: Second derivative (quotient rule with uniform bound).**\n1688: \n1689: $$\n1690: \\frac{\\partial^2}{\\partial x_i^{(\\alpha)} \\partial x_i^{(\\beta)}} d_{\\text{alg}}(i,j)\n1691: = \\frac{\\partial}{\\partial x_i^{(\\beta)}} \\left[\\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\\right]\n1692: \n1693: $$\n1694: \n1695: Applying quotient rule:\n1696: \n1697: $$\n1698: = \\frac{\\delta_{\\alpha\\beta}}{d_{\\text{alg}}(i,j)} - \\frac{(x_i^{(\\alpha)} - x_j^{(\\alpha)})(x_i^{(\\beta)} - x_j^{(\\beta)})}{d_{\\text{alg}}^3(i,j)}\n1699: \n1700: $$\n1701: \n1702: **Crucial difference from unregularized case**: Since $d_{\\text{alg}}(i,j) \\geq \\varepsilon_d > 0$ always, we obtain a **uniform bound**:\n1703: \n1704: $$\n1705: \\|\\nabla^2_{x_i} d_{\\text{alg}}(i,j)\\| \\leq \\frac{1}{\\varepsilon_d}\n1706: \n1707: $$\n1708: \n1709: Without regularization (Œµ_d = 0), this bound would **blow up** as $d_{\\text{alg}} \\to 0$ (walker collisions).\n1710: \n1711: **Step 3: Higher derivatives by induction with uniform bounds.**\n1712: \n1713: By induction on $n$, each derivative introduces:\n1714: - A quotient rule factor (Leibniz/Fa√† di Bruno)\n1715: - Additional powers of $1/d_{\\text{alg}}$\n1716: \n1717: The general bound:\n1718: \n1719: $$\n1720: \\|\\nabla^n d_{\\text{alg}}\\| \\leq C_{d,n} \\cdot d_{\\text{alg}}^{1-n} \\leq C_{d,n} \\cdot \\varepsilon_d^{1-n}\n1721: \n1722: $$\n1723: \n1724: follows from the Fa√† di Bruno formula for $(f \\circ g)^{(n)}$ where $f(s) = \\sqrt{s}$ and $s = r^2 + \\varepsilon_d^2$.\n1725: \n1726: The factorial growth $C_{d,n} = \\mathcal{O}(n!)$ comes from the $n$-th derivative of $\\sqrt{s}$ at $s \\geq \\varepsilon_d^2 > 0$:\n1727: \n1728: $$\n1729: \\frac{d^n}{ds^n} \\sqrt{s} = (-1)^{n-1} \\frac{(2n-3)!!}{2^n} s^{1/2 - n}\n1730: \n1731: $$\n1732: \n1733: where $(2n-3)!! = \\mathcal{O}(n! / 2^n)$, giving the Gevrey-1 bound.\n1734: \n1735: **Crucial point**: Evaluating at $s \\geq \\varepsilon_d^2$ gives:\n1736: \n1737: $$\n1738: \\left|\\frac{d^n}{ds^n} \\sqrt{s}\\right| \\leq \\frac{C_n}{\\varepsilon_d^{n-1}} \\quad \\text{(uniform bound)}\n1739: \n1740: $$",
      "metadata": {
        "label": "proof-lem-dalg-derivative-bounds-full"
      },
      "section": "## 5. Derivatives of Algorithmic Distance (Regularized Version)",
      "raw_directive": "1653: :::\n1654: \n1655: :::{prf:proof}\n1656: :label: proof-lem-dalg-derivative-bounds-full\n1657: \n1658: **Step 0: Regularization eliminates singularity.**\n1659: \n1660: Let $r^2 := \\|x_i - x_j\\|^2 + \\lambda_{\\text{alg}} \\|v_i - v_j\\|^2 \\geq 0$. Then:\n1661: \n1662: $$\n1663: d_{\\text{alg}}(i,j) = \\sqrt{r^2 + \\varepsilon_d^2}\n1664: \n1665: $$\n1666: \n1667: **Key observation**: Even when $r = 0$ (walkers coincide), we have $d_{\\text{alg}}(i,j) = \\varepsilon_d > 0$. This **eliminates the singularity** at the origin that would occur for the unregularized distance $\\sqrt{r^2}$.\n1668: \n1669: **Step 1: First derivative.**\n1670: \n1671: Direct calculation using the chain rule:\n1672: \n1673: $$\n1674: \\frac{\\partial}{\\partial x_i^{(\\alpha)}} d_{\\text{alg}}(i,j) = \\frac{\\partial}{\\partial x_i^{(\\alpha)}} \\sqrt{r^2 + \\varepsilon_d^2}\n1675: = \\frac{1}{2\\sqrt{r^2 + \\varepsilon_d^2}} \\cdot 2(x_i^{(\\alpha)} - x_j^{(\\alpha)})\n1676: = \\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\n1677: \n1678: $$\n1679: \n1680: Since $|x_i^{(\\alpha)} - x_j^{(\\alpha)}| \\leq r \\leq d_{\\text{alg}}(i,j)$, we have:\n1681: \n1682: $$\n1683: \\|\\nabla_{x_i} d_{\\text{alg}}(i,j)\\| = \\frac{\\|x_i - x_j\\|}{d_{\\text{alg}}(i,j)} \\leq 1\n1684: \n1685: $$\n1686: \n1687: **Step 2: Second derivative (quotient rule with uniform bound).**\n1688: \n1689: $$\n1690: \\frac{\\partial^2}{\\partial x_i^{(\\alpha)} \\partial x_i^{(\\beta)}} d_{\\text{alg}}(i,j)\n1691: = \\frac{\\partial}{\\partial x_i^{(\\beta)}} \\left[\\frac{x_i^{(\\alpha)} - x_j^{(\\alpha)}}{d_{\\text{alg}}(i,j)}\\right]\n1692: \n1693: $$\n1694: \n1695: Applying quotient rule:\n1696: \n1697: $$\n1698: = \\frac{\\delta_{\\alpha\\beta}}{d_{\\text{alg}}(i,j)} - \\frac{(x_i^{(\\alpha)} - x_j^{(\\alpha)})(x_i^{(\\beta)} - x_j^{(\\beta)})}{d_{\\text{alg}}^3(i,j)}\n1699: \n1700: $$\n1701: \n1702: **Crucial difference from unregularized case**: Since $d_{\\text{alg}}(i,j) \\geq \\varepsilon_d > 0$ always, we obtain a **uniform bound**:\n1703: \n1704: $$\n1705: \\|\\nabla^2_{x_i} d_{\\text{alg}}(i,j)\\| \\leq \\frac{1}{\\varepsilon_d}\n1706: \n1707: $$\n1708: \n1709: Without regularization (Œµ_d = 0), this bound would **blow up** as $d_{\\text{alg}} \\to 0$ (walker collisions).\n1710: \n1711: **Step 3: Higher derivatives by induction with uniform bounds.**\n1712: \n1713: By induction on $n$, each derivative introduces:\n1714: - A quotient rule factor (Leibniz/Fa√† di Bruno)\n1715: - Additional powers of $1/d_{\\text{alg}}$\n1716: \n1717: The general bound:\n1718: \n1719: $$\n1720: \\|\\nabla^n d_{\\text{alg}}\\| \\leq C_{d,n} \\cdot d_{\\text{alg}}^{1-n} \\leq C_{d,n} \\cdot \\varepsilon_d^{1-n}\n1721: \n1722: $$\n1723: \n1724: follows from the Fa√† di Bruno formula for $(f \\circ g)^{(n)}$ where $f(s) = \\sqrt{s}$ and $s = r^2 + \\varepsilon_d^2$.\n1725: \n1726: The factorial growth $C_{d,n} = \\mathcal{O}(n!)$ comes from the $n$-th derivative of $\\sqrt{s}$ at $s \\geq \\varepsilon_d^2 > 0$:\n1727: \n1728: $$\n1729: \\frac{d^n}{ds^n} \\sqrt{s} = (-1)^{n-1} \\frac{(2n-3)!!}{2^n} s^{1/2 - n}\n1730: \n1731: $$\n1732: \n1733: where $(2n-3)!! = \\mathcal{O}(n! / 2^n)$, giving the Gevrey-1 bound.\n1734: \n1735: **Crucial point**: Evaluating at $s \\geq \\varepsilon_d^2$ gives:\n1736: \n1737: $$\n1738: \\left|\\frac{d^n}{ds^n} \\sqrt{s}\\right| \\leq \\frac{C_n}{\\varepsilon_d^{n-1}} \\quad \\text{(uniform bound)}\n1739: \n1740: $$\n1741: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 7,
        "chapter_file": "chapter_7.json",
        "section_id": "## 5. Derivatives of Algorithmic Distance (Regularized Version)"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-companion-measurement-derivatives-full",
      "title": null,
      "start_line": 1828,
      "end_line": 1849,
      "header_lines": [
        1829
      ],
      "content_start": 1832,
      "content_end": 1848,
      "content": "1832: \n1833: :::{note}\n1834: **Derivative Structure Preview**: The companion-dependent measurement has the structure:\n1835: \n1836: $$\n1837: d_j = \\frac{N_j}{Z_j} = \\frac{\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\cdot e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}{\\sum_{\\ell} e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}\n1838: \n1839: $$\n1840: \n1841: This is a **quotient of weighted sums**, leading to high complexity. The n-th derivative involves:\n1842: \n1843: 1. **Leibniz rule** for products: $d_{\\text{alg}} \\cdot \\exp(\\cdots)$\n1844: 2. **Fa√† di Bruno** for exponential: $\\exp(-d_{\\text{alg}}^2/(2\\varepsilon_c^2))$\n1845: 3. **Quotient rule** for $N_j / Z_j$ (introduces additional partitions)\n1846: 4. **Sum over companions**: Each term has exponential decay, ensuring k-uniformity\n1847: \n1848: **Key challenge**: Tracking which scale dominates‚Äî$\\varepsilon_d^{1-n}$ (from $d_{\\text{alg}}$ derivatives) vs $\\varepsilon_c^{-n}$ (from exponential kernel derivatives).",
      "metadata": {
        "label": "proof-lem-companion-measurement-derivatives-full"
      },
      "section": "## 5.5 Companion-Dependent Measurements with Softmax Coupling",
      "raw_directive": "1828: :::\n1829: \n1830: :::{prf:proof}\n1831: :label: proof-lem-companion-measurement-derivatives-full\n1832: \n1833: :::{note}\n1834: **Derivative Structure Preview**: The companion-dependent measurement has the structure:\n1835: \n1836: $$\n1837: d_j = \\frac{N_j}{Z_j} = \\frac{\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\cdot e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}{\\sum_{\\ell} e^{-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_c^2)}}\n1838: \n1839: $$\n1840: \n1841: This is a **quotient of weighted sums**, leading to high complexity. The n-th derivative involves:\n1842: \n1843: 1. **Leibniz rule** for products: $d_{\\text{alg}} \\cdot \\exp(\\cdots)$\n1844: 2. **Fa√† di Bruno** for exponential: $\\exp(-d_{\\text{alg}}^2/(2\\varepsilon_c^2))$\n1845: 3. **Quotient rule** for $N_j / Z_j$ (introduces additional partitions)\n1846: 4. **Sum over companions**: Each term has exponential decay, ensuring k-uniformity\n1847: \n1848: **Key challenge**: Tracking which scale dominates‚Äî$\\varepsilon_d^{1-n}$ (from $d_{\\text{alg}}$ derivatives) vs $\\varepsilon_c^{-n}$ (from exponential kernel derivatives).\n1849: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 5.5 Companion-Dependent Measurements with Softmax Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-216",
      "title": null,
      "start_line": 1998,
      "end_line": 2105,
      "header_lines": [],
      "content_start": 2000,
      "content_end": 2104,
      "content": "2000: :::{prf:proof}\n2001: \n2002: **Step (a): Softmax-Jacobian identity.**\n2003: \n2004: Since only $K_i$ depends on $x_i$, we have $\\nabla_{x_i} Z = \\nabla_{x_i} K_i$. By the quotient rule:\n2005: \n2006: $$\n2007: \\nabla_{x_i} P_\\ell = \\frac{\\delta_{\\ell i} \\nabla_{x_i} K_i \\cdot Z - K_\\ell \\nabla_{x_i} Z}{Z^2}\n2008: = \\frac{\\delta_{\\ell i} \\nabla_{x_i} K_i \\cdot Z - K_\\ell \\nabla_{x_i} K_i}{Z^2}\n2009: \n2010: $$\n2011: \n2012: Factoring out $\\nabla_{x_i} K_i$:\n2013: \n2014: $$\n2015: \\nabla_{x_i} P_\\ell = \\frac{(\\delta_{\\ell i} Z - K_\\ell)}{Z^2} \\nabla_{x_i} K_i\n2016: = \\frac{K_\\ell}{Z} \\left(\\delta_{\\ell i} \\frac{Z}{K_\\ell} - 1\\right) \\frac{\\nabla_{x_i} K_i}{K_i} \\cdot K_i\n2017: \n2018: $$\n2019: \n2020: Since $P_\\ell = K_\\ell / Z$, $Z/K_i = 1/P_i$ when $\\ell = i$, and $\\nabla_{x_i} \\log K_i = \\nabla_{x_i} K_i / K_i$:\n2021: \n2022: $$\n2023: \\nabla_{x_i} P_\\ell = P_\\ell \\left(\\delta_{\\ell i} - P_i\\right) \\nabla_{x_i} \\log K_i\n2024: \n2025: $$\n2026: \n2027: where we used $\\delta_{\\ell i} Z - K_\\ell = \\delta_{\\ell i} K_i (Z/K_i) - K_\\ell = K_\\ell(\\delta_{\\ell i}/P_i - 1)$ for $\\ell = i$, and $\\delta_{\\ell i} Z - K_\\ell = -K_\\ell$ for $\\ell \\neq i$.\n2028: \n2029: **Step (b): Telescoping in the probability term.**\n2030: \n2031: Recall $d_j = \\sum_\\ell P_\\ell d_{\\text{alg}}(j,\\ell)$. By the product rule:\n2032: \n2033: $$\n2034: \\nabla_{x_i} d_j = \\sum_{\\ell} P_\\ell \\nabla_{x_i} d_{\\text{alg}}(j,\\ell) + \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\nabla_{x_i} P_\\ell\n2035: \n2036: $$\n2037: \n2038: For the first term, **derivative locality** of $d_{\\text{alg}}$ (see {prf:ref}`lem-dalg-derivative-bounds-full`) gives $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = 0$ for $\\ell \\neq i$, so:\n2039: \n2040: $$\n2041: \\sum_{\\ell} P_\\ell \\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = P_i \\nabla_{x_i} d_{\\text{alg}}(j,i)\n2042: \n2043: $$\n2044: \n2045: For the second term, substituting the softmax-Jacobian identity:\n2046: \n2047: $$\n2048: \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\nabla_{x_i} P_\\ell\n2049: = \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell (\\delta_{\\ell i} - P_i) \\nabla_{x_i} \\log K_i\n2050: \n2051: $$\n2052: \n2053: Expanding the $\\delta_{\\ell i}$ term:\n2054: \n2055: $$\n2056: = \\left[\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell \\delta_{\\ell i} - P_i \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell\\right] \\nabla_{x_i} \\log K_i\n2057: \n2058: $$\n2059: \n2060: The first sum collapses to $d_{\\text{alg}}(j,i) P_i$, and the second sum is $d_j$ by definition:\n2061: \n2062: $$\n2063: = \\left[d_{\\text{alg}}(j,i) P_i - P_i d_j\\right] \\nabla_{x_i} \\log K_i\n2064: = P_i (d_{\\text{alg}}(j,i) - d_j) \\nabla_{x_i} \\log K_i\n2065: \n2066: $$\n2067: \n2068: Combining both terms:\n2069: \n2070: $$\n2071: \\nabla_{x_i} d_j = P_i \\nabla_{x_i} d_{\\text{alg}}(j,i) + P_i (d_{\\text{alg}}(j,i) - d_j) \\nabla_{x_i} \\log K_i\n2072: \n2073: $$\n2074: \n2075: **Step (c): k-uniformity and extension to higher-order derivatives.**\n2076: \n2077: **For the first derivative:** Both terms involve only $(j,i)$-dependent quantities:\n2078: - $P_i = K_i / Z$ depends on $Z = \\sum_m K_m$, but the derivative $\\nabla_{x_i} d_j$ has **no explicit $\\ell$-sum**\n2079: - All factors scale as $\\mathcal{O}(1)$ or $\\mathcal{O}(\\varepsilon_c^{-1})$ (from $\\nabla \\log K_i$)\n2080: \n2081: **For higher-order derivatives ($n \\geq 2$):** The k-uniform structure is preserved by the following argument:\n2082: \n2083: 1. **Inductive structure**: Each higher-order derivative $\\nabla^n_{x_i} d_j$ is obtained by differentiating $\\nabla^{n-1}_{x_i} d_j$, which by induction has the form:\n2084:    $$\n2085:    \\nabla^{n-1}_{x_i} d_j = \\sum_{\\text{terms}} P_i^{k_1} (\\nabla^{k_2} d_{ji}) (\\nabla^{k_3} \\log K_i) (\\nabla^{k_4} d_j)\n2086:    $$\n2087:    where all derivatives are with respect to $x_i$ and depend only on the pair $(j,i)$.\n2088: \n2089: 2. **Derivative closure**: Applying $\\nabla_{x_i}$ to any such term produces new terms of the same form:\n2090:    - $\\nabla_{x_i} P_i = P_i(1 - P_i) \\nabla_{x_i} \\log K_i$ (softmax-Jacobian identity for $\\ell=i$)\n2091:    - $\\nabla_{x_i} d_{ji}$ increases the derivative order but remains $(j,i)$-dependent\n2092:    - $\\nabla_{x_i} \\log K_i$ increases the derivative order but remains $(j,i)$-dependent\n2093:    - $\\nabla_{x_i} d_j$ can be expanded using the formula from Step (b), maintaining the same structure\n2094: \n2095: 3. **No $\\ell$-summation introduced**: Since only $K_i$ depends on $x_i$ (locality), no derivative operation reintroduces a summation over $\\ell \\neq i$. Each term remains a function of $(j,i)$ only.\n2096: \n2097: 4. **Gevrey-1 growth**: The Leibniz rule, quotient rule, and Fa√† di Bruno formula (detailed in Step 3 below) produce combinatorial factors bounded by $\\mathcal{O}(n!)$, yielding Gevrey-1 growth.\n2098: \n2099: Therefore, for all $n \\geq 1$:\n2100: $$\n2101: \\|\\nabla^n_{x_i} d_j\\| \\leq C_n \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2102: $$\n2103: where $C_n = \\mathcal{O}(n!)$ is **k-uniform** (independent of the number of walkers).\n2104: ",
      "metadata": {},
      "section": "## 5.5 Companion-Dependent Measurements with Softmax Coupling",
      "raw_directive": "1998: :::\n1999: \n2000: :::{prf:proof}\n2001: \n2002: **Step (a): Softmax-Jacobian identity.**\n2003: \n2004: Since only $K_i$ depends on $x_i$, we have $\\nabla_{x_i} Z = \\nabla_{x_i} K_i$. By the quotient rule:\n2005: \n2006: $$\n2007: \\nabla_{x_i} P_\\ell = \\frac{\\delta_{\\ell i} \\nabla_{x_i} K_i \\cdot Z - K_\\ell \\nabla_{x_i} Z}{Z^2}\n2008: = \\frac{\\delta_{\\ell i} \\nabla_{x_i} K_i \\cdot Z - K_\\ell \\nabla_{x_i} K_i}{Z^2}\n2009: \n2010: $$\n2011: \n2012: Factoring out $\\nabla_{x_i} K_i$:\n2013: \n2014: $$\n2015: \\nabla_{x_i} P_\\ell = \\frac{(\\delta_{\\ell i} Z - K_\\ell)}{Z^2} \\nabla_{x_i} K_i\n2016: = \\frac{K_\\ell}{Z} \\left(\\delta_{\\ell i} \\frac{Z}{K_\\ell} - 1\\right) \\frac{\\nabla_{x_i} K_i}{K_i} \\cdot K_i\n2017: \n2018: $$\n2019: \n2020: Since $P_\\ell = K_\\ell / Z$, $Z/K_i = 1/P_i$ when $\\ell = i$, and $\\nabla_{x_i} \\log K_i = \\nabla_{x_i} K_i / K_i$:\n2021: \n2022: $$\n2023: \\nabla_{x_i} P_\\ell = P_\\ell \\left(\\delta_{\\ell i} - P_i\\right) \\nabla_{x_i} \\log K_i\n2024: \n2025: $$\n2026: \n2027: where we used $\\delta_{\\ell i} Z - K_\\ell = \\delta_{\\ell i} K_i (Z/K_i) - K_\\ell = K_\\ell(\\delta_{\\ell i}/P_i - 1)$ for $\\ell = i$, and $\\delta_{\\ell i} Z - K_\\ell = -K_\\ell$ for $\\ell \\neq i$.\n2028: \n2029: **Step (b): Telescoping in the probability term.**\n2030: \n2031: Recall $d_j = \\sum_\\ell P_\\ell d_{\\text{alg}}(j,\\ell)$. By the product rule:\n2032: \n2033: $$\n2034: \\nabla_{x_i} d_j = \\sum_{\\ell} P_\\ell \\nabla_{x_i} d_{\\text{alg}}(j,\\ell) + \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\nabla_{x_i} P_\\ell\n2035: \n2036: $$\n2037: \n2038: For the first term, **derivative locality** of $d_{\\text{alg}}$ (see {prf:ref}`lem-dalg-derivative-bounds-full`) gives $\\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = 0$ for $\\ell \\neq i$, so:\n2039: \n2040: $$\n2041: \\sum_{\\ell} P_\\ell \\nabla_{x_i} d_{\\text{alg}}(j,\\ell) = P_i \\nabla_{x_i} d_{\\text{alg}}(j,i)\n2042: \n2043: $$\n2044: \n2045: For the second term, substituting the softmax-Jacobian identity:\n2046: \n2047: $$\n2048: \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) \\nabla_{x_i} P_\\ell\n2049: = \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell (\\delta_{\\ell i} - P_i) \\nabla_{x_i} \\log K_i\n2050: \n2051: $$\n2052: \n2053: Expanding the $\\delta_{\\ell i}$ term:\n2054: \n2055: $$\n2056: = \\left[\\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell \\delta_{\\ell i} - P_i \\sum_{\\ell} d_{\\text{alg}}(j,\\ell) P_\\ell\\right] \\nabla_{x_i} \\log K_i\n2057: \n2058: $$\n2059: \n2060: The first sum collapses to $d_{\\text{alg}}(j,i) P_i$, and the second sum is $d_j$ by definition:\n2061: \n2062: $$\n2063: = \\left[d_{\\text{alg}}(j,i) P_i - P_i d_j\\right] \\nabla_{x_i} \\log K_i\n2064: = P_i (d_{\\text{alg}}(j,i) - d_j) \\nabla_{x_i} \\log K_i\n2065: \n2066: $$\n2067: \n2068: Combining both terms:\n2069: \n2070: $$\n2071: \\nabla_{x_i} d_j = P_i \\nabla_{x_i} d_{\\text{alg}}(j,i) + P_i (d_{\\text{alg}}(j,i) - d_j) \\nabla_{x_i} \\log K_i\n2072: \n2073: $$\n2074: \n2075: **Step (c): k-uniformity and extension to higher-order derivatives.**\n2076: \n2077: **For the first derivative:** Both terms involve only $(j,i)$-dependent quantities:\n2078: - $P_i = K_i / Z$ depends on $Z = \\sum_m K_m$, but the derivative $\\nabla_{x_i} d_j$ has **no explicit $\\ell$-sum**\n2079: - All factors scale as $\\mathcal{O}(1)$ or $\\mathcal{O}(\\varepsilon_c^{-1})$ (from $\\nabla \\log K_i$)\n2080: \n2081: **For higher-order derivatives ($n \\geq 2$):** The k-uniform structure is preserved by the following argument:\n2082: \n2083: 1. **Inductive structure**: Each higher-order derivative $\\nabla^n_{x_i} d_j$ is obtained by differentiating $\\nabla^{n-1}_{x_i} d_j$, which by induction has the form:\n2084:    $$\n2085:    \\nabla^{n-1}_{x_i} d_j = \\sum_{\\text{terms}} P_i^{k_1} (\\nabla^{k_2} d_{ji}) (\\nabla^{k_3} \\log K_i) (\\nabla^{k_4} d_j)\n2086:    $$\n2087:    where all derivatives are with respect to $x_i$ and depend only on the pair $(j,i)$.\n2088: \n2089: 2. **Derivative closure**: Applying $\\nabla_{x_i}$ to any such term produces new terms of the same form:\n2090:    - $\\nabla_{x_i} P_i = P_i(1 - P_i) \\nabla_{x_i} \\log K_i$ (softmax-Jacobian identity for $\\ell=i$)\n2091:    - $\\nabla_{x_i} d_{ji}$ increases the derivative order but remains $(j,i)$-dependent\n2092:    - $\\nabla_{x_i} \\log K_i$ increases the derivative order but remains $(j,i)$-dependent\n2093:    - $\\nabla_{x_i} d_j$ can be expanded using the formula from Step (b), maintaining the same structure\n2094: \n2095: 3. **No $\\ell$-summation introduced**: Since only $K_i$ depends on $x_i$ (locality), no derivative operation reintroduces a summation over $\\ell \\neq i$. Each term remains a function of $(j,i)$ only.\n2096: \n2097: 4. **Gevrey-1 growth**: The Leibniz rule, quotient rule, and Fa√† di Bruno formula (detailed in Step 3 below) produce combinatorial factors bounded by $\\mathcal{O}(n!)$, yielding Gevrey-1 growth.\n2098: \n2099: Therefore, for all $n \\geq 1$:\n2100: $$\n2101: \\|\\nabla^n_{x_i} d_j\\| \\leq C_n \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2102: $$\n2103: where $C_n = \\mathcal{O}(n!)$ is **k-uniform** (independent of the number of walkers).\n2104: \n2105: **Rigorous justification**: This inductive argument is formalized through the Fa√† di Bruno/quotient-rule analysis in Step 3 below, which tracks all derivative contributions through the composition structure $d_j = N_j / Z_j$.",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 5.5 Companion-Dependent Measurements with Softmax Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-self-measurement-derivatives-full",
      "title": null,
      "start_line": 2237,
      "end_line": 2334,
      "header_lines": [
        2238
      ],
      "content_start": 2240,
      "content_end": 2333,
      "content": "2240: :label: proof-lem-self-measurement-derivatives-full\n2241: \n2242: The self-measurement is:\n2243: \n2244: $$\n2245: d_i = \\frac{N_i}{Z_i}, \\quad N_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right), \\quad Z_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2246: \n2247: $$\n2248: \n2249: **Step 1: Derivatives of numerator $N_i$.**\n2250: \n2251: For $\\ell \\neq i$, the $\\ell$-th term in $N_i$ is:\n2252: \n2253: $$\n2254: f_\\ell := d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2255: \n2256: $$\n2257: \n2258: By the Leibniz rule (as in ¬ß5.5.2 for j‚â†i case), the $n$-th derivative satisfies:\n2259: \n2260: $$\n2261: \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2262: \n2263: $$\n2264: \n2265: where $C_{f,n} = \\mathcal{O}(n!)$ (Gevrey-1).\n2266: \n2267: **Summing over $\\ell$**:\n2268: \n2269: $$\n2270: \\|\\nabla^n_{x_i} N_i\\| \\leq \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2271: \n2272: $$\n2273: \n2274: **Step 2: Apply sum-to-integral bound.**\n2275: \n2276: By Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f \\equiv 1$:\n2277: \n2278: $$\n2279: \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n2280: \n2281: $$\n2282: \n2283: This bound is **k-uniform**: it depends only on $(\\rho_{\\max}, \\varepsilon_c, d)$, **not on $k$**.\n2284: \n2285: Therefore:\n2286: \n2287: $$\n2288: \\|\\nabla^n_{x_i} N_i\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2289: \n2290: $$\n2291: \n2292: **Step 3: Derivatives of partition function $Z_i$.**\n2293: \n2294: Similarly, for the exponential terms in $Z_i$:\n2295: \n2296: $$\n2297: \\|\\nabla^n_{x_i} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2298: \n2299: $$\n2300: \n2301: Summing and applying the sum-to-integral bound:\n2302: \n2303: $$\n2304: \\|\\nabla^n_{x_i} Z_i\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2305: \n2306: $$\n2307: \n2308: which is **k-uniform**.\n2309: \n2310: **Step 4: Quotient rule for $d_i = N_i / Z_i$.**\n2311: \n2312: By the generalized quotient rule (Fa√† di Bruno formula), the derivatives of $d_i$ involve products of $\\nabla^k N_i$ and $\\nabla^\\ell Z_i$ with $k + \\ell \\leq n$, divided by powers of $Z_i$.\n2313: \n2314: **Lower bound for $Z_i$**: By Lemma {prf:ref}`lem-companion-availability-enforcement`:\n2315: \n2316: $$\n2317: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n2318: \n2319: $$\n2320: \n2321: Combining the bounds from Steps 2-3 and applying the quotient rule:\n2322: \n2323: $$\n2324: \\|\\nabla^n_{x_i} d_i\\| \\leq C_{d_i,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2325: \n2326: $$\n2327: \n2328: where $C_{d_i,n} = \\mathcal{O}(n!)$ arises from:\n2329: - Fa√† di Bruno combinatorics: $\\mathcal{O}(n!)$\n2330: - Factorial growth from $C_{f,n}, C_{K,n}$: each $\\mathcal{O}(n!)$\n2331: - **k-uniform factors**: $\\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda} / Z_{\\min}$ (no $k$-dependence)\n2332: \n2333: **Conclusion**: The constant $C_{d_i,n}$ is **k-uniform** because the sum over companions is controlled by the sum-to-integral bound (Lemma {prf:ref}`lem-sum-to-integral-bound-full`), which replaces the naive $\\mathcal{O}(k)$ factor with $\\mathcal{O}(\\rho_{\\max} \\varepsilon_c^{2d})$ (independent of $k$).",
      "metadata": {
        "label": "proof-lem-self-measurement-derivatives-full"
      },
      "section": "## 5.5 Companion-Dependent Measurements with Softmax Coupling",
      "raw_directive": "2237: :::\n2238: \n2239: :::{prf:proof}\n2240: :label: proof-lem-self-measurement-derivatives-full\n2241: \n2242: The self-measurement is:\n2243: \n2244: $$\n2245: d_i = \\frac{N_i}{Z_i}, \\quad N_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right), \\quad Z_i := \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2246: \n2247: $$\n2248: \n2249: **Step 1: Derivatives of numerator $N_i$.**\n2250: \n2251: For $\\ell \\neq i$, the $\\ell$-th term in $N_i$ is:\n2252: \n2253: $$\n2254: f_\\ell := d_{\\text{alg}}(i,\\ell) \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2255: \n2256: $$\n2257: \n2258: By the Leibniz rule (as in ¬ß5.5.2 for j‚â†i case), the $n$-th derivative satisfies:\n2259: \n2260: $$\n2261: \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2262: \n2263: $$\n2264: \n2265: where $C_{f,n} = \\mathcal{O}(n!)$ (Gevrey-1).\n2266: \n2267: **Summing over $\\ell$**:\n2268: \n2269: $$\n2270: \\|\\nabla^n_{x_i} N_i\\| \\leq \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\|\\nabla^n_{x_i} f_\\ell\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2271: \n2272: $$\n2273: \n2274: **Step 2: Apply sum-to-integral bound.**\n2275: \n2276: By Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f \\equiv 1$:\n2277: \n2278: $$\n2279: \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right) \\leq \\rho_{\\max} \\cdot (2\\pi\\varepsilon_c^2)^d \\cdot C_{\\lambda}\n2280: \n2281: $$\n2282: \n2283: This bound is **k-uniform**: it depends only on $(\\rho_{\\max}, \\varepsilon_c, d)$, **not on $k$**.\n2284: \n2285: Therefore:\n2286: \n2287: $$\n2288: \\|\\nabla^n_{x_i} N_i\\| \\leq C_{f,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n}) \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2289: \n2290: $$\n2291: \n2292: **Step 3: Derivatives of partition function $Z_i$.**\n2293: \n2294: Similarly, for the exponential terms in $Z_i$:\n2295: \n2296: $$\n2297: \\|\\nabla^n_{x_i} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_c^2}\\right)\n2298: \n2299: $$\n2300: \n2301: Summing and applying the sum-to-integral bound:\n2302: \n2303: $$\n2304: \\|\\nabla^n_{x_i} Z_i\\| \\leq C_{K,n} \\varepsilon_c^{-n} \\cdot \\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda}\n2305: \n2306: $$\n2307: \n2308: which is **k-uniform**.\n2309: \n2310: **Step 4: Quotient rule for $d_i = N_i / Z_i$.**\n2311: \n2312: By the generalized quotient rule (Fa√† di Bruno formula), the derivatives of $d_i$ involve products of $\\nabla^k N_i$ and $\\nabla^\\ell Z_i$ with $k + \\ell \\leq n$, divided by powers of $Z_i$.\n2313: \n2314: **Lower bound for $Z_i$**: By Lemma {prf:ref}`lem-companion-availability-enforcement`:\n2315: \n2316: $$\n2317: Z_i \\geq \\exp\\left(-\\frac{D_{\\max}^2}{2\\varepsilon_c^2}\\right) =: Z_{\\min} > 0\n2318: \n2319: $$\n2320: \n2321: Combining the bounds from Steps 2-3 and applying the quotient rule:\n2322: \n2323: $$\n2324: \\|\\nabla^n_{x_i} d_i\\| \\leq C_{d_i,n} \\cdot \\max(\\varepsilon_d^{1-n}, \\varepsilon_d \\varepsilon_c^{-n})\n2325: \n2326: $$\n2327: \n2328: where $C_{d_i,n} = \\mathcal{O}(n!)$ arises from:\n2329: - Fa√† di Bruno combinatorics: $\\mathcal{O}(n!)$\n2330: - Factorial growth from $C_{f,n}, C_{K,n}$: each $\\mathcal{O}(n!)$\n2331: - **k-uniform factors**: $\\rho_{\\max} (2\\pi\\varepsilon_c^2)^d C_{\\lambda} / Z_{\\min}$ (no $k$-dependence)\n2332: \n2333: **Conclusion**: The constant $C_{d_i,n}$ is **k-uniform** because the sum over companions is controlled by the sum-to-integral bound (Lemma {prf:ref}`lem-sum-to-integral-bound-full`), which replaces the naive $\\mathcal{O}(k)$ factor with $\\mathcal{O}(\\rho_{\\max} \\varepsilon_c^{2d})$ (independent of $k$).\n2334: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 5.5 Companion-Dependent Measurements with Softmax Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-diversity-pairing-measurement-regularity",
      "title": null,
      "start_line": 2436,
      "end_line": 2620,
      "header_lines": [
        2437
      ],
      "content_start": 2439,
      "content_end": 2619,
      "content": "2439: :label: proof-thm-diversity-pairing-measurement-regularity\n2440: \n2441: **Step 1: Expected measurement structure**\n2442: \n2443: $$\n2444: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2445: \n2446: $$\n2447: \n2448: where:\n2449: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2450: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2451: \n2452: **Step 2: Exponential concentration of matching weights**\n2453: \n2454: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2455: \n2456: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2457: \n2458: $$\n2459: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2460: \n2461: $$\n2462: \n2463: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2464: \n2465: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2466: \n2467: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2468: \n2469: $$\n2470: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2471: \n2472: $$\n2473: \n2474: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2475: \n2476: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2477: \n2478: $$\n2479: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2480: \n2481: $$\n2482: \n2483: Then the expected measurement becomes:\n2484: \n2485: $$\n2486: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2487: \n2488: $$\n2489: \n2490: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2491: \n2492: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2493: \n2494: $$\n2495: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2496: \n2497: $$\n2498: \n2499: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2500: \n2501: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^‚àû regularity with k-uniform bounds **without** assuming this approximation.\n2502: \n2503: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2504: \n2505: $$\n2506: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2507: \n2508: $$\n2509: \n2510: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2511: \n2512: **Consequence**: The marginal probability has simplified derivative structure:\n2513: \n2514: $$\n2515: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2516: \n2517: $$\n2518: \n2519: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2520: \n2521: **Result**: The expected measurement has analytical structure\n2522: \n2523: $$\n2524: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2525: \n2526: $$\n2527: \n2528: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2529: \n2530: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2531: \n2532: **Step 4: Derivative analysis via locality**\n2533: \n2534: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2535: \n2536: $$\n2537: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2538: \n2539: $$\n2540: \n2541: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2542: \n2543: $$\n2544: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2545: \n2546: $$\n2547: \n2548: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2549: 1. **Bounded**: By exponential weights, all ratios ‚â§ exp(const ¬∑ (R_eff)¬≤/Œµ_d¬≤) < ‚àû\n2550: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(œÅ_max Œµ_d^{2d}), independent of k\n2551: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2552: \n2553: The derivatives follow from standard quotient rule + Fa√† di Bruno:\n2554: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2555: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2556: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2557: \n2558: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2559: \n2560: $$\n2561: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2562: \n2563: $$\n2564: \n2565: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2566: \n2567: **Step 5: Derivative bound via quotient rule**\n2568: \n2569: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2570: \n2571: $$\n2572: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2573: \n2574: $$\n2575: \n2576: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2577: \n2578: $$\n2579: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2580: \n2581: $$\n2582: \n2583: By the product rule and Fa√† di Bruno formula:\n2584: \n2585: $$\n2586: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2587: \n2588: $$\n2589: \n2590: **Bounds on each term**:\n2591: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2592: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2593: \n2594: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2595: \n2596: $$\n2597: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2598: \n2599: $$\n2600: \n2601: which is **k-uniform** (independent of total swarm size).\n2602: \n2603: **Step 6: Assemble the Gevrey-1 bound**\n2604: \n2605: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2606: \n2607: $$\n2608: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2609: \n2610: $$\n2611: \n2612: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2613: \n2614: $$\n2615: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2616: \n2617: $$\n2618: \n2619: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.",
      "metadata": {
        "label": "proof-thm-diversity-pairing-measurement-regularity"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "raw_directive": "2436: :::\n2437: \n2438: :::{prf:proof}\n2439: :label: proof-thm-diversity-pairing-measurement-regularity\n2440: \n2441: **Step 1: Expected measurement structure**\n2442: \n2443: $$\n2444: \\bar{d}_i = \\mathbb{E}[d_{\\text{alg}}(i, M(i))] = \\frac{\\sum_{M \\in \\mathcal{M}_k} W(M) \\cdot d_{\\text{alg}}(i, M(i))}{\\sum_{M' \\in \\mathcal{M}_k} W(M')}\n2445: \n2446: $$\n2447: \n2448: where:\n2449: - $W(M) = \\prod_{(j,\\ell) \\in M} \\exp(-d_{\\text{alg}}^2(j,\\ell)/(2\\varepsilon_d^2))$ (matching weight)\n2450: - $\\mathcal{M}_k$ = set of all perfect matchings of k walkers\n2451: \n2452: **Step 2: Exponential concentration of matching weights**\n2453: \n2454: **Key observation**: For walker $i$, matching weights are exponentially concentrated near matchings where $i$ is paired with a nearby companion.\n2455: \n2456: For any matching $M$ where $i$ is paired with walker $\\ell$ at distance $d_{\\text{alg}}(i,\\ell) = R$:\n2457: \n2458: $$\n2459: W(M) \\leq \\exp\\left(-\\frac{R^2}{2\\varepsilon_d^2}\\right) \\cdot W_{\\text{rest}}(M)\n2460: \n2461: $$\n2462: \n2463: where $W_{\\text{rest}}(M)$ is the product over other pairs (independent of the $(i,\\ell)$ pair).\n2464: \n2465: **Step 3: Permutation invariance reduces the matching sum to a marginal distribution**\n2466: \n2467: **Key Observation (Permutation Invariance)**: The fitness potential $V_{\\text{fit}}(x_i, v_i)$ must be invariant under relabeling of walkers $j \\neq i$ (fundamental symmetry of exchangeable particle systems). This means the expected measurement:\n2468: \n2469: $$\n2470: \\bar{d}_i = \\mathbb{E}_{M \\sim P_{\\text{ideal}}}[d_{\\text{alg}}(i, M(i))]\n2471: \n2472: $$\n2473: \n2474: depends only on walker $i$'s state $(x_i, v_i)$ and the **empirical distribution** of other walkers $\\{(x_j, v_j)\\}_{j \\neq i}$, not their labels.\n2475: \n2476: **Marginal Distribution Reformulation**: Instead of summing over all $(k-1)!! = O((k/e)^{k/2})$ matchings (combinatorial explosion), we compute the **marginal probability** that walker $i$ is paired with walker $\\ell$:\n2477: \n2478: $$\n2479: p_{i \\to \\ell} := \\mathbb{P}_{M \\sim P_{\\text{ideal}}}(M(i) = \\ell) = \\frac{\\sum_{M: M(i) = \\ell} W(M)}{\\sum_{M \\in \\mathcal{M}_k} W(M)}\n2480: \n2481: $$\n2482: \n2483: Then the expected measurement becomes:\n2484: \n2485: $$\n2486: \\bar{d}_i = \\sum_{\\ell \\in \\mathcal{A} \\setminus \\{i\\}} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i, \\ell)\n2487: \n2488: $$\n2489: \n2490: **This is a sum over $k-1$ terms, not $(k-1)!!$ matchings!** The combinatorial explosion is eliminated by permutation symmetry.\n2491: \n2492: **Computing the marginal probability**: For a fixed pair $(i, \\ell)$, the numerator sums over all matchings where $i$ is paired with $\\ell$:\n2493: \n2494: $$\n2495: \\sum_{M: M(i) = \\ell} W(M) = \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,\\ell)}{2\\varepsilon_d^2}\\right) \\cdot Z_{\\text{rest}}(i, \\ell)\n2496: \n2497: $$\n2498: \n2499: where $Z_{\\text{rest}}(i, \\ell) = \\sum_{M' \\in \\mathcal{M}_{k-2}} W(M')$ is the partition function over matchings of the remaining $k-2$ walkers (excluding $i$ and $\\ell$).\n2500: \n2501: **Key insight - Direct regularity without approximation**: While one might expect $Z_{\\text{rest}}(i,\\ell)$ to be approximately constant (independent of $\\ell$), this is NOT generally true in clustered geometries. **However**, we can prove C^‚àû regularity with k-uniform bounds **without** assuming this approximation.\n2502: \n2503: **Direct observation**: The critical fact is that $Z_{\\text{rest}}(i,\\ell)$ is **independent of $x_i$** (it depends only on walkers $\\mathcal{A} \\setminus \\{i,\\ell\\}$). Therefore:\n2504: \n2505: $$\n2506: \\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0\n2507: \n2508: $$\n2509: \n2510: because derivatives of d_alg(j,j') with respect to x_i are zero when $i \\notin \\{j,j'\\}$ (locality of distance derivatives).\n2511: \n2512: **Consequence**: The marginal probability has simplified derivative structure:\n2513: \n2514: $$\n2515: p_{i \\to \\ell} = \\frac{\\exp(-d_{\\text{alg}}^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} \\exp(-d_{\\text{alg}}^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell')}\n2516: \n2517: $$\n2518: \n2519: When taking derivatives $\\nabla_{x_i}$, the $Z_{\\text{rest}}$ terms factor out of the quotient rule because $\\nabla_{x_i} Z_{\\text{rest}} = 0$!\n2520: \n2521: **Result**: The expected measurement has analytical structure\n2522: \n2523: $$\n2524: \\bar{d}_i = \\sum_{\\ell \\neq i} p_{i \\to \\ell} \\cdot d_{\\text{alg}}(i,\\ell)\n2525: \n2526: $$\n2527: \n2528: where the marginal $p_{i \\to \\ell}$ is a **quotient with bounded, k-independent ratios** $Z_{\\text{rest}}(i,\\ell) / Z_{\\text{rest}}(i,\\ell')$ (both are partition functions over k-2 walkers with exponential weights, differing only by which walker is excluded).\n2529: \n2530: **No combinatorial explosion**: Permutation symmetry reduces (k-1)!! matchings to a sum over k-1 terms with well-behaved coefficients!\n2531: \n2532: **Step 4: Derivative analysis via locality**\n2533: \n2534: **Key**: When taking derivatives $\\nabla_{x_i}$ of $p_{i \\to \\ell}$:\n2535: \n2536: $$\n2537: \\nabla_{x_i} p_{i \\to \\ell} = \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2)) \\cdot Z_{\\text{rest}}(i,\\ell)}{\\sum_{\\ell'} (\\cdots)}\\right]\n2538: \n2539: $$\n2540: \n2541: Since $\\nabla_{x_i} Z_{\\text{rest}}(i,\\ell) = 0$ (locality), the $Z_{\\text{rest}}$ terms are **constants** for the derivative calculation. The quotient simplifies to:\n2542: \n2543: $$\n2544: \\nabla_{x_i} p_{i \\to \\ell} \\propto \\nabla_{x_i} \\left[\\frac{\\exp(-d^2(i,\\ell)/(2\\varepsilon_d^2))}{\\sum_{\\ell'} \\exp(-d^2(i,\\ell')/(2\\varepsilon_d^2)) \\cdot (Z_{\\text{rest}}(i,\\ell')/Z_{\\text{rest}}(i,\\ell))}\\right]\n2545: \n2546: $$\n2547: \n2548: **Bound via quotient rule**: Even though $Z_{\\text{rest}}$ ratios may vary by O(1) factors (e.g., in clustered geometries), they are:\n2549: 1. **Bounded**: By exponential weights, all ratios ‚â§ exp(const ¬∑ (R_eff)¬≤/Œµ_d¬≤) < ‚àû\n2550: 2. **k-uniform**: Number of $\\ell$ contributing is k_eff = O(œÅ_max Œµ_d^{2d}), independent of k\n2551: 3. **Smooth**: Each Z_rest is a sum of smooth exponentials\n2552: \n2553: The derivatives follow from standard quotient rule + Fa√† di Bruno:\n2554: 1. **Gaussian kernel derivatives**: $\\|\\nabla^m K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_m \\cdot \\varepsilon_d^{-2m} \\cdot K_{\\varepsilon_d}(i,\\ell)$\n2555: 2. **Exponential concentration**: Only $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ nearby walkers contribute significantly\n2556: 3. **Quotient rule**: Generalized Leibniz rule with k-uniform bounds\n2557: \n2558: By uniform density bound (Assumption {prf:ref}`assump-uniform-density-full`):\n2559: \n2560: $$\n2561: k_{\\text{eff}}(i) = |\\{\\ell : d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}}\\}| \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot R_{\\text{eff}}^{2d} = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2562: \n2563: $$\n2564: \n2565: where $R_{\\text{eff}} = O(\\varepsilon_d)$ is the effective interaction radius (exponential concentration of softmax).\n2566: \n2567: **Step 5: Derivative bound via quotient rule**\n2568: \n2569: Taking derivatives of $\\bar{d}_i = f_i / Z_i$:\n2570: \n2571: $$\n2572: \\nabla^m \\bar{d}_i = \\sum_{\\text{partitions of } m} C_{j_1,\\ldots,j_p} \\cdot \\frac{(\\nabla^{j_1} f_i) \\cdot (\\nabla^{j_2} Z_i) \\cdots (\\nabla^{j_p} Z_i)}{Z_i^{p+1}}\n2573: \n2574: $$\n2575: \n2576: Each derivative of $f_i$ and $Z_i$ involves sums over $k-1$ walkers:\n2577: \n2578: $$\n2579: \\nabla^j f_i = \\sum_{\\ell \\neq i} \\nabla^j [K_{\\varepsilon_d}(i,\\ell) \\cdot d_{\\text{alg}}(i,\\ell)]\n2580: \n2581: $$\n2582: \n2583: By the product rule and Fa√† di Bruno formula:\n2584: \n2585: $$\n2586: \\nabla^j [K_{\\varepsilon_d} \\cdot d_{\\text{alg}}] = \\sum_{\\alpha + \\beta = j} C_{\\alpha,\\beta} \\cdot (\\nabla^\\alpha K_{\\varepsilon_d}) \\cdot (\\nabla^\\beta d_{\\text{alg}})\n2587: \n2588: $$\n2589: \n2590: **Bounds on each term**:\n2591: - $\\|\\nabla^\\alpha K_{\\varepsilon_d}(i,\\ell)\\| \\leq C_\\alpha \\cdot \\varepsilon_d^{-2\\alpha} \\cdot K_{\\varepsilon_d}(i,\\ell)$ (Gaussian)\n2592: - $\\|\\nabla^\\beta d_{\\text{alg}}(i,\\ell)\\| \\leq C_\\beta \\cdot \\varepsilon_d^{1-\\beta}$ (regularized distance)\n2593: \n2594: **Exponential concentration**: Only walkers with $d_{\\text{alg}}(i,\\ell) \\leq R_{\\text{eff}} = O(\\varepsilon_d)$ contribute significantly (softmax tail bound). The effective number is:\n2595: \n2596: $$\n2597: k_{\\text{eff}} = O(\\rho_{\\max} \\cdot \\text{Vol}(B_{R_{\\text{eff}}})) = O(\\rho_{\\max} \\varepsilon_d^{2d})\n2598: \n2599: $$\n2600: \n2601: which is **k-uniform** (independent of total swarm size).\n2602: \n2603: **Step 6: Assemble the Gevrey-1 bound**\n2604: \n2605: Summing over $k_{\\text{eff}}$ effective walkers and applying quotient rule:\n2606: \n2607: $$\n2608: \\|\\nabla^m \\bar{d}_i\\| \\leq \\sum_{\\text{partitions}} \\frac{k_{\\text{eff}} \\cdot C_{j_1} \\varepsilon_d^{-2j_1} \\cdot (k_{\\text{eff}} \\cdot C_{j_2} \\varepsilon_d^{-2j_2})^{p-1}}{Z_{\\min}^p}\n2609: \n2610: $$\n2611: \n2612: Since $k_{\\text{eff}} = O(\\rho_{\\max} \\varepsilon_d^{2d})$ and $Z_{\\min} = \\Omega(k_{\\text{eff}})$, the $k_{\\text{eff}}$ factors cancel:\n2613: \n2614: $$\n2615: \\|\\nabla^m \\bar{d}_i\\| \\leq C_m(\\varepsilon_d, d, \\rho_{\\max}) \\cdot m! \\cdot \\varepsilon_d^{-2m}\n2616: \n2617: $$\n2618: \n2619: where $C_m = O(m!)$ (Gevrey-1) and is **k-uniform**.\n2620: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 5.6 Diversity Pairing Mechanism Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-greedy-ideal-equivalence",
      "title": null,
      "start_line": 2668,
      "end_line": 2750,
      "header_lines": [
        2669
      ],
      "content_start": 2671,
      "content_end": 2749,
      "content": "2671: :label: proof-lem-greedy-ideal-equivalence\n2672: \n2673: The proof consists of two main parts:\n2674: \n2675: **Part I: Statistical Equivalence** - Prove $\\mathbb{E}_{\\text{greedy}}[d_i | S] = \\mathbb{E}_{\\text{ideal}}[d_i | S] + O(k^{-\\beta})$ using exponential locality.\n2676: \n2677: **Part II: Regularity Transfer** - Show that both expectations have identical analytical structure as rational functions of smooth exponential weights.\n2678: \n2679: **Part I: Statistical Equivalence via Exponential Locality**\n2680: \n2681: Define the truncation radius $R_k := \\varepsilon_d \\sqrt{2(\\beta + d) \\log k}$ for some $\\beta > 0$ to be determined.\n2682: \n2683: *Lemma A (Exponential Tail Bound)*: For the total weight contribution from walkers outside $B(i,R_k)$:\n2684: \n2685: $$\n2686: \\sum_{j \\notin B(i,R_k)} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_d^2}\\right) \\leq C_{\\text{tail}}(\\rho_{\\max}, \\varepsilon_d, d) \\exp\\left(-\\frac{R_k^2}{2\\varepsilon_d^2}\\right) \\leq C_{\\text{tail}} \\cdot k^{-(\\beta + d)}\n2687: \n2688: $$\n2689: \n2690: **Proof**: Partition the exterior into shells and use the uniform density bound $|\\mathcal{S}(i, r, dr)| \\leq \\rho_{\\max} \\cdot \\text{vol}(S^{d-1}) \\cdot r^{d-1} \\, dr$. The total exterior weight is:\n2691: \n2692: $$\n2693: W_{\\text{exterior}}(R_k) \\leq \\int_{R_k}^{\\infty} \\rho_{\\max} \\cdot \\text{vol}(S^{d-1}) \\cdot r^{d-1} \\cdot \\exp\\left(-\\frac{r^2}{2\\varepsilon_d^2}\\right) \\, dr\n2694: \n2695: $$\n2696: \n2697: Substituting $u = r^2/(2\\varepsilon_d^2)$ and applying the incomplete gamma function tail bound:\n2698: \n2699: $$\n2700: \\int_{R_k^2/(2\\varepsilon_d^2)}^{\\infty} u^{(d-2)/2} e^{-u} \\, du \\leq \\Gamma(d/2) \\cdot \\exp\\left(-\\frac{R_k^2}{2\\varepsilon_d^2}\\right)\n2701: \n2702: $$\n2703: \n2704: For $R_k = \\varepsilon_d \\sqrt{2(\\beta + d) \\log k}$, this yields $W_{\\text{exterior}}(R_k) \\leq C_{\\text{tail}} \\cdot k^{-(\\beta + d)}$. ‚àé\n2705: \n2706: *Lemma B (Coupling on Good Event)*: Define the good event:\n2707: \n2708: $$\n2709: G_R := \\{\\text{No walker outside } B(i, R_k) \\text{ is paired with any walker in } B(i, R_k) \\text{ before walker } i \\text{ is paired}\\}\n2710: \n2711: $$\n2712: \n2713: On the event $G_R$, the greedy and ideal marginals coincide on the local neighborhood $B(i, R_k)$, with exponentially small correction from external walkers.\n2714: \n2715: **Proof**: By Lemma A, external walkers contribute weight $O(k^{-(\\beta + d)})$. The probability of the bad event $\\bar{G}_R$ (external pre-emption) is bounded by:\n2716: \n2717: $$\n2718: P(\\bar{G}_R) \\leq k \\cdot W_{\\text{exterior}}(R_k) \\leq C_{\\text{tail}} \\cdot k^{1-(\\beta + d)}\n2719: \n2720: $$\n2721: \n2722: For $\\beta > 1 - d$, this vanishes as $k \\to \\infty$. Conditioning on $G_R$, the greedy and localized ideal mechanisms select from the same effective neighborhood with the same exponential weights, yielding:\n2723: \n2724: $$\n2725: |\\mathbb{E}_{\\text{greedy}}[d_i | S] - \\mathbb{E}_{\\text{ideal}}[d_i | S]| \\leq C \\cdot k^{-\\beta}\n2726: \n2727: $$\n2728: \n2729: for some constant $C$ depending on $(\\varepsilon_d, d, \\rho_{\\max}, d_{\\max})$ but independent of $k$. ‚àé\n2730: \n2731: **Part II: Regularity Transfer**\n2732: \n2733: Both $\\mathbb{E}_{\\text{greedy}}$ and $\\mathbb{E}_{\\text{ideal}}$ are rational functions of exponential weights:\n2734: \n2735: $$\n2736: \\mathbb{E}_{\\bullet}[d_i | S] = \\frac{\\sum_{\\text{matchings } M} \\left(\\prod_{(j,j') \\in M} \\exp(-d^2/(2\\varepsilon_d^2))\\right) \\cdot f_i(M)}{\\sum_{\\text{matchings } M'} \\prod_{(j,j') \\in M'} \\exp(-d^2/(2\\varepsilon_d^2))}\n2737: \n2738: $$\n2739: \n2740: where $f_i(M)$ is a measurement value associated with the matching $M$.\n2741: \n2742: **Key observations**:\n2743: 1. Both expressions involve the **same exponential kernel** $\\exp(-d^2/(2\\varepsilon_d^2))$, which is C^‚àû in walker positions\n2744: 2. Derivatives are computed via Fa√† di Bruno's formula and quotient rule\n2745: 3. The sequential (greedy) vs. global (ideal) structure affects only the **combinatorial structure** (which matchings are summed), not the **analytical structure** (form of derivatives)\n2746: 4. Since both are rational functions of the same smooth weights, they have **identical regularity** (C^‚àû with Gevrey-1 bounds)\n2747: \n2748: *Lemma 5.1.2 from 03_cloning.md* establishes that the greedy algorithm preserves the geometric signal structure, meaning the dominant contributions to both sums come from geometrically similar matchings.\n2749: ",
      "metadata": {
        "label": "proof-lem-greedy-ideal-equivalence"
      },
      "section": "## 5.6 Diversity Pairing Mechanism Analysis",
      "raw_directive": "2668: :::\n2669: \n2670: :::{prf:proof}\n2671: :label: proof-lem-greedy-ideal-equivalence\n2672: \n2673: The proof consists of two main parts:\n2674: \n2675: **Part I: Statistical Equivalence** - Prove $\\mathbb{E}_{\\text{greedy}}[d_i | S] = \\mathbb{E}_{\\text{ideal}}[d_i | S] + O(k^{-\\beta})$ using exponential locality.\n2676: \n2677: **Part II: Regularity Transfer** - Show that both expectations have identical analytical structure as rational functions of smooth exponential weights.\n2678: \n2679: **Part I: Statistical Equivalence via Exponential Locality**\n2680: \n2681: Define the truncation radius $R_k := \\varepsilon_d \\sqrt{2(\\beta + d) \\log k}$ for some $\\beta > 0$ to be determined.\n2682: \n2683: *Lemma A (Exponential Tail Bound)*: For the total weight contribution from walkers outside $B(i,R_k)$:\n2684: \n2685: $$\n2686: \\sum_{j \\notin B(i,R_k)} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\varepsilon_d^2}\\right) \\leq C_{\\text{tail}}(\\rho_{\\max}, \\varepsilon_d, d) \\exp\\left(-\\frac{R_k^2}{2\\varepsilon_d^2}\\right) \\leq C_{\\text{tail}} \\cdot k^{-(\\beta + d)}\n2687: \n2688: $$\n2689: \n2690: **Proof**: Partition the exterior into shells and use the uniform density bound $|\\mathcal{S}(i, r, dr)| \\leq \\rho_{\\max} \\cdot \\text{vol}(S^{d-1}) \\cdot r^{d-1} \\, dr$. The total exterior weight is:\n2691: \n2692: $$\n2693: W_{\\text{exterior}}(R_k) \\leq \\int_{R_k}^{\\infty} \\rho_{\\max} \\cdot \\text{vol}(S^{d-1}) \\cdot r^{d-1} \\cdot \\exp\\left(-\\frac{r^2}{2\\varepsilon_d^2}\\right) \\, dr\n2694: \n2695: $$\n2696: \n2697: Substituting $u = r^2/(2\\varepsilon_d^2)$ and applying the incomplete gamma function tail bound:\n2698: \n2699: $$\n2700: \\int_{R_k^2/(2\\varepsilon_d^2)}^{\\infty} u^{(d-2)/2} e^{-u} \\, du \\leq \\Gamma(d/2) \\cdot \\exp\\left(-\\frac{R_k^2}{2\\varepsilon_d^2}\\right)\n2701: \n2702: $$\n2703: \n2704: For $R_k = \\varepsilon_d \\sqrt{2(\\beta + d) \\log k}$, this yields $W_{\\text{exterior}}(R_k) \\leq C_{\\text{tail}} \\cdot k^{-(\\beta + d)}$. ‚àé\n2705: \n2706: *Lemma B (Coupling on Good Event)*: Define the good event:\n2707: \n2708: $$\n2709: G_R := \\{\\text{No walker outside } B(i, R_k) \\text{ is paired with any walker in } B(i, R_k) \\text{ before walker } i \\text{ is paired}\\}\n2710: \n2711: $$\n2712: \n2713: On the event $G_R$, the greedy and ideal marginals coincide on the local neighborhood $B(i, R_k)$, with exponentially small correction from external walkers.\n2714: \n2715: **Proof**: By Lemma A, external walkers contribute weight $O(k^{-(\\beta + d)})$. The probability of the bad event $\\bar{G}_R$ (external pre-emption) is bounded by:\n2716: \n2717: $$\n2718: P(\\bar{G}_R) \\leq k \\cdot W_{\\text{exterior}}(R_k) \\leq C_{\\text{tail}} \\cdot k^{1-(\\beta + d)}\n2719: \n2720: $$\n2721: \n2722: For $\\beta > 1 - d$, this vanishes as $k \\to \\infty$. Conditioning on $G_R$, the greedy and localized ideal mechanisms select from the same effective neighborhood with the same exponential weights, yielding:\n2723: \n2724: $$\n2725: |\\mathbb{E}_{\\text{greedy}}[d_i | S] - \\mathbb{E}_{\\text{ideal}}[d_i | S]| \\leq C \\cdot k^{-\\beta}\n2726: \n2727: $$\n2728: \n2729: for some constant $C$ depending on $(\\varepsilon_d, d, \\rho_{\\max}, d_{\\max})$ but independent of $k$. ‚àé\n2730: \n2731: **Part II: Regularity Transfer**\n2732: \n2733: Both $\\mathbb{E}_{\\text{greedy}}$ and $\\mathbb{E}_{\\text{ideal}}$ are rational functions of exponential weights:\n2734: \n2735: $$\n2736: \\mathbb{E}_{\\bullet}[d_i | S] = \\frac{\\sum_{\\text{matchings } M} \\left(\\prod_{(j,j') \\in M} \\exp(-d^2/(2\\varepsilon_d^2))\\right) \\cdot f_i(M)}{\\sum_{\\text{matchings } M'} \\prod_{(j,j') \\in M'} \\exp(-d^2/(2\\varepsilon_d^2))}\n2737: \n2738: $$\n2739: \n2740: where $f_i(M)$ is a measurement value associated with the matching $M$.\n2741: \n2742: **Key observations**:\n2743: 1. Both expressions involve the **same exponential kernel** $\\exp(-d^2/(2\\varepsilon_d^2))$, which is C^‚àû in walker positions\n2744: 2. Derivatives are computed via Fa√† di Bruno's formula and quotient rule\n2745: 3. The sequential (greedy) vs. global (ideal) structure affects only the **combinatorial structure** (which matchings are summed), not the **analytical structure** (form of derivatives)\n2746: 4. Since both are rational functions of the same smooth weights, they have **identical regularity** (C^‚àû with Gevrey-1 bounds)\n2747: \n2748: *Lemma 5.1.2 from 03_cloning.md* establishes that the greedy algorithm preserves the geometric signal structure, meaning the dominant contributions to both sums come from geometrically similar matchings.\n2749: \n2750: **Conclusion**: The C^‚àû regularity of $\\mathbb{E}_{\\text{ideal}}$ established in Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity` (with k-uniform Gevrey-1 bounds $\\|\\nabla^m \\bar{d}_i\\| \\leq C_m \\cdot m! \\cdot \\varepsilon_d^{-2m}$) transfers identically to $\\mathbb{E}_{\\text{greedy}}$. The $O(k^{-\\beta})$ statistical difference is negligible for derivative bounds, which depend only on the analytical structure and the parameters $(\\varepsilon_d, d, \\rho_{\\max})$. ‚àé",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 5.6 Diversity Pairing Mechanism Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-statistical-equivalence-companion-mechanisms",
      "title": null,
      "start_line": 2869,
      "end_line": 2879,
      "header_lines": [
        2870
      ],
      "content_start": 2872,
      "content_end": 2878,
      "content": "2872: :label: proof-thm-statistical-equivalence-companion-mechanisms\n2873: \n2874: 1. **Boundedness**: Both expectations lie in $[0, D_{\\max}]$ because $d_{\\text{alg}}(j, \\ell)$ is bounded on the compact phase space. Hence $|\\Delta_j| \\leq D_{\\max}$.\n2875: \n2876: 2. **Regularity**: The \"softmax\" expectation satisfies Lemma {prf:ref}`lem-derivatives-companion-distance-full`, while the diversity-pairing expectation satisfies Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity`. Taking differences and using the triangle inequality gives the bound above with constants independent of $k$.\n2877: \n2878: 3. **Propagation through the pipeline**: Every subsequent stage of the proof (Sections 6‚Äì12) is affine in $d_j$ at the level of first principles, so replacing $d_j$ by $d_j + \\Delta_j$ perturbs each stage by at most the same derivative bound furnished in Step 2. Thus both mechanisms yield identical regularity statements for $V_{\\text{fit}}$.",
      "metadata": {
        "label": "proof-thm-statistical-equivalence-companion-mechanisms"
      },
      "section": "## 5.7 Statistical Equivalence and Unified Regularity Theorem",
      "raw_directive": "2869: :::\n2870: \n2871: :::{prf:proof}\n2872: :label: proof-thm-statistical-equivalence-companion-mechanisms\n2873: \n2874: 1. **Boundedness**: Both expectations lie in $[0, D_{\\max}]$ because $d_{\\text{alg}}(j, \\ell)$ is bounded on the compact phase space. Hence $|\\Delta_j| \\leq D_{\\max}$.\n2875: \n2876: 2. **Regularity**: The \"softmax\" expectation satisfies Lemma {prf:ref}`lem-derivatives-companion-distance-full`, while the diversity-pairing expectation satisfies Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity`. Taking differences and using the triangle inequality gives the bound above with constants independent of $k$.\n2877: \n2878: 3. **Propagation through the pipeline**: Every subsequent stage of the proof (Sections 6‚Äì12) is affine in $d_j$ at the level of first principles, so replacing $d_j$ by $d_j + \\Delta_j$ perturbs each stage by at most the same derivative bound furnished in Step 2. Thus both mechanisms yield identical regularity statements for $V_{\\text{fit}}$.\n2879: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 5.7 Statistical Equivalence and Unified Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-unified-cinf-regularity-both-mechanisms",
      "title": null,
      "start_line": 2933,
      "end_line": 2942,
      "header_lines": [
        2934
      ],
      "content_start": 2936,
      "content_end": 2941,
      "content": "2936: :label: proof-thm-unified-cinf-regularity-both-mechanisms\n2937: \n2938: **Proof Structure**:\n2939: \n2940: 1. **Softmax mechanism** (¬ß5.5): Proven in Lemma {prf:ref}`lem-companion-measurement-derivatives-full` + propagation through stages 2-6\n2941: 2. **Diversity pairing** (¬ß5.6): Proven in Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity` + same propagation",
      "metadata": {
        "label": "proof-thm-unified-cinf-regularity-both-mechanisms"
      },
      "section": "## 5.7 Statistical Equivalence and Unified Regularity Theorem",
      "raw_directive": "2933: :::\n2934: \n2935: :::{prf:proof}\n2936: :label: proof-thm-unified-cinf-regularity-both-mechanisms\n2937: \n2938: **Proof Structure**:\n2939: \n2940: 1. **Softmax mechanism** (¬ß5.5): Proven in Lemma {prf:ref}`lem-companion-measurement-derivatives-full` + propagation through stages 2-6\n2941: 2. **Diversity pairing** (¬ß5.6): Proven in Theorem {prf:ref}`thm-diversity-pairing-measurement-regularity` + same propagation\n2942: 3. **Statistical equivalence** (¬ß5.7.2): Theorem {prf:ref}`thm-statistical-equivalence-companion-mechanisms` establishes mechanisms differ by $O(k^{-1} \\log^{d+1/2} k)$ (worst-case)",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 5.7 Statistical Equivalence and Unified Regularity Theorem"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-gaussian-kernel-derivatives-full",
      "title": null,
      "start_line": 2993,
      "end_line": 3011,
      "header_lines": [
        2994
      ],
      "content_start": 2996,
      "content_end": 3010,
      "content": "2996: :label: proof-lem-gaussian-kernel-derivatives-full\n2997: \n2998: By Fa√† di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n2999: \n3000: $$\n3001: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3002: \n3003: $$\n3004: \n3005: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3006: \n3007: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3008: \n3009: $$\n3010: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho",
      "metadata": {
        "label": "proof-lem-gaussian-kernel-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "2993: :::\n2994: \n2995: :::{prf:proof}\n2996: :label: proof-lem-gaussian-kernel-derivatives-full\n2997: \n2998: By Fa√† di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n2999: \n3000: $$\n3001: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3002: \n3003: $$\n3004: \n3005: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3006: \n3007: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3008: \n3009: $$\n3010: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho\n3011: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-localization-weight-derivatives-full",
      "title": null,
      "start_line": 3028,
      "end_line": 3115,
      "header_lines": [
        3029
      ],
      "content_start": 3031,
      "content_end": 3114,
      "content": "3031: :label: proof-lem-localization-weight-derivatives-full\n3032: \n3033: **Step 1: Partition function bounds.**\n3034: \n3035: By {prf:ref}`lem-companion-availability-enforcement`:\n3036: \n3037: $$\n3038: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3039: \n3040: $$\n3041: \n3042: and\n3043: \n3044: $$\n3045: Z_i(\\rho) \\leq k \\cdot 1 = k\n3046: \n3047: $$\n3048: \n3049: **Step 2: Quotient rule for $n$-th derivative.**\n3050: \n3051: By the generalized quotient rule (Fa√† di Bruno for $f/g$):\n3052: \n3053: $$\n3054: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3055: \n3056: $$\n3057: \n3058: **Step 3: Bounding each term with k-uniform estimates.**\n3059: \n3060: To establish k-uniformity, we apply the sum-to-integral lemma.\n3061: \n3062: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3063: \n3064: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3065: \n3066: $$\n3067: \\begin{aligned}\n3068: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3069: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3070: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3071: \\end{aligned}\n3072: \n3073: $$\n3074: \n3075: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3076: \n3077: $$\n3078: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3079: \n3080: $$\n3081: \n3082: Define:\n3083: \n3084: $$\n3085: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3086: \n3087: $$\n3088: \n3089: This is **k-independent** - it depends only on œÅ_max (from density assumption), œÅ (localization scale), and d (dimension).\n3090: \n3091: **Updated quotient bound:**\n3092: \n3093: Using:\n3094: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3095: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3096: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3097: \n3098: The generalized quotient rule gives:\n3099: \n3100: $$\n3101: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3102: \n3103: $$\n3104: \n3105: where $C_{w,n}(\\rho)$ depends on œÅ, œÅ_max, d but is **k-uniform** (independent of k and N).\n3106: \n3107: **Step 4: Explicit constant dependence.**\n3108: \n3109: The constant $C_{w,n}(\\rho)$ arises from the Fa√† di Bruno formula for the quotient and scales as:\n3110: \n3111: $$\n3112: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3113: \n3114: $$",
      "metadata": {
        "label": "proof-lem-localization-weight-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3028: :::\n3029: \n3030: :::{prf:proof}\n3031: :label: proof-lem-localization-weight-derivatives-full\n3032: \n3033: **Step 1: Partition function bounds.**\n3034: \n3035: By {prf:ref}`lem-companion-availability-enforcement`:\n3036: \n3037: $$\n3038: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3039: \n3040: $$\n3041: \n3042: and\n3043: \n3044: $$\n3045: Z_i(\\rho) \\leq k \\cdot 1 = k\n3046: \n3047: $$\n3048: \n3049: **Step 2: Quotient rule for $n$-th derivative.**\n3050: \n3051: By the generalized quotient rule (Fa√† di Bruno for $f/g$):\n3052: \n3053: $$\n3054: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3055: \n3056: $$\n3057: \n3058: **Step 3: Bounding each term with k-uniform estimates.**\n3059: \n3060: To establish k-uniformity, we apply the sum-to-integral lemma.\n3061: \n3062: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3063: \n3064: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3065: \n3066: $$\n3067: \\begin{aligned}\n3068: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3069: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3070: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3071: \\end{aligned}\n3072: \n3073: $$\n3074: \n3075: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3076: \n3077: $$\n3078: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3079: \n3080: $$\n3081: \n3082: Define:\n3083: \n3084: $$\n3085: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3086: \n3087: $$\n3088: \n3089: This is **k-independent** - it depends only on œÅ_max (from density assumption), œÅ (localization scale), and d (dimension).\n3090: \n3091: **Updated quotient bound:**\n3092: \n3093: Using:\n3094: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3095: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3096: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3097: \n3098: The generalized quotient rule gives:\n3099: \n3100: $$\n3101: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3102: \n3103: $$\n3104: \n3105: where $C_{w,n}(\\rho)$ depends on œÅ, œÅ_max, d but is **k-uniform** (independent of k and N).\n3106: \n3107: **Step 4: Explicit constant dependence.**\n3108: \n3109: The constant $C_{w,n}(\\rho)$ arises from the Fa√† di Bruno formula for the quotient and scales as:\n3110: \n3111: $$\n3112: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3113: \n3114: $$\n3115: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-telescoping-localization-weights-full",
      "title": null,
      "start_line": 3130,
      "end_line": 3146,
      "header_lines": [
        3131
      ],
      "content_start": 3133,
      "content_end": 3145,
      "content": "3133: :label: proof-lem-telescoping-localization-weights-full\n3134: \n3135: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3136: \n3137: Differentiating $n$ times:\n3138: \n3139: $$\n3140: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3141: \n3142: $$\n3143: \n3144: The interchange of sum and differentiation is justified because:\n3145: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)",
      "metadata": {
        "label": "proof-lem-telescoping-localization-weights-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3130: :::\n3131: \n3132: :::{prf:proof}\n3133: :label: proof-lem-telescoping-localization-weights-full\n3134: \n3135: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3136: \n3137: Differentiating $n$ times:\n3138: \n3139: $$\n3140: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3141: \n3142: $$\n3143: \n3144: The interchange of sum and differentiation is justified because:\n3145: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)\n3146: - Each $w_{ij}$ is C^‚àû",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-k-uniformity-telescoping-full",
      "title": null,
      "start_line": 3189,
      "end_line": 3272,
      "header_lines": [
        3190
      ],
      "content_start": 3192,
      "content_end": 3271,
      "content": "3192: :label: proof-thm-k-uniformity-telescoping-full\n3193: \n3194: **Step 1: Naive expansion suggests k-dependence.**\n3195: \n3196: The first derivative is:\n3197: \n3198: $$\n3199: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3200: \n3201: $$\n3202: \n3203: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3204: \n3205: **Step 2: Telescoping eliminates the k-dependence.**\n3206: \n3207: Separate the sum into two parts:\n3208: \n3209: $$\n3210: \\begin{aligned}\n3211: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3212: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3213: }\n3214: \\end{aligned}\n3215: \n3216: $$\n3217: \n3218: For the first term, use the **mean subtraction trick**:\n3219: \n3220: $$\n3221: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3222: \n3223: $$\n3224: \n3225: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3226: \n3227: $$\n3228: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3229: \n3230: $$\n3231: \n3232: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3233: \n3234: **Step 3: Bound using centered deviations.**\n3235: \n3236: Now each term is centered:\n3237: \n3238: $$\n3239: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3240: \n3241: $$\n3242: \n3243: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3244: \n3245: Therefore:\n3246: \n3247: $$\n3248: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3249: \n3250: $$\n3251: \n3252: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3253: \n3254: **Step 4: Higher derivatives by induction.**\n3255: \n3256: For $m \\geq 2$, apply Leibniz rule:\n3257: \n3258: $$\n3259: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3260: \n3261: $$\n3262: \n3263: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3264: \n3265: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3266: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3267: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3268: \n3269: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3270: \n3271: By induction and combinatorial counting (Fa√† di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.",
      "metadata": {
        "label": "proof-thm-k-uniformity-telescoping-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "raw_directive": "3189: :::\n3190: \n3191: :::{prf:proof}\n3192: :label: proof-thm-k-uniformity-telescoping-full\n3193: \n3194: **Step 1: Naive expansion suggests k-dependence.**\n3195: \n3196: The first derivative is:\n3197: \n3198: $$\n3199: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3200: \n3201: $$\n3202: \n3203: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3204: \n3205: **Step 2: Telescoping eliminates the k-dependence.**\n3206: \n3207: Separate the sum into two parts:\n3208: \n3209: $$\n3210: \\begin{aligned}\n3211: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3212: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3213: }\n3214: \\end{aligned}\n3215: \n3216: $$\n3217: \n3218: For the first term, use the **mean subtraction trick**:\n3219: \n3220: $$\n3221: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3222: \n3223: $$\n3224: \n3225: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3226: \n3227: $$\n3228: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3229: \n3230: $$\n3231: \n3232: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3233: \n3234: **Step 3: Bound using centered deviations.**\n3235: \n3236: Now each term is centered:\n3237: \n3238: $$\n3239: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3240: \n3241: $$\n3242: \n3243: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3244: \n3245: Therefore:\n3246: \n3247: $$\n3248: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3249: \n3250: $$\n3251: \n3252: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3253: \n3254: **Step 4: Higher derivatives by induction.**\n3255: \n3256: For $m \\geq 2$, apply Leibniz rule:\n3257: \n3258: $$\n3259: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3260: \n3261: $$\n3262: \n3263: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3264: \n3265: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3266: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3267: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3268: \n3269: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3270: \n3271: By induction and combinatorial counting (Fa√† di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.\n3272: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 12,
        "chapter_file": "chapter_12.json",
        "section_id": "## 6. Structure of Localization Weights"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-derivatives-companion-distance-full",
      "title": null,
      "start_line": 3302,
      "end_line": 3313,
      "header_lines": [
        3303
      ],
      "content_start": 3305,
      "content_end": 3312,
      "content": "3305: :label: proof-lem-derivatives-companion-distance-full\n3306: \n3307: Since $d_j = \\sum_\\ell \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ (expectation over softmax):\n3308: \n3309: $$\n3310: \\frac{\\partial d_j}{\\partial x_i} = \\sum_\\ell \\frac{\\partial}{\\partial x_i} [\\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)]\n3311: \n3312: $$",
      "metadata": {
        "label": "proof-lem-derivatives-companion-distance-full"
      },
      "section": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling",
      "raw_directive": "3302: :::\n3303: \n3304: :::{prf:proof}\n3305: :label: proof-lem-derivatives-companion-distance-full\n3306: \n3307: Since $d_j = \\sum_\\ell \\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)$ (expectation over softmax):\n3308: \n3309: $$\n3310: \\frac{\\partial d_j}{\\partial x_i} = \\sum_\\ell \\frac{\\partial}{\\partial x_i} [\\mathbb{P}(c(j) = \\ell) \\cdot d_{\\text{alg}}(j, \\ell)]\n3311: \n3312: $$\n3313: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 13,
        "chapter_file": "chapter_13.json",
        "section_id": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-cluster-localized-derivative-bounds-full",
      "title": null,
      "start_line": 3334,
      "end_line": 3425,
      "header_lines": [
        3335
      ],
      "content_start": 3337,
      "content_end": 3424,
      "content": "3337: :label: proof-thm-cluster-localized-derivative-bounds-full\n3338: \n3339: **Step 1: Partition of unity decomposition.**\n3340: \n3341: Using the smooth partition $\\{\\psi_m\\}_{m=1}^M$ from {prf:ref}`def-smooth-phase-space-partition-full`, we have:\n3342: \n3343: $$\n3344: 1 = \\sum_{m=1}^M \\psi_m(x_i, v_i) \\quad \\text{and} \\quad 1 = \\sum_{m'=1}^M \\psi_{m'}(x_j, v_j)\n3345: \n3346: $$\n3347: \n3348: Therefore, for any function $F(x_i, v_i, x_j, v_j)$:\n3349: \n3350: $$\n3351: F = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\cdot \\psi_{m'}(x_j, v_j) \\cdot F\n3352: \n3353: $$\n3354: \n3355: Applying this to $\\partial d_j / \\partial x_i$:\n3356: \n3357: $$\n3358: \\frac{\\partial d_j}{\\partial x_i} = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\psi_{m'}(x_j, v_j) \\frac{\\partial d_j}{\\partial x_i}\n3359: \n3360: $$\n3361: \n3362: **Step 2: Intra-cluster bound** ($m = m'$).\n3363: \n3364: When walkers $i$ and $j$ both have non-zero membership in the same cluster $m$:\n3365: - Walker $i$ satisfies: $\\psi_m(x_i, v_i) > 0 \\Rightarrow d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$ (support of $\\psi_m$)\n3366: - Walker $j$ satisfies: $\\psi_m(x_j, v_j) > 0 \\Rightarrow d_{\\text{alg}}(j, \\text{center}_m) \\leq 2\\varepsilon_c$\n3367: \n3368: By the triangle inequality:\n3369: \n3370: $$\n3371: d_{\\text{alg}}(i, j) \\leq d_{\\text{alg}}(i, \\text{center}_m) + d_{\\text{alg}}(j, \\text{center}_m) \\leq 4\\varepsilon_c\n3372: \n3373: $$\n3374: \n3375: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full`:\n3376: \n3377: $$\n3378: \\left\\|\\frac{\\partial d_j}{\\partial x_i}\\right\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3379: \n3380: $$\n3381: \n3382: Therefore: $C_{i \\leftrightarrow j}^{(m,m)} = C_{d_j,1} = \\mathcal{O}(1)$.\n3383: \n3384: **Step 3: Inter-cluster bound** ($m \\neq m'$).\n3385: \n3386: When walkers belong to different clusters ($m \\neq m'$):\n3387: - Walker $i$ in cluster $m$: $d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$\n3388: - Walker $j$ in cluster $m'$: $d_{\\text{alg}}(j, \\text{center}_{m'}) \\leq 2\\varepsilon_c$\n3389: \n3390: By the triangle inequality (lower bound):\n3391: \n3392: $$\n3393: d_{\\text{alg}}(i, j) \\geq D_{\\text{sep}}(m, m') - 4\\varepsilon_c\n3394: \n3395: $$\n3396: \n3397: where $D_{\\text{sep}}(m, m') := d_{\\text{alg}}(\\text{center}_m, \\text{center}_{m'})$ is the cluster separation distance.\n3398: \n3399: The derivative involves the softmax probability (from Lemma {prf:ref}`lem-derivatives-companion-distance-full`). The key term is:\n3400: \n3401: $$\n3402: \\frac{\\partial \\mathbb{P}(c(j) = \\ell)}{\\partial x_i} \\sim \\mathbb{P}(c(j) = \\ell) \\cdot \\nabla_{x_i} \\left[-\\frac{d_{\\text{alg}}^2(j, \\ell)}{2\\varepsilon_c^2}\\right]\n3403: \n3404: $$\n3405: \n3406: For walkers $i, j$ in different clusters, the softmax probability for walker $i$ to be the companion of walker $j$ is exponentially suppressed:\n3407: \n3408: $$\n3409: \\mathbb{P}(c(j) = i) \\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\varepsilon_c^2))}{\\exp(-R_{\\max}^2/(2\\varepsilon_c^2))} \\leq \\exp\\left(-\\frac{(D_{\\text{sep}} - 4\\varepsilon_c)^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n3410: \n3411: $$\n3412: \n3413: where we used the partition function lower bound from {prf:ref}`lem-companion-availability-enforcement`.\n3414: \n3415: For well-separated clusters ($D_{\\text{sep}} \\gg \\varepsilon_c$), this gives:\n3416: \n3417: $$\n3418: C_{i \\leftrightarrow j}^{(m,m')} = \\mathcal{O}\\left(\\exp\\left(-\\frac{D_{\\text{sep}}^2(m,m')}{2\\varepsilon_c^2}\\right)\\right)\n3419: \n3420: $$\n3421: \n3422: **Conclusion**: The decomposition splits the derivative into:\n3423: - **Intra-cluster terms** ($m = m'$): $\\mathcal{O}(1)$ contributions from nearby walkers\n3424: - **Inter-cluster terms** ($m \\neq m'$): Exponentially suppressed contributions from distant walkers",
      "metadata": {
        "label": "proof-thm-cluster-localized-derivative-bounds-full"
      },
      "section": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling",
      "raw_directive": "3334: :::\n3335: \n3336: :::{prf:proof}\n3337: :label: proof-thm-cluster-localized-derivative-bounds-full\n3338: \n3339: **Step 1: Partition of unity decomposition.**\n3340: \n3341: Using the smooth partition $\\{\\psi_m\\}_{m=1}^M$ from {prf:ref}`def-smooth-phase-space-partition-full`, we have:\n3342: \n3343: $$\n3344: 1 = \\sum_{m=1}^M \\psi_m(x_i, v_i) \\quad \\text{and} \\quad 1 = \\sum_{m'=1}^M \\psi_{m'}(x_j, v_j)\n3345: \n3346: $$\n3347: \n3348: Therefore, for any function $F(x_i, v_i, x_j, v_j)$:\n3349: \n3350: $$\n3351: F = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\cdot \\psi_{m'}(x_j, v_j) \\cdot F\n3352: \n3353: $$\n3354: \n3355: Applying this to $\\partial d_j / \\partial x_i$:\n3356: \n3357: $$\n3358: \\frac{\\partial d_j}{\\partial x_i} = \\sum_{m,m'=1}^M \\psi_m(x_i, v_i) \\psi_{m'}(x_j, v_j) \\frac{\\partial d_j}{\\partial x_i}\n3359: \n3360: $$\n3361: \n3362: **Step 2: Intra-cluster bound** ($m = m'$).\n3363: \n3364: When walkers $i$ and $j$ both have non-zero membership in the same cluster $m$:\n3365: - Walker $i$ satisfies: $\\psi_m(x_i, v_i) > 0 \\Rightarrow d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$ (support of $\\psi_m$)\n3366: - Walker $j$ satisfies: $\\psi_m(x_j, v_j) > 0 \\Rightarrow d_{\\text{alg}}(j, \\text{center}_m) \\leq 2\\varepsilon_c$\n3367: \n3368: By the triangle inequality:\n3369: \n3370: $$\n3371: d_{\\text{alg}}(i, j) \\leq d_{\\text{alg}}(i, \\text{center}_m) + d_{\\text{alg}}(j, \\text{center}_m) \\leq 4\\varepsilon_c\n3372: \n3373: $$\n3374: \n3375: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full`:\n3376: \n3377: $$\n3378: \\left\\|\\frac{\\partial d_j}{\\partial x_i}\\right\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3379: \n3380: $$\n3381: \n3382: Therefore: $C_{i \\leftrightarrow j}^{(m,m)} = C_{d_j,1} = \\mathcal{O}(1)$.\n3383: \n3384: **Step 3: Inter-cluster bound** ($m \\neq m'$).\n3385: \n3386: When walkers belong to different clusters ($m \\neq m'$):\n3387: - Walker $i$ in cluster $m$: $d_{\\text{alg}}(i, \\text{center}_m) \\leq 2\\varepsilon_c$\n3388: - Walker $j$ in cluster $m'$: $d_{\\text{alg}}(j, \\text{center}_{m'}) \\leq 2\\varepsilon_c$\n3389: \n3390: By the triangle inequality (lower bound):\n3391: \n3392: $$\n3393: d_{\\text{alg}}(i, j) \\geq D_{\\text{sep}}(m, m') - 4\\varepsilon_c\n3394: \n3395: $$\n3396: \n3397: where $D_{\\text{sep}}(m, m') := d_{\\text{alg}}(\\text{center}_m, \\text{center}_{m'})$ is the cluster separation distance.\n3398: \n3399: The derivative involves the softmax probability (from Lemma {prf:ref}`lem-derivatives-companion-distance-full`). The key term is:\n3400: \n3401: $$\n3402: \\frac{\\partial \\mathbb{P}(c(j) = \\ell)}{\\partial x_i} \\sim \\mathbb{P}(c(j) = \\ell) \\cdot \\nabla_{x_i} \\left[-\\frac{d_{\\text{alg}}^2(j, \\ell)}{2\\varepsilon_c^2}\\right]\n3403: \n3404: $$\n3405: \n3406: For walkers $i, j$ in different clusters, the softmax probability for walker $i$ to be the companion of walker $j$ is exponentially suppressed:\n3407: \n3408: $$\n3409: \\mathbb{P}(c(j) = i) \\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\varepsilon_c^2))}{\\exp(-R_{\\max}^2/(2\\varepsilon_c^2))} \\leq \\exp\\left(-\\frac{(D_{\\text{sep}} - 4\\varepsilon_c)^2 - R_{\\max}^2}{2\\varepsilon_c^2}\\right)\n3410: \n3411: $$\n3412: \n3413: where we used the partition function lower bound from {prf:ref}`lem-companion-availability-enforcement`.\n3414: \n3415: For well-separated clusters ($D_{\\text{sep}} \\gg \\varepsilon_c$), this gives:\n3416: \n3417: $$\n3418: C_{i \\leftrightarrow j}^{(m,m')} = \\mathcal{O}\\left(\\exp\\left(-\\frac{D_{\\text{sep}}^2(m,m')}{2\\varepsilon_c^2}\\right)\\right)\n3419: \n3420: $$\n3421: \n3422: **Conclusion**: The decomposition splits the derivative into:\n3423: - **Intra-cluster terms** ($m = m'$): $\\mathcal{O}(1)$ contributions from nearby walkers\n3424: - **Inter-cluster terms** ($m \\neq m'$): Exponentially suppressed contributions from distant walkers\n3425: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 13,
        "chapter_file": "chapter_13.json",
        "section_id": "## 7. Companion-Dependent Measurements: Handling N-Body Coupling"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-first-derivative-localized-mean-full",
      "title": null,
      "start_line": 3462,
      "end_line": 3603,
      "header_lines": [
        3463
      ],
      "content_start": 3465,
      "content_end": 3602,
      "content": "3465: :label: proof-lem-first-derivative-localized-mean-full\n3466: \n3467: **Step 1: Expand the derivative.**\n3468: \n3469: $$\n3470: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\nabla_{x_i} w_{ij} \\cdot d_j + \\sum_{j \\in \\mathcal{A}} w_{ij} \\cdot \\nabla_{x_i} d_j\n3471: \n3472: $$\n3473: \n3474: **Step 2: Telescoping the first term.**\n3475: \n3476: Using $\\sum_j \\nabla w_{ij} = 0$ and $\\mu_\\rho^{(i)} = \\sum_j w_{ij} d_j$:\n3477: \n3478: $$\n3479: \\sum_j \\nabla w_{ij} \\cdot d_j = \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho^{(i)})\n3480: \n3481: $$\n3482: \n3483: **Step 2: Use exponential localization and weighted telescoping.**\n3484: \n3485: The key observation is that $\\nabla w_{ij}$ is **exponentially localized**: $\\|\\nabla w_{ij}\\| \\sim e^{-d^2(i,j)/(2\\rho^2)} / \\rho$.\n3486: \n3487: So the sum is dominated by **nearby walkers** $j$ with $d_{\\text{alg}}(i,j) \\leq \\mathcal{O}(\\rho)$.\n3488: \n3489: By {prf:ref}`assump-uniform-density-full`, the number of such walkers is:\n3490: \n3491: $$\n3492: \\#\\{j : d_{\\text{alg}}(i,j) \\leq C\\rho\\} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\rho^{2d} = \\mathcal{O}(\\rho^{2d})\n3493: \n3494: $$\n3495: \n3496: Therefore:\n3497: \n3498: $$\n3499: \\left\\|\\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{2d}) \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3500: \n3501: $$\n3502: \n3503: This is **independent of $k$** but depends on $\\rho$.\n3504: \n3505: **Step 3: Bounding the second term with explicit k-uniformity.**\n3506: \n3507: $$\n3508: \\sum_j w_{ij} \\cdot \\nabla_{x_i} d_j\n3509: \n3510: $$\n3511: \n3512: From {prf:ref}`lem-derivatives-companion-distance-full`, $\\|\\nabla_{x_i} d_j\\| = \\mathcal{O}(1)$ when $i$ affects $j$'s companion selection.\n3513: \n3514: **Justification for k-uniformity**: Although the sum runs over all $k$ alive walkers, the result is **k-uniform** because of exponential localization:\n3515: \n3516: 1. **Localization weight decay**: $w_{ij}(\\rho) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2)) / Z_i(\\rho)$ decays exponentially with distance.\n3517: \n3518: 2. **Measurement derivative bounds**: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (Section 4.5.2), the companion-dependent measurement derivative satisfies **polynomial bounds**:\n3519: \n3520: $$\n3521: \\|\\nabla_{x_i} d_j\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3522: \n3523: $$\n3524: \n3525: **Key clarification**: The exponential factors from the softmax **cancel** in the quotient (see proof of Lemma {prf:ref}`lem-companion-measurement-derivatives-full`, Step 3, line 1012), leaving polynomial bounds rather than exponential decay. This is a crucial technical detail.\n3526: \n3527: 3. **Combined decay via weight dominance**: The summand combines the exponential decay of $w_{ij}$ with the polynomial bound on $\\nabla_{x_i} d_j$:\n3528: \n3529: $$\n3530: |w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3531: \n3532: $$\n3533: \n3534: The exponential decay of $w_{ij}(\\rho)$ **dominates** the polynomial bound on $\\nabla_{x_i} d_j$, ensuring k-uniformity of the sum.\n3535: \n3536: 4. **Sum-to-integral bound**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full` with the exponentially weighted sum:\n3537: \n3538: $$\n3539: \\sum_{j \\in \\mathcal{A}} |w_{ij} \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq C_{d_j,1} \\cdot \\rho_{\\max} (2\\pi\\rho^2)^d C_\\lambda = \\mathcal{O}(\\rho^{2d})\n3540: \n3541: $$\n3542: \n3543: This bound depends only on $\\rho$, $\\rho_{\\max}$, and dimension $d$ ‚Äî **not on $k$**.\n3544: \n3545: :::{note} **Explicit k-Uniformity Verification (Detailed)**\n3546: \n3547: To make the k-independence completely transparent, let us trace the bound step-by-step for the representative term $\\sum_j w_{ij} \\nabla_{x_i} d_j$:\n3548: \n3549: **Setup**: The summand is:\n3550: \n3551: $$\n3552: F_{ij} := w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\n3553: \n3554: $$\n3555: \n3556: **Step 1**: Bound the summand using our established bounds:\n3557: \n3558: $$\n3559: \\begin{aligned}\n3560: \\|F_{ij}\\| &= \\left\\|w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\\right\\| \\\\\n3561: &\\leq \\|w_{ij}(\\rho)\\| \\cdot \\|\\nabla_{x_i} d_j\\| \\\\\n3562: &\\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))}{Z_i(\\rho)} \\cdot C_{d_j,1} \\\\\n3563: &\\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\quad \\text{(using } Z_i \\geq 1\\text{)}\n3564: \\end{aligned}\n3565: \n3566: $$\n3567: \n3568: **Step 2**: Sum over all $k$ walkers:\n3569: \n3570: $$\n3571: \\left\\|\\sum_{j \\in \\mathcal{A}} F_{ij}\\right\\| \\leq \\sum_{j \\in \\mathcal{A}} \\|F_{ij}\\| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3572: \n3573: $$\n3574: \n3575: **Step 3**: Apply sum-to-integral lemma ({prf:ref}`lem-sum-to-integral-bound-full`):\n3576: \n3577: The sum over walkers is bounded by an integral using the uniform density bound œÅ_max:\n3578: \n3579: $$\n3580: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,y)}{2\\rho^2}\\right) dy\\,dv\n3581: \n3582: $$\n3583: \n3584: **Step 4**: Evaluate the Gaussian integral:\n3585: \n3586: $$\n3587: \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y-x_i\\|^2 + \\lambda_{\\text{alg}}\\|v-v_i\\|^2}{2\\rho^2}\\right) dy\\,dv = (2\\pi\\rho^2)^d \\cdot (2\\pi\\rho^2/\\lambda_{\\text{alg}})^{d/2} = (2\\pi\\rho^2)^d C_\\lambda\n3588: \n3589: $$\n3590: \n3591: **Step 5**: Combine to get k-uniform bound:\n3592: \n3593: $$\n3594: \\left\\|\\sum_{j \\in \\mathcal{A}} w_{ij} \\nabla_{x_i} d_j\\right\\| \\leq C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi\\rho^2)^d C_\\lambda =: C_{\\mu,1}(\\rho) \\cdot \\rho^{2d}\n3595: \n3596: $$\n3597: \n3598: where the constant $C_{\\mu,1}(\\rho) = C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi)^d C_\\lambda$ depends on:\n3599: - Derivative bound $C_{d_j,1}$ (from Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3600: - Density bound $\\rho_{\\max}$ (from Assumption {prf:ref}`assump-uniform-density-full`)\n3601: - Geometric constants $(2\\pi)^d$, $C_\\lambda$\n3602: - **NOT** on the number of alive walkers $k$",
      "metadata": {
        "label": "proof-lem-first-derivative-localized-mean-full"
      },
      "section": "## 8. Localized Mean: Derivative Expansion",
      "raw_directive": "3462: :::\n3463: \n3464: :::{prf:proof}\n3465: :label: proof-lem-first-derivative-localized-mean-full\n3466: \n3467: **Step 1: Expand the derivative.**\n3468: \n3469: $$\n3470: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\nabla_{x_i} w_{ij} \\cdot d_j + \\sum_{j \\in \\mathcal{A}} w_{ij} \\cdot \\nabla_{x_i} d_j\n3471: \n3472: $$\n3473: \n3474: **Step 2: Telescoping the first term.**\n3475: \n3476: Using $\\sum_j \\nabla w_{ij} = 0$ and $\\mu_\\rho^{(i)} = \\sum_j w_{ij} d_j$:\n3477: \n3478: $$\n3479: \\sum_j \\nabla w_{ij} \\cdot d_j = \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho^{(i)})\n3480: \n3481: $$\n3482: \n3483: **Step 2: Use exponential localization and weighted telescoping.**\n3484: \n3485: The key observation is that $\\nabla w_{ij}$ is **exponentially localized**: $\\|\\nabla w_{ij}\\| \\sim e^{-d^2(i,j)/(2\\rho^2)} / \\rho$.\n3486: \n3487: So the sum is dominated by **nearby walkers** $j$ with $d_{\\text{alg}}(i,j) \\leq \\mathcal{O}(\\rho)$.\n3488: \n3489: By {prf:ref}`assump-uniform-density-full`, the number of such walkers is:\n3490: \n3491: $$\n3492: \\#\\{j : d_{\\text{alg}}(i,j) \\leq C\\rho\\} \\leq \\rho_{\\max} \\cdot C_{\\text{vol}} \\cdot \\rho^{2d} = \\mathcal{O}(\\rho^{2d})\n3493: \n3494: $$\n3495: \n3496: Therefore:\n3497: \n3498: $$\n3499: \\left\\|\\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{2d}) \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3500: \n3501: $$\n3502: \n3503: This is **independent of $k$** but depends on $\\rho$.\n3504: \n3505: **Step 3: Bounding the second term with explicit k-uniformity.**\n3506: \n3507: $$\n3508: \\sum_j w_{ij} \\cdot \\nabla_{x_i} d_j\n3509: \n3510: $$\n3511: \n3512: From {prf:ref}`lem-derivatives-companion-distance-full`, $\\|\\nabla_{x_i} d_j\\| = \\mathcal{O}(1)$ when $i$ affects $j$'s companion selection.\n3513: \n3514: **Justification for k-uniformity**: Although the sum runs over all $k$ alive walkers, the result is **k-uniform** because of exponential localization:\n3515: \n3516: 1. **Localization weight decay**: $w_{ij}(\\rho) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2)) / Z_i(\\rho)$ decays exponentially with distance.\n3517: \n3518: 2. **Measurement derivative bounds**: From Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (Section 4.5.2), the companion-dependent measurement derivative satisfies **polynomial bounds**:\n3519: \n3520: $$\n3521: \\|\\nabla_{x_i} d_j\\| \\leq C_{d_j,1} \\cdot \\max(1, \\varepsilon_d \\varepsilon_c^{-1}) = \\mathcal{O}(1)\n3522: \n3523: $$\n3524: \n3525: **Key clarification**: The exponential factors from the softmax **cancel** in the quotient (see proof of Lemma {prf:ref}`lem-companion-measurement-derivatives-full`, Step 3, line 1012), leaving polynomial bounds rather than exponential decay. This is a crucial technical detail.\n3526: \n3527: 3. **Combined decay via weight dominance**: The summand combines the exponential decay of $w_{ij}$ with the polynomial bound on $\\nabla_{x_i} d_j$:\n3528: \n3529: $$\n3530: |w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3531: \n3532: $$\n3533: \n3534: The exponential decay of $w_{ij}(\\rho)$ **dominates** the polynomial bound on $\\nabla_{x_i} d_j$, ensuring k-uniformity of the sum.\n3535: \n3536: 4. **Sum-to-integral bound**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full` with the exponentially weighted sum:\n3537: \n3538: $$\n3539: \\sum_{j \\in \\mathcal{A}} |w_{ij} \\nabla_{x_i} d_j| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq C_{d_j,1} \\cdot \\rho_{\\max} (2\\pi\\rho^2)^d C_\\lambda = \\mathcal{O}(\\rho^{2d})\n3540: \n3541: $$\n3542: \n3543: This bound depends only on $\\rho$, $\\rho_{\\max}$, and dimension $d$ ‚Äî **not on $k$**.\n3544: \n3545: :::{note} **Explicit k-Uniformity Verification (Detailed)**\n3546: \n3547: To make the k-independence completely transparent, let us trace the bound step-by-step for the representative term $\\sum_j w_{ij} \\nabla_{x_i} d_j$:\n3548: \n3549: **Setup**: The summand is:\n3550: \n3551: $$\n3552: F_{ij} := w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\n3553: \n3554: $$\n3555: \n3556: **Step 1**: Bound the summand using our established bounds:\n3557: \n3558: $$\n3559: \\begin{aligned}\n3560: \\|F_{ij}\\| &= \\left\\|w_{ij}(\\rho) \\cdot \\nabla_{x_i} d_j\\right\\| \\\\\n3561: &\\leq \\|w_{ij}(\\rho)\\| \\cdot \\|\\nabla_{x_i} d_j\\| \\\\\n3562: &\\leq \\frac{\\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))}{Z_i(\\rho)} \\cdot C_{d_j,1} \\\\\n3563: &\\leq C_{d_j,1} \\cdot \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\quad \\text{(using } Z_i \\geq 1\\text{)}\n3564: \\end{aligned}\n3565: \n3566: $$\n3567: \n3568: **Step 2**: Sum over all $k$ walkers:\n3569: \n3570: $$\n3571: \\left\\|\\sum_{j \\in \\mathcal{A}} F_{ij}\\right\\| \\leq \\sum_{j \\in \\mathcal{A}} \\|F_{ij}\\| \\leq C_{d_j,1} \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right)\n3572: \n3573: $$\n3574: \n3575: **Step 3**: Apply sum-to-integral lemma ({prf:ref}`lem-sum-to-integral-bound-full`):\n3576: \n3577: The sum over walkers is bounded by an integral using the uniform density bound œÅ_max:\n3578: \n3579: $$\n3580: \\sum_{j \\in \\mathcal{A}} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho^2}\\right) \\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\exp\\left(-\\frac{d_{\\text{alg}}^2(i,y)}{2\\rho^2}\\right) dy\\,dv\n3581: \n3582: $$\n3583: \n3584: **Step 4**: Evaluate the Gaussian integral:\n3585: \n3586: $$\n3587: \\int_{\\mathbb{R}^{2d}} \\exp\\left(-\\frac{\\|y-x_i\\|^2 + \\lambda_{\\text{alg}}\\|v-v_i\\|^2}{2\\rho^2}\\right) dy\\,dv = (2\\pi\\rho^2)^d \\cdot (2\\pi\\rho^2/\\lambda_{\\text{alg}})^{d/2} = (2\\pi\\rho^2)^d C_\\lambda\n3588: \n3589: $$\n3590: \n3591: **Step 5**: Combine to get k-uniform bound:\n3592: \n3593: $$\n3594: \\left\\|\\sum_{j \\in \\mathcal{A}} w_{ij} \\nabla_{x_i} d_j\\right\\| \\leq C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi\\rho^2)^d C_\\lambda =: C_{\\mu,1}(\\rho) \\cdot \\rho^{2d}\n3595: \n3596: $$\n3597: \n3598: where the constant $C_{\\mu,1}(\\rho) = C_{d_j,1} \\cdot \\rho_{\\max} \\cdot (2\\pi)^d C_\\lambda$ depends on:\n3599: - Derivative bound $C_{d_j,1}$ (from Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3600: - Density bound $\\rho_{\\max}$ (from Assumption {prf:ref}`assump-uniform-density-full`)\n3601: - Geometric constants $(2\\pi)^d$, $C_\\lambda$\n3602: - **NOT** on the number of alive walkers $k$\n3603: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 15,
        "chapter_file": "chapter_15.json",
        "section_id": "## 8. Localized Mean: Derivative Expansion"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-mth-derivative-localized-mean-full",
      "title": null,
      "start_line": 3643,
      "end_line": 3679,
      "header_lines": [
        3644
      ],
      "content_start": 3645,
      "content_end": 3678,
      "content": "3645: :::{prf:proof}\n3646: :label: proof-lem-mth-derivative-localized-mean-full\n3647: **Proof Strategy Overview**:\n3648: 1. **Leibniz rule expansion**: Apply the product rule to $\\nabla^{m+1}(\\sum_j w_{ij} \\cdot d_j)$ to generate $\\binom{m+1}{k}$ binomial terms\n3649: 2. **Telescoping identity**: Use $\\sum_j \\nabla^k w_{ij} = 0$ to achieve cancellation in the weight derivatives\n3650: 3. **Exponential localization**: Exploit exponential decay of $w_{ij}$ to dominate polynomial growth of measurement derivatives\n3651: 4. **Sum-to-integral technique**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to achieve k-uniformity\n3652: 5. **Fa√† di Bruno tracking**: Track combinatorial factors through nested compositions to verify Gevrey-1 growth (factorial, not exponential)\n3653: 6. **Inductive closure**: Combine bounds to show $C_{\\mu,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3654: \n3655: \n3656: \n3657: **Induction on $m$.**\n3658: \n3659: **Base case** ($m=1$): Established in {prf:ref}`lem-first-derivative-localized-mean-full`.\n3660: \n3661: **Inductive step** ($m \\to m+1$):\n3662: \n3663: Assume $\\|\\nabla^m \\mu_\\rho^{(i)}\\| \\leq C_{\\mu,m} \\rho^{-m}$.\n3664: \n3665: :::{note}\n3666: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\mu_\\rho$ has the schematic form:\n3667: \n3668: $$\n3669: \\nabla^{m+1} \\mu_\\rho \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} d_j]\n3670: \n3671: $$\n3672: \n3673: where the sum runs over all partitions of $m+1$ into two parts: $\\alpha + \\beta = m+1$.\n3674: \n3675: **Key bounding strategy**:\n3676: 1. **Term I** ($\\beta = 0$): Use telescoping identity $\\sum_j \\nabla^{m+1} w_{ij} = 0$ to eliminate dependence on absolute values $d_j$\n3677: 2. **Term II** ($\\beta \\geq 1$): Use **combined exponential localization**: both $w_{ij}$ (from Gaussian kernel) and $\\nabla^{\\beta} d_j$ (from companion coupling) decay exponentially\n3678: 3. **Sum-to-integral**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to show the sum over $k$ walkers is k-uniform",
      "metadata": {
        "label": "proof-lem-mth-derivative-localized-mean-full"
      },
      "section": "## 8. Localized Mean: Derivative Expansion",
      "raw_directive": "3643: :::\n3644: \n3645: :::{prf:proof}\n3646: :label: proof-lem-mth-derivative-localized-mean-full\n3647: **Proof Strategy Overview**:\n3648: 1. **Leibniz rule expansion**: Apply the product rule to $\\nabla^{m+1}(\\sum_j w_{ij} \\cdot d_j)$ to generate $\\binom{m+1}{k}$ binomial terms\n3649: 2. **Telescoping identity**: Use $\\sum_j \\nabla^k w_{ij} = 0$ to achieve cancellation in the weight derivatives\n3650: 3. **Exponential localization**: Exploit exponential decay of $w_{ij}$ to dominate polynomial growth of measurement derivatives\n3651: 4. **Sum-to-integral technique**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to achieve k-uniformity\n3652: 5. **Fa√† di Bruno tracking**: Track combinatorial factors through nested compositions to verify Gevrey-1 growth (factorial, not exponential)\n3653: 6. **Inductive closure**: Combine bounds to show $C_{\\mu,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3654: \n3655: \n3656: \n3657: **Induction on $m$.**\n3658: \n3659: **Base case** ($m=1$): Established in {prf:ref}`lem-first-derivative-localized-mean-full`.\n3660: \n3661: **Inductive step** ($m \\to m+1$):\n3662: \n3663: Assume $\\|\\nabla^m \\mu_\\rho^{(i)}\\| \\leq C_{\\mu,m} \\rho^{-m}$.\n3664: \n3665: :::{note}\n3666: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\mu_\\rho$ has the schematic form:\n3667: \n3668: $$\n3669: \\nabla^{m+1} \\mu_\\rho \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} d_j]\n3670: \n3671: $$\n3672: \n3673: where the sum runs over all partitions of $m+1$ into two parts: $\\alpha + \\beta = m+1$.\n3674: \n3675: **Key bounding strategy**:\n3676: 1. **Term I** ($\\beta = 0$): Use telescoping identity $\\sum_j \\nabla^{m+1} w_{ij} = 0$ to eliminate dependence on absolute values $d_j$\n3677: 2. **Term II** ($\\beta \\geq 1$): Use **combined exponential localization**: both $w_{ij}$ (from Gaussian kernel) and $\\nabla^{\\beta} d_j$ (from companion coupling) decay exponentially\n3678: 3. **Sum-to-integral**: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` to show the sum over $k$ walkers is k-uniform\n3679: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 15,
        "chapter_file": "chapter_15.json",
        "section_id": "## 8. Localized Mean: Derivative Expansion"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-first-derivative-localized-variance-full",
      "title": null,
      "start_line": 3829,
      "end_line": 3938,
      "header_lines": [
        3830
      ],
      "content_start": 3832,
      "content_end": 3937,
      "content": "3832: :label: proof-lem-first-derivative-localized-variance-full\n3833: \n3834: **Step 1: Product rule expansion.**\n3835: \n3836: $$\n3837: \\frac{\\partial}{\\partial x_i} \\sigma_\\rho^{2(i)} = \\sum_j \\frac{\\partial}{\\partial x_i} \\left[w_{ij}(\\rho) \\cdot (d_j - \\mu_\\rho^{(i)})^2\\right]\n3838: \n3839: $$\n3840: \n3841: Applying product rule:\n3842: \n3843: $$\n3844: = \\sum_j \\left[\\frac{\\partial w_{ij}}{\\partial x_i} \\cdot (d_j - \\mu_\\rho)^2 + w_{ij} \\cdot \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2\\right]\n3845: \n3846: $$\n3847: \n3848: **Step 2: Derivative of squared term.**\n3849: \n3850: By chain rule:\n3851: \n3852: $$\n3853: \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2 = 2(d_j - \\mu_\\rho) \\cdot \\left(\\frac{\\partial d_j}{\\partial x_i} - \\frac{\\partial \\mu_\\rho}{\\partial x_i}\\right)\n3854: \n3855: $$\n3856: \n3857: **Step 3: Telescoping the first term.**\n3858: \n3859: Using $\\sum_j \\nabla w_{ij} = 0$:\n3860: \n3861: Define the **localized second moment**:\n3862: \n3863: $$\n3864: M_2^{(i)} := \\sum_j w_{ij} (d_j - \\mu_\\rho)^2 = \\sigma_\\rho^{2(i)}\n3865: \n3866: $$\n3867: \n3868: Then:\n3869: \n3870: $$\n3871: \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)^2 = \\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\n3872: \n3873: $$\n3874: \n3875: Bounding:\n3876: \n3877: $$\n3878: \\left\\|\\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\\right\\| \\leq \\rho^{2d} \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3879: \n3880: $$\n3881: \n3882: **Step 4: Bounding the second term with explicit k-uniformity.**\n3883: \n3884: $$\n3885: \\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\n3886: \n3887: $$\n3888: \n3889: **Justification for k-uniformity**: The sum runs over $k$ walkers, but remains k-uniform due to exponential localization:\n3890: \n3891: 1. **Measurement bounds**: $|d_j - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$ (measurements are bounded)\n3892: \n3893: 2. **Derivative bounds**:\n3894:    - $\\|\\nabla d_j\\| = \\mathcal{O}(1)$ with polynomial bounds (Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3895:    - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$ (from Section 7.1)\n3896: \n3897: 3. **Combined term**: Each summand satisfies:\n3898: \n3899: $$\n3900: |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla_{x_i} d_j - \\nabla_{x_i} \\mu_\\rho)|\n3901: \\leq w_{ij} \\cdot \\mathcal{O}(1) \\cdot \\mathcal{O}(\\rho^{-1})\n3902: \n3903: $$\n3904: \n3905: 4. **Exponential localization of the product**: The key is that both $w_{ij}$ and $\\nabla_{x_i} d_j$ decay exponentially (as shown in ¬ß8.1), so their product is exponentially suppressed for distant walkers:\n3906: \n3907: $$\n3908: w_{ij} \\cdot \\nabla_{x_i} d_j = \\mathcal{O}\\left(\\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho_{\\text{eff}}^2}\\right)\\right)\n3909: \n3910: $$\n3911: \n3912: where $\\rho_{\\text{eff}}^{-2} = \\rho^{-2} + \\varepsilon_c^{-2}$.\n3913: \n3914: 5. **Sum-to-integral**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full`:\n3915: \n3916: $$\n3917: \\sum_j |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)|\n3918: \\leq \\rho_{\\max} \\int_{\\mathbb{R}^{2d}} \\mathcal{O}(\\rho^{-1}) \\exp\\left(-\\frac{\\|y\\|^2}{2\\rho_{\\text{eff}}^2}\\right) dy\n3919: = \\mathcal{O}(\\rho^{2d-1})\n3920: \n3921: $$\n3922: \n3923: Therefore:\n3924: \n3925: $$\n3926: \\left\\|\\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{-1})\n3927: \n3928: $$\n3929: \n3930: which is **k-uniform** (depends only on $\\rho$, $\\varepsilon_c$, $\\rho_{\\max}$, $d$ ‚Äî not on $k$ or $N$).\n3931: \n3932: **Step 5: Combine.**\n3933: \n3934: $$\n3935: \\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq \\mathcal{O}(\\rho^{2d-1}) + \\mathcal{O}(\\rho^{-1}) = \\mathcal{O}(\\rho^{-1})\n3936: \n3937: $$",
      "metadata": {
        "label": "proof-lem-first-derivative-localized-variance-full"
      },
      "section": "## 9. Localized Variance: Full Derivative Analysis",
      "raw_directive": "3829: :::\n3830: \n3831: :::{prf:proof}\n3832: :label: proof-lem-first-derivative-localized-variance-full\n3833: \n3834: **Step 1: Product rule expansion.**\n3835: \n3836: $$\n3837: \\frac{\\partial}{\\partial x_i} \\sigma_\\rho^{2(i)} = \\sum_j \\frac{\\partial}{\\partial x_i} \\left[w_{ij}(\\rho) \\cdot (d_j - \\mu_\\rho^{(i)})^2\\right]\n3838: \n3839: $$\n3840: \n3841: Applying product rule:\n3842: \n3843: $$\n3844: = \\sum_j \\left[\\frac{\\partial w_{ij}}{\\partial x_i} \\cdot (d_j - \\mu_\\rho)^2 + w_{ij} \\cdot \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2\\right]\n3845: \n3846: $$\n3847: \n3848: **Step 2: Derivative of squared term.**\n3849: \n3850: By chain rule:\n3851: \n3852: $$\n3853: \\frac{\\partial}{\\partial x_i}(d_j - \\mu_\\rho)^2 = 2(d_j - \\mu_\\rho) \\cdot \\left(\\frac{\\partial d_j}{\\partial x_i} - \\frac{\\partial \\mu_\\rho}{\\partial x_i}\\right)\n3854: \n3855: $$\n3856: \n3857: **Step 3: Telescoping the first term.**\n3858: \n3859: Using $\\sum_j \\nabla w_{ij} = 0$:\n3860: \n3861: Define the **localized second moment**:\n3862: \n3863: $$\n3864: M_2^{(i)} := \\sum_j w_{ij} (d_j - \\mu_\\rho)^2 = \\sigma_\\rho^{2(i)}\n3865: \n3866: $$\n3867: \n3868: Then:\n3869: \n3870: $$\n3871: \\sum_j \\nabla w_{ij} \\cdot (d_j - \\mu_\\rho)^2 = \\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\n3872: \n3873: $$\n3874: \n3875: Bounding:\n3876: \n3877: $$\n3878: \\left\\|\\sum_j \\nabla w_{ij} \\cdot [(d_j - \\mu_\\rho)^2 - M_2^{(i)}]\\right\\| \\leq \\rho^{2d} \\cdot C_w \\rho^{-1} \\cdot \\mathcal{O}(1) = \\mathcal{O}(\\rho^{2d-1})\n3879: \n3880: $$\n3881: \n3882: **Step 4: Bounding the second term with explicit k-uniformity.**\n3883: \n3884: $$\n3885: \\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\n3886: \n3887: $$\n3888: \n3889: **Justification for k-uniformity**: The sum runs over $k$ walkers, but remains k-uniform due to exponential localization:\n3890: \n3891: 1. **Measurement bounds**: $|d_j - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$ (measurements are bounded)\n3892: \n3893: 2. **Derivative bounds**:\n3894:    - $\\|\\nabla d_j\\| = \\mathcal{O}(1)$ with polynomial bounds (Lemma {prf:ref}`lem-companion-measurement-derivatives-full`)\n3895:    - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$ (from Section 7.1)\n3896: \n3897: 3. **Combined term**: Each summand satisfies:\n3898: \n3899: $$\n3900: |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla_{x_i} d_j - \\nabla_{x_i} \\mu_\\rho)|\n3901: \\leq w_{ij} \\cdot \\mathcal{O}(1) \\cdot \\mathcal{O}(\\rho^{-1})\n3902: \n3903: $$\n3904: \n3905: 4. **Exponential localization of the product**: The key is that both $w_{ij}$ and $\\nabla_{x_i} d_j$ decay exponentially (as shown in ¬ß8.1), so their product is exponentially suppressed for distant walkers:\n3906: \n3907: $$\n3908: w_{ij} \\cdot \\nabla_{x_i} d_j = \\mathcal{O}\\left(\\exp\\left(-\\frac{d_{\\text{alg}}^2(i,j)}{2\\rho_{\\text{eff}}^2}\\right)\\right)\n3909: \n3910: $$\n3911: \n3912: where $\\rho_{\\text{eff}}^{-2} = \\rho^{-2} + \\varepsilon_c^{-2}$.\n3913: \n3914: 5. **Sum-to-integral**: Applying Lemma {prf:ref}`lem-sum-to-integral-bound-full`:\n3915: \n3916: $$\n3917: \\sum_j |w_{ij} \\cdot (d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)|\n3918: \\leq \\rho_{\\max} \\int_{\\mathbb{R}^{2d}} \\mathcal{O}(\\rho^{-1}) \\exp\\left(-\\frac{\\|y\\|^2}{2\\rho_{\\text{eff}}^2}\\right) dy\n3919: = \\mathcal{O}(\\rho^{2d-1})\n3920: \n3921: $$\n3922: \n3923: Therefore:\n3924: \n3925: $$\n3926: \\left\\|\\sum_j w_{ij} \\cdot 2(d_j - \\mu_\\rho) \\cdot (\\nabla d_j - \\nabla \\mu_\\rho)\\right\\| \\leq \\mathcal{O}(\\rho^{-1})\n3927: \n3928: $$\n3929: \n3930: which is **k-uniform** (depends only on $\\rho$, $\\varepsilon_c$, $\\rho_{\\max}$, $d$ ‚Äî not on $k$ or $N$).\n3931: \n3932: **Step 5: Combine.**\n3933: \n3934: $$\n3935: \\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq \\mathcal{O}(\\rho^{2d-1}) + \\mathcal{O}(\\rho^{-1}) = \\mathcal{O}(\\rho^{-1})\n3936: \n3937: $$\n3938: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 16,
        "chapter_file": "chapter_16.json",
        "section_id": "## 9. Localized Variance: Full Derivative Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-mth-derivative-localized-variance-full",
      "title": null,
      "start_line": 3955,
      "end_line": 4000,
      "header_lines": [
        3956
      ],
      "content_start": 3958,
      "content_end": 3999,
      "content": "3958: :label: proof-thm-mth-derivative-localized-variance-full\n3959: \n3960: **Proof Strategy Overview**:\n3961: 1. **Product rule for squared terms**: Expand $\\nabla^{m+1}[\\sum_j w_{ij}(d_j - \\mu_\\rho)^2]$ using the product rule for $(d_j - \\mu_\\rho)^2$\n3962: 2. **Leibniz rule cascade**: Apply Leibniz rule multiple times for products of weights, measurements, and mean\n3963: 3. **Telescoping with squared terms**: Use $\\sum_j \\nabla^k w_{ij} = 0$ but account for the $(d_j - \\mu_\\rho)^2$ factor\n3964: 4. **Cross-terms from mean derivatives**: Track cross-terms arising from $\\nabla^k \\mu_\\rho$ (using inductive hypothesis on mean from Lemma {prf:ref}`lem-mth-derivative-localized-mean-full`)\n3965: 5. **Exponential localization dominance**: Show that exponential decay of $w_{ij}$ overcomes polynomial growth from all terms\n3966: 6. **Sum-to-integral for k-uniformity**: Apply sum-to-integral lemma to each term class separately\n3967: 7. **Fa√† di Bruno combinatorics**: Verify that despite increased complexity, Gevrey-1 growth is preserved\n3968: 8. **Inductive closure**: Establish $C_{\\sigma^2,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3969: \n3970: \n3971: \n3972: **Induction on $m$**, following the structure of {prf:ref}`lem-mth-derivative-localized-mean-full` but accounting for the additional complexity from the squared term.\n3973: \n3974: **Base case** ($m=1$): Established in Section 8.1.\n3975: \n3976: **Inductive step** ($m \\to m+1$):\n3977: \n3978: Assume $\\|\\nabla^m \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,m}(\\rho) \\rho^{-m}$ where $C_{\\sigma^2,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm})$.\n3979: \n3980: :::{note}\n3981: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\sigma_\\rho^2$ has the schematic form:\n3982: \n3983: $$\n3984: \\nabla^{m+1} \\sigma_\\rho^2 \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} (d_j - \\mu_\\rho)^2]\n3985: \n3986: $$\n3987: \n3988: where $\\alpha + \\beta = m+1$. The squared term adds complexity through Fa√† di Bruno's formula:\n3989: \n3990: $$\n3991: \\nabla^{\\beta} (d_j - \\mu_\\rho)^2 \\sim \\sum_{\\text{compositions}} [\\nabla^{k_1} \\Delta_j] \\cdot [\\nabla^{k_2} \\Delta_j] \\cdots\n3992: \n3993: $$\n3994: \n3995: **Key bounding strategy**:\n3996: 1. **Telescoping** ($\\alpha = m+1, \\beta = 0$): Use $\\sum_j \\nabla^{m+1} w_{ij} = 0$ as in ¬ß8.2\n3997: 2. **Product structure** ($\\beta \\geq 1$): Each $\\nabla^{\\beta} (d_j - \\mu_\\rho)^2$ involves products of derivatives $\\nabla^k \\Delta_j$ with $k \\leq \\beta$\n3998: 3. **Exponential localization**: Combined decay from $w_{ij}$ and companion coupling in $d_j$ ensures k-uniformity\n3999: 4. **Factorial counting**: Compositions and partitions contribute at most $\\mathcal{O}(\\beta!) \\cdot \\mathcal{O}((m+1-\\beta)!) = \\mathcal{O}((m+1)!)$",
      "metadata": {
        "label": "proof-thm-mth-derivative-localized-variance-full"
      },
      "section": "## 9. Localized Variance: Full Derivative Analysis",
      "raw_directive": "3955: :::\n3956: \n3957: :::{prf:proof}\n3958: :label: proof-thm-mth-derivative-localized-variance-full\n3959: \n3960: **Proof Strategy Overview**:\n3961: 1. **Product rule for squared terms**: Expand $\\nabla^{m+1}[\\sum_j w_{ij}(d_j - \\mu_\\rho)^2]$ using the product rule for $(d_j - \\mu_\\rho)^2$\n3962: 2. **Leibniz rule cascade**: Apply Leibniz rule multiple times for products of weights, measurements, and mean\n3963: 3. **Telescoping with squared terms**: Use $\\sum_j \\nabla^k w_{ij} = 0$ but account for the $(d_j - \\mu_\\rho)^2$ factor\n3964: 4. **Cross-terms from mean derivatives**: Track cross-terms arising from $\\nabla^k \\mu_\\rho$ (using inductive hypothesis on mean from Lemma {prf:ref}`lem-mth-derivative-localized-mean-full`)\n3965: 5. **Exponential localization dominance**: Show that exponential decay of $w_{ij}$ overcomes polynomial growth from all terms\n3966: 6. **Sum-to-integral for k-uniformity**: Apply sum-to-integral lemma to each term class separately\n3967: 7. **Fa√† di Bruno combinatorics**: Verify that despite increased complexity, Gevrey-1 growth is preserved\n3968: 8. **Inductive closure**: Establish $C_{\\sigma^2,m+1} = \\mathcal{O}((m+1)! \\cdot \\rho^{2d(m+1)})$\n3969: \n3970: \n3971: \n3972: **Induction on $m$**, following the structure of {prf:ref}`lem-mth-derivative-localized-mean-full` but accounting for the additional complexity from the squared term.\n3973: \n3974: **Base case** ($m=1$): Established in Section 8.1.\n3975: \n3976: **Inductive step** ($m \\to m+1$):\n3977: \n3978: Assume $\\|\\nabla^m \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,m}(\\rho) \\rho^{-m}$ where $C_{\\sigma^2,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm})$.\n3979: \n3980: :::{note}\n3981: **Derivative Structure Preview**: The $(m+1)$-th derivative of $\\sigma_\\rho^2$ has the schematic form:\n3982: \n3983: $$\n3984: \\nabla^{m+1} \\sigma_\\rho^2 \\sim \\sum_{\\text{partitions}} [\\nabla^{\\alpha} w_{ij}] \\cdot [\\nabla^{\\beta} (d_j - \\mu_\\rho)^2]\n3985: \n3986: $$\n3987: \n3988: where $\\alpha + \\beta = m+1$. The squared term adds complexity through Fa√† di Bruno's formula:\n3989: \n3990: $$\n3991: \\nabla^{\\beta} (d_j - \\mu_\\rho)^2 \\sim \\sum_{\\text{compositions}} [\\nabla^{k_1} \\Delta_j] \\cdot [\\nabla^{k_2} \\Delta_j] \\cdots\n3992: \n3993: $$\n3994: \n3995: **Key bounding strategy**:\n3996: 1. **Telescoping** ($\\alpha = m+1, \\beta = 0$): Use $\\sum_j \\nabla^{m+1} w_{ij} = 0$ as in ¬ß8.2\n3997: 2. **Product structure** ($\\beta \\geq 1$): Each $\\nabla^{\\beta} (d_j - \\mu_\\rho)^2$ involves products of derivatives $\\nabla^k \\Delta_j$ with $k \\leq \\beta$\n3998: 3. **Exponential localization**: Combined decay from $w_{ij}$ and companion coupling in $d_j$ ensures k-uniformity\n3999: 4. **Factorial counting**: Compositions and partitions contribute at most $\\mathcal{O}(\\beta!) \\cdot \\mathcal{O}((m+1-\\beta)!) = \\mathcal{O}((m+1)!)$\n4000: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 16,
        "chapter_file": "chapter_16.json",
        "section_id": "## 9. Localized Variance: Full Derivative Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-properties-regularized-std-dev-full",
      "title": null,
      "start_line": 4303,
      "end_line": 4385,
      "header_lines": [
        4304
      ],
      "content_start": 4306,
      "content_end": 4384,
      "content": "4306: :label: proof-lem-properties-regularized-std-dev-full\n4307: \n4308: **Step 1: Lower bound.**\n4309: \n4310: Since $\\sigma_\\rho^{2(i)} \\geq 0$:\n4311: \n4312: $$\n4313: \\sigma'_\\rho(i) = \\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2} \\geq \\sqrt{\\eta_{\\min}^2} = \\eta_{\\min} > 0\n4314: \n4315: $$\n4316: \n4317: **Step 2: Smoothness.**\n4318: \n4319: The square root function $f(x) = \\sqrt{x}$ is C^‚àû on $(0, \\infty)$.\n4320: \n4321: Since $\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2 > 0$ always, the composition:\n4322: \n4323: $$\n4324: \\sigma'_\\rho(i) = f(\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2)\n4325: \n4326: $$\n4327: \n4328: is C^‚àû (composition of C^‚àû functions with domain avoiding the singularity at 0).\n4329: \n4330: **Step 3: First derivative via chain rule.**\n4331: \n4332: $$\n4333: \\nabla \\sigma'_\\rho(i) = \\frac{1}{2\\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2}} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4334: = \\frac{1}{2\\sigma'_\\rho(i)} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4335: \n4336: $$\n4337: \n4338: Using $\\sigma'_\\rho(i) \\geq \\eta_{\\min}$ and $\\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,1} \\rho^{-1}$:\n4339: \n4340: $$\n4341: \\|\\nabla \\sigma'_\\rho(i)\\| \\leq \\frac{1}{2\\eta_{\\min}} \\cdot C_{\\sigma^2,1} \\rho^{-1} = \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})\n4342: \n4343: $$\n4344: \n4345: **Step 4: Higher derivatives via Fa√† di Bruno.**\n4346: \n4347: For $m \\geq 2$, apply the Fa√† di Bruno formula for the composition $\\sqrt{g(x)}$ where $g = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2$:\n4348: \n4349: $$\n4350: \\nabla^m \\sigma'_\\rho = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot \\frac{d^k}{dx^k}\\sqrt{x}\\Big|_{x=g} \\cdot \\prod_j (\\nabla^{j} g)^{n_j}\n4351: \n4352: $$\n4353: \n4354: The derivatives of $\\sqrt{x}$ are:\n4355: \n4356: $$\n4357: \\frac{d^m}{dx^m} \\sqrt{x} = (-1)^{m-1} \\frac{(2m-3)!!}{2^m} x^{1/2 - m}\n4358: \n4359: $$\n4360: \n4361: At $x = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$:\n4362: \n4363: $$\n4364: \\left|\\frac{d^m}{dx^m} \\sqrt{x}\\right| \\leq C_m \\cdot \\eta_{\\min}^{1-2m}\n4365: \n4366: $$\n4367: \n4368: where $C_m = \\mathcal{O}(m!)$ from the double factorial $(2m-3)!! = \\mathcal{O}(m!/2^m)$.\n4369: \n4370: Combining with $\\|\\nabla^j \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,j} \\rho^{-j}$:\n4371: \n4372: $$\n4373: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_m \\eta_{\\min}^{1-2m} \\sum_{\\text{partitions}} \\prod_j (C_{\\sigma^2,j} \\rho^{-j})^{n_j}\n4374: \n4375: $$\n4376: \n4377: The sum over partitions gives factorial growth, yielding:\n4378: \n4379: $$\n4380: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_{\\sigma',m}(\\rho) \\cdot \\rho^{-m}\n4381: \n4382: $$\n4383: \n4384: where $C_{\\sigma',m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m-1)})$.",
      "metadata": {
        "label": "proof-lem-properties-regularized-std-dev-full"
      },
      "section": "## 10. Regularized Standard Deviation",
      "raw_directive": "4303: :::\n4304: \n4305: :::{prf:proof}\n4306: :label: proof-lem-properties-regularized-std-dev-full\n4307: \n4308: **Step 1: Lower bound.**\n4309: \n4310: Since $\\sigma_\\rho^{2(i)} \\geq 0$:\n4311: \n4312: $$\n4313: \\sigma'_\\rho(i) = \\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2} \\geq \\sqrt{\\eta_{\\min}^2} = \\eta_{\\min} > 0\n4314: \n4315: $$\n4316: \n4317: **Step 2: Smoothness.**\n4318: \n4319: The square root function $f(x) = \\sqrt{x}$ is C^‚àû on $(0, \\infty)$.\n4320: \n4321: Since $\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2 > 0$ always, the composition:\n4322: \n4323: $$\n4324: \\sigma'_\\rho(i) = f(\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2)\n4325: \n4326: $$\n4327: \n4328: is C^‚àû (composition of C^‚àû functions with domain avoiding the singularity at 0).\n4329: \n4330: **Step 3: First derivative via chain rule.**\n4331: \n4332: $$\n4333: \\nabla \\sigma'_\\rho(i) = \\frac{1}{2\\sqrt{\\sigma_\\rho^{2(i)} + \\eta_{\\min}^2}} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4334: = \\frac{1}{2\\sigma'_\\rho(i)} \\cdot \\nabla \\sigma_\\rho^{2(i)}\n4335: \n4336: $$\n4337: \n4338: Using $\\sigma'_\\rho(i) \\geq \\eta_{\\min}$ and $\\|\\nabla \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,1} \\rho^{-1}$:\n4339: \n4340: $$\n4341: \\|\\nabla \\sigma'_\\rho(i)\\| \\leq \\frac{1}{2\\eta_{\\min}} \\cdot C_{\\sigma^2,1} \\rho^{-1} = \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})\n4342: \n4343: $$\n4344: \n4345: **Step 4: Higher derivatives via Fa√† di Bruno.**\n4346: \n4347: For $m \\geq 2$, apply the Fa√† di Bruno formula for the composition $\\sqrt{g(x)}$ where $g = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2$:\n4348: \n4349: $$\n4350: \\nabla^m \\sigma'_\\rho = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot \\frac{d^k}{dx^k}\\sqrt{x}\\Big|_{x=g} \\cdot \\prod_j (\\nabla^{j} g)^{n_j}\n4351: \n4352: $$\n4353: \n4354: The derivatives of $\\sqrt{x}$ are:\n4355: \n4356: $$\n4357: \\frac{d^m}{dx^m} \\sqrt{x} = (-1)^{m-1} \\frac{(2m-3)!!}{2^m} x^{1/2 - m}\n4358: \n4359: $$\n4360: \n4361: At $x = \\sigma_\\rho^{2(i)} + \\eta_{\\min}^2 \\geq \\eta_{\\min}^2$:\n4362: \n4363: $$\n4364: \\left|\\frac{d^m}{dx^m} \\sqrt{x}\\right| \\leq C_m \\cdot \\eta_{\\min}^{1-2m}\n4365: \n4366: $$\n4367: \n4368: where $C_m = \\mathcal{O}(m!)$ from the double factorial $(2m-3)!! = \\mathcal{O}(m!/2^m)$.\n4369: \n4370: Combining with $\\|\\nabla^j \\sigma_\\rho^{2(i)}\\| \\leq C_{\\sigma^2,j} \\rho^{-j}$:\n4371: \n4372: $$\n4373: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_m \\eta_{\\min}^{1-2m} \\sum_{\\text{partitions}} \\prod_j (C_{\\sigma^2,j} \\rho^{-j})^{n_j}\n4374: \n4375: $$\n4376: \n4377: The sum over partitions gives factorial growth, yielding:\n4378: \n4379: $$\n4380: \\|\\nabla^m \\sigma'_\\rho\\| \\leq C_{\\sigma',m}(\\rho) \\cdot \\rho^{-m}\n4381: \n4382: $$\n4383: \n4384: where $C_{\\sigma',m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m-1)})$.\n4385: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 18,
        "chapter_file": "chapter_18.json",
        "section_id": "## 10. Regularized Standard Deviation"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-cinf-regularity-zscore-full",
      "title": null,
      "start_line": 4417,
      "end_line": 4494,
      "header_lines": [
        4418
      ],
      "content_start": 4420,
      "content_end": 4493,
      "content": "4420: :label: proof-thm-cinf-regularity-zscore-full\n4421: \n4422: **Step 1: Well-definedness.**\n4423: \n4424: Since $\\sigma'_\\rho(i) \\geq \\eta_{\\min} > 0$ (by {prf:ref}`lem-properties-regularized-std-dev-full`), the quotient is well-defined everywhere.\n4425: \n4426: **Step 2: Smoothness.**\n4427: \n4428: Both numerator and denominator are C^‚àû:\n4429: - $d_i - \\mu_\\rho^{(i)} \\in C^\\infty$ (measurements and localized mean)\n4430: - $\\sigma'_\\rho(i) \\in C^\\infty$ (regularized std dev)\n4431: \n4432: Therefore $Z_\\rho^{(i)} \\in C^\\infty$ by smoothness of quotients with non-vanishing denominator.\n4433: \n4434: **Step 3: First derivative via quotient rule.**\n4435: \n4436: $$\n4437: \\nabla Z_\\rho^{(i)} = \\frac{\\nabla(d_i - \\mu_\\rho) \\cdot \\sigma'_\\rho - (d_i - \\mu_\\rho) \\cdot \\nabla \\sigma'_\\rho}{(\\sigma'_\\rho)^2}\n4438: \n4439: $$\n4440: \n4441: Bounding each term:\n4442: - $\\|\\nabla d_i\\| = \\mathcal{O}(1)$ (companion coupling)\n4443: - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$\n4444: - $|d_i - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$\n4445: - $\\|\\nabla \\sigma'_\\rho\\| \\leq C_{\\sigma'} \\eta_{\\min}^{-1} \\rho^{-1}$\n4446: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4447: \n4448: Therefore:\n4449: \n4450: $$\n4451: \\|\\nabla Z_\\rho^{(i)}\\| \\leq \\frac{\\mathcal{O}(\\rho^{-1}) + \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})}{\\eta_{\\min}^2} = \\mathcal{O}(\\eta_{\\min}^{-3} \\rho^{-1})\n4452: \n4453: $$\n4454: \n4455: **Step 4: Higher derivatives via generalized quotient rule.**\n4456: \n4457: For $m \\geq 2$, the $m$-th derivative of a quotient $f/g$ is given by:\n4458: \n4459: $$\n4460: \\nabla^m \\left(\\frac{f}{g}\\right) = \\frac{1}{g} \\sum_{k=0}^m \\binom{m}{k} \\nabla^k f \\cdot \\nabla^{m-k}\\left(\\frac{1}{g}\\right)\n4461: \n4462: $$\n4463: \n4464: where derivatives of $1/g$ satisfy:\n4465: \n4466: $$\n4467: \\nabla^{m}\\left(\\frac{1}{g}\\right) = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot g^{-(n_1+\\cdots+n_m+1)} \\cdot \\prod_{j=1}^m (\\nabla^j g)^{n_j}\n4468: \n4469: $$\n4470: \n4471: Using:\n4472: - $\\|\\nabla^k (d_i - \\mu_\\rho)\\| \\leq C_\\mu^{(k)} \\rho^{-k}$ (from {prf:ref}`lem-mth-derivative-localized-mean-full`)\n4473: - $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma',j} \\eta_{\\min}^{-(2j-1)} \\rho^{-j}$\n4474: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4475: \n4476: We get:\n4477: \n4478: $$\n4479: \\|\\nabla^m Z_\\rho^{(i)}\\| \\leq C_{Z,m}(\\rho) \\cdot \\rho^{-m}\n4480: \n4481: $$\n4482: \n4483: where the constant:\n4484: \n4485: $$\n4486: C_{Z,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)})\n4487: \n4488: $$\n4489: \n4490: accounts for:\n4491: - Factorial growth from combinatorial quotient rule terms: $m!$\n4492: - Localization radius factors: $\\rho^{2dm}$\n4493: - Inverse powers of regularization: $\\eta_{\\min}^{-(2m+1)}$",
      "metadata": {
        "label": "proof-thm-cinf-regularity-zscore-full"
      },
      "section": "## 11. Z-Score: Quotient Rule Analysis",
      "raw_directive": "4417: :::\n4418: \n4419: :::{prf:proof}\n4420: :label: proof-thm-cinf-regularity-zscore-full\n4421: \n4422: **Step 1: Well-definedness.**\n4423: \n4424: Since $\\sigma'_\\rho(i) \\geq \\eta_{\\min} > 0$ (by {prf:ref}`lem-properties-regularized-std-dev-full`), the quotient is well-defined everywhere.\n4425: \n4426: **Step 2: Smoothness.**\n4427: \n4428: Both numerator and denominator are C^‚àû:\n4429: - $d_i - \\mu_\\rho^{(i)} \\in C^\\infty$ (measurements and localized mean)\n4430: - $\\sigma'_\\rho(i) \\in C^\\infty$ (regularized std dev)\n4431: \n4432: Therefore $Z_\\rho^{(i)} \\in C^\\infty$ by smoothness of quotients with non-vanishing denominator.\n4433: \n4434: **Step 3: First derivative via quotient rule.**\n4435: \n4436: $$\n4437: \\nabla Z_\\rho^{(i)} = \\frac{\\nabla(d_i - \\mu_\\rho) \\cdot \\sigma'_\\rho - (d_i - \\mu_\\rho) \\cdot \\nabla \\sigma'_\\rho}{(\\sigma'_\\rho)^2}\n4438: \n4439: $$\n4440: \n4441: Bounding each term:\n4442: - $\\|\\nabla d_i\\| = \\mathcal{O}(1)$ (companion coupling)\n4443: - $\\|\\nabla \\mu_\\rho\\| \\leq C_\\mu \\rho^{-1}$\n4444: - $|d_i - \\mu_\\rho| \\leq \\text{diam}(d) = \\mathcal{O}(1)$\n4445: - $\\|\\nabla \\sigma'_\\rho\\| \\leq C_{\\sigma'} \\eta_{\\min}^{-1} \\rho^{-1}$\n4446: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4447: \n4448: Therefore:\n4449: \n4450: $$\n4451: \\|\\nabla Z_\\rho^{(i)}\\| \\leq \\frac{\\mathcal{O}(\\rho^{-1}) + \\mathcal{O}(\\eta_{\\min}^{-1} \\rho^{-1})}{\\eta_{\\min}^2} = \\mathcal{O}(\\eta_{\\min}^{-3} \\rho^{-1})\n4452: \n4453: $$\n4454: \n4455: **Step 4: Higher derivatives via generalized quotient rule.**\n4456: \n4457: For $m \\geq 2$, the $m$-th derivative of a quotient $f/g$ is given by:\n4458: \n4459: $$\n4460: \\nabla^m \\left(\\frac{f}{g}\\right) = \\frac{1}{g} \\sum_{k=0}^m \\binom{m}{k} \\nabla^k f \\cdot \\nabla^{m-k}\\left(\\frac{1}{g}\\right)\n4461: \n4462: $$\n4463: \n4464: where derivatives of $1/g$ satisfy:\n4465: \n4466: $$\n4467: \\nabla^{m}\\left(\\frac{1}{g}\\right) = \\sum_{\\text{partitions}} c_{\\text{partition}} \\cdot g^{-(n_1+\\cdots+n_m+1)} \\cdot \\prod_{j=1}^m (\\nabla^j g)^{n_j}\n4468: \n4469: $$\n4470: \n4471: Using:\n4472: - $\\|\\nabla^k (d_i - \\mu_\\rho)\\| \\leq C_\\mu^{(k)} \\rho^{-k}$ (from {prf:ref}`lem-mth-derivative-localized-mean-full`)\n4473: - $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma',j} \\eta_{\\min}^{-(2j-1)} \\rho^{-j}$\n4474: - $\\sigma'_\\rho \\geq \\eta_{\\min}$\n4475: \n4476: We get:\n4477: \n4478: $$\n4479: \\|\\nabla^m Z_\\rho^{(i)}\\| \\leq C_{Z,m}(\\rho) \\cdot \\rho^{-m}\n4480: \n4481: $$\n4482: \n4483: where the constant:\n4484: \n4485: $$\n4486: C_{Z,m}(\\rho) = \\mathcal{O}(m! \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)})\n4487: \n4488: $$\n4489: \n4490: accounts for:\n4491: - Factorial growth from combinatorial quotient rule terms: $m!$\n4492: - Localization radius factors: $\\rho^{2dm}$\n4493: - Inverse powers of regularization: $\\eta_{\\min}^{-(2m+1)}$\n4494: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 19,
        "chapter_file": "chapter_19.json",
        "section_id": "## 11. Z-Score: Quotient Rule Analysis"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-main-cinf-regularity-fitness-potential-full",
      "title": null,
      "start_line": 4594,
      "end_line": 4673,
      "header_lines": [
        4595
      ],
      "content_start": 4597,
      "content_end": 4672,
      "content": "4597: :label: proof-thm-main-cinf-regularity-fitness-potential-full\n4598: \n4599: **Step 1: Composition structure.**\n4600: \n4601: The fitness potential is the composition:\n4602: \n4603: $$\n4604: V_{\\text{fit}} = g_A \\circ Z_\\rho \\circ (\\mu_\\rho, \\sigma'_\\rho, d_i)\n4605: \n4606: $$\n4607: \n4608: where each component is C^‚àû by previous lemmas.\n4609: \n4610: **Step 2: Fa√† di Bruno formula for composition.**\n4611: \n4612: For $m \\geq 1$, the $m$-th derivative of $g_A(Z_\\rho^{(i)})$ is:\n4613: \n4614: $$\n4615: \\nabla^m V_{\\text{fit}} = \\sum_{k=1}^m g_A^{(k)}(Z_\\rho^{(i)}) \\cdot B_{m,k}(\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\ldots, \\nabla^m Z_\\rho)\n4616: \n4617: $$\n4618: \n4619: where $B_{m,k}$ are the **Bell polynomials** encoding the combinatorics of the chain rule.\n4620: \n4621: **Step 3: Bounding each term with Œµ_d propagation.**\n4622: \n4623: For the $k$-th term:\n4624: - $|g_A^{(k)}(Z_\\rho)| \\leq L_{g,k} = \\mathcal{O}(k!)$ (bounded derivatives of $g_A$)\n4625: - $B_{m,k}$ involves products of $\\nabla^j Z_\\rho$ with $j \\leq m$\n4626: - $\\|\\nabla^j Z_\\rho\\| \\leq C_{Z,j}(\\rho, \\varepsilon_d) \\cdot \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ where $C_{Z,j} = \\mathcal{O}(j! \\cdot \\rho^{2dj} \\cdot \\eta_{\\min}^{-(2j+1)})$\n4627: \n4628: **Œµ_d dependency chain**:\n4629: 1. **Companion measurements**: $\\|\\nabla^j d_i\\| \\leq C_d \\varepsilon_d^{1-j}$\n4630: 2. **Localized mean**: $\\|\\nabla^j \\mu_\\rho\\| \\leq C_\\mu(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $d_i$ via Leibniz rule)\n4631: 3. **Localized variance**: $\\|\\nabla^j \\sigma_\\rho^2\\| \\leq C_{\\sigma^2}(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\mu_\\rho$ and $d_i$)\n4632: 4. **Regularized std dev**: $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma'}(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\sigma_\\rho^2$)\n4633: 5. **Z-score**: $\\|\\nabla^j Z_\\rho\\| \\leq C_Z(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (quotient of functions with Œµ_d dependence)\n4634: 6. **Fitness potential**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_V \\max(\\rho^{-m}, \\varepsilon_d^{1-m})$ (composition with $g_A$)\n4635: \n4636: For typical parameters $\\varepsilon_d \\ll \\rho \\sim \\varepsilon_c$, the $\\varepsilon_d^{1-m}$ term dominates for $m \\geq 2$.\n4637: \n4638: The Bell polynomial $B_{m,k}$ satisfies:\n4639: \n4640: $$\n4641: \\|B_{m,k}\\| \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m \\|\\nabla^j Z_\\rho\\|^{n_j} \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m (C_{Z,j} \\rho^{-j})^{n_j}\n4642: \n4643: $$\n4644: \n4645: The sum over partitions of $m$ into $k$ parts gives combinatorial factors of at most $m!$.\n4646: \n4647: **Step 4: Factorial accounting.**\n4648: \n4649: Combining all factors:\n4650: \n4651: $$\n4652: \\begin{aligned}\n4653: \\|\\nabla^m V_{\\text{fit}}\\|\n4654: &\\leq \\sum_{k=1}^m L_{g,k} \\cdot \\|B_{m,k}\\| \\\\\n4655: &\\leq \\sum_{k=1}^m \\mathcal{O}(k!) \\cdot \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\text{(other factors)}) \\\\\n4656: &= \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)} \\cdot L_{g,m})\n4657: \\end{aligned}\n4658: \n4659: $$\n4660: \n4661: The key observation is that summing $k!$ over $k=1$ to $m$ gives $\\mathcal{O}(m!)$ (dominated by the largest term), preserving **single-factorial growth**.\n4662: \n4663: **Step 5: k-uniformity and N-uniformity.**\n4664: \n4665: All constants in the bound trace back to:\n4666: - Localization weights: k-uniform via telescoping\n4667: - Localized moments: k-uniform via exponential localization\n4668: - Regularized std dev: deterministic function of variance\n4669: - Z-score: quotient of k-uniform functions\n4670: - Rescale function: independent of swarm configuration\n4671: \n4672: Therefore $C_{V,m}(\\rho)$ is **independent of $k$ and $N$**.",
      "metadata": {
        "label": "proof-thm-main-cinf-regularity-fitness-potential-full"
      },
      "section": "## 12. Fitness Potential: Composition with Rescale Function",
      "raw_directive": "4594: :::\n4595: \n4596: :::{prf:proof}\n4597: :label: proof-thm-main-cinf-regularity-fitness-potential-full\n4598: \n4599: **Step 1: Composition structure.**\n4600: \n4601: The fitness potential is the composition:\n4602: \n4603: $$\n4604: V_{\\text{fit}} = g_A \\circ Z_\\rho \\circ (\\mu_\\rho, \\sigma'_\\rho, d_i)\n4605: \n4606: $$\n4607: \n4608: where each component is C^‚àû by previous lemmas.\n4609: \n4610: **Step 2: Fa√† di Bruno formula for composition.**\n4611: \n4612: For $m \\geq 1$, the $m$-th derivative of $g_A(Z_\\rho^{(i)})$ is:\n4613: \n4614: $$\n4615: \\nabla^m V_{\\text{fit}} = \\sum_{k=1}^m g_A^{(k)}(Z_\\rho^{(i)}) \\cdot B_{m,k}(\\nabla Z_\\rho, \\nabla^2 Z_\\rho, \\ldots, \\nabla^m Z_\\rho)\n4616: \n4617: $$\n4618: \n4619: where $B_{m,k}$ are the **Bell polynomials** encoding the combinatorics of the chain rule.\n4620: \n4621: **Step 3: Bounding each term with Œµ_d propagation.**\n4622: \n4623: For the $k$-th term:\n4624: - $|g_A^{(k)}(Z_\\rho)| \\leq L_{g,k} = \\mathcal{O}(k!)$ (bounded derivatives of $g_A$)\n4625: - $B_{m,k}$ involves products of $\\nabla^j Z_\\rho$ with $j \\leq m$\n4626: - $\\|\\nabla^j Z_\\rho\\| \\leq C_{Z,j}(\\rho, \\varepsilon_d) \\cdot \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ where $C_{Z,j} = \\mathcal{O}(j! \\cdot \\rho^{2dj} \\cdot \\eta_{\\min}^{-(2j+1)})$\n4627: \n4628: **Œµ_d dependency chain**:\n4629: 1. **Companion measurements**: $\\|\\nabla^j d_i\\| \\leq C_d \\varepsilon_d^{1-j}$\n4630: 2. **Localized mean**: $\\|\\nabla^j \\mu_\\rho\\| \\leq C_\\mu(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $d_i$ via Leibniz rule)\n4631: 3. **Localized variance**: $\\|\\nabla^j \\sigma_\\rho^2\\| \\leq C_{\\sigma^2}(\\rho, \\varepsilon_d) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\mu_\\rho$ and $d_i$)\n4632: 4. **Regularized std dev**: $\\|\\nabla^j \\sigma'_\\rho\\| \\leq C_{\\sigma'}(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (inherits from $\\sigma_\\rho^2$)\n4633: 5. **Z-score**: $\\|\\nabla^j Z_\\rho\\| \\leq C_Z(\\rho, \\varepsilon_d, \\eta) \\max(\\rho^{-j}, \\varepsilon_d^{1-j})$ (quotient of functions with Œµ_d dependence)\n4634: 6. **Fitness potential**: $\\|\\nabla^m V_{\\text{fit}}\\| \\leq C_V \\max(\\rho^{-m}, \\varepsilon_d^{1-m})$ (composition with $g_A$)\n4635: \n4636: For typical parameters $\\varepsilon_d \\ll \\rho \\sim \\varepsilon_c$, the $\\varepsilon_d^{1-m}$ term dominates for $m \\geq 2$.\n4637: \n4638: The Bell polynomial $B_{m,k}$ satisfies:\n4639: \n4640: $$\n4641: \\|B_{m,k}\\| \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m \\|\\nabla^j Z_\\rho\\|^{n_j} \\leq \\sum_{\\text{partitions}} \\prod_{j=1}^m (C_{Z,j} \\rho^{-j})^{n_j}\n4642: \n4643: $$\n4644: \n4645: The sum over partitions of $m$ into $k$ parts gives combinatorial factors of at most $m!$.\n4646: \n4647: **Step 4: Factorial accounting.**\n4648: \n4649: Combining all factors:\n4650: \n4651: $$\n4652: \\begin{aligned}\n4653: \\|\\nabla^m V_{\\text{fit}}\\|\n4654: &\\leq \\sum_{k=1}^m L_{g,k} \\cdot \\|B_{m,k}\\| \\\\\n4655: &\\leq \\sum_{k=1}^m \\mathcal{O}(k!) \\cdot \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\text{(other factors)}) \\\\\n4656: &= \\mathcal{O}(m! \\cdot \\rho^{-m} \\cdot \\rho^{2dm} \\cdot \\eta_{\\min}^{-(2m+1)} \\cdot L_{g,m})\n4657: \\end{aligned}\n4658: \n4659: $$\n4660: \n4661: The key observation is that summing $k!$ over $k=1$ to $m$ gives $\\mathcal{O}(m!)$ (dominated by the largest term), preserving **single-factorial growth**.\n4662: \n4663: **Step 5: k-uniformity and N-uniformity.**\n4664: \n4665: All constants in the bound trace back to:\n4666: - Localization weights: k-uniform via telescoping\n4667: - Localized moments: k-uniform via exponential localization\n4668: - Regularized std dev: deterministic function of variance\n4669: - Z-score: quotient of k-uniform functions\n4670: - Rescale function: independent of swarm configuration\n4671: \n4672: Therefore $C_{V,m}(\\rho)$ is **independent of $k$ and $N$**.\n4673: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 21,
        "chapter_file": "chapter_21.json",
        "section_id": "## 12. Fitness Potential: Composition with Rescale Function"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-gevrey-1-fitness-potential-full",
      "title": null,
      "start_line": 4690,
      "end_line": 4694,
      "header_lines": [
        4691
      ],
      "content_start": 4693,
      "content_end": 4693,
      "content": "4693: :label: proof-cor-gevrey-1-fitness-potential-full",
      "metadata": {
        "label": "proof-cor-gevrey-1-fitness-potential-full"
      },
      "section": "## 12. Fitness Potential: Composition with Rescale Function",
      "raw_directive": "4690: :::\n4691: \n4692: :::{prf:proof}\n4693: :label: proof-cor-gevrey-1-fitness-potential-full\n4694: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 21,
        "chapter_file": "chapter_21.json",
        "section_id": "## 12. Fitness Potential: Composition with Rescale Function"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-main-complete-cinf-geometric-gas-full",
      "title": null,
      "start_line": 4866,
      "end_line": 4899,
      "header_lines": [
        4867
      ],
      "content_start": 4869,
      "content_end": 4898,
      "content": "4869: :label: proof-thm-main-complete-cinf-geometric-gas-full\n4870: \n4871: **Summary of proof architecture**:\n4872: \n4873: 1. **Part I (¬ß2-4)**: Smooth clustering framework\n4874:    - Partition of unity construction ({prf:ref}`const-mollified-partition-full`)\n4875:    - Exponential locality ({prf:ref}`lem-softmax-tail-corrected-full`)\n4876:    - Effective interactions ({prf:ref}`lem-effective-companion-count-corrected-full`)\n4877:    - Derivative bounds for $d_{\\text{alg}}$ ({prf:ref}`lem-dalg-derivative-bounds-full`)\n4878: \n4879: 2. **Part II (¬ß5-6)**: Localization weights\n4880:    - Gaussian kernel derivatives ({prf:ref}`lem-gaussian-kernel-derivatives-full`)\n4881:    - Quotient rule for weights ({prf:ref}`lem-localization-weight-derivatives-full`)\n4882:    - Telescoping identity ({prf:ref}`lem-telescoping-localization-weights-full`)\n4883:    - Companion coupling analysis ({prf:ref}`lem-derivatives-companion-distance-full`)\n4884: \n4885: 3. **Part III (¬ß7-8)**: Localized moments\n4886:    - Localized mean inductive bounds ({prf:ref}`lem-mth-derivative-localized-mean-full`)\n4887:    - Localized variance inductive bounds ({prf:ref}`thm-mth-derivative-localized-variance-full`)\n4888:    - k-uniformity via telescoping and exponential localization\n4889: \n4890: 4. **Part IV (¬ß9-10)**: Regularization and Z-score\n4891:    - Regularized std dev with positive lower bound ({prf:ref}`lem-properties-regularized-std-dev-full`)\n4892:    - Z-score quotient rule ({prf:ref}`thm-cinf-regularity-zscore-full`)\n4893:    - Uniform bounds from non-vanishing denominator\n4894: \n4895: 5. **Part V (¬ß11-12)**: Final composition\n4896:    - Chain rule with Fa√† di Bruno formula ({prf:ref}`thm-main-cinf-regularity-fitness-potential-full`)\n4897:    - Gevrey-1 classification ({prf:ref}`cor-gevrey-1-fitness-potential-full`)\n4898:    - N-uniform and k-uniform bounds established",
      "metadata": {
        "label": "proof-thm-main-complete-cinf-geometric-gas-full"
      },
      "section": "## 13. Main Theorem: Complete Statement",
      "raw_directive": "4866: :::\n4867: \n4868: :::{prf:proof}\n4869: :label: proof-thm-main-complete-cinf-geometric-gas-full\n4870: \n4871: **Summary of proof architecture**:\n4872: \n4873: 1. **Part I (¬ß2-4)**: Smooth clustering framework\n4874:    - Partition of unity construction ({prf:ref}`const-mollified-partition-full`)\n4875:    - Exponential locality ({prf:ref}`lem-softmax-tail-corrected-full`)\n4876:    - Effective interactions ({prf:ref}`lem-effective-companion-count-corrected-full`)\n4877:    - Derivative bounds for $d_{\\text{alg}}$ ({prf:ref}`lem-dalg-derivative-bounds-full`)\n4878: \n4879: 2. **Part II (¬ß5-6)**: Localization weights\n4880:    - Gaussian kernel derivatives ({prf:ref}`lem-gaussian-kernel-derivatives-full`)\n4881:    - Quotient rule for weights ({prf:ref}`lem-localization-weight-derivatives-full`)\n4882:    - Telescoping identity ({prf:ref}`lem-telescoping-localization-weights-full`)\n4883:    - Companion coupling analysis ({prf:ref}`lem-derivatives-companion-distance-full`)\n4884: \n4885: 3. **Part III (¬ß7-8)**: Localized moments\n4886:    - Localized mean inductive bounds ({prf:ref}`lem-mth-derivative-localized-mean-full`)\n4887:    - Localized variance inductive bounds ({prf:ref}`thm-mth-derivative-localized-variance-full`)\n4888:    - k-uniformity via telescoping and exponential localization\n4889: \n4890: 4. **Part IV (¬ß9-10)**: Regularization and Z-score\n4891:    - Regularized std dev with positive lower bound ({prf:ref}`lem-properties-regularized-std-dev-full`)\n4892:    - Z-score quotient rule ({prf:ref}`thm-cinf-regularity-zscore-full`)\n4893:    - Uniform bounds from non-vanishing denominator\n4894: \n4895: 5. **Part V (¬ß11-12)**: Final composition\n4896:    - Chain rule with Fa√† di Bruno formula ({prf:ref}`thm-main-cinf-regularity-fitness-potential-full`)\n4897:    - Gevrey-1 classification ({prf:ref}`cor-gevrey-1-fitness-potential-full`)\n4898:    - N-uniform and k-uniform bounds established\n4899: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 22,
        "chapter_file": "chapter_22.json",
        "section_id": "## 13. Main Theorem: Complete Statement"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-hypoellipticity-companion-dependent-full",
      "title": null,
      "start_line": 4924,
      "end_line": 4965,
      "header_lines": [
        4925
      ],
      "content_start": 4927,
      "content_end": 4964,
      "content": "4927: :label: proof-thm-hypoellipticity-companion-dependent-full\n4928: \n4929: **Step 1: Kinetic operator hypoellipticity.**\n4930: \n4931: The underdamped Langevin operator:\n4932: \n4933: $$\n4934: \\mathcal{L}_{\\text{kin}} = \\sum_{i=1}^k \\left[v_i \\cdot \\nabla_{x_i} - \\nabla_{x_i} U(x_i) \\cdot \\nabla_{v_i} - \\gamma v_i \\cdot \\nabla_{v_i} + \\frac{\\sigma^2}{2} \\Delta_{v_i}\\right]\n4935: \n4936: $$\n4937: \n4938: satisfies **H√∂rmander's condition**: the Lie algebra generated by the drift and diffusion vector fields spans the tangent space $T(\\mathcal{X}^k \\times (\\mathbb{R}^d)^k)$ at each point.\n4939: \n4940: This is a standard result for underdamped Langevin dynamics (see H√©rau & Nier, 2004).\n4941: \n4942: **Step 2: Adaptive force as C^‚àû first-order perturbation.**\n4943: \n4944: The adaptive force term:\n4945: \n4946: $$\n4947: \\mathcal{L}_{\\text{adapt}} = -\\varepsilon_F \\sum_{i=1}^k \\nabla_{x_i} V_{\\text{fit}}(x_i, v_i) \\cdot \\nabla_{v_i}\n4948: \n4949: $$\n4950: \n4951: is a **C^‚àû first-order vector field** by {prf:ref}`thm-main-complete-cinf-geometric-gas-full`. The \"first-order\" designation is crucial: $\\mathcal{L}_{\\text{adapt}}$ contains only first derivatives ($\\nabla_{v_i}$), not second derivatives, ensuring stability under perturbation theory.\n4952: \n4953: **Step 3: Perturbation theory for hypoelliptic operators.**\n4954: \n4955: By the theory of H√∂rmander (1967): a **C^‚àû first-order perturbation** of a hypoelliptic operator **preserves hypoellipticity**.\n4956: \n4957: Since $\\mathcal{L}_{\\text{kin}}$ is hypoelliptic and $\\mathcal{L}_{\\text{adapt}}$ is a C^‚àû perturbation:\n4958: \n4959: $$\n4960: \\mathcal{L}_{\\text{geo}} = \\mathcal{L}_{\\text{kin}} + \\mathcal{L}_{\\text{adapt}}\n4961: \n4962: $$\n4963: \n4964: is hypoelliptic.",
      "metadata": {
        "label": "proof-thm-hypoellipticity-companion-dependent-full"
      },
      "section": "## 14. Hypoellipticity of the Geometric Gas Generator",
      "raw_directive": "4924: :::\n4925: \n4926: :::{prf:proof}\n4927: :label: proof-thm-hypoellipticity-companion-dependent-full\n4928: \n4929: **Step 1: Kinetic operator hypoellipticity.**\n4930: \n4931: The underdamped Langevin operator:\n4932: \n4933: $$\n4934: \\mathcal{L}_{\\text{kin}} = \\sum_{i=1}^k \\left[v_i \\cdot \\nabla_{x_i} - \\nabla_{x_i} U(x_i) \\cdot \\nabla_{v_i} - \\gamma v_i \\cdot \\nabla_{v_i} + \\frac{\\sigma^2}{2} \\Delta_{v_i}\\right]\n4935: \n4936: $$\n4937: \n4938: satisfies **H√∂rmander's condition**: the Lie algebra generated by the drift and diffusion vector fields spans the tangent space $T(\\mathcal{X}^k \\times (\\mathbb{R}^d)^k)$ at each point.\n4939: \n4940: This is a standard result for underdamped Langevin dynamics (see H√©rau & Nier, 2004).\n4941: \n4942: **Step 2: Adaptive force as C^‚àû first-order perturbation.**\n4943: \n4944: The adaptive force term:\n4945: \n4946: $$\n4947: \\mathcal{L}_{\\text{adapt}} = -\\varepsilon_F \\sum_{i=1}^k \\nabla_{x_i} V_{\\text{fit}}(x_i, v_i) \\cdot \\nabla_{v_i}\n4948: \n4949: $$\n4950: \n4951: is a **C^‚àû first-order vector field** by {prf:ref}`thm-main-complete-cinf-geometric-gas-full`. The \"first-order\" designation is crucial: $\\mathcal{L}_{\\text{adapt}}$ contains only first derivatives ($\\nabla_{v_i}$), not second derivatives, ensuring stability under perturbation theory.\n4952: \n4953: **Step 3: Perturbation theory for hypoelliptic operators.**\n4954: \n4955: By the theory of H√∂rmander (1967): a **C^‚àû first-order perturbation** of a hypoelliptic operator **preserves hypoellipticity**.\n4956: \n4957: Since $\\mathcal{L}_{\\text{kin}}$ is hypoelliptic and $\\mathcal{L}_{\\text{adapt}}$ is a C^‚àû perturbation:\n4958: \n4959: $$\n4960: \\mathcal{L}_{\\text{geo}} = \\mathcal{L}_{\\text{kin}} + \\mathcal{L}_{\\text{adapt}}\n4961: \n4962: $$\n4963: \n4964: is hypoelliptic.\n4965: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 24,
        "chapter_file": "chapter_24.json",
        "section_id": "## 14. Hypoellipticity of the Geometric Gas Generator"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-exponential-qsd-companion-dependent-full",
      "title": null,
      "start_line": 5073,
      "end_line": 5077,
      "header_lines": [
        5074
      ],
      "content_start": 5076,
      "content_end": 5076,
      "content": "5076: :label: proof-cor-exponential-qsd-companion-dependent-full",
      "metadata": {
        "label": "proof-cor-exponential-qsd-companion-dependent-full"
      },
      "section": "## 15. Logarithmic Sobolev Inequality",
      "raw_directive": "5073: :::\n5074: \n5075: :::{prf:proof}\n5076: :label: proof-cor-exponential-qsd-companion-dependent-full\n5077: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 25,
        "chapter_file": "chapter_25.json",
        "section_id": "## 15. Logarithmic Sobolev Inequality"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-faa-di-bruno-appendix",
      "title": null,
      "start_line": 5306,
      "end_line": 5310,
      "header_lines": [
        5307
      ],
      "content_start": 5309,
      "content_end": 5309,
      "content": "5309: :label: proof-thm-faa-di-bruno-appendix",
      "metadata": {
        "label": "proof-thm-faa-di-bruno-appendix"
      },
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5306: :::\n5307: \n5308: :::{prf:proof}\n5309: :label: proof-thm-faa-di-bruno-appendix\n5310: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-prop-factorial-sqrt-composition",
      "title": null,
      "start_line": 5346,
      "end_line": 5457,
      "header_lines": [
        5347
      ],
      "content_start": 5349,
      "content_end": 5456,
      "content": "5349: :label: proof-prop-factorial-sqrt-composition\n5350: \n5351: **Step 1: Derivatives of the outer function $f(s) = \\sqrt{s}$.**\n5352: \n5353: For $s \\geq c^2 > 0$, the $n$-th derivative of $f(s) = s^{1/2}$ is:\n5354: \n5355: $$\n5356: f^{(n)}(s) = \\frac{d^n}{ds^n} s^{1/2} = \\frac{(-1)^{n-1} \\cdot (2n-3)!!}{2^n} \\cdot s^{1/2 - n}\n5357: \n5358: $$\n5359: \n5360: where $(2n-3)!! = 1 \\cdot 3 \\cdot 5 \\cdots (2n-3)$ is the double factorial.\n5361: \n5362: **Key fact**: The double factorial satisfies:\n5363: \n5364: $$\n5365: (2n-3)!! = \\frac{(2n-2)!}{2^{n-1} (n-1)!} = \\mathcal{O}\\left(\\frac{n!}{2^{n-1}}\\right)\n5366: \n5367: $$\n5368: \n5369: Therefore:\n5370: \n5371: $$\n5372: |f^{(n)}(s)| \\leq \\frac{(2n-3)!!}{2^n \\cdot c^{n-1}} \\leq \\frac{C \\cdot n!}{2^{2n-1} \\cdot c^{n-1}} = \\mathcal{O}(n!) \\cdot c^{-(n-1)}\n5373: \n5374: $$\n5375: \n5376: **Step 2: Applying Fa√† di Bruno formula.**\n5377: \n5378: For $\\sigma'(V(x)) = f(V(x) + c^2)$, let $g(x) = V(x) + c^2$. Then:\n5379: \n5380: $$\n5381: \\nabla^m \\sigma'(V) = \\sum_{\\pi \\in \\mathcal{P}_m} f^{(|\\pi|)}(g) \\cdot B_\\pi(\\nabla g, \\nabla^2 g, \\ldots, \\nabla^m g)\n5382: \n5383: $$\n5384: \n5385: **Step 3: Bounding each partition contribution.**\n5386: \n5387: For partition $\\pi$ with $|\\pi| = \\ell$ blocks, the Bell polynomial $B_\\pi$ is a product:\n5388: \n5389: $$\n5390: B_\\pi = \\prod_{B \\in \\pi} \\nabla^{|B|} g\n5391: \n5392: $$\n5393: \n5394: where $B$ ranges over blocks of $\\pi$ and $\\sum_{B \\in \\pi} |B| = m$.\n5395: \n5396: Using $\\|\\nabla^k g\\| = \\|\\nabla^k V\\| \\leq M_k$:\n5397: \n5398: $$\n5399: \\|B_\\pi\\| \\leq \\prod_{B \\in \\pi} M_{|B|}\n5400: \n5401: $$\n5402: \n5403: **Step 4: Counting partitions and summing.**\n5404: \n5405: For fixed $\\ell$, the number of partitions of $m$ elements into $\\ell$ non-empty blocks is the **Stirling number of the second kind** $S(m, \\ell)$, which satisfies:\n5406: \n5407: $$\n5408: S(m, \\ell) \\leq \\frac{\\ell^m}{\\ell!}\n5409: \n5410: $$\n5411: \n5412: Combining:\n5413: \n5414: $$\n5415: \\begin{aligned}\n5416: \\|\\nabla^m \\sigma'\\| &\\leq \\sum_{\\ell=1}^m |f^{(\\ell)}(g)| \\cdot \\sum_{\\pi: |\\pi|=\\ell} \\|B_\\pi\\| \\\\\n5417: &\\leq \\sum_{\\ell=1}^m \\frac{C \\ell!}{c^{\\ell-1}} \\cdot S(m,\\ell) \\cdot (\\text{bound on } B_\\pi)\n5418: \\end{aligned}\n5419: \n5420: $$\n5421: \n5422: **Step 5: Worst-case scenario - all derivatives contribute.**\n5423: \n5424: The dominant contribution comes from $\\ell = 1$ (single block, using $\\nabla^m V$ directly):\n5425: \n5426: $$\n5427: \\|\\nabla^m \\sigma'\\| \\geq |f^{(1)}(g)| \\cdot \\|\\nabla^m V\\| \\sim \\frac{1}{c} M_m\n5428: \n5429: $$\n5430: \n5431: But the total sum over all partitions gives:\n5432: \n5433: $$\n5434: \\|\\nabla^m \\sigma'\\| \\leq C \\sum_{\\ell=1}^m \\ell! \\cdot c^{-(\\ell-1)} \\cdot \\frac{\\ell^m}{\\ell!} \\cdot \\prod_k M_k^{(\\text{multiplicity})}\n5435: \n5436: $$\n5437: \n5438: **Step 6: Factorial bound emerges.**\n5439: \n5440: The key observation is that the Stirling numbers and factorial from $f^{(\\ell)}$ **combine multiplicatively**, not additively. The dominant term in the sum is $\\ell = m$ (each derivative appears once):\n5441: \n5442: $$\n5443: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot c^{-(m-1)} \\cdot \\prod_{k=1}^m M_k^{(a_k)}\n5444: \n5445: $$\n5446: \n5447: where $\\sum k \\cdot a_k = m$ (partition constraint) and $\\sum a_k = m$ (Bell polynomial structure).\n5448: \n5449: For $M_k = \\mathcal{O}(k!)$ (Gevrey-1 input), this gives:\n5450: \n5451: $$\n5452: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot (\\text{poly}(m)) = \\mathcal{O}(m!)\n5453: \n5454: $$\n5455: \n5456: where the polynomial factor comes from combining products of factorial-growth inputs.",
      "metadata": {
        "label": "proof-prop-factorial-sqrt-composition"
      },
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5346: :::\n5347: \n5348: :::{prf:proof}\n5349: :label: proof-prop-factorial-sqrt-composition\n5350: \n5351: **Step 1: Derivatives of the outer function $f(s) = \\sqrt{s}$.**\n5352: \n5353: For $s \\geq c^2 > 0$, the $n$-th derivative of $f(s) = s^{1/2}$ is:\n5354: \n5355: $$\n5356: f^{(n)}(s) = \\frac{d^n}{ds^n} s^{1/2} = \\frac{(-1)^{n-1} \\cdot (2n-3)!!}{2^n} \\cdot s^{1/2 - n}\n5357: \n5358: $$\n5359: \n5360: where $(2n-3)!! = 1 \\cdot 3 \\cdot 5 \\cdots (2n-3)$ is the double factorial.\n5361: \n5362: **Key fact**: The double factorial satisfies:\n5363: \n5364: $$\n5365: (2n-3)!! = \\frac{(2n-2)!}{2^{n-1} (n-1)!} = \\mathcal{O}\\left(\\frac{n!}{2^{n-1}}\\right)\n5366: \n5367: $$\n5368: \n5369: Therefore:\n5370: \n5371: $$\n5372: |f^{(n)}(s)| \\leq \\frac{(2n-3)!!}{2^n \\cdot c^{n-1}} \\leq \\frac{C \\cdot n!}{2^{2n-1} \\cdot c^{n-1}} = \\mathcal{O}(n!) \\cdot c^{-(n-1)}\n5373: \n5374: $$\n5375: \n5376: **Step 2: Applying Fa√† di Bruno formula.**\n5377: \n5378: For $\\sigma'(V(x)) = f(V(x) + c^2)$, let $g(x) = V(x) + c^2$. Then:\n5379: \n5380: $$\n5381: \\nabla^m \\sigma'(V) = \\sum_{\\pi \\in \\mathcal{P}_m} f^{(|\\pi|)}(g) \\cdot B_\\pi(\\nabla g, \\nabla^2 g, \\ldots, \\nabla^m g)\n5382: \n5383: $$\n5384: \n5385: **Step 3: Bounding each partition contribution.**\n5386: \n5387: For partition $\\pi$ with $|\\pi| = \\ell$ blocks, the Bell polynomial $B_\\pi$ is a product:\n5388: \n5389: $$\n5390: B_\\pi = \\prod_{B \\in \\pi} \\nabla^{|B|} g\n5391: \n5392: $$\n5393: \n5394: where $B$ ranges over blocks of $\\pi$ and $\\sum_{B \\in \\pi} |B| = m$.\n5395: \n5396: Using $\\|\\nabla^k g\\| = \\|\\nabla^k V\\| \\leq M_k$:\n5397: \n5398: $$\n5399: \\|B_\\pi\\| \\leq \\prod_{B \\in \\pi} M_{|B|}\n5400: \n5401: $$\n5402: \n5403: **Step 4: Counting partitions and summing.**\n5404: \n5405: For fixed $\\ell$, the number of partitions of $m$ elements into $\\ell$ non-empty blocks is the **Stirling number of the second kind** $S(m, \\ell)$, which satisfies:\n5406: \n5407: $$\n5408: S(m, \\ell) \\leq \\frac{\\ell^m}{\\ell!}\n5409: \n5410: $$\n5411: \n5412: Combining:\n5413: \n5414: $$\n5415: \\begin{aligned}\n5416: \\|\\nabla^m \\sigma'\\| &\\leq \\sum_{\\ell=1}^m |f^{(\\ell)}(g)| \\cdot \\sum_{\\pi: |\\pi|=\\ell} \\|B_\\pi\\| \\\\\n5417: &\\leq \\sum_{\\ell=1}^m \\frac{C \\ell!}{c^{\\ell-1}} \\cdot S(m,\\ell) \\cdot (\\text{bound on } B_\\pi)\n5418: \\end{aligned}\n5419: \n5420: $$\n5421: \n5422: **Step 5: Worst-case scenario - all derivatives contribute.**\n5423: \n5424: The dominant contribution comes from $\\ell = 1$ (single block, using $\\nabla^m V$ directly):\n5425: \n5426: $$\n5427: \\|\\nabla^m \\sigma'\\| \\geq |f^{(1)}(g)| \\cdot \\|\\nabla^m V\\| \\sim \\frac{1}{c} M_m\n5428: \n5429: $$\n5430: \n5431: But the total sum over all partitions gives:\n5432: \n5433: $$\n5434: \\|\\nabla^m \\sigma'\\| \\leq C \\sum_{\\ell=1}^m \\ell! \\cdot c^{-(\\ell-1)} \\cdot \\frac{\\ell^m}{\\ell!} \\cdot \\prod_k M_k^{(\\text{multiplicity})}\n5435: \n5436: $$\n5437: \n5438: **Step 6: Factorial bound emerges.**\n5439: \n5440: The key observation is that the Stirling numbers and factorial from $f^{(\\ell)}$ **combine multiplicatively**, not additively. The dominant term in the sum is $\\ell = m$ (each derivative appears once):\n5441: \n5442: $$\n5443: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot c^{-(m-1)} \\cdot \\prod_{k=1}^m M_k^{(a_k)}\n5444: \n5445: $$\n5446: \n5447: where $\\sum k \\cdot a_k = m$ (partition constraint) and $\\sum a_k = m$ (Bell polynomial structure).\n5448: \n5449: For $M_k = \\mathcal{O}(k!)$ (Gevrey-1 input), this gives:\n5450: \n5451: $$\n5452: \\|\\nabla^m \\sigma'\\| \\leq C \\cdot m! \\cdot (\\text{poly}(m)) = \\mathcal{O}(m!)\n5453: \n5454: $$\n5455: \n5456: where the polynomial factor comes from combining products of factorial-growth inputs.\n5457: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    },
    {
      "directive_type": "proof",
      "label": "proof-cor-gevrey-closure",
      "title": null,
      "start_line": 5481,
      "end_line": 5484,
      "header_lines": [
        5482
      ],
      "content_start": 5483,
      "content_end": 5483,
      "content": "5483: :::{prf:proof}",
      "metadata": {
        "label": "proof-cor-gevrey-closure"
      },
      "section": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula",
      "raw_directive": "5481: :::\n5482: \n5483: :::{prf:proof}\n5484: :label: proof-cor-gevrey-closure",
      "_registry_context": {
        "stage": "directives",
        "document_id": "14_geometric_gas_cinf_regularity_full",
        "chapter_index": 29,
        "chapter_file": "chapter_29.json",
        "section_id": "## Appendix A: Combinatorial Proof of Gevrey-1 Bounds via Fa√† di Bruno Formula"
      }
    }
  ]
}