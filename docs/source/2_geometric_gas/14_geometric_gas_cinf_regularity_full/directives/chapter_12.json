{
  "chapter_index": 12,
  "section_id": "## 6. Structure of Localization Weights",
  "directive_count": 8,
  "hints": [
    {
      "directive_type": "lemma",
      "label": "lem-gaussian-kernel-derivatives-full",
      "title": "Gaussian Kernel Derivatives",
      "start_line": 2978,
      "end_line": 2991,
      "header_lines": [
        2979
      ],
      "content_start": 2981,
      "content_end": 2990,
      "content": "2981: :label: lem-gaussian-kernel-derivatives-full\n2982: \n2983: The Gaussian kernel $K_\\rho(i,j) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))$ satisfies:\n2984: \n2985: For derivative order $n \\geq 1$:\n2986: \n2987: $$\n2988: \\|\\nabla^n_{x_i} K_\\rho(i,j)\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho(i,j)\n2989: \n2990: $$",
      "metadata": {
        "label": "lem-gaussian-kernel-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "2978: ### 6.1 Derivative Bounds for Localization Kernel\n2979: \n2980: :::{prf:lemma} Gaussian Kernel Derivatives\n2981: :label: lem-gaussian-kernel-derivatives-full\n2982: \n2983: The Gaussian kernel $K_\\rho(i,j) = \\exp(-d_{\\text{alg}}^2(i,j)/(2\\rho^2))$ satisfies:\n2984: \n2985: For derivative order $n \\geq 1$:\n2986: \n2987: $$\n2988: \\|\\nabla^n_{x_i} K_\\rho(i,j)\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho(i,j)\n2989: \n2990: $$\n2991: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-gaussian-kernel-derivatives-full",
      "title": null,
      "start_line": 2993,
      "end_line": 3011,
      "header_lines": [
        2994
      ],
      "content_start": 2996,
      "content_end": 3010,
      "content": "2996: :label: proof-lem-gaussian-kernel-derivatives-full\n2997: \n2998: By Fa\u00e0 di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n2999: \n3000: $$\n3001: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3002: \n3003: $$\n3004: \n3005: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3006: \n3007: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3008: \n3009: $$\n3010: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho",
      "metadata": {
        "label": "proof-lem-gaussian-kernel-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "2993: :::\n2994: \n2995: :::{prf:proof}\n2996: :label: proof-lem-gaussian-kernel-derivatives-full\n2997: \n2998: By Fa\u00e0 di Bruno formula for $\\nabla^n e^{-d^2/(2\\rho^2)}$:\n2999: \n3000: $$\n3001: \\nabla^n_{x_i} K_\\rho(i,j) = K_\\rho(i,j) \\cdot P_n\\left(\\frac{d_{\\text{alg}}(i,j)}{\\rho}, \\frac{\\nabla d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}, \\ldots, \\frac{\\nabla^n d_{\\text{alg}}(i,j)}{d_{\\text{alg}}}\\right)\n3002: \n3003: $$\n3004: \n3005: where $P_n$ is a polynomial (Hermite polynomial) of degree $n$ with coefficients $\\mathcal{O}(n!)$.\n3006: \n3007: Using $\\|\\nabla^k d_{\\text{alg}}\\| \\leq C_{d,k} d_{\\text{alg}}^{1-k}$:\n3008: \n3009: $$\n3010: \\|\\nabla^n K_\\rho\\| \\leq C_{K,n} \\cdot \\rho^{-n} \\cdot K_\\rho\n3011: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-localization-weight-derivatives-full",
      "title": "Localization Weight Derivatives",
      "start_line": 3015,
      "end_line": 3026,
      "header_lines": [
        3016
      ],
      "content_start": 3018,
      "content_end": 3025,
      "content": "3018: :label: lem-localization-weight-derivatives-full\n3019: \n3020: The localization weights $w_{ij}(\\rho) = K_\\rho(i,j) / Z_i(\\rho)$ satisfy:\n3021: \n3022: $$\n3023: \\|\\nabla^n_{x_i} w_{ij}(\\rho)\\| \\leq C_{w,n} \\cdot \\rho^{-n}\n3024: \n3025: $$",
      "metadata": {
        "label": "lem-localization-weight-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "3015: ### 6.2 Localization Weights: Quotient Rule Analysis\n3016: \n3017: :::{prf:lemma} Localization Weight Derivatives\n3018: :label: lem-localization-weight-derivatives-full\n3019: \n3020: The localization weights $w_{ij}(\\rho) = K_\\rho(i,j) / Z_i(\\rho)$ satisfy:\n3021: \n3022: $$\n3023: \\|\\nabla^n_{x_i} w_{ij}(\\rho)\\| \\leq C_{w,n} \\cdot \\rho^{-n}\n3024: \n3025: $$\n3026: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-localization-weight-derivatives-full",
      "title": null,
      "start_line": 3028,
      "end_line": 3115,
      "header_lines": [
        3029
      ],
      "content_start": 3031,
      "content_end": 3114,
      "content": "3031: :label: proof-lem-localization-weight-derivatives-full\n3032: \n3033: **Step 1: Partition function bounds.**\n3034: \n3035: By {prf:ref}`lem-companion-availability-enforcement`:\n3036: \n3037: $$\n3038: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3039: \n3040: $$\n3041: \n3042: and\n3043: \n3044: $$\n3045: Z_i(\\rho) \\leq k \\cdot 1 = k\n3046: \n3047: $$\n3048: \n3049: **Step 2: Quotient rule for $n$-th derivative.**\n3050: \n3051: By the generalized quotient rule (Fa\u00e0 di Bruno for $f/g$):\n3052: \n3053: $$\n3054: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3055: \n3056: $$\n3057: \n3058: **Step 3: Bounding each term with k-uniform estimates.**\n3059: \n3060: To establish k-uniformity, we apply the sum-to-integral lemma.\n3061: \n3062: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3063: \n3064: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3065: \n3066: $$\n3067: \\begin{aligned}\n3068: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3069: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3070: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3071: \\end{aligned}\n3072: \n3073: $$\n3074: \n3075: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3076: \n3077: $$\n3078: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3079: \n3080: $$\n3081: \n3082: Define:\n3083: \n3084: $$\n3085: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3086: \n3087: $$\n3088: \n3089: This is **k-independent** - it depends only on \u03c1_max (from density assumption), \u03c1 (localization scale), and d (dimension).\n3090: \n3091: **Updated quotient bound:**\n3092: \n3093: Using:\n3094: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3095: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3096: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3097: \n3098: The generalized quotient rule gives:\n3099: \n3100: $$\n3101: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3102: \n3103: $$\n3104: \n3105: where $C_{w,n}(\\rho)$ depends on \u03c1, \u03c1_max, d but is **k-uniform** (independent of k and N).\n3106: \n3107: **Step 4: Explicit constant dependence.**\n3108: \n3109: The constant $C_{w,n}(\\rho)$ arises from the Fa\u00e0 di Bruno formula for the quotient and scales as:\n3110: \n3111: $$\n3112: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3113: \n3114: $$",
      "metadata": {
        "label": "proof-lem-localization-weight-derivatives-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [
        "lem-companion-availability-enforcement",
        "lem-sum-to-integral-bound-full",
        "lem-gaussian-kernel-derivatives-full"
      ],
      "raw_directive": "3028: :::\n3029: \n3030: :::{prf:proof}\n3031: :label: proof-lem-localization-weight-derivatives-full\n3032: \n3033: **Step 1: Partition function bounds.**\n3034: \n3035: By {prf:ref}`lem-companion-availability-enforcement`:\n3036: \n3037: $$\n3038: Z_i(\\rho) \\geq \\exp\\left(-\\frac{R_{\\max}^2}{2\\rho^2}\\right) = Z_{\\min}(\\rho) > 0\n3039: \n3040: $$\n3041: \n3042: and\n3043: \n3044: $$\n3045: Z_i(\\rho) \\leq k \\cdot 1 = k\n3046: \n3047: $$\n3048: \n3049: **Step 2: Quotient rule for $n$-th derivative.**\n3050: \n3051: By the generalized quotient rule (Fa\u00e0 di Bruno for $f/g$):\n3052: \n3053: $$\n3054: \\nabla^n \\left(\\frac{K_\\rho(i,j)}{Z_i}\\right) = \\sum_{\\text{partitions}} \\frac{(\\text{products of } \\nabla^{k} K_\\rho) \\cdot (\\text{products of } \\nabla^\\ell Z_i)}{Z_i^{\\text{(partition dependent)}}}\n3055: \n3056: $$\n3057: \n3058: **Step 3: Bounding each term with k-uniform estimates.**\n3059: \n3060: To establish k-uniformity, we apply the sum-to-integral lemma.\n3061: \n3062: **Bound for $\\|\\nabla^\\ell Z_i\\|$:**\n3063: \n3064: Apply Lemma {prf:ref}`lem-sum-to-integral-bound-full` with $f(x_j, v_j) = \\nabla^\\ell K_\\rho(i,j)$:\n3065: \n3066: $$\n3067: \\begin{aligned}\n3068: \\|\\nabla^\\ell Z_i\\| &= \\left\\|\\nabla^\\ell \\sum_{m \\in \\mathcal{A}} K_\\rho(i,m)\\right\\| \\\\\n3069: &= \\left\\|\\sum_{m \\in \\mathcal{A}} \\nabla^\\ell K_\\rho(i,m)\\right\\| \\\\\n3070: &\\leq \\rho_{\\max} \\int_{\\mathcal{X} \\times \\mathbb{R}^d} \\|\\nabla^\\ell K_\\rho(i,y)\\| \\, dy\\,dv\n3071: \\end{aligned}\n3072: \n3073: $$\n3074: \n3075: From Lemma {prf:ref}`lem-gaussian-kernel-derivatives-full`, we have $\\|\\nabla^\\ell K_\\rho\\| \\leq C_{K,\\ell} \\rho^{-\\ell} K_\\rho$, so:\n3076: \n3077: $$\n3078: \\|\\nabla^\\ell Z_i\\| \\leq \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot \\int K_\\rho(i,y) \\, dy\\,dv = \\rho_{\\max} \\cdot C_{K,\\ell} \\rho^{-\\ell} \\cdot (2\\pi\\rho^2)^d C_\\lambda\n3079: \n3080: $$\n3081: \n3082: Define:\n3083: \n3084: $$\n3085: C'_{K,\\ell}(\\rho) := \\rho_{\\max} \\cdot C_{K,\\ell} \\cdot (2\\pi)^d C_\\lambda \\cdot \\rho^{2d-\\ell}\n3086: \n3087: $$\n3088: \n3089: This is **k-independent** - it depends only on \u03c1_max (from density assumption), \u03c1 (localization scale), and d (dimension).\n3090: \n3091: **Updated quotient bound:**\n3092: \n3093: Using:\n3094: - $\\|\\nabla^k K_\\rho(i,j)\\| \\leq C_{K,k} \\rho^{-k} K_\\rho(i,j)$\n3095: - $\\|\\nabla^\\ell Z_i\\| \\leq C'_{K,\\ell}(\\rho) = \\rho_{\\max} C_{K,\\ell} (2\\pi)^d C_\\lambda \\rho^{2d-\\ell}$ (k-independent!)\n3096: - $1/Z_i \\leq 1/Z_{\\min}(\\rho) = \\mathcal{O}(1)$\n3097: \n3098: The generalized quotient rule gives:\n3099: \n3100: $$\n3101: \\|\\nabla^n w_{ij}\\| \\leq C_{w,n}(\\rho) \\cdot \\rho^{-n}\n3102: \n3103: $$\n3104: \n3105: where $C_{w,n}(\\rho)$ depends on \u03c1, \u03c1_max, d but is **k-uniform** (independent of k and N).\n3106: \n3107: **Step 4: Explicit constant dependence.**\n3108: \n3109: The constant $C_{w,n}(\\rho)$ arises from the Fa\u00e0 di Bruno formula for the quotient and scales as:\n3110: \n3111: $$\n3112: C_{w,n}(\\rho) = \\mathcal{O}(n! \\cdot \\rho_{\\max} \\cdot \\rho^{2d} \\cdot Z_{\\min}^{-n})\n3113: \n3114: $$\n3115: "
    },
    {
      "directive_type": "lemma",
      "label": "lem-telescoping-localization-weights-full",
      "title": "Telescoping for Localization Weights",
      "start_line": 3119,
      "end_line": 3128,
      "header_lines": [
        3120
      ],
      "content_start": 3122,
      "content_end": 3127,
      "content": "3122: :label: lem-telescoping-localization-weights-full\n3123: \n3124: For walker $i$ and any derivative order $n \\geq 1$:\n3125: \n3126: $$\n3127: \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = 0",
      "metadata": {
        "label": "lem-telescoping-localization-weights-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "3119: ### 6.3 Telescoping Identity for Smooth Weights\n3120: \n3121: :::{prf:lemma} Telescoping for Localization Weights\n3122: :label: lem-telescoping-localization-weights-full\n3123: \n3124: For walker $i$ and any derivative order $n \\geq 1$:\n3125: \n3126: $$\n3127: \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = 0\n3128: "
    },
    {
      "directive_type": "proof",
      "label": "proof-lem-telescoping-localization-weights-full",
      "title": null,
      "start_line": 3130,
      "end_line": 3146,
      "header_lines": [
        3131
      ],
      "content_start": 3133,
      "content_end": 3145,
      "content": "3133: :label: proof-lem-telescoping-localization-weights-full\n3134: \n3135: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3136: \n3137: Differentiating $n$ times:\n3138: \n3139: $$\n3140: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3141: \n3142: $$\n3143: \n3144: The interchange of sum and differentiation is justified because:\n3145: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)",
      "metadata": {
        "label": "proof-lem-telescoping-localization-weights-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "3130: :::\n3131: \n3132: :::{prf:proof}\n3133: :label: proof-lem-telescoping-localization-weights-full\n3134: \n3135: The normalization $\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) = 1$ holds identically for all $(x_i, v_i)$.\n3136: \n3137: Differentiating $n$ times:\n3138: \n3139: $$\n3140: \\nabla^n_{x_i} \\left(\\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho)\\right) = \\sum_{j \\in \\mathcal{A}} \\nabla^n_{x_i} w_{ij}(\\rho) = \\nabla^n_{x_i} (1) = 0\n3141: \n3142: $$\n3143: \n3144: The interchange of sum and differentiation is justified because:\n3145: - The alive set $\\mathcal{A}$ is **fixed** (independent of $x_i$)\n3146: - Each $w_{ij}$ is C^\u221e"
    },
    {
      "directive_type": "theorem",
      "label": "thm-k-uniformity-telescoping-full",
      "title": "k-Uniformity via Telescoping Cancellation",
      "start_line": 3172,
      "end_line": 3187,
      "header_lines": [
        3173
      ],
      "content_start": 3175,
      "content_end": 3186,
      "content": "3175: :label: thm-k-uniformity-telescoping-full\n3176: \n3177: For the localized mean $\\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j$, the $m$-th derivative satisfies:\n3178: \n3179: $$\n3180: \\|\\nabla^m_{x_i} \\mu_\\rho^{(i)}\\| \\leq C_m(\\rho, \\varepsilon_c, \\varepsilon_d, d) \\cdot m!\n3181: \n3182: $$\n3183: \n3184: where $C_m$ is **independent of $k$** (the number of alive walkers).\n3185: \n3186: **Key mechanism**: Although the sum contains $k$ terms, the telescoping identity ensures that the $k$ dependence cancels in the derivative.",
      "metadata": {
        "label": "thm-k-uniformity-telescoping-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [],
      "raw_directive": "3172: We now show explicitly how the telescoping identity controls $j$-summations at $\\rho$-scale (localization weights $w_{ij}$) to yield k-uniform bounds. Note: This addresses the $j$-sum only; the $\\ell$-sum from softmax (scale $\\varepsilon_c$) is handled separately via derivative locality (\u00a77.1).\n3173: \n3174: :::{prf:theorem} k-Uniformity via Telescoping Cancellation\n3175: :label: thm-k-uniformity-telescoping-full\n3176: \n3177: For the localized mean $\\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} w_{ij}(\\rho) \\cdot d_j$, the $m$-th derivative satisfies:\n3178: \n3179: $$\n3180: \\|\\nabla^m_{x_i} \\mu_\\rho^{(i)}\\| \\leq C_m(\\rho, \\varepsilon_c, \\varepsilon_d, d) \\cdot m!\n3181: \n3182: $$\n3183: \n3184: where $C_m$ is **independent of $k$** (the number of alive walkers).\n3185: \n3186: **Key mechanism**: Although the sum contains $k$ terms, the telescoping identity ensures that the $k$ dependence cancels in the derivative.\n3187: "
    },
    {
      "directive_type": "proof",
      "label": "proof-thm-k-uniformity-telescoping-full",
      "title": null,
      "start_line": 3189,
      "end_line": 3272,
      "header_lines": [
        3190
      ],
      "content_start": 3192,
      "content_end": 3271,
      "content": "3192: :label: proof-thm-k-uniformity-telescoping-full\n3193: \n3194: **Step 1: Naive expansion suggests k-dependence.**\n3195: \n3196: The first derivative is:\n3197: \n3198: $$\n3199: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3200: \n3201: $$\n3202: \n3203: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3204: \n3205: **Step 2: Telescoping eliminates the k-dependence.**\n3206: \n3207: Separate the sum into two parts:\n3208: \n3209: $$\n3210: \\begin{aligned}\n3211: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3212: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3213: }\n3214: \\end{aligned}\n3215: \n3216: $$\n3217: \n3218: For the first term, use the **mean subtraction trick**:\n3219: \n3220: $$\n3221: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3222: \n3223: $$\n3224: \n3225: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3226: \n3227: $$\n3228: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3229: \n3230: $$\n3231: \n3232: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3233: \n3234: **Step 3: Bound using centered deviations.**\n3235: \n3236: Now each term is centered:\n3237: \n3238: $$\n3239: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3240: \n3241: $$\n3242: \n3243: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3244: \n3245: Therefore:\n3246: \n3247: $$\n3248: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3249: \n3250: $$\n3251: \n3252: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3253: \n3254: **Step 4: Higher derivatives by induction.**\n3255: \n3256: For $m \\geq 2$, apply Leibniz rule:\n3257: \n3258: $$\n3259: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3260: \n3261: $$\n3262: \n3263: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3264: \n3265: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3266: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3267: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3268: \n3269: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3270: \n3271: By induction and combinatorial counting (Fa\u00e0 di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.",
      "metadata": {
        "label": "proof-thm-k-uniformity-telescoping-full"
      },
      "section": "## 6. Structure of Localization Weights",
      "references": [
        "lem-telescoping-localization-weights-full",
        "lem-companion-measurement-derivatives-full",
        "lem-self-measurement-derivatives-full",
        "lem-localization-weight-derivatives-full"
      ],
      "raw_directive": "3189: :::\n3190: \n3191: :::{prf:proof}\n3192: :label: proof-thm-k-uniformity-telescoping-full\n3193: \n3194: **Step 1: Naive expansion suggests k-dependence.**\n3195: \n3196: The first derivative is:\n3197: \n3198: $$\n3199: \\nabla_{x_i} \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} [\\nabla w_{ij} \\cdot d_j + w_{ij} \\cdot \\nabla d_j]\n3200: \n3201: $$\n3202: \n3203: **Naive bound**: Each term is $O(1)$, and there are $k$ terms, suggesting $\\|\\nabla \\mu_\\rho\\| = O(k)$. This would destroy k-uniformity!\n3204: \n3205: **Step 2: Telescoping eliminates the k-dependence.**\n3206: \n3207: Separate the sum into two parts:\n3208: \n3209: $$\n3210: \\begin{aligned}\n3211: \\nabla_{x_i} \\mu_\\rho^{(i)} &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\\\\n3212: &= \\sum_j (\\nabla w_{ij}) \\cdot d_j + \\sum_j w_{ij} \\cdot (\\nabla d_j) \\quad \\text{(*)\n3213: }\n3214: \\end{aligned}\n3215: \n3216: $$\n3217: \n3218: For the first term, use the **mean subtraction trick**:\n3219: \n3220: $$\n3221: \\sum_j (\\nabla w_{ij}) \\cdot d_j = \\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\n3222: \n3223: $$\n3224: \n3225: where $\\bar{d} = \\frac{1}{k}\\sum_j d_j$ is the arithmetic mean. This is valid because:\n3226: \n3227: $$\n3228: \\sum_j (\\nabla w_{ij}) \\cdot \\bar{d} = \\bar{d} \\cdot \\sum_j \\nabla w_{ij} = \\bar{d} \\cdot 0 = 0\n3229: \n3230: $$\n3231: \n3232: by the telescoping identity {prf:ref}`lem-telescoping-localization-weights-full`.\n3233: \n3234: **Step 3: Bound using centered deviations.**\n3235: \n3236: Now each term is centered:\n3237: \n3238: $$\n3239: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq \\sum_j \\|\\nabla w_{ij}\\| \\cdot |d_j - \\bar{d}|\n3240: \n3241: $$\n3242: \n3243: By exponential decay of localization kernel $K_\\rho(i,j)$ (scale $\\rho$), only $k_{\\text{eff}}^{(\\rho)} = O(\\rho_{\\max} \\rho^{2d})$ walkers contribute significantly to $\\nabla w_{ij}$. For these walkers, $|d_j - \\bar{d}| \\leq \\text{diam}(\\mathcal{X})$ is bounded.\n3244: \n3245: Therefore:\n3246: \n3247: $$\n3248: \\left\\|\\sum_j (\\nabla w_{ij}) \\cdot (d_j - \\bar{d})\\right\\| \\leq k_{\\text{eff}}^{(\\rho)} \\cdot C_{\\nabla w} \\cdot \\text{diam}(\\mathcal{X}) = O(1)\n3249: \n3250: $$\n3251: \n3252: where $k_{\\text{eff}}^{(\\rho)}$ is **k-uniform** (depends only on $\\rho_{\\max}, \\rho, d$, but NOT on $k$).\n3253: \n3254: **Step 4: Higher derivatives by induction.**\n3255: \n3256: For $m \\geq 2$, apply Leibniz rule:\n3257: \n3258: $$\n3259: \\nabla^m \\mu_\\rho^{(i)} = \\sum_{j \\in \\mathcal{A}} \\sum_{\\alpha + \\beta = m} \\binom{m}{\\alpha} (\\nabla^\\alpha w_{ij}) \\cdot (\\nabla^\\beta d_j)\n3260: \n3261: $$\n3262: \n3263: Terms with $\\alpha \\geq 1$ use telescoping: $\\sum_j \\nabla^\\alpha w_{ij} = 0$, so we can subtract any constant (e.g., the mean of $\\nabla^\\beta d_j$).\n3264: \n3265: Terms with $\\alpha = 0$ give: $\\sum_j w_{ij} \\cdot \\nabla^m d_j$. Each term $\\nabla^m d_j$ is k-uniform by:\n3266: - **For $j \\neq i$**: Lemma {prf:ref}`lem-companion-measurement-derivatives-full` (derivative locality)\n3267: - **For $j = i$**: Lemma {prf:ref}`lem-self-measurement-derivatives-full` (sum-to-integral bound)\n3268: \n3269: Since localization weights $w_{ij}$ have k-uniform bounds (Lemma {prf:ref}`lem-localization-weight-derivatives-full`) and the sum has $k$ terms with exponential decay (only $k_{\\text{eff}}^{(\\rho)}$ contribute significantly), the product $\\sum_j w_{ij} \\cdot \\nabla^m d_j$ is k-uniform.\n3270: \n3271: By induction and combinatorial counting (Fa\u00e0 di Bruno), the total bound grows as $C_m m!$ (Gevrey-1) with $C_m$ independent of $k$.\n3272: "
    }
  ],
  "validation": {
    "ok": true,
    "errors": []
  }
}