{
  "document_id": "04_wasserstein_contraction_ASSEMBLED",
  "stage": "directives",
  "directive_type": "proof",
  "generated_at": "2025-11-08T23:19:38.346518+00:00",
  "count": 11,
  "items": [
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-23",
      "title": null,
      "start_line": 464,
      "end_line": 517,
      "header_lines": [],
      "content_start": 466,
      "content_end": 516,
      "content": "466: :::{prf:proof}\n467: \n468: **Step 1: Define the Path**\n469: \n470: Consider the function $f:[0,1] \\to \\mathbb{R}$ defined by:\n471: $$\n472: f(t) = F((1-t)\\bar{x}_1 + t\\bar{x}_2)\n473: $$\n474: \n475: This traces the fitness along the straight line from $\\bar{x}_1$ to $\\bar{x}_2$.\n476: \n477: **Step 2: Endpoint Values**\n478: \n479: By hypothesis:\n480: - $f(0) = F(\\bar{x}_1)$ is a local maximum value\n481: - $f(1) = F(\\bar{x}_2)$ is a local maximum value\n482: \n483: **Step 3: Asymptotic Behavior**\n484: \n485: Extend the line beyond the endpoints. For $t < 0$:\n486: $$\n487: \\|(1-t)\\bar{x}_1 + t\\bar{x}_2\\| = \\|\\bar{x}_1 - t(\\bar{x}_1 - \\bar{x}_2)\\| \\geq \\|\\bar{x}_1\\| + |t|L\n488: $$\n489: \n490: As $t \\to -\\infty$, the position goes to infinity. By the Confining Potential axiom:\n491: $$\n492: f(t) \\to -\\infty \\quad \\text{as } t \\to -\\infty\n493: $$\n494: \n495: Similarly, $f(t) \\to -\\infty$ as $t \\to +\\infty$.\n496: \n497: **Step 4: Existence of Minimum**\n498: \n499: Since $f$ is continuous and $f(t) \\to -\\infty$ at both ends, the function $f$ restricted to $[0,1]$ attains its minimum.\n500: \n501: **Step 5: Ruling Out Monotonicity**\n502: \n503: Suppose $f$ is monotonically non-decreasing on $[0,1]$. Then:\n504: - For all $t \\in [0,1]$: $f(t) \\geq f(0) = F(\\bar{x}_1)$\n505: \n506: But by the Environmental Richness axiom, the landscape has multiple local maxima at different reward values. By the Confining Potential, fitness must decrease in some directions from each local maximum. The line segment $[\\bar{x}_1, \\bar{x}_2]$ cannot avoid all such decreasing directions for both maxima simultaneously when $L$ is large enough.\n507: \n508: **Step 6: Conclusion**\n509: \n510: Therefore, $f$ must have a local minimum in $(0,1)$. Let $t_{\\min} \\in (0,1)$ achieve this minimum:\n511: \n512: $$\n513: f(t_{\\min}) < \\min(f(0), f(1)) - \\Delta_{\\text{valley}}\n514: $$\n515: \n516: for some $\\Delta_{\\text{valley}} > 0$ depending on the curvature of $F$ and the separation $L$.",
      "metadata": {},
      "section": "## 2. Foundational Lemmas for Outlier Alignment",
      "references": [],
      "raw_directive": "464: :::\n465: \n466: :::{prf:proof}\n467: \n468: **Step 1: Define the Path**\n469: \n470: Consider the function $f:[0,1] \\to \\mathbb{R}$ defined by:\n471: $$\n472: f(t) = F((1-t)\\bar{x}_1 + t\\bar{x}_2)\n473: $$\n474: \n475: This traces the fitness along the straight line from $\\bar{x}_1$ to $\\bar{x}_2$.\n476: \n477: **Step 2: Endpoint Values**\n478: \n479: By hypothesis:\n480: - $f(0) = F(\\bar{x}_1)$ is a local maximum value\n481: - $f(1) = F(\\bar{x}_2)$ is a local maximum value\n482: \n483: **Step 3: Asymptotic Behavior**\n484: \n485: Extend the line beyond the endpoints. For $t < 0$:\n486: $$\n487: \\|(1-t)\\bar{x}_1 + t\\bar{x}_2\\| = \\|\\bar{x}_1 - t(\\bar{x}_1 - \\bar{x}_2)\\| \\geq \\|\\bar{x}_1\\| + |t|L\n488: $$\n489: \n490: As $t \\to -\\infty$, the position goes to infinity. By the Confining Potential axiom:\n491: $$\n492: f(t) \\to -\\infty \\quad \\text{as } t \\to -\\infty\n493: $$\n494: \n495: Similarly, $f(t) \\to -\\infty$ as $t \\to +\\infty$.\n496: \n497: **Step 4: Existence of Minimum**\n498: \n499: Since $f$ is continuous and $f(t) \\to -\\infty$ at both ends, the function $f$ restricted to $[0,1]$ attains its minimum.\n500: \n501: **Step 5: Ruling Out Monotonicity**\n502: \n503: Suppose $f$ is monotonically non-decreasing on $[0,1]$. Then:\n504: - For all $t \\in [0,1]$: $f(t) \\geq f(0) = F(\\bar{x}_1)$\n505: \n506: But by the Environmental Richness axiom, the landscape has multiple local maxima at different reward values. By the Confining Potential, fitness must decrease in some directions from each local maximum. The line segment $[\\bar{x}_1, \\bar{x}_2]$ cannot avoid all such decreasing directions for both maxima simultaneously when $L$ is large enough.\n507: \n508: **Step 6: Conclusion**\n509: \n510: Therefore, $f$ must have a local minimum in $(0,1)$. Let $t_{\\min} \\in (0,1)$ achieve this minimum:\n511: \n512: $$\n513: f(t_{\\min}) < \\min(f(0), f(1)) - \\Delta_{\\text{valley}}\n514: $$\n515: \n516: for some $\\Delta_{\\text{valley}} > 0$ depending on the curvature of $F$ and the separation $L$.\n517: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Foundational Lemmas for Outlier Alignment"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-122",
      "title": null,
      "start_line": 563,
      "end_line": 750,
      "header_lines": [],
      "content_start": 565,
      "content_end": 749,
      "content": "565: :::{prf:proof}\n566: \n567: The proof uses only **static** properties of the fitness landscape and geometric configuration. No time evolution or H-theorem dynamics are invoked.\n568: \n569: **Setup:** Consider two swarms $S_1$ and $S_2$ with barycenters $\\bar{x}_1$ and $\\bar{x}_2$ at distance $L = \\|\\bar{x}_1 - \\bar{x}_2\\| > D_{\\min}$.\n570: \n571: ---\n572: \n573: **Step 1: Fitness Valley Exists (Static)**\n574: \n575: By Lemma {prf:ref}`lem-fitness-valley-static`, there exists $x_{\\text{valley}}$ on the line segment $[\\bar{x}_1, \\bar{x}_2]$ with:\n576: \n577: $$\n578: F(x_{\\text{valley}}) < \\min(F(\\bar{x}_1), F(\\bar{x}_2)) - \\Delta_{\\text{valley}}\n579: $$\n580: \n581: This is a **static geometric property** of the fitness landscape - no dynamics required.\n582: \n583: ---\n584: \n585: **Step 2: Define Wrong-Side (Misaligned) Outliers**\n586: \n587: For swarm $S_1$, define the **misaligned set**:\n588: \n589: $$\n590: M_1 = \\left\\{x \\in \\mathbb{R}^d : \\langle x - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle < 0\\right\\}\n591: $$\n592: \n593: This is the half-space on the side of $S_1$ that **faces** $S_2$ (the wrong side).\n594: \n595: An outlier $x_{1,i} \\in H_1 \\cap M_1$ is \"on the wrong side\" - it is far from the barycenter AND pointing toward the other swarm.\n596: \n597: ---\n598: \n599: **Step 3: Wrong-Side Outliers Are in Valley Region (Geometric)**\n600: \n601: **Claim:** For $L > D_{\\min}$, any wrong-side outlier $x_{1,i} \\in H_1 \\cap M_1$ lies geometrically in or near the valley region.\n602: \n603: **Geometric Argument:**\n604: \n605: The outlier satisfies:\n606: 1. $\\|x_{1,i} - \\bar{x}_1\\| \\geq R_H(\\varepsilon)$ (definition of high-error set)\n607: 2. $\\langle x_{1,i} - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle < 0$ (wrong-side condition)\n608: \n609: Let $u = \\frac{\\bar{x}_1 - \\bar{x}_2}{L}$ be the unit direction from $\\bar{x}_2$ to $\\bar{x}_1$.\n610: \n611: The projection of $x_{1,i}$ onto this direction is:\n612: \n613: $$\n614: \\langle x_{1,i} - \\bar{x}_1, u \\rangle < 0\n615: $$\n616: \n617: This means $x_{1,i}$ is on the side of $\\bar{x}_1$ facing $\\bar{x}_2$, hence closer to the valley than to $\\bar{x}_1$ along the connecting direction.\n618: \n619: For $L > D_{\\min} = 10 R_H$, the valley is at distance $\\approx L/2$ from $\\bar{x}_1$, while the outlier is only at distance $R_H \\ll L/2$ from $\\bar{x}_1$. But crucially, it's pointing in the wrong direction (toward the valley).\n620: \n621: ---\n622: \n623: **Step 4: Fitness Comparison (Static)**\n624: \n625: The fitness function is $V_{\\text{fit},i} = (d'_i)^\\beta (r'_i)^\\alpha$ where:\n626: - $d'_i$ depends on distance to barycenter\n627: - $r'_i$ depends on local reward value\n628: \n629: **For wrong-side outlier $x_{1,i} \\in H_1 \\cap M_1$:**\n630: \n631: **Distance component:** The outlier has high distance from barycenter, giving:\n632: $$\n633: z_{d,i} = \\frac{\\|x_{1,i} - \\bar{x}_1\\| - \\mu_d}{\\sigma_d} \\gg 0\n634: $$\n635: \n636: This reduces $d'_i$ and hence $V_{\\text{fit},i}$ via the $(d'_i)^\\beta$ term.\n637: \n638: **Reward component:** By geometric positioning toward the valley, and using Step 1:\n639: $$\n640: R(x_{1,i}) \\leq R(\\bar{x}_1) + O(R_H \\|\\nabla R\\|)\n641: $$\n642: \n643: But since the valley has significantly lower fitness (Step 1), and the outlier is oriented toward the valley, the combined effect is:\n644: \n645: $$\n646: V_{\\text{fit},i} < V_{\\text{typical}} - \\Delta_{\\text{fit}}\n647: $$\n648: \n649: for some $\\Delta_{\\text{fit}} > 0$ depending on framework parameters.\n650: \n651: **For companion $x_{1,j} \\in L_1$ (low-error):**\n652: \n653: The companion is near $\\bar{x}_1$ (within $R_L$) and has:\n654: - Low distance Z-score: $z_{d,j} \\approx 0$\n655: - High reward: $R(x_{1,j}) \\approx R(\\bar{x}_1)$\n656: \n657: Therefore:\n658: $$\n659: V_{\\text{fit},j} \\geq V_{\\text{typical}}\n660: $$\n661: \n662: **Fitness ordering:** $V_{\\text{fit},i} < V_{\\text{fit},j}$ is guaranteed by the Stability Condition (Theorem 7.5.2.4 in [03_cloning.md](03_cloning.md)).\n663: \n664: ---\n665: \n666: **Step 5: Survival Probability Bound (Quantitative)**\n667: \n668: From the cloning operator definition (Chapter 9, [03_cloning.md](03_cloning.md)):\n669: \n670: The cloning score for walker $i$ with companion $j$ is:\n671: \n672: $$\n673: S_i = \\frac{V_{\\text{fit},j} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n674: $$\n675: \n676: For wrong-side outliers with $V_{\\text{fit},i} < V_{\\text{fit},j} - \\Delta_{\\text{fit}}$:\n677: \n678: $$\n679: S_i \\geq \\frac{\\Delta_{\\text{fit}}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n680: $$\n681: \n682: The cloning probability is:\n683: \n684: $$\n685: p_i = \\min\\left(1, \\frac{S_i}{p_{\\max}}\\right) \\geq \\min\\left(1, \\frac{\\Delta_{\\text{fit}}}{p_{\\max}(V_{\\text{fit},i} + \\varepsilon_{\\text{clone}})}\\right)\n686: $$\n687: \n688: For $L > D_{\\min}$, the fitness gap $\\Delta_{\\text{fit}}$ grows with $L$ (due to valley depth from Step 1), so:\n689: \n690: $$\n691: p_i \\geq p_u(\\varepsilon) \\geq 0.1\n692: $$\n693: \n694: where $p_u(\\varepsilon)$ is the minimum cloning probability from Lemma 8.3.2 in [03_cloning.md](03_cloning.md).\n695: \n696: **Survival probability for wrong-side outliers:**\n697: \n698: $$\n699: \\mathbb{P}(\\text{survive} \\mid x_{1,i} \\in H_1 \\cap M_1) = 1 - p_i \\leq 1 - p_u(\\varepsilon) \\leq 0.9\n700: $$\n701: \n702: For larger $L$, this probability decreases exponentially.\n703: \n704: ---\n705: \n706: **Step 6: Derive Alignment Constant $\\eta = 1/4$**\n707: \n708: Among high-error walkers, the survival-weighted distribution heavily favors correctly-aligned outliers.\n709: \n710: Define the cosine of alignment:\n711: \n712: $$\n713: \\cos \\theta_i = \\frac{\\langle x_{1,i} - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle}{\\|x_{1,i} - \\bar{x}_1\\| \\|\\bar{x}_1 - \\bar{x}_2\\|}\n714: $$\n715: \n716: **Partition by alignment:**\n717: - **Aligned set** $A_1$: $\\cos \\theta_i \\geq 0$ (correct side)\n718: - **Misaligned set** $M_1$: $\\cos \\theta_i < 0$ (wrong side)\n719: \n720: **Survival probabilities:**\n721: - For $i \\in A_1$: $\\mathbb{P}(\\text{survive} \\mid i \\in A_1) \\geq 1 - p_{\\max} \\geq 0.5$\n722: - For $i \\in M_1$: $\\mathbb{P}(\\text{survive} \\mid i \\in M_1) \\leq 0.1$ (from Step 5)\n723: \n724: **Bayesian update:** Using Bayes' theorem with uniform prior:\n725: \n726: $$\n727: \\mathbb{P}(A_1 \\mid \\text{survives}) = \\frac{0.5 \\cdot 0.5}{0.5 \\cdot 0.5 + 0.1 \\cdot 0.5} = \\frac{0.25}{0.3} = \\frac{5}{6}\n728: $$\n729: \n730: $$\n731: \\mathbb{P}(M_1 \\mid \\text{survives}) = \\frac{0.1 \\cdot 0.5}{0.3} = \\frac{1}{6}\n732: $$\n733: \n734: **Expected alignment among survivors:**\n735: \n736: Assuming:\n737: - $\\mathbb{E}[\\cos \\theta \\mid A_1] \\geq 1/2$ (positive alignment away from other swarm)\n738: - $\\mathbb{E}[\\cos \\theta \\mid M_1] \\geq -1$ (worst case)\n739: \n740: We get:\n741: \n742: $$\n743: \\mathbb{E}[\\cos \\theta \\mid \\text{survives}] \\geq \\frac{5}{6} \\cdot \\frac{1}{2} + \\frac{1}{6} \\cdot (-1) = \\frac{5}{12} - \\frac{2}{12} = \\frac{1}{4}\n744: $$\n745: \n746: **Therefore:** $\\eta = 1/4$ is a conservative bound.\n747: \n748: ---\n749: ",
      "metadata": {},
      "section": "## 2. Foundational Lemmas for Outlier Alignment",
      "references": [
        "lem-fitness-valley-static"
      ],
      "raw_directive": "563: ### 2.2. Proof of Outlier Alignment (Static Method)\n564: \n565: :::{prf:proof}\n566: \n567: The proof uses only **static** properties of the fitness landscape and geometric configuration. No time evolution or H-theorem dynamics are invoked.\n568: \n569: **Setup:** Consider two swarms $S_1$ and $S_2$ with barycenters $\\bar{x}_1$ and $\\bar{x}_2$ at distance $L = \\|\\bar{x}_1 - \\bar{x}_2\\| > D_{\\min}$.\n570: \n571: ---\n572: \n573: **Step 1: Fitness Valley Exists (Static)**\n574: \n575: By Lemma {prf:ref}`lem-fitness-valley-static`, there exists $x_{\\text{valley}}$ on the line segment $[\\bar{x}_1, \\bar{x}_2]$ with:\n576: \n577: $$\n578: F(x_{\\text{valley}}) < \\min(F(\\bar{x}_1), F(\\bar{x}_2)) - \\Delta_{\\text{valley}}\n579: $$\n580: \n581: This is a **static geometric property** of the fitness landscape - no dynamics required.\n582: \n583: ---\n584: \n585: **Step 2: Define Wrong-Side (Misaligned) Outliers**\n586: \n587: For swarm $S_1$, define the **misaligned set**:\n588: \n589: $$\n590: M_1 = \\left\\{x \\in \\mathbb{R}^d : \\langle x - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle < 0\\right\\}\n591: $$\n592: \n593: This is the half-space on the side of $S_1$ that **faces** $S_2$ (the wrong side).\n594: \n595: An outlier $x_{1,i} \\in H_1 \\cap M_1$ is \"on the wrong side\" - it is far from the barycenter AND pointing toward the other swarm.\n596: \n597: ---\n598: \n599: **Step 3: Wrong-Side Outliers Are in Valley Region (Geometric)**\n600: \n601: **Claim:** For $L > D_{\\min}$, any wrong-side outlier $x_{1,i} \\in H_1 \\cap M_1$ lies geometrically in or near the valley region.\n602: \n603: **Geometric Argument:**\n604: \n605: The outlier satisfies:\n606: 1. $\\|x_{1,i} - \\bar{x}_1\\| \\geq R_H(\\varepsilon)$ (definition of high-error set)\n607: 2. $\\langle x_{1,i} - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle < 0$ (wrong-side condition)\n608: \n609: Let $u = \\frac{\\bar{x}_1 - \\bar{x}_2}{L}$ be the unit direction from $\\bar{x}_2$ to $\\bar{x}_1$.\n610: \n611: The projection of $x_{1,i}$ onto this direction is:\n612: \n613: $$\n614: \\langle x_{1,i} - \\bar{x}_1, u \\rangle < 0\n615: $$\n616: \n617: This means $x_{1,i}$ is on the side of $\\bar{x}_1$ facing $\\bar{x}_2$, hence closer to the valley than to $\\bar{x}_1$ along the connecting direction.\n618: \n619: For $L > D_{\\min} = 10 R_H$, the valley is at distance $\\approx L/2$ from $\\bar{x}_1$, while the outlier is only at distance $R_H \\ll L/2$ from $\\bar{x}_1$. But crucially, it's pointing in the wrong direction (toward the valley).\n620: \n621: ---\n622: \n623: **Step 4: Fitness Comparison (Static)**\n624: \n625: The fitness function is $V_{\\text{fit},i} = (d'_i)^\\beta (r'_i)^\\alpha$ where:\n626: - $d'_i$ depends on distance to barycenter\n627: - $r'_i$ depends on local reward value\n628: \n629: **For wrong-side outlier $x_{1,i} \\in H_1 \\cap M_1$:**\n630: \n631: **Distance component:** The outlier has high distance from barycenter, giving:\n632: $$\n633: z_{d,i} = \\frac{\\|x_{1,i} - \\bar{x}_1\\| - \\mu_d}{\\sigma_d} \\gg 0\n634: $$\n635: \n636: This reduces $d'_i$ and hence $V_{\\text{fit},i}$ via the $(d'_i)^\\beta$ term.\n637: \n638: **Reward component:** By geometric positioning toward the valley, and using Step 1:\n639: $$\n640: R(x_{1,i}) \\leq R(\\bar{x}_1) + O(R_H \\|\\nabla R\\|)\n641: $$\n642: \n643: But since the valley has significantly lower fitness (Step 1), and the outlier is oriented toward the valley, the combined effect is:\n644: \n645: $$\n646: V_{\\text{fit},i} < V_{\\text{typical}} - \\Delta_{\\text{fit}}\n647: $$\n648: \n649: for some $\\Delta_{\\text{fit}} > 0$ depending on framework parameters.\n650: \n651: **For companion $x_{1,j} \\in L_1$ (low-error):**\n652: \n653: The companion is near $\\bar{x}_1$ (within $R_L$) and has:\n654: - Low distance Z-score: $z_{d,j} \\approx 0$\n655: - High reward: $R(x_{1,j}) \\approx R(\\bar{x}_1)$\n656: \n657: Therefore:\n658: $$\n659: V_{\\text{fit},j} \\geq V_{\\text{typical}}\n660: $$\n661: \n662: **Fitness ordering:** $V_{\\text{fit},i} < V_{\\text{fit},j}$ is guaranteed by the Stability Condition (Theorem 7.5.2.4 in [03_cloning.md](03_cloning.md)).\n663: \n664: ---\n665: \n666: **Step 5: Survival Probability Bound (Quantitative)**\n667: \n668: From the cloning operator definition (Chapter 9, [03_cloning.md](03_cloning.md)):\n669: \n670: The cloning score for walker $i$ with companion $j$ is:\n671: \n672: $$\n673: S_i = \\frac{V_{\\text{fit},j} - V_{\\text{fit},i}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n674: $$\n675: \n676: For wrong-side outliers with $V_{\\text{fit},i} < V_{\\text{fit},j} - \\Delta_{\\text{fit}}$:\n677: \n678: $$\n679: S_i \\geq \\frac{\\Delta_{\\text{fit}}}{V_{\\text{fit},i} + \\varepsilon_{\\text{clone}}}\n680: $$\n681: \n682: The cloning probability is:\n683: \n684: $$\n685: p_i = \\min\\left(1, \\frac{S_i}{p_{\\max}}\\right) \\geq \\min\\left(1, \\frac{\\Delta_{\\text{fit}}}{p_{\\max}(V_{\\text{fit},i} + \\varepsilon_{\\text{clone}})}\\right)\n686: $$\n687: \n688: For $L > D_{\\min}$, the fitness gap $\\Delta_{\\text{fit}}$ grows with $L$ (due to valley depth from Step 1), so:\n689: \n690: $$\n691: p_i \\geq p_u(\\varepsilon) \\geq 0.1\n692: $$\n693: \n694: where $p_u(\\varepsilon)$ is the minimum cloning probability from Lemma 8.3.2 in [03_cloning.md](03_cloning.md).\n695: \n696: **Survival probability for wrong-side outliers:**\n697: \n698: $$\n699: \\mathbb{P}(\\text{survive} \\mid x_{1,i} \\in H_1 \\cap M_1) = 1 - p_i \\leq 1 - p_u(\\varepsilon) \\leq 0.9\n700: $$\n701: \n702: For larger $L$, this probability decreases exponentially.\n703: \n704: ---\n705: \n706: **Step 6: Derive Alignment Constant $\\eta = 1/4$**\n707: \n708: Among high-error walkers, the survival-weighted distribution heavily favors correctly-aligned outliers.\n709: \n710: Define the cosine of alignment:\n711: \n712: $$\n713: \\cos \\theta_i = \\frac{\\langle x_{1,i} - \\bar{x}_1, \\bar{x}_1 - \\bar{x}_2 \\rangle}{\\|x_{1,i} - \\bar{x}_1\\| \\|\\bar{x}_1 - \\bar{x}_2\\|}\n714: $$\n715: \n716: **Partition by alignment:**\n717: - **Aligned set** $A_1$: $\\cos \\theta_i \\geq 0$ (correct side)\n718: - **Misaligned set** $M_1$: $\\cos \\theta_i < 0$ (wrong side)\n719: \n720: **Survival probabilities:**\n721: - For $i \\in A_1$: $\\mathbb{P}(\\text{survive} \\mid i \\in A_1) \\geq 1 - p_{\\max} \\geq 0.5$\n722: - For $i \\in M_1$: $\\mathbb{P}(\\text{survive} \\mid i \\in M_1) \\leq 0.1$ (from Step 5)\n723: \n724: **Bayesian update:** Using Bayes' theorem with uniform prior:\n725: \n726: $$\n727: \\mathbb{P}(A_1 \\mid \\text{survives}) = \\frac{0.5 \\cdot 0.5}{0.5 \\cdot 0.5 + 0.1 \\cdot 0.5} = \\frac{0.25}{0.3} = \\frac{5}{6}\n728: $$\n729: \n730: $$\n731: \\mathbb{P}(M_1 \\mid \\text{survives}) = \\frac{0.1 \\cdot 0.5}{0.3} = \\frac{1}{6}\n732: $$\n733: \n734: **Expected alignment among survivors:**\n735: \n736: Assuming:\n737: - $\\mathbb{E}[\\cos \\theta \\mid A_1] \\geq 1/2$ (positive alignment away from other swarm)\n738: - $\\mathbb{E}[\\cos \\theta \\mid M_1] \\geq -1$ (worst case)\n739: \n740: We get:\n741: \n742: $$\n743: \\mathbb{E}[\\cos \\theta \\mid \\text{survives}] \\geq \\frac{5}{6} \\cdot \\frac{1}{2} + \\frac{1}{6} \\cdot (-1) = \\frac{5}{12} - \\frac{2}{12} = \\frac{1}{4}\n744: $$\n745: \n746: **Therefore:** $\\eta = 1/4$ is a conservative bound.\n747: \n748: ---\n749: \n750: **Conclusion:** The Outlier Alignment Lemma is proven using only static fitness landscape properties (Fitness Valley Lemma) and geometric/fitness comparisons. No dynamics or H-theorem required. â–¡",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 3,
        "chapter_file": "chapter_3.json",
        "section_id": "## 2. Foundational Lemmas for Outlier Alignment"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-174",
      "title": null,
      "start_line": 952,
      "end_line": 978,
      "header_lines": [],
      "content_start": 953,
      "content_end": 977,
      "content": "953: \n954: :::{prf:proof}\n955: Total expected distance:\n956: \n957: $$\n958: \\mathbb{E}[D'_{ii}] + D'_{jj} = \\mathbb{E}[D'_{ii}] + D_{jj}\n959: $$\n960: \n961: Using the bound from Section 3.3 and $D_{ji} \\leq (1 + \\epsilon)(D_{ii} + D_{jj})$ for small $\\epsilon$:\n962: \n963: $$\n964: \\mathbb{E}[D'_{ii}] \\leq (1 - p_{\\min}) D_{ii} + p_{\\min} D_{jj} + \\Delta p [(1 + \\epsilon)(D_{ii} + D_{jj}) + d\\delta^2]\n965: $$\n966: \n967: Adding $D_{jj}$:\n968: \n969: $$\n970: \\mathbb{E}[D'_{ii} + D'_{jj}] \\leq [(1 - p_{\\min}) + \\Delta p (1 + \\epsilon)] D_{ii} + [p_{\\min} + 1 + \\Delta p(1 + \\epsilon)] D_{jj} + \\Delta p d\\delta^2\n971: $$\n972: \n973: Since $p_{\\min} + \\Delta p = p_{\\max}$ and $\\Delta p \\leq 1$:\n974: \n975: $$\n976: \\leq [1 + \\epsilon] D_{ii} + [1 + p_{\\max} + \\epsilon] D_{jj} + d\\delta^2 \\leq (1 + 2\\epsilon) (D_{ii} + D_{jj}) + 2d\\delta^2\n977: $$",
      "metadata": {},
      "section": "## 3. Case A: Consistent Fitness Ordering",
      "references": [],
      "raw_directive": "952: :::\n953: \n954: :::{prf:proof}\n955: Total expected distance:\n956: \n957: $$\n958: \\mathbb{E}[D'_{ii}] + D'_{jj} = \\mathbb{E}[D'_{ii}] + D_{jj}\n959: $$\n960: \n961: Using the bound from Section 3.3 and $D_{ji} \\leq (1 + \\epsilon)(D_{ii} + D_{jj})$ for small $\\epsilon$:\n962: \n963: $$\n964: \\mathbb{E}[D'_{ii}] \\leq (1 - p_{\\min}) D_{ii} + p_{\\min} D_{jj} + \\Delta p [(1 + \\epsilon)(D_{ii} + D_{jj}) + d\\delta^2]\n965: $$\n966: \n967: Adding $D_{jj}$:\n968: \n969: $$\n970: \\mathbb{E}[D'_{ii} + D'_{jj}] \\leq [(1 - p_{\\min}) + \\Delta p (1 + \\epsilon)] D_{ii} + [p_{\\min} + 1 + \\Delta p(1 + \\epsilon)] D_{jj} + \\Delta p d\\delta^2\n971: $$\n972: \n973: Since $p_{\\min} + \\Delta p = p_{\\max}$ and $\\Delta p \\leq 1$:\n974: \n975: $$\n976: \\leq [1 + \\epsilon] D_{ii} + [1 + p_{\\max} + \\epsilon] D_{jj} + d\\delta^2 \\leq (1 + 2\\epsilon) (D_{ii} + D_{jj}) + 2d\\delta^2\n977: $$\n978: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 4,
        "chapter_file": "chapter_4.json",
        "section_id": "## 3. Case A: Consistent Fitness Ordering"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-27",
      "title": null,
      "start_line": 1577,
      "end_line": 1656,
      "header_lines": [],
      "content_start": 1578,
      "content_end": 1655,
      "content": "1578: \n1579: :::{prf:proof}\n1580: **Case A Configuration**: By definition, walker $i$ in swarm $k$ satisfies:\n1581: $$\n1582: V_{\\text{fit},k,i} \\geq V_{\\text{fit},k,j_i}\n1583: $$\n1584: \n1585: where $j_i$ is $i$'s companion. Therefore, walker $i$ is **fitter than its companion** and has **lower elimination probability**.\n1586: \n1587: **Step 1: Survival Probability**\n1588: \n1589: From Remark 3.2, the survival probability for walker $i$ is:\n1590: $$\n1591: p_{k,i} = \\frac{\\exp(\\beta V_{\\text{fit},k,i})}{\\sum_{\\ell=1}^N \\exp(\\beta V_{\\text{fit},k,\\ell})} \\geq \\frac{1}{N}\n1592: $$\n1593: \n1594: with the key property:\n1595: $$\n1596: p_{k,i} \\geq p_{k,j_i} \\quad \\text{(fitter walker survives more often)}\n1597: $$\n1598: \n1599: **Step 2: Expected Distance Change**\n1600: \n1601: If walker $i$ survives (probability $p_{k,i}$):\n1602: $$\n1603: D'_{i\\pi(i)} = \\|x'_{k,i} - x'_{\\ell,\\pi(i)}\\|^2 = \\|x_{k,i} + \\zeta_i - x_{\\ell,\\pi(i)} - \\zeta_{\\pi(i)}\\|^2\n1604: $$\n1605: \n1606: Using $\\mathbb{E}[\\|\\zeta_i\\|^2] = d\\delta^2$ and $\\mathbb{E}[\\|\\zeta_{\\pi(i)}\\|^2] = d\\delta^2$:\n1607: $$\n1608: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ survives}, M, T] = D_{i\\pi(i)} + 2d\\delta^2\n1609: $$\n1610: \n1611: If walker $i$ is eliminated and replaced by companion $j_i$ (probability $1 - p_{k,i}$):\n1612: $$\n1613: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}, M, T] = \\mathbb{E}[\\|x_{k,j_i} + \\zeta_i - x_{\\ell,\\pi(i)} - \\zeta_{\\pi(i)}\\|^2]\n1614: $$\n1615: \n1616: **Step 3: Companion Replacement Bound**\n1617: \n1618: In Case A, the companion $j_i$ is in the same swarm $S_k$. For walkers in the same swarm:\n1619: $$\n1620: \\|x_{k,j_i} - x_{k,i}\\| \\leq 2R_L\n1621: $$\n1622: \n1623: where $R_L$ is the low-error region radius. Therefore:\n1624: $$\n1625: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}] \\leq (D_{i\\pi(i)}^{1/2} + 2R_L)^2 + 2d\\delta^2\n1626: $$\n1627: \n1628: For separated swarms with $D_{i\\pi(i)} \\sim L^2 \\gg R_L^2$:\n1629: $$\n1630: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}] \\leq D_{i\\pi(i)} + 4R_L \\sqrt{D_{i\\pi(i)}} + 2d\\delta^2\n1631: $$\n1632: \n1633: **Step 4: Weighted Average**\n1634: \n1635: Combining survival and elimination:\n1636: $$\n1637: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] = p_{k,i} \\cdot (D_{i\\pi(i)} + 2d\\delta^2) + (1 - p_{k,i}) \\cdot (D_{i\\pi(i)} + O(R_L L))\n1638: $$\n1639: \n1640: Since $p_{k,i} \\geq 1/N$ and $R_L \\leq R_H \\leq c_H L$ (from Lemma 4.3.7):\n1641: $$\n1642: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] \\leq D_{i\\pi(i)} + 4d\\delta^2\n1643: $$\n1644: \n1645: **Step 5: Contraction Factor**\n1646: \n1647: Therefore:\n1648: $$\n1649: \\gamma_A = \\frac{\\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}]}{D_{i\\pi(i)}} \\leq 1 + \\frac{4d\\delta^2}{D_{i\\pi(i)}}\n1650: $$\n1651: \n1652: For separated swarms with $D_{i\\pi(i)} \\geq (L - 2R_H)^2 \\geq (L - 2c_H L)^2 = L^2(1 - 2c_H)^2$:\n1653: $$\n1654: \\gamma_A \\leq 1 + \\frac{4d\\delta^2}{L^2(1 - 2c_H)^2} = 1 + O(\\delta^2/L^2)\n1655: $$",
      "metadata": {},
      "section": "## 5. Unified Single-Pair Lemma",
      "references": [],
      "raw_directive": "1577: :::\n1578: \n1579: :::{prf:proof}\n1580: **Case A Configuration**: By definition, walker $i$ in swarm $k$ satisfies:\n1581: $$\n1582: V_{\\text{fit},k,i} \\geq V_{\\text{fit},k,j_i}\n1583: $$\n1584: \n1585: where $j_i$ is $i$'s companion. Therefore, walker $i$ is **fitter than its companion** and has **lower elimination probability**.\n1586: \n1587: **Step 1: Survival Probability**\n1588: \n1589: From Remark 3.2, the survival probability for walker $i$ is:\n1590: $$\n1591: p_{k,i} = \\frac{\\exp(\\beta V_{\\text{fit},k,i})}{\\sum_{\\ell=1}^N \\exp(\\beta V_{\\text{fit},k,\\ell})} \\geq \\frac{1}{N}\n1592: $$\n1593: \n1594: with the key property:\n1595: $$\n1596: p_{k,i} \\geq p_{k,j_i} \\quad \\text{(fitter walker survives more often)}\n1597: $$\n1598: \n1599: **Step 2: Expected Distance Change**\n1600: \n1601: If walker $i$ survives (probability $p_{k,i}$):\n1602: $$\n1603: D'_{i\\pi(i)} = \\|x'_{k,i} - x'_{\\ell,\\pi(i)}\\|^2 = \\|x_{k,i} + \\zeta_i - x_{\\ell,\\pi(i)} - \\zeta_{\\pi(i)}\\|^2\n1604: $$\n1605: \n1606: Using $\\mathbb{E}[\\|\\zeta_i\\|^2] = d\\delta^2$ and $\\mathbb{E}[\\|\\zeta_{\\pi(i)}\\|^2] = d\\delta^2$:\n1607: $$\n1608: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ survives}, M, T] = D_{i\\pi(i)} + 2d\\delta^2\n1609: $$\n1610: \n1611: If walker $i$ is eliminated and replaced by companion $j_i$ (probability $1 - p_{k,i}$):\n1612: $$\n1613: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}, M, T] = \\mathbb{E}[\\|x_{k,j_i} + \\zeta_i - x_{\\ell,\\pi(i)} - \\zeta_{\\pi(i)}\\|^2]\n1614: $$\n1615: \n1616: **Step 3: Companion Replacement Bound**\n1617: \n1618: In Case A, the companion $j_i$ is in the same swarm $S_k$. For walkers in the same swarm:\n1619: $$\n1620: \\|x_{k,j_i} - x_{k,i}\\| \\leq 2R_L\n1621: $$\n1622: \n1623: where $R_L$ is the low-error region radius. Therefore:\n1624: $$\n1625: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}] \\leq (D_{i\\pi(i)}^{1/2} + 2R_L)^2 + 2d\\delta^2\n1626: $$\n1627: \n1628: For separated swarms with $D_{i\\pi(i)} \\sim L^2 \\gg R_L^2$:\n1629: $$\n1630: \\mathbb{E}[D'_{i\\pi(i)} \\mid i \\text{ eliminated}] \\leq D_{i\\pi(i)} + 4R_L \\sqrt{D_{i\\pi(i)}} + 2d\\delta^2\n1631: $$\n1632: \n1633: **Step 4: Weighted Average**\n1634: \n1635: Combining survival and elimination:\n1636: $$\n1637: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] = p_{k,i} \\cdot (D_{i\\pi(i)} + 2d\\delta^2) + (1 - p_{k,i}) \\cdot (D_{i\\pi(i)} + O(R_L L))\n1638: $$\n1639: \n1640: Since $p_{k,i} \\geq 1/N$ and $R_L \\leq R_H \\leq c_H L$ (from Lemma 4.3.7):\n1641: $$\n1642: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] \\leq D_{i\\pi(i)} + 4d\\delta^2\n1643: $$\n1644: \n1645: **Step 5: Contraction Factor**\n1646: \n1647: Therefore:\n1648: $$\n1649: \\gamma_A = \\frac{\\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}]}{D_{i\\pi(i)}} \\leq 1 + \\frac{4d\\delta^2}{D_{i\\pi(i)}}\n1650: $$\n1651: \n1652: For separated swarms with $D_{i\\pi(i)} \\geq (L - 2R_H)^2 \\geq (L - 2c_H L)^2 = L^2(1 - 2c_H)^2$:\n1653: $$\n1654: \\gamma_A \\leq 1 + \\frac{4d\\delta^2}{L^2(1 - 2c_H)^2} = 1 + O(\\delta^2/L^2)\n1655: $$\n1656: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Unified Single-Pair Lemma"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-144",
      "title": null,
      "start_line": 1694,
      "end_line": 1754,
      "header_lines": [],
      "content_start": 1695,
      "content_end": 1753,
      "content": "1695: \n1696: :::{prf:proof}\n1697: This follows directly from Section 4.4 (Contraction Factor Derivation) combined with Proposition 4.3.6 (Exact Distance Change Identity) and Lemma 4.3.7 (High-Error Projection).\n1698: \n1699: **Step 1: Quadratic Bound on Distance Change**\n1700: \n1701: From Proposition 4.3.6, for Case B where walker $i$ survives and walker $\\pi(i)$ is eliminated:\n1702: $$\n1703: D_{ii} - D_{ji} = (N-1) \\|x_{1,j} - x_{1,i}\\|^2 + 2N \\langle x_{1,j} - x_{1,i}, x_{1,i} - \\bar{x}_1 \\rangle\n1704: $$\n1705: \n1706: For separated swarms with $x_{1,j} \\in H_1$ (companion in same swarm) and $x_{1,i} \\in H_1$:\n1707: $$\n1708: D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}}}{2} \\|x_{1,j} - x_{1,i}\\|^2\n1709: $$\n1710: \n1711: From Lemma 4.3.7, the high-error projection gives:\n1712: $$\n1713: \\|x_{1,j} - x_{1,i}\\|^2 \\geq R_H^2 \\geq (c_0 L - c_1)^2\n1714: $$\n1715: \n1716: Therefore:\n1717: $$\n1718: D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}}}{2} (c_0 L - c_1)^2\n1719: $$\n1720: \n1721: For $L > 2c_1/c_0$, this gives $D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}} c_0^2 L^2}{4}$.\n1722: \n1723: **Step 2: Survival Probability**\n1724: \n1725: Walker $i \\in H_1$ has fitness $V_{\\text{fit},1,i}$. The minimum survival probability is:\n1726: $$\n1727: p_{1,i} \\geq \\frac{\\exp(-\\beta \\Delta V_{\\max})}{N} := p_u\n1728: $$\n1729: \n1730: where $\\Delta V_{\\max}$ is the maximum virtual reward difference (bounded by axioms).\n1731: \n1732: **Step 3: Expected Distance Change**\n1733: \n1734: Combining the quadratic bound with survival probability:\n1735: $$\n1736: \\mathbb{E}[\\Delta D_{i\\pi(i)} \\mid \\text{Case B}] \\leq -p_{1,i} \\cdot (D_{ii} - D_{ji}) + 4d\\delta^2\n1737: $$\n1738: \n1739: $$\n1740: \\leq -p_u \\cdot \\frac{N \\eta_{\\text{geo}} c_0^2 L^2}{4} + 4d\\delta^2\n1741: $$\n1742: \n1743: **Step 4: Contraction Factor**\n1744: \n1745: For $D_{i\\pi(i)} \\sim L^2$:\n1746: $$\n1747: \\gamma_B \\leq 1 - \\frac{p_u \\eta_{\\text{geo}} c_0^2 N}{4 \\cdot 2} + \\frac{4d\\delta^2}{L^2} = 1 - \\frac{p_u \\eta_{\\text{geo}}}{2} + O(\\delta^2/L^2)\n1748: $$\n1749: \n1750: Defining $\\kappa_B := \\frac{p_u \\eta_{\\text{geo}}}{2}$:\n1751: $$\n1752: \\gamma_B \\leq 1 - \\kappa_B + O(\\delta^2/L^2)\n1753: $$",
      "metadata": {},
      "section": "## 5. Unified Single-Pair Lemma",
      "references": [],
      "raw_directive": "1694: :::\n1695: \n1696: :::{prf:proof}\n1697: This follows directly from Section 4.4 (Contraction Factor Derivation) combined with Proposition 4.3.6 (Exact Distance Change Identity) and Lemma 4.3.7 (High-Error Projection).\n1698: \n1699: **Step 1: Quadratic Bound on Distance Change**\n1700: \n1701: From Proposition 4.3.6, for Case B where walker $i$ survives and walker $\\pi(i)$ is eliminated:\n1702: $$\n1703: D_{ii} - D_{ji} = (N-1) \\|x_{1,j} - x_{1,i}\\|^2 + 2N \\langle x_{1,j} - x_{1,i}, x_{1,i} - \\bar{x}_1 \\rangle\n1704: $$\n1705: \n1706: For separated swarms with $x_{1,j} \\in H_1$ (companion in same swarm) and $x_{1,i} \\in H_1$:\n1707: $$\n1708: D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}}}{2} \\|x_{1,j} - x_{1,i}\\|^2\n1709: $$\n1710: \n1711: From Lemma 4.3.7, the high-error projection gives:\n1712: $$\n1713: \\|x_{1,j} - x_{1,i}\\|^2 \\geq R_H^2 \\geq (c_0 L - c_1)^2\n1714: $$\n1715: \n1716: Therefore:\n1717: $$\n1718: D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}}}{2} (c_0 L - c_1)^2\n1719: $$\n1720: \n1721: For $L > 2c_1/c_0$, this gives $D_{ii} - D_{ji} \\geq \\frac{N \\eta_{\\text{geo}} c_0^2 L^2}{4}$.\n1722: \n1723: **Step 2: Survival Probability**\n1724: \n1725: Walker $i \\in H_1$ has fitness $V_{\\text{fit},1,i}$. The minimum survival probability is:\n1726: $$\n1727: p_{1,i} \\geq \\frac{\\exp(-\\beta \\Delta V_{\\max})}{N} := p_u\n1728: $$\n1729: \n1730: where $\\Delta V_{\\max}$ is the maximum virtual reward difference (bounded by axioms).\n1731: \n1732: **Step 3: Expected Distance Change**\n1733: \n1734: Combining the quadratic bound with survival probability:\n1735: $$\n1736: \\mathbb{E}[\\Delta D_{i\\pi(i)} \\mid \\text{Case B}] \\leq -p_{1,i} \\cdot (D_{ii} - D_{ji}) + 4d\\delta^2\n1737: $$\n1738: \n1739: $$\n1740: \\leq -p_u \\cdot \\frac{N \\eta_{\\text{geo}} c_0^2 L^2}{4} + 4d\\delta^2\n1741: $$\n1742: \n1743: **Step 4: Contraction Factor**\n1744: \n1745: For $D_{i\\pi(i)} \\sim L^2$:\n1746: $$\n1747: \\gamma_B \\leq 1 - \\frac{p_u \\eta_{\\text{geo}} c_0^2 N}{4 \\cdot 2} + \\frac{4d\\delta^2}{L^2} = 1 - \\frac{p_u \\eta_{\\text{geo}}}{2} + O(\\delta^2/L^2)\n1748: $$\n1749: \n1750: Defining $\\kappa_B := \\frac{p_u \\eta_{\\text{geo}}}{2}$:\n1751: $$\n1752: \\gamma_B \\leq 1 - \\kappa_B + O(\\delta^2/L^2)\n1753: $$\n1754: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Unified Single-Pair Lemma"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-245",
      "title": null,
      "start_line": 1795,
      "end_line": 1880,
      "header_lines": [],
      "content_start": 1796,
      "content_end": 1879,
      "content": "1796: \n1797: :::{prf:proof}\n1798: **Step 1: Partition by Case**\n1799: \n1800: For any matched pair, either Case A or Case B occurs. By the law of total expectation:\n1801: $$\n1802: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] = \\mathbb{P}(\\text{Case A} \\mid M) \\cdot \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}, M, T]\n1803: $$\n1804: $$\n1805: + \\mathbb{P}(\\text{Case B} \\mid M) \\cdot \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}, M, T]\n1806: $$\n1807: \n1808: **Step 2: Apply Individual Case Bounds**\n1809: \n1810: From Lemma 5.1 (Case A):\n1811: $$\n1812: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}, M, T] \\leq D_{i\\pi(i)} + 4d\\delta^2 = D_{i\\pi(i)}(1 + \\varepsilon_A)\n1813: $$\n1814: \n1815: From Lemma 5.2 (Case B):\n1816: $$\n1817: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}, M, T] \\leq D_{i\\pi(i)}(1 - \\kappa_B) + C_W\n1818: $$\n1819: \n1820: **Step 3: Combine with Probabilities**\n1821: \n1822: $$\n1823: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq \\mathbb{P}(\\text{Case A}) \\cdot D_{i\\pi(i)}(1 + \\varepsilon_A)\n1824: $$\n1825: $$\n1826: + \\mathbb{P}(\\text{Case B}) \\cdot [D_{i\\pi(i)}(1 - \\kappa_B) + C_W]\n1827: $$\n1828: \n1829: Since $\\mathbb{P}(\\text{Case A}) + \\mathbb{P}(\\text{Case B}) = 1$:\n1830: $$\n1831: = D_{i\\pi(i)} \\left[1 - \\mathbb{P}(\\text{Case B}) \\kappa_B + \\mathbb{P}(\\text{Case A}) \\varepsilon_A\\right] + \\mathbb{P}(\\text{Case B}) C_W\n1832: $$\n1833: \n1834: Since $\\mathbb{P}(\\text{Case B}) \\leq 1$:\n1835: $$\n1836: \\leq D_{i\\pi(i)} \\left[1 - \\mathbb{P}(\\text{Case B}) \\kappa_B + \\mathbb{P}(\\text{Case A}) \\varepsilon_A\\right] + C_W\n1837: $$\n1838: \n1839: Defining:\n1840: $$\n1841: \\kappa_{\\text{pair}} := \\mathbb{P}(\\text{Case B}) \\kappa_B - \\mathbb{P}(\\text{Case A}) \\varepsilon_A\n1842: $$\n1843: \n1844: we obtain:\n1845: $$\n1846: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq (1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W\n1847: $$\n1848: \n1849: **Step 4: Apply Case B Frequency Lower Bound**\n1850: \n1851: From Lemma 4.6:\n1852: $$\n1853: \\mathbb{P}(\\text{Case B} \\mid M) \\geq f_{UH}(\\varepsilon) \\cdot q_{\\min}(\\varepsilon) > 0\n1854: $$\n1855: \n1856: Therefore:\n1857: $$\n1858: \\kappa_{\\text{pair}} \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B - \\varepsilon_A\n1859: $$\n1860: \n1861: **Step 5: Show Positivity for Large $L$**\n1862: \n1863: For $L > L_{\\min}(\\varepsilon)$ where $\\varepsilon_A = \\frac{4d\\delta^2}{L^2} < \\frac{\\kappa_B f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)}{2}$:\n1864: \n1865: $$\n1866: \\kappa_{\\text{pair}} \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B - \\frac{f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B}{2}\n1867: $$\n1868: \n1869: $$\n1870: = \\frac{f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B}{2} > 0\n1871: $$\n1872: \n1873: **Step 6: Verify N-Uniformity**\n1874: \n1875: All components are N-uniform:\n1876: - $\\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2}$ where $p_u = \\exp(-\\beta \\Delta V_{\\max})/N \\cdot N = \\exp(-\\beta \\Delta V_{\\max})$ (N-independent)\n1877: - $f_{UH}(\\varepsilon)$ depends only on geometric separation $\\varepsilon$\n1878: - $q_{\\min}(\\varepsilon)$ is the minimum Gibbs weight (N-uniform for $\\beta$ fixed)\n1879: - $\\varepsilon_A = 4d\\delta^2/L^2$ depends only on problem parameters $d, \\delta, L$",
      "metadata": {},
      "section": "## 5. Unified Single-Pair Lemma",
      "references": [],
      "raw_directive": "1795: :::\n1796: \n1797: :::{prf:proof}\n1798: **Step 1: Partition by Case**\n1799: \n1800: For any matched pair, either Case A or Case B occurs. By the law of total expectation:\n1801: $$\n1802: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] = \\mathbb{P}(\\text{Case A} \\mid M) \\cdot \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}, M, T]\n1803: $$\n1804: $$\n1805: + \\mathbb{P}(\\text{Case B} \\mid M) \\cdot \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}, M, T]\n1806: $$\n1807: \n1808: **Step 2: Apply Individual Case Bounds**\n1809: \n1810: From Lemma 5.1 (Case A):\n1811: $$\n1812: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}, M, T] \\leq D_{i\\pi(i)} + 4d\\delta^2 = D_{i\\pi(i)}(1 + \\varepsilon_A)\n1813: $$\n1814: \n1815: From Lemma 5.2 (Case B):\n1816: $$\n1817: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}, M, T] \\leq D_{i\\pi(i)}(1 - \\kappa_B) + C_W\n1818: $$\n1819: \n1820: **Step 3: Combine with Probabilities**\n1821: \n1822: $$\n1823: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq \\mathbb{P}(\\text{Case A}) \\cdot D_{i\\pi(i)}(1 + \\varepsilon_A)\n1824: $$\n1825: $$\n1826: + \\mathbb{P}(\\text{Case B}) \\cdot [D_{i\\pi(i)}(1 - \\kappa_B) + C_W]\n1827: $$\n1828: \n1829: Since $\\mathbb{P}(\\text{Case A}) + \\mathbb{P}(\\text{Case B}) = 1$:\n1830: $$\n1831: = D_{i\\pi(i)} \\left[1 - \\mathbb{P}(\\text{Case B}) \\kappa_B + \\mathbb{P}(\\text{Case A}) \\varepsilon_A\\right] + \\mathbb{P}(\\text{Case B}) C_W\n1832: $$\n1833: \n1834: Since $\\mathbb{P}(\\text{Case B}) \\leq 1$:\n1835: $$\n1836: \\leq D_{i\\pi(i)} \\left[1 - \\mathbb{P}(\\text{Case B}) \\kappa_B + \\mathbb{P}(\\text{Case A}) \\varepsilon_A\\right] + C_W\n1837: $$\n1838: \n1839: Defining:\n1840: $$\n1841: \\kappa_{\\text{pair}} := \\mathbb{P}(\\text{Case B}) \\kappa_B - \\mathbb{P}(\\text{Case A}) \\varepsilon_A\n1842: $$\n1843: \n1844: we obtain:\n1845: $$\n1846: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq (1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W\n1847: $$\n1848: \n1849: **Step 4: Apply Case B Frequency Lower Bound**\n1850: \n1851: From Lemma 4.6:\n1852: $$\n1853: \\mathbb{P}(\\text{Case B} \\mid M) \\geq f_{UH}(\\varepsilon) \\cdot q_{\\min}(\\varepsilon) > 0\n1854: $$\n1855: \n1856: Therefore:\n1857: $$\n1858: \\kappa_{\\text{pair}} \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B - \\varepsilon_A\n1859: $$\n1860: \n1861: **Step 5: Show Positivity for Large $L$**\n1862: \n1863: For $L > L_{\\min}(\\varepsilon)$ where $\\varepsilon_A = \\frac{4d\\delta^2}{L^2} < \\frac{\\kappa_B f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)}{2}$:\n1864: \n1865: $$\n1866: \\kappa_{\\text{pair}} \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B - \\frac{f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B}{2}\n1867: $$\n1868: \n1869: $$\n1870: = \\frac{f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) \\kappa_B}{2} > 0\n1871: $$\n1872: \n1873: **Step 6: Verify N-Uniformity**\n1874: \n1875: All components are N-uniform:\n1876: - $\\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2}$ where $p_u = \\exp(-\\beta \\Delta V_{\\max})/N \\cdot N = \\exp(-\\beta \\Delta V_{\\max})$ (N-independent)\n1877: - $f_{UH}(\\varepsilon)$ depends only on geometric separation $\\varepsilon$\n1878: - $q_{\\min}(\\varepsilon)$ is the minimum Gibbs weight (N-uniform for $\\beta$ fixed)\n1879: - $\\varepsilon_A = 4d\\delta^2/L^2$ depends only on problem parameters $d, \\delta, L$\n1880: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Unified Single-Pair Lemma"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-370",
      "title": null,
      "start_line": 1920,
      "end_line": 1975,
      "header_lines": [],
      "content_start": 1921,
      "content_end": 1974,
      "content": "1921: \n1922: :::{prf:proof}\n1923: **Step 1: Apply Theorem 5.3 Lower Bound**\n1924: \n1925: From Theorem 5.3, for $L > L_{\\min}(\\varepsilon)$ where $\\varepsilon_A < \\frac{\\kappa_B f_{UH} q_{\\min}}{2}$:\n1926: $$\n1927: \\kappa_{\\text{pair}} \\geq \\frac{\\kappa_B f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)}{2}\n1928: $$\n1929: \n1930: **Step 2: Expand $\\kappa_B$**\n1931: \n1932: From Lemma 5.2:\n1933: $$\n1934: \\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2}\n1935: $$\n1936: \n1937: Therefore:\n1938: $$\n1939: \\kappa_{\\text{pair}} \\geq \\frac{1}{2} \\cdot \\frac{p_u \\eta_{\\text{geo}}}{2} \\cdot f_{UH}(\\varepsilon) \\cdot q_{\\min}(\\varepsilon)\n1940: $$\n1941: \n1942: $$\n1943: = \\frac{1}{4} \\cdot p_u \\eta_{\\text{geo}} f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)\n1944: $$\n1945: \n1946: **Step 3: Substitute Component Bounds**\n1947: \n1948: From Lemma 4.6:\n1949: - $f_{UH}(\\varepsilon) \\geq \\varepsilon^2 / 4$ (proven via geometric overlap)\n1950: - $q_{\\min}(\\varepsilon) \\geq \\exp(-\\beta V_{\\max}) / Z$ (minimum Gibbs weight)\n1951: \n1952: From Lemma 4.3.7:\n1953: - $\\eta_{\\text{geo}} = \\frac{c_0^2}{2(1 + 2c_H)^2}$\n1954: \n1955: From Section 4.4:\n1956: - $p_u = \\exp(-\\beta \\Delta V_{\\max})$\n1957: \n1958: **Step 4: Concrete Numerical Estimate**\n1959: \n1960: For $\\varepsilon = 0.1$ (10% separation), $\\beta = 1$, $\\Delta V_{\\max} = 10$ (typical fitness range):\n1961: - $p_u = e^{-10} \\approx 4.5 \\times 10^{-5}$\n1962: - $\\eta_{\\text{geo}} \\approx c_0^2 / 4$ (assuming $c_H$ is small)\n1963: - $f_{UH}(0.1) \\geq 0.01 / 4 = 0.0025$\n1964: - $q_{\\min} \\geq e^{-V_{\\max}} / Z$ (depends on fitness landscape)\n1965: \n1966: Therefore:\n1967: $$\n1968: \\kappa_{\\text{pair}} \\geq \\frac{1}{4} \\cdot 4.5 \\times 10^{-5} \\cdot \\frac{c_0^2}{4} \\cdot 0.0025 \\cdot \\frac{e^{-V_{\\max}}}{Z}\n1969: $$\n1970: \n1971: While this numerical value is small, it is:\n1972: 1. **Strictly positive** (all factors are positive)\n1973: 2. **N-uniform** (no dependence on number of walkers $N$)\n1974: 3. **Stable** (all components are bounded away from zero by axioms)",
      "metadata": {},
      "section": "## 5. Unified Single-Pair Lemma",
      "references": [],
      "raw_directive": "1920: :::\n1921: \n1922: :::{prf:proof}\n1923: **Step 1: Apply Theorem 5.3 Lower Bound**\n1924: \n1925: From Theorem 5.3, for $L > L_{\\min}(\\varepsilon)$ where $\\varepsilon_A < \\frac{\\kappa_B f_{UH} q_{\\min}}{2}$:\n1926: $$\n1927: \\kappa_{\\text{pair}} \\geq \\frac{\\kappa_B f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)}{2}\n1928: $$\n1929: \n1930: **Step 2: Expand $\\kappa_B$**\n1931: \n1932: From Lemma 5.2:\n1933: $$\n1934: \\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2}\n1935: $$\n1936: \n1937: Therefore:\n1938: $$\n1939: \\kappa_{\\text{pair}} \\geq \\frac{1}{2} \\cdot \\frac{p_u \\eta_{\\text{geo}}}{2} \\cdot f_{UH}(\\varepsilon) \\cdot q_{\\min}(\\varepsilon)\n1940: $$\n1941: \n1942: $$\n1943: = \\frac{1}{4} \\cdot p_u \\eta_{\\text{geo}} f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon)\n1944: $$\n1945: \n1946: **Step 3: Substitute Component Bounds**\n1947: \n1948: From Lemma 4.6:\n1949: - $f_{UH}(\\varepsilon) \\geq \\varepsilon^2 / 4$ (proven via geometric overlap)\n1950: - $q_{\\min}(\\varepsilon) \\geq \\exp(-\\beta V_{\\max}) / Z$ (minimum Gibbs weight)\n1951: \n1952: From Lemma 4.3.7:\n1953: - $\\eta_{\\text{geo}} = \\frac{c_0^2}{2(1 + 2c_H)^2}$\n1954: \n1955: From Section 4.4:\n1956: - $p_u = \\exp(-\\beta \\Delta V_{\\max})$\n1957: \n1958: **Step 4: Concrete Numerical Estimate**\n1959: \n1960: For $\\varepsilon = 0.1$ (10% separation), $\\beta = 1$, $\\Delta V_{\\max} = 10$ (typical fitness range):\n1961: - $p_u = e^{-10} \\approx 4.5 \\times 10^{-5}$\n1962: - $\\eta_{\\text{geo}} \\approx c_0^2 / 4$ (assuming $c_H$ is small)\n1963: - $f_{UH}(0.1) \\geq 0.01 / 4 = 0.0025$\n1964: - $q_{\\min} \\geq e^{-V_{\\max}} / Z$ (depends on fitness landscape)\n1965: \n1966: Therefore:\n1967: $$\n1968: \\kappa_{\\text{pair}} \\geq \\frac{1}{4} \\cdot 4.5 \\times 10^{-5} \\cdot \\frac{c_0^2}{4} \\cdot 0.0025 \\cdot \\frac{e^{-V_{\\max}}}{Z}\n1969: $$\n1970: \n1971: While this numerical value is small, it is:\n1972: 1. **Strictly positive** (all factors are positive)\n1973: 2. **N-uniform** (no dependence on number of walkers $N$)\n1974: 3. **Stable** (all components are bounded away from zero by axioms)\n1975: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Unified Single-Pair Lemma"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-454",
      "title": null,
      "start_line": 2004,
      "end_line": 2021,
      "header_lines": [],
      "content_start": 2005,
      "content_end": 2020,
      "content": "2005: \n2006: :::{prf:proof}\n2007: For $L > L_0$, we have:\n2008: $$\n2009: \\varepsilon_A = \\frac{4d\\delta^2}{L^2} < \\frac{4d\\delta^2}{L_0^2} \\leq \\frac{4d\\delta^2}{4d\\delta^2 / (\\kappa_B f_{UH} q_{\\min})} = \\kappa_B f_{UH} q_{\\min}\n2010: $$\n2011: \n2012: From Theorem 5.3:\n2013: $$\n2014: \\kappa_{\\text{pair}} \\geq f_{UH} q_{\\min} \\kappa_B - \\varepsilon_A > f_{UH} q_{\\min} \\kappa_B - \\kappa_B f_{UH} q_{\\min} / 2 = \\frac{\\kappa_B f_{UH} q_{\\min}}{2}\n2015: $$\n2016: \n2017: Therefore, the contraction factor is:\n2018: $$\n2019: 1 - \\kappa_{\\text{pair}} \\leq 1 - \\frac{\\kappa_B f_{UH} q_{\\min}}{2}\n2020: $$",
      "metadata": {},
      "section": "## 5. Unified Single-Pair Lemma",
      "references": [],
      "raw_directive": "2004: :::\n2005: \n2006: :::{prf:proof}\n2007: For $L > L_0$, we have:\n2008: $$\n2009: \\varepsilon_A = \\frac{4d\\delta^2}{L^2} < \\frac{4d\\delta^2}{L_0^2} \\leq \\frac{4d\\delta^2}{4d\\delta^2 / (\\kappa_B f_{UH} q_{\\min})} = \\kappa_B f_{UH} q_{\\min}\n2010: $$\n2011: \n2012: From Theorem 5.3:\n2013: $$\n2014: \\kappa_{\\text{pair}} \\geq f_{UH} q_{\\min} \\kappa_B - \\varepsilon_A > f_{UH} q_{\\min} \\kappa_B - \\kappa_B f_{UH} q_{\\min} / 2 = \\frac{\\kappa_B f_{UH} q_{\\min}}{2}\n2015: $$\n2016: \n2017: Therefore, the contraction factor is:\n2018: $$\n2019: 1 - \\kappa_{\\text{pair}} \\leq 1 - \\frac{\\kappa_B f_{UH} q_{\\min}}{2}\n2020: $$\n2021: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 6,
        "chapter_file": "chapter_6.json",
        "section_id": "## 5. Unified Single-Pair Lemma"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-33",
      "title": null,
      "start_line": 2079,
      "end_line": 2092,
      "header_lines": [],
      "content_start": 2080,
      "content_end": 2091,
      "content": "2080: \n2081: :::{prf:proof}\n2082: By linearity of expectation:\n2083: \n2084: $$\n2085: \\begin{aligned}\n2086: \\mathbb{E}\\left[\\frac{1}{N} \\sum_{i=1}^N \\|x'_{1,i} - x'_{2,i}\\|^2 \\mid M\\right] &= \\frac{1}{N} \\sum_{k=1}^{N/2} \\mathbb{E}[\\|x'_{1,i_k} - x'_{2,i_k}\\|^2 + \\|x'_{1,j_k} - x'_{2,j_k}\\|^2 \\mid M] \\\\\n2087: &\\leq \\frac{1}{N} \\sum_{k=1}^{N/2} [\\gamma_{\\text{pair}}(\\|x_{1,i_k} - x_{2,i_k}\\|^2 + \\|x_{1,j_k} - x_{2,j_k}\\|^2) + C_{\\text{pair}}] \\\\\n2088: &= \\gamma_{\\text{pair}} \\cdot \\frac{1}{N} \\sum_{i=1}^N \\|x_{1,i} - x_{2,i}\\|^2 + C_{\\text{pair}} \\\\\n2089: &= \\gamma_{\\text{pair}} W_2^2(\\mu_{S_1}, \\mu_{S_2}) + C_{\\text{pair}}\n2090: \\end{aligned}\n2091: $$",
      "metadata": {},
      "section": "## 6. Sum Over Matching",
      "references": [
        "lem-single-pair-unified"
      ],
      "raw_directive": "2079: :::\n2080: \n2081: :::{prf:proof}\n2082: By linearity of expectation:\n2083: \n2084: $$\n2085: \\begin{aligned}\n2086: \\mathbb{E}\\left[\\frac{1}{N} \\sum_{i=1}^N \\|x'_{1,i} - x'_{2,i}\\|^2 \\mid M\\right] &= \\frac{1}{N} \\sum_{k=1}^{N/2} \\mathbb{E}[\\|x'_{1,i_k} - x'_{2,i_k}\\|^2 + \\|x'_{1,j_k} - x'_{2,j_k}\\|^2 \\mid M] \\\\\n2087: &\\leq \\frac{1}{N} \\sum_{k=1}^{N/2} [\\gamma_{\\text{pair}}(\\|x_{1,i_k} - x_{2,i_k}\\|^2 + \\|x_{1,j_k} - x_{2,j_k}\\|^2) + C_{\\text{pair}}] \\\\\n2088: &= \\gamma_{\\text{pair}} \\cdot \\frac{1}{N} \\sum_{i=1}^N \\|x_{1,i} - x_{2,i}\\|^2 + C_{\\text{pair}} \\\\\n2089: &= \\gamma_{\\text{pair}} W_2^2(\\mu_{S_1}, \\mu_{S_2}) + C_{\\text{pair}}\n2090: \\end{aligned}\n2091: $$\n2092: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 8,
        "chapter_file": "chapter_8.json",
        "section_id": "## 6. Sum Over Matching"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-21",
      "title": null,
      "start_line": 2118,
      "end_line": 2136,
      "header_lines": [],
      "content_start": 2119,
      "content_end": 2135,
      "content": "2119: \n2120: :::{prf:proof}\n2121: By the tower property of expectation:\n2122: \n2123: $$\n2124: \\mathbb{E}[W_2^2(\\mu_{S_1'}, \\mu_{S_2'})] = \\mathbb{E}_M[\\mathbb{E}[W_2^2(\\mu_{S_1'}, \\mu_{S_2'}) \\mid M]]\n2125: $$\n2126: \n2127: Using Proposition {prf:ref}`prop-matching-conditional-contraction`:\n2128: \n2129: $$\n2130: \\mathbb{E}_M[\\mathbb{E}[W_2^2 \\mid M]] \\leq \\mathbb{E}_M[\\gamma_{\\text{pair}} W_2^2(\\mu_{S_1}, \\mu_{S_2}) + C_{\\text{pair}}]\n2131: $$\n2132: \n2133: Since $W_2^2(\\mu_{S_1}, \\mu_{S_2})$ is deterministic given $S_1$ and $S_2$ (not random in $M$):\n2134: \n2135: $$",
      "metadata": {},
      "section": "## 7. Integration Over Matching Distribution",
      "references": [
        "prop-matching-conditional-contraction"
      ],
      "raw_directive": "2118: :::\n2119: \n2120: :::{prf:proof}\n2121: By the tower property of expectation:\n2122: \n2123: $$\n2124: \\mathbb{E}[W_2^2(\\mu_{S_1'}, \\mu_{S_2'})] = \\mathbb{E}_M[\\mathbb{E}[W_2^2(\\mu_{S_1'}, \\mu_{S_2'}) \\mid M]]\n2125: $$\n2126: \n2127: Using Proposition {prf:ref}`prop-matching-conditional-contraction`:\n2128: \n2129: $$\n2130: \\mathbb{E}_M[\\mathbb{E}[W_2^2 \\mid M]] \\leq \\mathbb{E}_M[\\gamma_{\\text{pair}} W_2^2(\\mu_{S_1}, \\mu_{S_2}) + C_{\\text{pair}}]\n2131: $$\n2132: \n2133: Since $W_2^2(\\mu_{S_1}, \\mu_{S_2})$ is deterministic given $S_1$ and $S_2$ (not random in $M$):\n2134: \n2135: $$\n2136: = \\gamma_{\\text{pair}} W_2^2(\\mu_{S_1}, \\mu_{S_2}) + C_{\\text{pair}} \\qquad \\Box",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 9,
        "chapter_file": "chapter_9.json",
        "section_id": "## 7. Integration Over Matching Distribution"
      }
    },
    {
      "directive_type": "proof",
      "label": "unlabeled-proof-178",
      "title": null,
      "start_line": 2358,
      "end_line": 2440,
      "header_lines": [],
      "content_start": 2359,
      "content_end": 2439,
      "content": "2359: \n2360: :::{prf:proof}\n2361: The proof proceeds in five steps, each corresponding to a major section:\n2362: \n2363: **Step 1: Synchronous Coupling Construction** (Section 1)\n2364: \n2365: By Proposition 1.1 and Remark 1.3, there exists a synchronous coupling of $(\\mu_1, \\mu_2)$ using:\n2366: - Shared randomness: Measurement outcomes $M$, thresholds $\\{T_i\\}$, jitter $\\{\\zeta_i\\}$\n2367: - Independent selections: Companions $\\{j_i^{(1)}\\}, \\{j_i^{(2)}\\}$ drawn from Gibbs matching\n2368: \n2369: This coupling is **sufficient** (though not necessarily optimal) for Wasserstein-2 contraction analysis.\n2370: \n2371: **Step 2: Outlier Alignment** (Section 2)\n2372: \n2373: By Lemma 2.2 (Outlier Alignment for Separated Swarms), for swarms with separation $L > D_{\\min}$:\n2374: - Each swarm has outliers pointing away from the other swarm\n2375: - These outliers have lower fitness (fitness valley between swarms)\n2376: - When cloned, they create a geometric advantage for Case B pairs\n2377: \n2378: This establishes the **geometric foundation** for contraction.\n2379: \n2380: **Step 3: Case A and Case B Analysis** (Sections 3-4)\n2381: \n2382: By Lemma 5.1 (Case A Weak Expansion):\n2383: $$\n2384: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] \\leq D_{i\\pi(i)} (1 + \\varepsilon_A)\n2385: $$\n2386: where $\\varepsilon_A = 4d\\delta^2 / L^2 = O(\\delta^2/L^2)$.\n2387: \n2388: By Lemma 5.2 (Case B Strong Contraction):\n2389: $$\n2390: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}] \\leq D_{i\\pi(i)} (1 - \\kappa_B) + C_W\n2391: $$\n2392: where $\\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2} = O(1)$ is independent of $L$.\n2393: \n2394: The key resolution of the scaling issue is:\n2395: - **Exact Distance Change Identity** (Proposition 4.3.6): $D_{ii} - D_{ji} = (N-1)\\|x_j - x_i\\|^2 + 2N\\langle x_j - x_i, x_i - \\bar{x}\\rangle$\n2396: - **High-Error Projection** (Lemma 4.3.7): $R_H \\geq c_0 L - c_1$\n2397: - **Combined**: $D_{ii} - D_{ji} \\sim L^2$, giving **O(1) contraction**\n2398: \n2399: **Step 4: Probability-Weighted Single-Pair Contraction** (Section 5)\n2400: \n2401: By Theorem 5.3 (Single-Pair Expected Contraction):\n2402: $$\n2403: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq (1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W\n2404: $$\n2405: \n2406: where:\n2407: $$\n2408: \\kappa_{\\text{pair}} = \\mathbb{P}(\\text{Case B}) \\kappa_B - \\mathbb{P}(\\text{Case A}) \\varepsilon_A\n2409: $$\n2410: \n2411: By Lemma 4.6 (Case B Frequency Lower Bound):\n2412: $$\n2413: \\mathbb{P}(\\text{Case B}) \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) > 0\n2414: $$\n2415: \n2416: For $L > L_0$, by Corollary 5.5:\n2417: $$\n2418: \\kappa_{\\text{pair}} \\geq \\frac{\\kappa_B f_{UH} q_{\\min}}{2} > 0\n2419: $$\n2420: \n2421: **Step 5: Sum Over All Pairs** (Section 7)\n2422: \n2423: By the synchronous coupling, the Wasserstein-2 distance is:\n2424: $$\n2425: W_2^2(\\mu_1, \\mu_2) = \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N \\|x_{1,i} - x_{2,\\pi(i)}\\|^2\\right]\n2426: $$\n2427: \n2428: Applying the single-pair bound to all pairs:\n2429: $$\n2430: W_2^2(\\Psi_{\\text{clone}}(\\mu_1), \\Psi_{\\text{clone}}(\\mu_2)) = \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T]\\right]\n2431: $$\n2432: \n2433: $$\n2434: \\leq \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N [(1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W]\\right]\n2435: $$\n2436: \n2437: $$\n2438: = (1 - \\kappa_{\\text{pair}}) W_2^2(\\mu_1, \\mu_2) + C_W\n2439: $$",
      "metadata": {},
      "section": "## 8. Main Wasserstein-2 Contraction Theorem",
      "references": [],
      "raw_directive": "2358: We now assemble the complete proof by citing the key results from Sections 1-7.\n2359: \n2360: :::{prf:proof}\n2361: The proof proceeds in five steps, each corresponding to a major section:\n2362: \n2363: **Step 1: Synchronous Coupling Construction** (Section 1)\n2364: \n2365: By Proposition 1.1 and Remark 1.3, there exists a synchronous coupling of $(\\mu_1, \\mu_2)$ using:\n2366: - Shared randomness: Measurement outcomes $M$, thresholds $\\{T_i\\}$, jitter $\\{\\zeta_i\\}$\n2367: - Independent selections: Companions $\\{j_i^{(1)}\\}, \\{j_i^{(2)}\\}$ drawn from Gibbs matching\n2368: \n2369: This coupling is **sufficient** (though not necessarily optimal) for Wasserstein-2 contraction analysis.\n2370: \n2371: **Step 2: Outlier Alignment** (Section 2)\n2372: \n2373: By Lemma 2.2 (Outlier Alignment for Separated Swarms), for swarms with separation $L > D_{\\min}$:\n2374: - Each swarm has outliers pointing away from the other swarm\n2375: - These outliers have lower fitness (fitness valley between swarms)\n2376: - When cloned, they create a geometric advantage for Case B pairs\n2377: \n2378: This establishes the **geometric foundation** for contraction.\n2379: \n2380: **Step 3: Case A and Case B Analysis** (Sections 3-4)\n2381: \n2382: By Lemma 5.1 (Case A Weak Expansion):\n2383: $$\n2384: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case A}] \\leq D_{i\\pi(i)} (1 + \\varepsilon_A)\n2385: $$\n2386: where $\\varepsilon_A = 4d\\delta^2 / L^2 = O(\\delta^2/L^2)$.\n2387: \n2388: By Lemma 5.2 (Case B Strong Contraction):\n2389: $$\n2390: \\mathbb{E}[D'_{i\\pi(i)} \\mid \\text{Case B}] \\leq D_{i\\pi(i)} (1 - \\kappa_B) + C_W\n2391: $$\n2392: where $\\kappa_B = \\frac{p_u \\eta_{\\text{geo}}}{2} = O(1)$ is independent of $L$.\n2393: \n2394: The key resolution of the scaling issue is:\n2395: - **Exact Distance Change Identity** (Proposition 4.3.6): $D_{ii} - D_{ji} = (N-1)\\|x_j - x_i\\|^2 + 2N\\langle x_j - x_i, x_i - \\bar{x}\\rangle$\n2396: - **High-Error Projection** (Lemma 4.3.7): $R_H \\geq c_0 L - c_1$\n2397: - **Combined**: $D_{ii} - D_{ji} \\sim L^2$, giving **O(1) contraction**\n2398: \n2399: **Step 4: Probability-Weighted Single-Pair Contraction** (Section 5)\n2400: \n2401: By Theorem 5.3 (Single-Pair Expected Contraction):\n2402: $$\n2403: \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T] \\leq (1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W\n2404: $$\n2405: \n2406: where:\n2407: $$\n2408: \\kappa_{\\text{pair}} = \\mathbb{P}(\\text{Case B}) \\kappa_B - \\mathbb{P}(\\text{Case A}) \\varepsilon_A\n2409: $$\n2410: \n2411: By Lemma 4.6 (Case B Frequency Lower Bound):\n2412: $$\n2413: \\mathbb{P}(\\text{Case B}) \\geq f_{UH}(\\varepsilon) q_{\\min}(\\varepsilon) > 0\n2414: $$\n2415: \n2416: For $L > L_0$, by Corollary 5.5:\n2417: $$\n2418: \\kappa_{\\text{pair}} \\geq \\frac{\\kappa_B f_{UH} q_{\\min}}{2} > 0\n2419: $$\n2420: \n2421: **Step 5: Sum Over All Pairs** (Section 7)\n2422: \n2423: By the synchronous coupling, the Wasserstein-2 distance is:\n2424: $$\n2425: W_2^2(\\mu_1, \\mu_2) = \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N \\|x_{1,i} - x_{2,\\pi(i)}\\|^2\\right]\n2426: $$\n2427: \n2428: Applying the single-pair bound to all pairs:\n2429: $$\n2430: W_2^2(\\Psi_{\\text{clone}}(\\mu_1), \\Psi_{\\text{clone}}(\\mu_2)) = \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N \\mathbb{E}[D'_{i\\pi(i)} \\mid M, T]\\right]\n2431: $$\n2432: \n2433: $$\n2434: \\leq \\mathbb{E}_\\pi \\left[\\frac{1}{N} \\sum_{i=1}^N [(1 - \\kappa_{\\text{pair}}) D_{i\\pi(i)} + C_W]\\right]\n2435: $$\n2436: \n2437: $$\n2438: = (1 - \\kappa_{\\text{pair}}) W_2^2(\\mu_1, \\mu_2) + C_W\n2439: $$\n2440: ",
      "_registry_context": {
        "stage": "directives",
        "document_id": "04_wasserstein_contraction_ASSEMBLED",
        "chapter_index": 10,
        "chapter_file": "chapter_10.json",
        "section_id": "## 8. Main Wasserstein-2 Contraction Theorem"
      }
    }
  ]
}